function SitemapController(_,$scope,$state,$q,CommentsService,PagesService,UsabilityTestService,Settings,editorSocket,EscapeHtmlService,PreviewNavigation,SitemapService,AnalyticsService,Engine,hotkeys,CanvasContainerHeight){"use strict";var KEY_CODES=keysEnums.KEY_CODES,PAGE_CHANGED_EVENT="Preview - Navigation - page changed",PAGE_CHANGE_CONFLICT_EVENT="Preview - Navigation - page changed - keyboard error",goToPage=function(pageId){CanvasContainerHeight.saveHeightFromDom();var currentState=$state.current.name;$state.go(currentState,{pageId:PagesService.getPageByBreakpoint(pageId)})},goToPrevPage=function(){var prevPageId=PagesService.getPrevPageId();prevPageId&&(Engine.isPageWithKeyboardActions()?AnalyticsService.kissEvent(PAGE_CHANGE_CONFLICT_EVENT):(goToPage(prevPageId),AnalyticsService.kissEvent(PAGE_CHANGED_EVENT,{Keyboard:!0})))},goToNextPage=function(){var nextPageId=PagesService.getNextPageId();nextPageId&&(Engine.isPageWithKeyboardActions()?AnalyticsService.kissEvent(PAGE_CHANGE_CONFLICT_EVENT):(goToPage(nextPageId),AnalyticsService.kissEvent(PAGE_CHANGED_EVENT,{Keyboard:!0})))};$scope.isVisible=function(){return PreviewNavigation.isPanelVisible(PreviewNavigation.PREVIEW_PANELS.SITEMAP)},$scope.isActive=function(id){return PagesService.currentPageId===PagesService.getPageByBreakpoint(id)},$scope.isIndent=function(){var isIndent=!1;return PagesService.pagesTree.nodes?(PagesService.pagesTree.nodes.forEach(function(node){if(node.nodes.length)return isIndent=!0,!1}),isIndent):isIndent},$scope.onClick=function(e,id){goToPage(id),AnalyticsService.kissEvent(PAGE_CHANGED_EVENT,{Sitemap:!0})},$scope.focusInput=function(){$scope.searchData.focused=!0},$scope.keyDown=function(e){var keyCode=e.keyCode;e.stopPropagation(),keyCode===KEY_CODES.ESC&&(_.isEmpty($scope.searchData.searchFor)?$scope.searchData.focused=!1:$scope.searchData.searchFor=""),keyCode===KEY_CODES.ENTER&&e.preventDefault()},$scope.comparatorSearch=function(actual){return!!_.isEmpty($scope.searchData.searchFor)||recursiveSearch(actual)},$scope.init=function(id){Settings.minimized.indexOf(String(id))===-1?$scope.minimized[id]=!0:angular.isUndefined($scope.minimized[id])&&($scope.minimized[id]=!1)},$scope.toggleMinimized=function(id){if($scope.minimized[id]){var index=Settings.minimized.indexOf(String(id));Settings.minimized.splice(index,1)}else Settings.minimized.push(String(id));Settings.updateMinimized()};var recursiveSearch=function(id){var i,page=PagesService.pagesMap[id],children=PagesService.pagesChildrenMap[id];if(search(page.name,$scope.searchData.searchFor))return!0;if(children)for(i=0;i<children.length;i++)if(recursiveSearch(children[i]))return!0;return!1},search=function(where,what){return where.toLocaleLowerCase().indexOf(what.toLocaleLowerCase())!==-1};$scope.searchData={searchFor:"",focused:!1},$scope.tree=PagesService.pagesTree.nodes,$scope.treeMapped=SitemapService.mapTree($scope.tree),$scope.filterSearch={id:null},$scope.minimized={},$scope.isSitemapAvailable=!0,$scope.isMessageVisible=!0,$scope.message="Waiting for participant",$scope.shouldHideSitemap=$scope.tree&&$scope.tree.length<=1&&!$scope.tree[0].nodes.length,UsabilityTestService.isSession()&&!$scope.shouldHideSitemap?$scope.isSitemapAvailable=UsabilityTestService.getMyData().settings[LiveShare.enums.ROOM_SETTINGS.SEE_SITEMAP]:$scope.shouldHideSitemap&&(PreviewNavigation.disablePanel(PreviewNavigation.PREVIEW_PANELS.SITEMAP),$scope.isSitemapAvailable=!1),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,function(){$scope.$apply(function(){UsabilityTestService.isHostSession()||($scope.isSitemapAvailable=UsabilityTestService.getMyData().settings[LiveShare.enums.ROOM_SETTINGS.SEE_SITEMAP],$scope.isSitemapAvailable||(PreviewNavigation.setActivePanels(null),PreviewNavigation.disablePanel(PreviewNavigation.PREVIEW_PANELS.SITEMAP)))})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.OPTIONS_CHANGED,function(data){data.key===LiveShare.enums.ROOM_SETTINGS.SEE_SITEMAP&&$scope.$apply(function(){UsabilityTestService.isHostSession()&&$scope.shouldHideSitemap||($scope.isSitemapAvailable=data.val,$scope.isSitemapAvailable?(PreviewNavigation.enablePanel(PreviewNavigation.PREVIEW_PANELS.SITEMAP),PreviewNavigation.setActivePanels([PreviewNavigation.PREVIEW_PANELS.SITEMAP])):(PreviewNavigation.setActivePanels(null),PreviewNavigation.disablePanel(PreviewNavigation.PREVIEW_PANELS.SITEMAP)))})});var resetSitemap=function(){return PagesService.getPages().then(function(){var d=$q.defer();return $scope.tree=PagesService.pagesTree.nodes,$scope.treeMapped=SitemapService.mapTree($scope.tree),$scope.shouldHideSitemap?(PreviewNavigation.disablePanel(PreviewNavigation.PREVIEW_PANELS.SITEMAP),$scope.isSitemapAvailable=!1):(PreviewNavigation.enablePanel(PreviewNavigation.PREVIEW_PANELS.SITEMAP),$scope.isSitemapAvailable=!0),d.resolve(),d.promise})};editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_CREATE,resetSitemap),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_UPDATE,resetSitemap),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_REORDER,resetSitemap),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_DOCUMENTATION_SET,resetSitemap),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_DELETE,function(){resetSitemap().then(function(){angular.isUndefined(PagesService.pagesMap[PagesService.currentPageId])&&$scope.onClick(null,PagesService.rootPageId)})}),hotkeys.bindTo($scope).add({combo:"left",description:"Go to previous page",callback:goToPrevPage}).add({combo:"right",description:"Go to next page",callback:goToNextPage})}!function(global){"use strict";var FormEvents={wrapperSelector:".preview-container",dispatchFormEvent:function(e,additionalData){if(LIVE_SHARE&&LIVE_SHARE.eventDispatcher)try{LIVE_SHARE.eventDispatcher.handleEvent(e,_.extend({selector:this.getElementUniqueSelector(e.target),time:+new Date},additionalData||{}))}catch(e){return void console.error(e)}},getElementUniqueSelector:function(el){var path=[];do{if(el.id){/^el[0-9]+\_/.test(el.id)?path.unshift("[id^=el"+this.getIdByElement(el)+"_]"):path.unshift("#"+el.id);break}path.unshift(el.nodeName.toLowerCase()+(el.className?"."+el.className.replace(" ","."):""))}while("html"!==el.nodeName.toLowerCase()&&(el=el.parentNode));return path.join(">")}};LIVE_SHARE&&(FormEvents=_.extend(LIVE_SHARE.FormEvents,FormEvents)),global.FormEvents=FormEvents}(window),function(global){"use strict";var Interactions=function(){return{active_node_id:"canvas-wrapper",scrolls:[],scrollable_els:null,loading_el:null,getSelector:function(elementId,trigger,event){return!elementId||"keydown"===event.type&&"canvas"===elementId?"window":"hover"===trigger&&"mouseleave"===event.type?"#"+this.active_node_id:"[data-id='"+elementId+"']"},handleEvent:function(elementId,trigger,event){if("load"!==event&&"scroll"!==event.type){if(LIVE_SHARE&&LIVE_SHARE.eventDispatcher){var selector=this.getSelector(elementId,trigger,event);"hover"===trigger&&"mouseleave"===event.type&&(event=new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,view:window}));try{LIVE_SHARE.eventDispatcher.handleEvent(event,{selector:selector})}catch(err){return void console.error(err)}}var target_node_name=event.target?event.target.nodeName.toLowerCase():null;if(!(event.keyCode&&["input","textarea","select"].indexOf(target_node_name)>-1)){if("click"===event.type){if("label"===target_node_name)return;if("input"===target_node_name&&["checkbox","radio"].indexOf(event.target.getAttribute("type").toLowerCase())>-1)return}_.isFunction(event.preventDefault)&&event.preventDefault()}}}}}();global.MD5=md5,global.Interactions=_.extend(Interactions,FormEvents)}(window),function(global){"use strict";var Preview=function(){var _animation,FADE_IN_DURATION=.1,FADE_OUT_DURATION=.15,HIGHLIGHT_DURATION=.45,isHighlighted=!1,onScroll=function(e){for(var scrollTop=0,scrollLeft=0,i=0,l=Interactions.scrollable_els.length;i<l;i++)scrollTop+=Interactions.scrollable_els[i].scrollTop,scrollLeft+=Interactions.scrollable_els[i].scrollLeft;_.forEach(this.mFixedElems,function(fixed){fixed.style.top=scrollTop+parseInt(fixed.originalTop)+"px",fixed.style.left=scrollLeft+parseInt(fixed.originalLeft)+"px"}.bind(this))},parseLinks=function(hrefs){var pages;_.forEach(hrefs,function(href){pages=/\/([\d]+)c?d?m?$/g.exec(href.href),pages&&pages.length&&(href.onclick=function(pageId){return function(e){e.preventDefault(),Preview.gotoPage(pageId)}}(pages[1]))})},copyStyle=function(companion,interactive){var interactiveDomElement=interactive.view.domElement,interactiveTransform=getInteractiveDomElementTransform(interactive),border=parseInt(interactiveDomElement.style.borderWidth),width="canvas"===interactive.id?interactiveDomElement.style.width:interactive.width+"px",height="canvas"===interactive.id?interactiveDomElement.style.height:interactive.height+"px";companion.style.transform=interactiveTransform,companion.style.transformOrigin="inherit",companion.style.width=width,companion.style.height=height,companion.style.position="absolute",border&&(companion.style.width=parseInt(interactiveDomElement.style.width)+2*border+"px",companion.style.height=parseInt(interactiveDomElement.style.height)+2*border+"px")},getInteractiveDomElementTransform=function(interactive){var interactiveDomElement=interactive.view.domElement,interactiveDomElementTransform=document.defaultView.getComputedStyle(interactiveDomElement).transform;return(interactive.parent&&interactive.parent.isMultistate()||!interactiveDomElementTransform||"none"===interactiveDomElementTransform)&&(interactiveDomElementTransform="translate("+interactive.x+"px, "+interactive.y+"px) rotate("+interactive.angle+"deg)"),interactiveDomElementTransform},animate=function(container,companion){TweenLite.to(companion,FADE_IN_DURATION,{className:"+=visible-highlighted"}),TweenLite.to(companion,FADE_OUT_DURATION,{className:"-=visible-highlighted",delay:HIGHLIGHT_DURATION,onComplete:removeHighlight.bind(this,container,companion)})},removeHighlight=function(container,companion){isHighlighted=!1,container.removeChild(companion)},getElementsWithInteractions=function(elements,elementsWithInteractions){var interactives=elementsWithInteractions||[];return _.each(elements,function(element){element.isVisible()&&!_.isEmpty(element.getAllActions())&&interactives.push(element),_.isEmpty(element.children)||getElementsWithInteractions(element.children,interactives)}),interactives},highlight=function(page){if(!isHighlighted){var companion,interactives=getElementsWithInteractions([page.getCanvas()]),canvasNode=document.querySelector(".ng-canvas");isHighlighted=!0,_.forEach(interactives,function(interactive){companion=document.createElement("DIV"),companion.className="interactive highlighted companion",copyStyle(companion,interactive),animate(canvasNode,companion),canvasNode.appendChild(companion)})}},clearTimeouts=function(){if(Interactions.timeouts)for(;Interactions.timeouts.length;)clearTimeout(Interactions.timeouts.pop())},initFixed=function(){if(this.mFixedElems=document.querySelectorAll(".FixedPos"),_.forEach(this.mFixedElems,function(fixed){fixed.originalTop=fixed.style.top,fixed.originalLeft=fixed.style.left}),!this.onScroll&&Interactions.scrollable_els){this.onScroll=onScroll.bind(this);for(var i=0,l=Interactions.scrollable_els.length;i<l;i++)Interactions.scrollable_els[i].addEventListener("scroll",this.onScroll)}},parseNavigationHrefs=function(){parseLinks(document.querySelector("section.preview-container").querySelectorAll("a"))},parsePageLinks=function(){var arr,hrefs=document.querySelectorAll('[onclick^="location"]');_.forEach(hrefs,function(href){angular.isFunction(href.onclick)&&(arr=/\/([\d]+)c?d?m?\'/g.exec(href.onclick.toString()),arr&&arr.length>1&&(href.onclick=function(pageId){return function(e){e.preventDefault(),Preview.gotoPage(pageId)}}(arr[1])))})},initDocument=function(container,cb){if("W"!==ApplicationConfiguration.project.type&&!ApplicationConfiguration.isDesignSystem){_.forEach(container.querySelectorAll("textarea, input"),function(el){el.setAttribute("readonly","readonly"),el.removeAttribute("placeholder")});var margin;_.forEach(container.querySelectorAll("textarea"),function(el){margin=el.classList.contains("type-text")||"quote"===el.id?15:el.classList.contains("block")?13:0,autoGrow(el,{margin:margin})})}},autoGrow=function(el,options){options.minHeight=0,options.maxHeight=0;var style=window.getComputedStyle(el),dummy=document.createElement("div");dummy.style.overflowX="hidden",dummy.style.position="absolute",dummy.style.top=0,dummy.style.left="-9999px",dummy.style.whiteSpace="pre-wrap",dummy.style.fontSize=style.fontSize,dummy.style.fontFamily=style.fontFamily,dummy.style.fontStyle=style.fontStyle,dummy.style.fontVariant=style.fontVariant,dummy.style.fontWeight=style.fontWeight,dummy.style.width=style.width,dummy.style.lineHeight=style.lineHeight,dummy.style.padding=style.padding,document.body.appendChild(dummy);var html=el.value.replace(/\n|\r\n/g,"<br>X")+"X";if(dummy&&dummy.innerHTML.toLowerCase()!==html.toLowerCase()){dummy.innerHTML=html;var triggerHeight=dummy.getBoundingClientRect().height+options.margin,newHeight=Math.max(options.minHeight,triggerHeight);options.maxHeight&&newHeight>options.maxHeight&&(newHeight=options.maxHeight),el.clientHeight!==newHeight&&(el.style.height=newHeight+"px")}};return{mFixedElems:null,onScroll:null,highlightInteractive:function(page){highlight(page)},onLoadPage:function(container,cb){initDocument(container,cb),initFixed.call(this),parseNavigationHrefs(),parsePageLinks()},onChangePage:function(){clearTimeouts();var i;if(isHighlighted=!1,Interactions.loading_el=null,this.onScroll&&Interactions.scrollable_els){for(i=0;i<Interactions.scrollable_els.length;i++)Interactions.scrollable_els[i].removeEventListener("scroll",this.onScroll);this.onScroll=null}if(Interactions.scrolls)for(;Interactions.scrolls.length;)for(i=0;i<Interactions.scrollable_els.length;i++)Interactions.scrollable_els[i].removeEventListener("scroll",Interactions.scrolls.pop())},gotoPage:function(pageUrl,animation){if(pageUrl.match(/^http/))window.location=pageUrl;else{var pageId=parseInt(pageUrl.replace(/.*\/(\d+)c?d?m?$/,"$1"));angular.element(document.getElementById("page-controller")).scope().gotoPage(pageId)}},setAnimation:function(animation){_animation=animation},getAnimation:function(){return _animation}}}();global.Preview=Preview}(window),function(global){"use strict";function socketWildcard(Emitter){function onevent(packet){var args=packet.data||[];return null!=packet.id&&args.push(this.ack(packet.id)),emit.call(this,"*",packet),emit.apply(this,args)}var emit=Emitter.prototype.emit;return function(socket,next){return socket.onevent!==onevent&&(socket.onevent=onevent),next?next():null}}global.SocketServiceHelper=function(socketUrl,$rootScope,wildcard){if("undefined"==typeof io)return{on:angular.noop,emit:angular.noop};var socket=io.connect(socketUrl,{reconnectionAttempts:/\.dev$/.test(global.location.host)?1:50,reconnectionDelay:2e3,reconnectionDelayMax:1e4,randomizationFactor:.5});if(wildcard){var patch=socketWildcard(io.Manager);patch(socket)}return{on:function(eventName,callback){socket.on(eventName,function(){var args=arguments;$rootScope.$apply(function(){angular.isFunction(callback)&&callback.apply(socket,args)})})},emit:function(eventName,data,callback){socket.emit(eventName,data,function(){var args=arguments;$rootScope.$apply(function(){angular.isFunction(callback)&&callback.apply(socket,args)})})}}}}(window),function(global){"use strict";var configuration=function(){var applicationModuleName="uxpin-preview",applicationModuleVendorDependencies=["restangular","ui.router","pascalprecht.translate","LocalStorageModule","ngclipboard","custom.ui.bootstrap","youtube-embed","ngSanitize","angulartics","angulartics.google.analytics","ngCookies","cfp.hotkeys","duScroll"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule,project:{hash:0}}}();global.ApplicationConfiguration=_.defaults(global.ApplicationConfiguration||{},configuration)}(window),function(angular){"use strict";angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])})}(window.angular),ApplicationConfiguration.registerModule("comments"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("designSystem"),ApplicationConfiguration.registerModule("documentation"),ApplicationConfiguration.registerModule("specification"),ApplicationConfiguration.registerModule("styleguide"),function(){"use strict";var VALUES={TEAM:"team",PUBLIC:"public"};angular.module("comments").constant("COMMENT_TYPES",{VALUES:VALUES,BASIC_OPTIONS:[{value:VALUES.PUBLIC,text:"Public comment",className:"comment-public"}],ALL_OPTIONS:[{value:VALUES.PUBLIC,text:"Public comment",className:"comment-public"},{value:VALUES.TEAM,text:"Team comment",className:"comment-team"}],STORAGE_KEYS:{LAST_USED_COMMENT_TYPE:"lastUsedCommentType"}})}(),function(){"use strict";var TYPE_VALUES={PUBLIC_COMMENTS:"publicComments",TEAM_COMMENTS:"teamComments"};angular.module("comments").constant("COMMENTS_FILTER",{TYPE_VALUES:TYPE_VALUES,ALL_TYPE_OPTIONS:[{value:TYPE_VALUES.PUBLIC_COMMENTS,text:"Public",hint:"P",className:"comment-public",shortcut:["shift","alt","p"]},{value:TYPE_VALUES.TEAM_COMMENTS,text:"Team",hint:"T",className:"comment-team",shortcut:["shift","alt","t"]}],STORAGE_KEYS:{TYPE_FILTER:"commentTypeFilter"}})}(),function(){"use strict";function CommentsFiltersCtrl(AssignHelper,UsersService,CommentsSettings,PreviewNavigation){function isVisible(){return PreviewNavigation.isPanelVisible(PreviewNavigation.PREVIEW_PANELS.FILTERS)}var vm=this;vm.isAssignmentActive=AssignHelper.isAssignmentActive(),vm.isCommentTypeActive=CommentsSettings.commentTypesActive(),vm.isAnonymous=UsersService.isAnonymous(),vm.isVisible=isVisible}angular.module("comments").controller("CommentsFiltersCtrl",CommentsFiltersCtrl),CommentsFiltersCtrl.$inject=["AssignHelper","UsersService","CommentsSettings","PreviewNavigation"]}(),function(){"use strict";function CommentsNotesCtrl(_,$rootScope,$scope,$sce,CommentsService,CommentsFilter,PagesService,UsersService,BreakpointsService,ProjectsService,Settings,ScrollService,PreviewNavigation,CommentsListApi,CommentsTreeApi){function activate(){vm.minItemHeight=UsersService.isAnonymous()?MIN_ITEM_HEIGHT.ANONYMOUS:MIN_ITEM_HEIGHT.LOGGED,onPanelsChange=$rootScope.$on(PreviewEnums.ON_PANEL_CHANGED,handlePanelChange),$scope.$on("$destroy",onPanelsChange)}function handlePanelChange(){shouldInitComments()&&initComments()}function shouldInitComments(){return vm.isVisible()&&!vm.areCommentsInitialized}function initComments(){vm.areCommentsInitialized=!0,getComments().then(initCommentsEvents)}function initCommentsEvents(){onComments=$scope.$watchCollection("vm.comments",handleCommentsChange),onCommentsFilterChange=$rootScope.$on(PreviewEnums.ON_COMMENTS_FILTER_CHANGE,update),onCommentTypeUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,update),onCommentAssignedUserUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_ASSIGNED_USER_UPDATE,update),onLoadingComments=$rootScope.$on(PreviewEnums.LOADING_COMMENTS,handleLoadingComments),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,handleSelectComment),onAssignmentListOpen=$rootScope.$on(PreviewEnums.ON_ASSIGNMENT_LIST_OPEN,handleAssignmentOpen),onPageLoaded=$rootScope.$on(PreviewEnums.ON_PAGE_LOADED,handlePageLoaded),onShowCommentsResolvedChanged=$rootScope.$on(PreviewEnums.ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED,handleShowResolvedChange),$scope.$on("$destroy",destroyCommentsEvents)}function destroyCommentsEvents(){onLoadingComments(),onSelectComment(),onComments(),onShowCommentsResolvedChanged(),onCommentsFilterChange(),onCommentTypeUpdate(),onCommentAssignedUserUpdate(),onAssignmentListOpen(),onPageLoaded()}function handleCommentsChange(newValue){newValue&&update()}function handleLoadingComments(event,value){vm.showCurrentPageOnly&&(vm.loading=value)}function handleSelectComment(event,id,type){id&&"canvas"===type&&(vm.showCurrentPageOnly?CommentsListApi.scrollTo(vm.commentsListId,id):CommentsTreeApi.scrollTo(vm.commentsListId,id))}function handleShowResolvedChange(event,value){vm.showResolved=value,update()}function handleAssignmentOpen(event,elementId,type){"panel"===type&&ScrollService.scrollToElement(vm.commentsListId,elementId)}function handlePageLoaded(){vm.showCurrentPageOnly&&CommentsListApi.reloadList(vm.commentsListId)}function isVisible(){return PreviewNavigation.isPanelVisible(PreviewNavigation.PREVIEW_PANELS.COMMENTS)}function addNewComment(){PreviewNavigation.isModeActive(PreviewNavigation.PREVIEW_MODES.COMMENT)||PreviewNavigation.setActiveMode(PreviewNavigation.PREVIEW_MODES.COMMENT)}function onShowCurrentPageOnly(){getComments()}function getPageName(id){var page=PagesService.pagesMap[id];return null===page.version_of?page.name:PagesService.pagesMap[page.version_of].name}function getBreakpointName(id){return $sce.trustAsHtml(BreakpointsService.breakpointsMap[id].name)}function showBreakpoints(){return breakpoints.length>1}function handleSearch(searchText){CommentsService.searchFor=searchText,$rootScope.$emit("searchComments"),update()}function search(where,what){return where.toLocaleLowerCase().indexOf(what.toLocaleLowerCase())!==-1}function testResolved(comment){return vm.showResolved||!comment.resolved.is}function testBreakpoint(comment){return vm.isDocument||!vm.showCurrentPageOnly||PagesService.pagesMap[comment.id_page].version_type===PagesService.currentBreakpointId}function testSearch(comment){if(!vm.searchFor)return!0;var child,id=comment._id,showChild=!1,found=!1,comments=CommentsService.commentsTree[id];if(comments&&comments.forEach(function(childId){if(child=CommentsService.commentsMap[childId],search(child.comment,vm.searchFor))return showChild=!0,!1}),found=search(comment.comment,vm.searchFor)||showChild||!vm.showCurrentPageOnly&&search(vm.getPageName(comment.id_page),vm.searchFor),!vm.showCurrentPageOnly){var pageId=PagesService.pagesMap[comment.id_page].version_of||comment.id_page;found&&CommentsTreeApi.isPageHidden(vm.commentsListId,pageId)&&CommentsTreeApi.togglePage(vm.commentsListId,pageId)}return found}function canDisplayComment(comment){return!comment._parent_comment&&testResolved(comment)&&testBreakpoint(comment)&&testSearch(comment)}function update(){vm.showCurrentPageOnly?buildList():buildTree()}function buildList(){vm.list=[],_.forEach(vm.comments,function(comment){CommentsFilter.canDisplayComment(comment)&&canDisplayComment(comment)&&vm.list.push(comment)})}function buildTree(){var page;vm.tree=[],_.forEach(pagesBreakpoints,function(breakpointIds,pageId){page=getPage(pageId,breakpointIds),_.isEmpty(page.breakpoints)||vm.tree.push(page)})}function getPage(pageId,breakpointIds){var breakpoint,page={id:pageId,name:getPageName(pageId),breakpoints:[]};return _.forEach(breakpointIds,function(breakpointPageId,breakpointId){breakpoint=getBreakpoint(breakpointId,breakpointPageId),_.isEmpty(breakpoint.comments)||page.breakpoints.push(breakpoint)}),page}function getBreakpoint(breakpointId,pageId){var comment,breakpoint={id:breakpointId,name:getBreakpointName(breakpointId),comments:[]};return _.forEach(commentIdsInPage[pageId],function(commentId){comment=CommentsService.commentsMap[commentId],CommentsFilter.canDisplayComment(comment)&&canDisplayComment(comment)&&breakpoint.comments.push(comment)}),breakpoint}function getComments(){return vm.loading=!0,CommentsService.getComments(vm.showCurrentPageOnly).then(function(comments){vm.loading=!1,vm.comments=comments,commentIdsInPage=CommentsService.commentIdsInPage,pagesBreakpoints=PagesService.pagesBreakpoints,breakpoints=PagesService.breakpointIds})}var commentIdsInPage,pagesBreakpoints,breakpoints,onPanelsChange,onComments,onCommentsFilterChange,onCommentTypeUpdate,onCommentAssignedUserUpdate,onLoadingComments,onSelectComment,onShowCommentsResolvedChanged,onAssignmentListOpen,onPageLoaded,MIN_ITEM_HEIGHT={LOGGED:120,ANONYMOUS:70},vm=this;vm.commentsListId="comments-list",vm.showResolved=Settings.showResolvedComments,vm.isDocument=ProjectsService.isDocument(),vm.showCurrentPageOnly=Settings.showCurrentPageOnly||vm.isDocument,vm.searchFor=CommentsService.searchFor,vm.areCommentsInitialized=!1,vm.loading=!0,vm.tree=[],vm.list=[],vm.minItemHeight=0,vm.isVisible=isVisible,vm.addNewComment=addNewComment,vm.onShowCurrentPageOnly=onShowCurrentPageOnly,vm.getPageName=getPageName,vm.getBreakpointName=getBreakpointName,vm.showBreakpoints=showBreakpoints,vm.handleSearch=handleSearch,activate()}angular.module("comments").controller("CommentsNotesCtrl",CommentsNotesCtrl),CommentsNotesCtrl.$inject=["_","$rootScope","$scope","$sce","CommentsService","CommentsFilter","PagesService","UsersService","BreakpointsService","ProjectsService","Settings","ScrollService","PreviewNavigation","CommentsListApi","CommentsTreeApi"]}(),angular.module("comments").directive("addComment",[function(){"use strict";return{restrict:"A",scope:!1,link:function(scope,element){var isChildOf=function(childElement,parentClass){for(;childElement&&childElement!==element[0];){if(childElement.classList&&childElement.classList.contains(parentClass))return!0;childElement=childElement.parentNode}return!1},isValidCommentLocation=function(e){return!isChildOf(e.target,PreviewEnums.COMMENT_POINT_CLASS)&&!isChildOf(e.target,"comments-group")};element.on("click",function(e){scope.commentMode&&isValidCommentLocation(e)&&(scope.onAddCommentClick(e),e.stopPropagation())})}}}]),function(){"use strict";function CommentsFilter(CommentsFilterSettings,COMMENTS_FILTER,COMMENT_TYPES){function canDisplayComment(comment){return _.every([validateType(comment),validateAssignment(comment)])}function canDisplayCanvasComment(comment){return CommentsFilterSettings.getPinsVisibility()&&canDisplayComment(comment)}function validateType(comment){var typeFilters=CommentsFilterSettings.getTypeFilters();return!!(typeFilters.indexOf(TYPE_FILTERS.PUBLIC_COMMENTS)!==-1&&isPublic(comment)||typeFilters.indexOf(TYPE_FILTERS.TEAM_COMMENTS)!==-1&&isTeam(comment))}function validateAssignment(comment){var isDisabled=CommentsFilterSettings.isAssignmentFilterDisabled(),assignmentFilter=CommentsFilterSettings.getAssignmentFilter();return!!isDisabled||(_.isNull(assignmentFilter)?!comment.assignedUserId:assignmentFilter.indexOf(parseInt(comment.assignedUserId))!==-1)}function isPublic(comment){return!comment.type||comment.type===TYPES.PUBLIC}function isTeam(comment){return comment.type===TYPES.TEAM}var TYPES=COMMENT_TYPES.VALUES,TYPE_FILTERS=COMMENTS_FILTER.TYPE_VALUES;return{canDisplayComment:canDisplayComment,canDisplayCanvasComment:canDisplayCanvasComment,validateType:validateType,validateAssignment:validateAssignment}}angular.module("comments").factory("CommentsFilter",CommentsFilter),CommentsFilter.$inject=["CommentsFilterSettings","COMMENTS_FILTER","COMMENT_TYPES"]}(),function(){"use strict";function CommentsFilterSettings($rootScope,CommentsSettings,localStorageService,AnalyticsService,COMMENTS_FILTER,ApprovalsService,_){function isAssignmentFilterDisabled(){return filters.assignment===DISABLED}function getPinsVisibility(){return pinsVsibility}function setPinsVisibility(value){pinsVsibility=value,$rootScope.$emit(PreviewEnums.ON_COMMENTS_FILTER_CHANGE)}function disableAssignmentFilter(){setAssignmentFilter(DISABLED)}function getAssignmentFilter(){return filters.assignment}function setAssignmentFilter(value){filters.assignment=value,$rootScope.$emit(PreviewEnums.ON_COMMENTS_FILTER_CHANGE)}function getTypeFilterOptions(){return CommentsSettings.commentTypesActive()?COMMENTS_FILTER.ALL_TYPE_OPTIONS:[]}function getAllCommentsType(){return COMMENTS_FILTER.ALL_TYPE_OPTIONS.map(function(type){return type.value})}function getTypeFilters(){return ApprovalsService.getIsActive()?getAllCommentsType():(filters.types||(filters.types=getLastUsedTypeFilter()),filters.types||getAllCommentsType())}function setTypeFilters(value){filters.types=value,setLastUsedTypeFilter(value),$rootScope.$emit(PreviewEnums.ON_COMMENTS_FILTER_CHANGE),AnalyticsService.event(PreviewEnums.KM_EVENTS.VIEW_MODE_SET,{"Type of View Mode":filters.types.join(", ")})}function getLastUsedTypeFilter(){var lastUsedTypeFilters=localStorageService.get(COMMENTS_FILTER.STORAGE_KEYS.TYPE_FILTER);return isValidTypeFilter(lastUsedTypeFilters)?lastUsedTypeFilters:null}function setLastUsedTypeFilter(value){localStorageService.set(COMMENTS_FILTER.STORAGE_KEYS.TYPE_FILTER,value)}function isValidTypeFilter(filters){var commentsType=getAllCommentsType();return!!_.isArray(filters)&&filters.every(function(filter){return commentsType.indexOf(filter)!==-1})}var DISABLED="disabled",filters={types:null,assignment:DISABLED},pinsVsibility=!0;return{isAssignmentFilterDisabled:isAssignmentFilterDisabled,disableAssignmentFilter:disableAssignmentFilter,getAssignmentFilter:getAssignmentFilter,setAssignmentFilter:setAssignmentFilter,getTypeFilterOptions:getTypeFilterOptions,getPinsVisibility:getPinsVisibility,setPinsVisibility:setPinsVisibility,getTypeFilters:getTypeFilters,setTypeFilters:setTypeFilters,DISABLED:DISABLED}}angular.module("comments").factory("CommentsFilterSettings",CommentsFilterSettings),CommentsFilterSettings.$rootScope=["$rootScope","CommentsSettings","localStorageService","AnalyticsService","COMMENTS_FILTER","ApprovalsService","_"]}(),function(){"use strict";function CommentsSettings(UsersService,FeatureToggler,localStorageService,COMMENT_TYPES){function commentTypesActive(){return FeatureToggler.teamComments&&UsersService.isInProjectsAccount()}function getCommentTypeOptions(){return commentTypesActive()?COMMENT_TYPES.ALL_OPTIONS:COMMENT_TYPES.BASIC_OPTIONS}function getLastUsedCommentType(){return localStorageService.get(COMMENT_TYPES.STORAGE_KEYS.LAST_USED_COMMENT_TYPE)}function setLastUsedCommentType(commentType){localStorageService.set(COMMENT_TYPES.STORAGE_KEYS.LAST_USED_COMMENT_TYPE,commentType)}return{commentTypes:COMMENT_TYPES.VALUES,commentTypesActive:commentTypesActive,getCommentTypeOptions:getCommentTypeOptions,getLastUsedCommentType:getLastUsedCommentType,setLastUsedCommentType:setLastUsedCommentType}}angular.module("comments").factory("CommentsSettings",CommentsSettings),CommentsSettings.$inject=["UsersService","FeatureToggler","localStorageService","COMMENT_TYPES"]}(),function(){"use strict";function CommentsState(){return{groupInEditModeId:null,selectedGroupId:null}}angular.module("comments").factory("CommentsState",CommentsState)}(),function(){"use strict";function commentTooltip($document,$rootScope,PreviewNavigation){return{restrict:"A",scope:!1,link:function(scope,element){var $tooltipElement,textDefault="Click to add comment",textAdding="Click to reposition the comment",tooltip={element:'<span class="comment-tooltip">'+textDefault+"</span>",offset:5},overflowedPage=$document[0].querySelector("[overflowed-page]"),$body=$document.find("body").eq(0),posX=0,posY=0,handleMouseMove=function(e){var scrollX=0,scrollY=0;overflowedPage&&"auto"!==overflowedPage.style.overflow&&(scrollX=overflowedPage.scrollLeft,scrollY=overflowedPage.scrollTop),posX=Math.round(e.clientX+tooltip.offset+scrollX),posY=Math.round(e.clientY+tooltip.offset+scrollY),$tooltipElement&&($tooltipElement.css("top",posY+"px"),$tooltipElement.css("left",posX+"px"))},addTooltip=function(){$tooltipElement||($tooltipElement=angular.element(tooltip.element),$body.append($tooltipElement))},removeTooltip=function(){$tooltipElement&&($tooltipElement.remove(),$tooltipElement=null)},onElementMouseMove=function(e){scope.commentMode&&!scope.dragging&&(changeText(scope.addingComment?textAdding:textDefault),
handleMouseMove(e),e.stopPropagation())},onModeChanged=function(){PreviewNavigation.isModeActive(PreviewNavigation.PREVIEW_MODES.COMMENT)?(element.on("mouseenter",addTooltip),element.on("mouseleave",removeTooltip),element.on("mousemove",onElementMouseMove)):(element.off("mouseenter",addTooltip),element.off("mouseleave",removeTooltip),element.off("mousemove",onElementMouseMove),removeTooltip())},changeText=function(text){$tooltipElement&&$tooltipElement[0].textContent!==text&&($tooltipElement[0].textContent=text)},onModeChangedOff=$rootScope.$on(PreviewEnums.ON_PREVIEW_MODE_CHANGED,onModeChanged),onAddingCommentChange=$rootScope.$on(PreviewEnums.ADDING_COMMENT,function(){changeText(textAdding)}),onDeselectCommentChange=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(event,id){changeText(null===id?textDefault:textAdding)});scope.$on("$destroy",function(){onModeChangedOff(),onAddingCommentChange(),onDeselectCommentChange()})}}}angular.module("comments").directive("commentTooltip",commentTooltip),commentTooltip.$inject=["$document","$rootScope","PreviewNavigation"]}(),function(){"use strict";function CommentsService(_,$q,$rootScope,Rest,UsersService,ProjectsService,PagesService,DocumentsService,ExportService,AnalyticsService,Settings,editorSocket,CommentsSettings,ApprovalsService,RestWithCache,PreviewCache,moment){function _getPageComments(projectHash,pageId){var collection,d;if(ExportService.isExport())return d=$q.defer(),d.resolve([]),d.promise;collection=Settings.showCurrentPageOnly?RestWithCache.one("projects",projectHash).one("pages",pageId):Rest.one("projects",projectHash);var query={};return ApprovalsService.getIsActive()&&(query={"stakeholder[id]":ApplicationConfiguration.stakeholder.id}),collection.all("comments").getList(query)}function addComment(comment){var d=$q.defer();return this.getComments().then(function(){Rest.all("comments").post(comment).then(function(response){AnalyticsService.trackComment(comment),AnalyticsService.event(PreviewEnums.KM_EVENTS.COMMENT_ADDED,{"Type of Comment":comment.type}),this.applyAddComment(response,{updateCommentsModelOnly:!1}),d.resolve(response),editorSocket.emit(PreviewEnums.SOCKET.ON_COMMENT_CREATE,response),PreviewCache.removeComments(ProjectsService.currentProjectHash,PagesService.currentPageId)}.bind(this),function(error){d.reject(error)})}.bind(this)),d.promise}function getComments(isPageLimited){return ProjectsService.isDocument()?this.getDocumentComments():this.getPageComments(isPageLimited)}function getPageComments(isPageLimited){var pageId=PagesService.currentPageId,projectHash=ProjectsService.currentProjectHash;return this.isCached(isPageLimited,pageId)?this.commentsCached.promise:(this.pageId=pageId,Settings.setShowCurrentPageOnly(angular.isUndefined(isPageLimited)?Settings.showCurrentPageOnly:isPageLimited),this.commentsCached=$q.defer(),_getPageComments(projectHash,pageId).then(function(comments){for(;this.comments.length;)this.comments.pop();comments.forEach(function(comment){this.comments.push(comment)}.bind(this)),this.sort(this.comments),this.generateCommentsMap(this.comments),this.generateCommentsTree(this.comments),this.commentsCached.resolve(this.comments)}.bind(this)),this.commentsCached.promise)}function getDocumentComments(){var collection,documentId=DocumentsService.currentDocumentId,projectHash=ProjectsService.currentProjectHash;return this.commentsCached?this.commentsCached.promise:(this.documentId=documentId,this.commentsCached=$q.defer(),collection=Rest.one("projects",projectHash).one("documents",documentId),collection.all("comments").getList().then(function(comments){for(;this.comments.length;)this.comments.pop();comments.forEach(function(comment){this.comments.push(comment)}.bind(this)),this.sort(this.comments),this.generateCommentsMap(this.comments),this.generateCommentsTree(this.comments),this.commentsCached.resolve(this.comments)}.bind(this)),this.commentsCached.promise)}function getComment(id){var d=$q.defer();return this.getComments().then(function(comments){comments.forEach(function(comment){comment._id===id&&d.resolve(comment)})}),d.promise}function updateCommentType(id,type){return Rest.one("comments",id).customPUT({type:type}).then(function(res){return type!==CommentsSettings.commentTypes.PUBLIC||_.isEmpty(this.commentsTree[id])||(res.children=_.map(this.commentsTree[id],function(childId){return this.commentsMap[childId]}.bind(this))),editorSocket.emit(PreviewEnums.SOCKET.ON_COMMENT_TYPE_UPDATE,res),PreviewCache.removeComments(ProjectsService.currentProjectHash,PagesService.currentPageId),this.applyUpdateCommentType(id,type),AnalyticsService.event(PreviewEnums.KM_EVENTS.COMMENT_TYPE_CHANGED,{"Type of Comment":type}),res}.bind(this))}function updateCommentContent(id,content,mentions){var payload={comment:content,mentions:mentions};return ApprovalsService.getIsActive()&&(payload.stakeholder={id:UsersService.me.id_user}),Rest.one("comments",id).customPUT(payload).then(function(res){return editorSocket.emit(PreviewEnums.SOCKET.ON_COMMENT_CONTENT_UPDATE,res),PreviewCache.removeComments(ProjectsService.currentProjectHash,PagesService.currentPageId),this.applyUpdateCommentContent(id,content),AnalyticsService.event(PreviewEnums.KM_EVENTS.EDITED_COMMENTS),res}.bind(this))}function updateAssginedUser(id,assignedUserId){return Rest.one("comments",id).customPUT({assignedUserId:assignedUserId}).then(function(res){editorSocket.emit(PreviewEnums.SOCKET.ON_COMMENT_ASSIGNED_USER_UPDATE,res),PreviewCache.removeComments(ProjectsService.currentProjectHash,PagesService.currentPageId),this.applyUpdateAssignedUser(id,assignedUserId)}.bind(this))}function updateComment(id,properties){var d=$q.defer(),shouldEmitCommentChange=_.isUndefined(properties.is_read)||1!==Object.keys(properties).length;return this.getComment(id).then(function(){ApprovalsService.getIsActive()&&(properties.stakeholder={id:UsersService.me.id_user}),Rest.one("comments",id).customPUT(properties).then(function(response){shouldEmitCommentChange&&(editorSocket.emit(PreviewEnums.SOCKET.ON_COMMENT_UPDATE,response),PreviewCache.removeComments(ProjectsService.currentProjectHash,PagesService.currentPageId)),this.applyUpdateComment(id,response).then(function(){d.resolve(response)})}.bind(this),function(error){d.reject(error)})}.bind(this)),d.promise}function updateCommentResolve(id,isResolved){return this.updateComment(id,{is_resolved:isResolved}).then(function(res){this.applyUpdateCommentResolve(id,res)}.bind(this))}function applyUpdateCommentResolve(id,data){this.getComments().then(function(comments){this.sort(comments),$rootScope.$emit(PreviewEnums.SORT_COMMENTS)}.bind(this)),$rootScope.$emit(PreviewEnums.RESOLVE_COMMENT,id,data.resolved.is)}function deleteComment(id){var d=$q.defer(),headers={"Content-Type":"application/json;charset=utf-8"},payload={id:id};return ApprovalsService.getIsActive()&&(payload.stakeholder={id:UsersService.me.id_user}),this.getComment(id).then(function(){Rest.one("comments",id).customDELETE(void 0,void 0,headers,payload).then(function(response){this.applyDeleteComment(response),editorSocket.emit(PreviewEnums.SOCKET.ON_COMMENT_DELETE,response),PreviewCache.removeComments(ProjectsService.currentProjectHash,PagesService.currentPageId),d.resolve(response)}.bind(this))}.bind(this)),d.promise}function fastDeletOnExit(id){Rest.one("comments",id).remove(),editorSocket.emit(PreviewEnums.SOCKET.ON_COMMENT_DELETE,this.commentsMap[id])}function applyAddComment(data,options){ApprovalsService.getIsActive()&&data.type===CommentsSettings.commentTypes.PUBLIC||(this.addToCommentsTree(data),this.addToCommentsMap(data),this.addToCommentIdsInPage(data),_.find(this.comments,{_id:data._id})||this.comments.push(data),options&&!options.updateCommentsModelOnly&&$rootScope.$emit(PreviewEnums.ADD_COMMENT,data._id,data._parent_comment))}function applyUpdateCommentType(id,type){this.getComment(id).then(function(comment){comment.type=type,$rootScope.$emit(PreviewEnums.ON_COMMENT_TYPE_UPDATE,id,type)})}function applyUpdateCommentContent(id,content){this.getComment(id).then(function(comment){comment.comment=content,$rootScope.$emit(PreviewEnums.ON_COMMENT_CONTENT_UPDATE,id,content)})}function applyUpdateAssignedUser(id,assignedUserId){this.getComment(id).then(function(comment){comment.assignedUserId=assignedUserId,$rootScope.$emit(PreviewEnums.ON_COMMENT_ASSIGNED_USER_UPDATE,id,assignedUserId)})}function applyUpdateComment(id,data){var d=$q.defer();return this.getComment(id).then(function(comment){var changeResolved=comment.resolved.is!==data.resolved.is;_.forIn(data.plain(),function(value,key){comment[key]=value}),changeResolved&&(this.getComments().then(function(comments){this.sort(comments),$rootScope.$emit(PreviewEnums.SORT_COMMENTS)}.bind(this)),$rootScope.$emit(PreviewEnums.RESOLVE_COMMENT,id,data.resolved.is)),d.resolve(comment)}.bind(this),function(error){d.reject(error)}),d.promise}function applyDeleteComment(comment){this.removeFromCommentsMap(comment),this.removeFromCommentIdsInPage(comment),this.removeFromCommentsTree(comment),this.removeById(comment._id),$rootScope.$emit(PreviewEnums.DELETE_COMMENT,comment._id,!!comment._parent_comment)}function getIndex(pageId,id){return id?this.commentIdsInPage[pageId].indexOf(id)+1:this.commentIdsInPage[pageId]?this.commentIdsInPage[pageId].length+1:1}function isLoved(comment){var isLoved=!1;return _.forEach(comment.lovers,function(lover){if(lover.id_user===UsersService.me.id_user)return isLoved=!0,!1}),isLoved}function canEdit(comment){return!comment.user.is_anonymous&&comment.user.id===UsersService.me.id_user||ApprovalsService.getIsActive()&&comment.user.id===UsersService.me.id_user||UsersService.me.is_owner}function canEditContent(comment){return!comment.user.is_anonymous&&comment.user.id===UsersService.me.id_user||ApprovalsService.getIsActive()&&comment.user.id===UsersService.me.id_user}function isCached(isPageLimited,pageId){return this.commentsCached&&(pageId===this.pageId||!Settings.showCurrentPageOnly)&&(angular.isUndefined(isPageLimited)||isPageLimited===Settings.showCurrentPageOnly)}function isGroup(id){return!!this.commentsTree[id]}function sort(comments){comments.sort(function(c1,c2){return c1.resolved.is&&!c2.resolved.is?1:!c1.resolved.is&&c2.resolved.is?-1:moment(c1.created_at)<moment(c2.created_at)?-1:1}),this.generateCommentIdsInPage(comments)}function generateCommentsTree(comments){_.forIn(this.commentsTree,function(value,key){delete this.commentsTree[key]}.bind(this)),comments.forEach(function(comment){this.addToCommentsTree(comment)}.bind(this))}function addToCommentsTree(comment){var pageId=comment.id_page?comment.id_page:comment.id_document;(PagesService.pagesMap[pageId]||ProjectsService.isDocument())&&comment._parent_comment&&(this.commentsTree[comment._parent_comment]||(this.commentsTree[comment._parent_comment]=[]),_.indexOf(this.commentsTree[comment._parent_comment],comment._id)===-1&&this.commentsTree[comment._parent_comment].push(comment._id))}function removeFromCommentsTree(comment){if(comment._parent_comment){var comments=this.commentsTree[comment._parent_comment],index=comments.indexOf(comment._id);comments.splice(index,1),comments.length||delete this.commentsTree[comment._parent_comment]}else this.commentsTree[comment._id]&&(_.forEach(this.commentsTree[comment._id],function(id){this.removeById(this.commentsMap[id]),this.removeFromCommentsMap(this.commentsMap[id])}.bind(this)),delete this.commentsTree[comment._id])}function generateCommentIdsInPage(comments){_.forIn(this.commentIdsInPage,function(value){for(;value.length;)value.pop()}),comments.forEach(function(comment){this.addToCommentIdsInPage(comment)}.bind(this))}function addToCommentIdsInPage(comment){var pageId=comment.id_page?comment.id_page:comment.id_document;(PagesService.pagesMap[pageId]||ProjectsService.isDocument())&&(comment._parent_comment||(this.commentIdsInPage[pageId]||(this.commentIdsInPage[pageId]=[]),_.indexOf(this.commentIdsInPage[pageId],comment._id)===-1&&this.commentIdsInPage[pageId].push(comment._id)))}function removeFromCommentIdsInPage(comment){if(!comment._parent_comment){var pageId=comment.id_page?comment.id_page:comment.id_document,index=this.commentIdsInPage[pageId].indexOf(comment._id);index>=0&&this.commentIdsInPage[pageId].splice(index,1)}}function generateCommentsMap(comments){_.forIn(this.commentsMap,function(value,key){delete this.commentsMap[key]}.bind(this)),comments.forEach(function(comment){this.addToCommentsMap(comment)}.bind(this))}function addToCommentsMap(comment){var pageId=comment.id_page?comment.id_page:comment.id_document;(PagesService.pagesMap[pageId]||ProjectsService.isDocument())&&(this.commentsMap[comment._id]=comment)}function removeFromCommentsMap(comment){delete this.commentsMap[comment._id]}function markAsRead(id){this.updateComment(id,{is_read:!0})}function getRedirectId(commentId){return this.commentsMap[commentId]?this.commentsMap[commentId]._parent_comment?this.commentsMap[commentId]._parent_comment:commentId:null}function findById(commentId,returnIndex){var index=-1;return this.comments.some(function(comment,i){return comment._id===commentId&&(index=i,!0)}),returnIndex?index:this.comments[index]}function removeById(commentId){var index=this.findById(commentId,!0);index>=0&&this.comments.splice(index,1)}return{commentsCached:null,comments:[],commentsMap:{},commentsTree:{},commentIdsInPage:{},pageId:null,selectedCommentId:null,selectedCommentShowNotificationPanel:!1,searchFor:"",addComment:addComment,getComments:getComments,getPageComments:getPageComments,getDocumentComments:getDocumentComments,getComment:getComment,updateCommentResolve:updateCommentResolve,updateCommentType:updateCommentType,updateCommentContent:updateCommentContent,updateAssignedUser:updateAssginedUser,updateComment:updateComment,deleteComment:deleteComment,fastDeletOnExit:fastDeletOnExit,applyAddComment:applyAddComment,applyUpdateCommentResolve:applyUpdateCommentResolve,applyUpdateCommentType:applyUpdateCommentType,applyUpdateCommentContent:applyUpdateCommentContent,applyUpdateAssignedUser:applyUpdateAssignedUser,applyUpdateComment:applyUpdateComment,applyDeleteComment:applyDeleteComment,getIndex:getIndex,isLoved:isLoved,canEdit:canEdit,canEditContent:canEditContent,isCached:isCached,isGroup:isGroup,sort:sort,generateCommentsTree:generateCommentsTree,addToCommentsTree:addToCommentsTree,removeFromCommentsTree:removeFromCommentsTree,generateCommentIdsInPage:generateCommentIdsInPage,addToCommentIdsInPage:addToCommentIdsInPage,removeFromCommentIdsInPage:removeFromCommentIdsInPage,generateCommentsMap:generateCommentsMap,addToCommentsMap:addToCommentsMap,removeFromCommentsMap:removeFromCommentsMap,markAsRead:markAsRead,getRedirectId:getRedirectId,findById:findById,removeById:removeById}}angular.module("comments").factory("CommentsService",CommentsService),CommentsService.$inject=["_","$q","$rootScope","Rest","UsersService","ProjectsService","PagesService","DocumentsService","ExportService","AnalyticsService","Settings","editorSocket","CommentsSettings","ApprovalsService","RestWithCache","PreviewCache","moment"]}(),angular.module("core").config(["$compileProvider",function($compileProvider){"use strict";$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|data|file|blob):/)}]),function(){"use strict";function config($stateProvider,$urlRouterProvider,$compileProvider){if($compileProvider.debugInfoEnabled(ApplicationConfiguration.debugInfoEnabled),!ApplicationConfiguration.isStyleguide&&!ApplicationConfiguration.isDesignSystem){"W"===ApplicationConfiguration.project.type?$urlRouterProvider.otherwise("/pages").when("/pages","/pages/{pageId}").when("/pages/{pageId}/usability-test/","/pages/{pageId}/usability-test/1"):$urlRouterProvider.otherwise(function($injector){var $state=$injector.get("$state");$state.go("home.document")});var isCommentMode=function($q,$stateParams,PreviewNavigation){var d=$q.defer();return $stateParams.previewMode===PreviewNavigation.PREVIEW_MODES.COMMENT?d.resolve(!0):d.reject(!1),d.promise},isAuthenticated=function(UsersService,$location){if(UsersService.me.is_anonymous)return $location.path("/")};$stateProvider.state("home",{url:"",abstract:!0,views:{"":{templateUrl:"/scripts/modules/core/views/home.view.html",controller:function(){}},comments:{templateUrl:"/scripts/modules/comments/views/commentsNotes.view.html",controller:"CommentsNotesCtrl",controllerAs:"vm"},filters:{templateUrl:"/scripts/modules/comments/views/commentsFilters.view.html",controller:"CommentsFiltersCtrl",controllerAs:"vm"},sitemap:{templateUrl:"/scripts/modules/core/views/sitemap.view.html",controller:"SitemapController"},specification:{templateUrl:"/scripts/modules/specification/views/specification.view.html",controller:"SpecificationController",controllerAs:"vm"},documentation:{templateUrl:"/scripts/modules/documentation/views/documentation.view.html",controller:"DocumentationController",controllerAs:"vm"},canvas:{templateUrl:"/scripts/modules/core/views/canvas.view.html",controller:"CanvasController"},breadcrumbs:{templateUrl:"/scripts/modules/core/views/breadcrumbs.view.html",controller:"BreadcrumbsController"},topBar:{templateUrl:"/scripts/modules/core/views/topBar.view.html",controller:"TopBarController",controllerAs:"vm"},"approvalProcess@home":{templateUrl:"/scripts/modules/core/views/approvalProcess/approvalProcessControls.view.html",controller:"ApprovalProcessController",controllerAs:"vm"},tasks:{templateUrl:"/scripts/modules/core/views/tasks.view.html",controller:"UsabilityTestTasksController"},layers:{templateUrl:"/scripts/modules/core/views/layers.view.html",controller:"LayersController",controllerAs:"vm"}},resolve:{collaborators:function($q,UsersService){return UsersService.getCollaborators()},documents:function($q,DocumentsService,ProjectsService){var d=$q.defer();return ProjectsService.isDocument()?DocumentsService.getDocuments():(d.resolve(null),d.promise)},notifications:function(NotificationsService){return NotificationsService.getNotifications()},isMobile:function(){return"mobile"===new UAParser(navigator.userAgent).getDevice().type}}}).state("home.page",{url:"/pages/{pageId}?mode",template:'<div id="page-controller" ui-view></div>',controller:"PageController",resolve:{initialData:function($stateParams,ProjectsService,PreloadService,PagesService,BreakpointsService){return ProjectsService.isDocument()?Promise.resolve(null):PreloadService.getInitialData($stateParams.pageId).then(function(initialData){return Promise.all([PagesService.getPages(),BreakpointsService.getBreakpoints()]).then(function(data){return{redirectToPageId:initialData.redirect?initialData.pageId:null,pages:data[0],breakpoints:data[1]}})})}}}).state("home.page.live-share-configuration",{url:"/live-presentation-configuration",controller:function($modal){$modal.open({templateUrl:"/scripts/modules/core/views/liveShare/configuration.view.html",controller:"LiveShareConfigurationController"})},resolve:{isAuthenticated:isAuthenticated}}).state("home.page.live-share-start",{url:"/live-presentation-start?options&type",templateUrl:"/scripts/modules/core/views/liveShare/initialize.view.html",controller:"LiveShareInitializeCtrl",resolve:{isAuthenticated:isAuthenticated}}).state("home.page.live-share-join",{url:"/live-presentation-join/{sessionId}?type",templateUrl:"/scripts/modules/core/views/liveShare/initialize.view.html",controller:"LiveShareInitializeCtrl"}).state("home.page.live-share-finish",{url:"/live-presentation-finish/{type}/",templateUrl:"/scripts/modules/core/views/liveShare/finish.view.html",controller:"LiveShareFinishController"}).state("home.page.usability-test",{url:"/usability-test/{step:[1-5]{1}}",controller:"UsabilityTestController",resolve:{isAuthenticated:isAuthenticated}}).state("home.page.usability-test-video-upload",{url:"/usability-test-video-upload",templateUrl:"/scripts/modules/core/views/usabilityTest/videoUpload.view.html",controller:"VideoUploadCtrl",controllerAs:"vm"}).state("home.page.mode",{url:"/{previewMode}/{panels}",controller:"NavController",params:{panels:{value:"",squash:!0}}}).state("home.page.mode.comment",{url:"/{commentId}",resolve:{isCommentMode:isCommentMode}}).state("home.document",{url:"/documents/{documentId}?mode",template:'<div id="document-controller" ui-view></div>',controller:"DocumentController"}).state("home.document.mode",{url:"/{previewMode}/{panels}",controller:"NavController",params:{panels:{value:"",squash:!0}}}).state("home.document.mode.comment",{url:"/{commentId}",resolve:{isCommentMode:isCommentMode}})}}angular.module("core").config(config),config.$inject=["$stateProvider","$urlRouterProvider","$compileProvider"]}(),angular.module("core").config(["$translateProvider",function($translateProvider){"use strict";$translateProvider.preferredLanguage("en"),$translateProvider.translations("en",{BTN_REPLY:"Reply",BTN_RESOLVE:"Resolve",BTN_UNRESOLVE:"Unresolve",BTN_DELETE:"Delete",BTN_ADD_COMMENT:"Add comment",BTN_NOTIFY:"Notify those people",BTN_ADD_USER:"Notify also",BTN_SEND_NOTIFICATION:"Send notification",BTN_UNDO:"Undo",LBL_COMMENTS:"Comments",LBL_NOTES:"Notes",LBL_SHOW_RESOLVED:"Show resolved comments",LBL_CURRENT_PAGE:"Current page only",LBL_SEARCH:"Search",LBL_RESOLVED:"Resolved",INFO_DELETED:"You've deleted this comment.",INFO_NO_COMMENTS:"There are no comments yet.",INFO_ADD_FIRST:"Add first comment",INFO_ENTER_COMMENT_MODE:"Enter comment mode",INFO_ADD_FIRST_NOTE:"Add your first note",INFO_NO_NOTES:"This is your private notepad.\nNo one can see it.",INFO_SEARCH:"Search in comments",INFO_SEARCH_SITEMAP:"Type here to search",INFO_FEEDBACK:"Put your feedback",TIP_COMMENT_MODE:"Comment mode",TIP_ADD_NEW_COMMENT:"Add new comment",TIP_COLLABORATION:"Collaboration",TIP_COMMENTS_NOTES:"Comments / Notes",TIP_SITEMAP:"Sitemap",TIP_LIVE_SHARE:"Start Live Presentation",TIP_SPECIFICATION:"Enter spec mode",TIP_USABILITY_TEST:"Create usability test",TIP_RESOLVE:"Resolve",TIP_DELETE:"Delete",TIP_CANT_DELETE:"Only owner can delete his comments",TIP_FINISH_SESSION:"Finish session",LOVE_IT:"Love it",DONT_LOVE_IT:"Love it not",RESOLVED_BY:"Resolved by {{name}}",LS_OPTION_CAN_COMMENT:"Viewers can comment during session",LS_OPTION_SHOW_CURSOR:"Show viewers' cursors",LS_OPTION_FOLLOW_CURSOR:"Viewers always follow my cursor",LS_OPTION_DISABLE_VOICE:"Disable voice calls",LS_SESSION_QUIT:"You left {{projectName}} session. Redirecting to preview...",LS_SESSION_BANNED:"You've been banned from {{projectName}}.",LS_SESSION_OVER:"{{projectName}} session is over.",LS_SESSION_404:"No session found.",LS_USERS:"Live Presentation users",LS_FOLLOW_CURSOR:"Follow cursor",LS_SETTINGS:"Live Presentation settings",LS_SESSION_SETTINGS:"Session settings",LS_LINK_TO_SESSION:"Link to session",LS_LINK_HAS_BEEN_COPIED:"Link has been copied to your clipboard!",LS_TOGGLE_MUTE:"Toggle mute",LS_COPY:"Copy",LS_LEAVE_SESSION:"Leave session",LS_NAME_SHARING:"Live Presentation session",LS_NAME_TESTING:"usability test",LS_BACK_TO_PREVIEW:"Back to preview",UT_INTRODUCTION_TEXT:"Hello {Name of the participant}, thank you for coming. My name is {your name} and Im a researcher for {name of the product}  Im going to walk you through the session today.\n\nBefore well start I have some information for you.\n\nWere currently testing {name of the product} to learn as much as we can about the way people use it. Every product is intended to work in a certain way by its creators, but as you know  the reality might be quite different. The goal of this research is to get us as close to the reality as possible.\n\nThe session will take about an hour.\n\nPlease remember, during the next hour, that were testing {name of the product} not you. Dont worry at all about mistakes. If they happen, its the fault of the product. Finding about it is absolutely fantastic and gets us closer to creating a great product.\n\nDuring the whole test, please try to think out loud. Share anything thats in your head. Tell me what you are looking at on the screen, what your thoughts are, what you like and what dont you like, et cetera. We want to learn about your honest reactions to {name of the product}.\n\nIf you have any doubts during the test, feel free to ask me any questions. However, please remember that I might not be able to answer them during the test. We want to learn about your experience with {name of the product}, so I cant guide you. Ill be glad to answer all your questions after the test.\n\nWith your permission, were going to record the session. Well record your voice, face and actions on the screen  that will give us the full picture of the session for further analysis. Were not going to share these recordings outside of the team directly working on {name of the product}.\n\nIf you dont mind, Id like to ask you to sign this permission form. It simply states that you give us the permission to record the session and that were going to secure this data and make it available only to the team working on {name of the product}.\n\nAlso, I hope you dont mind, but Im going to take notes. It helps me with analyzing the session.",UT_OPTION_CAN_CLOSE_TASK:"Participants can close tasks themselves",UT_OPTION_SEE_SITEMAP:"Participants can see sitemap",UT_THANKS_FOR_CONTRIBUTION:"This session is over, thank you for your contribution.",UT_SETTINGS:"Usability test settings",UT_USERS:"Usability test users",UM_CLOSE_MOVIE:"Close movie",UM_MODAL_HEADER:"Show your design,\nshare your screen and allow others to follow your actions!",UM_MODAL_TEXT:"With Live Presentation you'll be able to create an outstanding real-time presentation for your team. By means of voice calls, collaboration will be smooth and easy.",UM_CLOSE_MODAL:"Close modal",UM_HOW_IT_WORKS:"Show me how it works",UM_UPGRADE_NOW:"Upgrade now!",UM_TEAM_TEXT:"Live Presentation is available in Team Plan.",UM_TEAM:"Team"})}]),angular.module("core").config(["localStorageServiceProvider",function(localStorageServiceProvider){"use strict";localStorageServiceProvider.setPrefix("Preview"),localStorageServiceProvider.setStorageCookieDomain(ApplicationConfiguration.cookieDomain)}]),angular.module("core").config(["RestangularProvider",function(RestangularProvider){"use strict";RestangularProvider.setDefaultHttpFields({timeout:2e4})}]),function(){"use strict";var CODE_EDITOR_MODES={CSS:"css",HTML_MIXED:"htmlmixed",JAVA:"clike",JAVASCRIPT:"javascript",MARKDOWN:"markdown",OBJECTIVE_C:"clike",PHP:"php",RUBY:"ruby",SLIM:"slim",SMARTY:"smarty",SWIFT:"swift"};angular.module("core").constant("CODE_EDITOR",{MODES:CODE_EDITOR_MODES,MODES_OPTIONS:[{text:"CSS",value:CODE_EDITOR_MODES.CSS},{text:"HTML",value:CODE_EDITOR_MODES.HTML_MIXED},{text:"Java",value:CODE_EDITOR_MODES.JAVA},{text:"JavaScript",value:CODE_EDITOR_MODES.JAVASCRIPT},{text:"PHP",value:CODE_EDITOR_MODES.PHP},{text:"Ruby",value:CODE_EDITOR_MODES.RUBY},{text:"Slim",value:CODE_EDITOR_MODES.SLIM},{text:"Smarty",value:CODE_EDITOR_MODES.SMARTY},{text:"Other",value:CODE_EDITOR_MODES.MARKDOWN}]})}(),function(){"use strict";var MODES={DOCUMENTATION:"documentation",PREVIEW:"preview",SPEC:"spec"};angular.module("core").constant("MODES",MODES)}(),function(){"use strict";function UsabilityTestController(_,$rootScope,$state,$stateParams,$modal,UsabilityTestService,PreviewNavigation,ScreencastifyService){function activate(){UsabilityTestService.isWizardOpen||ScreencastifyService.isInstalled().then(function(isInstalled){isInstalled?openWizard():openScreencastifyDownloadModal()})}function openScreencastifyDownloadModal(){$modal.open({controller:"ScreencastifyDownloadCtrl",controllerAs:"vm",templateUrl:"/scripts/modules/core/views/usabilityTest/screencastifyDownload.view.html"}),$state.go("home.page.mode",_.extend({},PreviewNavigation.getCurrentUrlParams(),{pageId:$stateParams.pageId}))}function openWizard(){var dialog=$modal.open({controller:"UsabilityTestWizardController",templateUrl:"/scripts/modules/core/views/usabilityTest/wizard.view.html",keyboard:!1});UsabilityTestService.isWizardOpen=!0,dialog.result.finally(function(){$state.includes("**.usability-test.**")&&$state.go("home.page.mode",_.extend({},PreviewNavigation.getCurrentUrlParams(),{pageId:$stateParams.pageId})),_.isFunction(onStateChangeSuccess)&&onStateChangeSuccess(),UsabilityTestService.isWizardOpen=!1}),onStateChangeSuccess=$rootScope.$on("$stateChangeSuccess",function(e,toState,toParams){toParams.step||dialog.close()})}var onStateChangeSuccess;activate()}angular.module("core").controller("UsabilityTestController",UsabilityTestController),UsabilityTestController.$inject=["_","$rootScope","$state","$stateParams","$modal","UsabilityTestService","PreviewNavigation","ScreencastifyService"]}(),function(){"use strict";function ApprovalProcessController($scope,$modal,ApprovalsService,AnalyticsService){function init(){shouldOpenWelcomeModal()&&openWelcomeModal(),shouldOpenReviewModal()&&openReviewModal(),shouldSendStakeholderEvent()&&AnalyticsService.event("Preview - Stakeholder visited")}function isApproved(){return vm.approvalData.getStatus()===PreviewEnums.APPROVALS.STATUS.APPROVED}function isRejected(){return vm.approvalData.getStatus()===PreviewEnums.APPROVALS.STATUS.REJECTED}function getApproveLabel(){return isApproved()?"Approved":"Approve"}function getRejectLabel(){return isRejected()?"Rejected":"Reject"}function shouldOpenReviewModal(){return ApplicationConfiguration.approvalRequestsCount&&ApplicationConfiguration.approvalRequestsCount>1&&!ApplicationConfiguration.approvalRequest.seenAt}function shouldOpenWelcomeModal(){return ApplicationConfiguration.approvalRequestsCount&&1===ApplicationConfiguration.approvalRequestsCount&&!ApplicationConfiguration.approvalRequest.seenAt&&ApplicationConfiguration.approvalRequest.status===PreviewEnums.APPROVALS.STATUS.PENDING}function shouldSendStakeholderEvent(){return!(!ApplicationConfiguration.approval||!ApplicationConfiguration.approval.id)}function approvalButtonClick(isApproval,event){event.preventDefault(),vm.approvalData.isPending()&&$modal.open({templateUrl:"/scripts/modules/core/views/approvalProcess/accept.view.html",controller:"ApprovalProcessModalboxController",controllerAs:"vm",resolve:{approvalData:function(){return{isApproval:isApproval}}}})}function openReviewModal(){$modal.open({templateUrl:"/scripts/modules/core/views/approvalProcess/review.view.html",controller:"ApprovalProcessReviewModalboxController",controllerAs:"vm"})}function openWelcomeModal(){$modal.open({templateUrl:"/scripts/modules/core/views/approvalProcess/welcome.view.html",controller:"ApprovalProcessReviewModalboxController",controllerAs:"vm"})}var vm=this;vm.approvalData={isActive:ApprovalsService.getIsActive,isPending:ApprovalsService.getIsPending,getStatus:ApprovalsService.getApprovalStatus,getApproveLabel:getApproveLabel,getRejectLabel:getRejectLabel,isApproved:isApproved,isRejected:isRejected},vm.approvalButtonClick=approvalButtonClick,init()}angular.module("core").controller("ApprovalProcessController",ApprovalProcessController),ApprovalProcessController.$inject=["$scope","$modal","ApprovalsService","AnalyticsService"]}(),function(){"use strict";function ApprovalProcessModalboxController($scope,$modalInstance,approvalData,ApprovalsService,AnalyticsService){function sendApproval(){ApprovalsService.sendApproval({status:getStatus(),idApproval:ApprovalsService.getIdApproval(),idRequest:ApprovalsService.getIdRequest(),feedback:vm.feedback}).then(function(request){AnalyticsService.event("Preview - Stakeholder status set",{"Preview - Stakeholder status set":getStatus().charAt(0).toUpperCase()+getStatus().slice(1),"Preview - Stakeholder status set: Note added":vm.feedback?"Note added":"Without note"}),ApprovalsService.setApprovalStatus(getStatus()),closeModal()})}function closeModal(event){event&&event.preventDefault(),$modalInstance.close()}function getApprovalLabel(){return approvalData.isApproval?PreviewEnums.APPROVALS.LABEL.APPROVE:PreviewEnums.APPROVALS.LABEL.REJECT}function getStatus(){return approvalData.isApproval?PreviewEnums.APPROVALS.STATUS.APPROVED:PreviewEnums.APPROVALS.STATUS.REJECTED;
}var vm=this;vm.approvalLabel=getApprovalLabel(),vm.sendApproval=sendApproval,vm.closeModal=closeModal}angular.module("core").controller("ApprovalProcessModalboxController",ApprovalProcessModalboxController),ApprovalProcessModalboxController.$inject=["$scope","$modalInstance","approvalData","ApprovalsService","AnalyticsService"]}(),function(){"use strict";function ApprovalProcessReviewModalboxController($scope,$modalInstance){function closeModal(event){event&&event.preventDefault(),$modalInstance.close()}var vm=this;vm.closeModal=closeModal}angular.module("core").controller("ApprovalProcessReviewModalboxController",ApprovalProcessReviewModalboxController),ApprovalProcessReviewModalboxController.$inject=["$scope","$modalInstance"]}(),angular.module("core").controller("BreadcrumbsController",["$rootScope","$scope","$sce","PagesService","BreakpointsService","LiveSessionInstanceService",function($rootScope,$scope,$sce,PagesService,BreakpointsService,LiveSessionInstanceService){"use strict";var LiveSessionInstance=LiveSessionInstanceService.get();$scope.breadcrumbs=[],$scope.breakpoint=null;var getBreadcrumbs=function(){var id=PagesService.currentPageId,breadcrumbs=[];do breadcrumbs.unshift(getPageName(id)),id=PagesService.pagesMap[id].parent;while(id);return breadcrumbs},getPageName=function(id){return PagesService.pagesMap[id].name},getBreakpointName=function(id){return $sce.trustAsHtml(BreakpointsService.breakpointsMap[PagesService.currentBreakpointId].name)};LiveSessionInstance.isSession()&&(LiveSessionInstance.getType()===LiveShare.enums.SESSION_TYPES.TESTING&&LiveSessionInstance.isHostSession()||!LiveSessionInstance.isHostSession())&&($scope.breadcrumbs=getBreadcrumbs(),$scope.breakpoint=getBreakpointName()),LiveSessionInstance.registerObserverCallback("finish",function(){$scope.breadcrumbs=[],$scope.breakpoint=null});$rootScope.$on(PreviewEnums.ON_CONTENT_LOADED,function(e,id){$scope.breadcrumbs=getBreadcrumbs(),$scope.breakpoint=getBreakpointName()})}]),function(){"use strict";function CanvasController(_,$document,$rootScope,$scope,$state,$timeout,$q,PagesService,DocumentsService,CommentsService,CommentsFilter,BreakpointsService,ProjectsService,Settings,animate,editorSocket,UsersService,LiveSessionInstanceService,UsabilityTestService,LiveShareService,AnalyticsService,ScrollService,Engine,PreloadService,PreviewNavigation,SpecificationService,PreviewCache,$window,DesignSystem,CanvasContainerHeight){$scope.canvasWrapperId="canvas-wrapper",$scope.addingComment=!1,$scope.commentMode=!1,$scope.isLoading=!1,$scope.firstTimeLoaded=!1,$scope.dimensions=null,$scope.overflow=null,$scope.onClick=null,$scope.clickX=0,$scope.clickY=0,$scope.list={},$scope.isDocument=ProjectsService.isDocument(),$scope.isUXTestDocument=ProjectsService.isUXTestDocument(),$scope.visibleComments=[],$scope.showNewCommentWindow=!1,$scope.isSpecMode=function(){return PreviewNavigation.isModeActive(PreviewNavigation.PREVIEW_MODES.SPEC)},$scope.width=0,$scope.height=0;var onPreviewModeOff,workbenchNode,canvasWrapper,container=null,content=null,contentDimensions={width:0,height:0},contentCropping={x:!1,y:!1},mouseStartPosition={x:null,y:null},scrollStartPosition={x:null,y:null},WORKBENCH={CLASSES:{CANVAS:"ng-canvas",PRESS:"grab",DRAG:"dragging",WITH_FIXED_ELEMENT:"with-fixed-element"}},INTERACTION_CLASS="interactive",KEY_CODES=keysEnums.KEY_CODES,MIN_WIDTH=320,MIN_HEIGHT=768,pNav=PreviewNavigation,spaceHeld=!1,scale=Engine.getScale(),pageHasFixedElements=!1;$scope.$on("$destroy",function(){onAddComment(),onLoading(),onSelectComment(),onChangePage(),onComments(),onShowCommentsResolvedChanged(),onCommentsFilterChange(),onCommentTypeUpdate(),onCommentAssignedUserUpdate(),onModeChanged(),onAssignmentListOpen(),onPreviewModeOff(),onZoomChange(),removeEventListeners()}),$scope.highlightInteractions=function(event){var element=event.target,classNames=element.classList;Settings.disableInteractionsHighlight||!element.parentNode||isInteractiveElement(element)||$scope.isLiveSession||$scope.isUTSession||!pNav.isModeActive(pNav.PREVIEW_MODES.SIMULATE)||classNames.contains(INTERACTION_CLASS)&&!classNames.contains(WORKBENCH.CLASSES.CANVAS)||isChildOf(element,INTERACTION_CLASS)&&!classNames.contains(WORKBENCH.CLASSES.CANVAS)||Preview.highlightInteractive(Engine.getPage())},$scope.onContentLoaded=function(){var LiveSessionService=LiveSessionInstanceService.get();LiveSessionService&&LiveSessionService.isSession()?LiveSessionService.executeEventsQueue().then(function(){onContentLoaded(),$scope.$apply()}).catch(function(){onContentLoaded(),$scope.$apply()}):onContentLoaded()},$scope.onAddCommentClick=function(e){UsersService.isAnonymous()&&!UsersService.isAnonymousNameSet()&&$rootScope.$emit(PreviewEnums.ANONYMOUS_ADD_COMMENT);var overflowedPage=$document[0].querySelector("[overflowed-page]"),scrollX=0,scrollY=0;overflowedPage&&(scrollX=overflowedPage.scrollLeft,scrollY=overflowedPage.scrollTop),$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null);var bb=content.getBoundingClientRect();$scope.clickX=Math.round(e.clientX-PreviewEnums.PIN_RADIUS-bb.left+scrollX),$scope.clickY=Math.round(e.clientY-PreviewEnums.PIN_RADIUS-bb.top+scrollY),addComment(!0)};var isInteractiveElement=function(element){var tagName=element.tagName.toLowerCase();return["input","label","select","option"].indexOf(tagName)!==-1},isChildOf=function(childElement,parentClass){for(;childElement&&childElement!==canvasWrapper;){if(childElement.classList&&(childElement.classList.contains(parentClass)||isInteractiveElement(childElement)))return!0;childElement=childElement.parentNode}return!1},loadSymbol=function(){if(ApplicationConfiguration.isDesignSystem){var symbol=DesignSystem.getSymbolContent(),accountPageOptions=DesignSystem.getAccountPageOptions();if(symbol.pageContent){var page=Engine.getPage()||Engine.initPage(container,content,accountPageOptions);Engine.updateOffset(),clearPage(),page.on($window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,function(){onLoad(page),PreviewNavigation.setActiveMode(pNav.PREVIEW_MODES.SPEC),pNav.isModeActive(pNav.PREVIEW_MODES.SPEC)&&Engine.updateCanvasRectangle()}),page.load(Object.assign({pageId:symbol.id,isComponent:!0},symbol.pageContent)),SpecificationService.setLastUpdateDate(symbol.pageContent.last_update),PreloadService.preloadPageImages(page).then(function(){$scope.onContentLoaded()}).then(PreloadService.preloadAllPages)}}},removeEventListeners=function(){$document[0].removeEventListener("keydown",handleKeyDown),$document[0].removeEventListener("keyup",handleKeyUp)},onContentLoaded=function(){$rootScope.$emit(PreviewEnums.LOADING,!1),$rootScope.$emit(PreviewEnums.ON_CONTENT_LOADED),Preview.onLoadPage($document[0].querySelector(".canvas-content"),ProjectsService.isDocument()?function(rect){$scope.$apply(function(){contentDimensions.height=rect.height,$scope.dimensions.height=contentDimensions.height+"px"})}:null),$timeout(function(){$scope.isLoading=!1},0),AnalyticsService.finishPageSwitchTrack(ProjectsService.currentProjectHash,PagesService.currentPageId),AnalyticsService.countPageviews(PagesService.currentPageId,ProjectsService.currentProjectAccount)},updateScale=function(){scale=Engine.getScale()},onAddComment=$rootScope.$on(PreviewEnums.ADD_COMMENT,function(){addComment(!1)}),onLoading=$rootScope.$on(PreviewEnums.LOADING,function(e,value){value||($scope.firstTimeLoaded=!0)}),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id,type){var comment;addComment(!1),$scope.visibleComments.splice(0,$scope.visibleComments.length),comment=_.find($scope.comments,{_id:id}),comment&&CommentsFilter.canDisplayCanvasComment(comment)&&canDisplayComment(comment)&&($scope.visibleComments.push(comment),scrollToComment(id,type,.7))});onPreviewModeOff=$rootScope.$on(PreviewEnums.ON_PREVIEW_MODE_CHANGED,function(e,mode){$scope.commentMode=mode===pNav.PREVIEW_MODES.COMMENT});var verticalScrollRatio,horizontalScrollRatio,onChangePage=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(){$scope.isDocument=ProjectsService.isDocument(),AnalyticsService.startPageSwitchTrack(ProjectsService.currentProjectHash,PagesService.currentPageId),addComment(!1),update(),ProjectsService.isDocument()?getContent().then(function(){scrollToCommentDelayed()}):($scope.isLoading=!0,PreviewCache.isPageDataInCache(ProjectsService.currentProjectHash,PagesService.currentPageId)||$rootScope.$emit(PreviewEnums.LOADING,!0),loadPage(PagesService.currentPageId),scrollToCommentDelayed()),Preview.onChangePage()}),scrollToCommentDelayed=function(){container.scrollLeft=0,container.scrollTop=0,$timeout(function(){scrollToComment(CommentsService.selectedCommentId,"panel",0)},0)},updateCurrentPage=function(){PagesService.getCanvasData(PagesService.currentPageId).then(function(data){var page=Engine.getPage();Engine.updateOffset(),clearPage(),page.load(data,function(){page.on($window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,onLoadAfterUpdate)}())})},getSketchArtboard=function(){var canvasSketchArtboard=Engine.getCanvasSketchArtboard();return canvasSketchArtboard&&canvasSketchArtboard.width&&canvasSketchArtboard.height?canvasSketchArtboard:{}},updateCanvasDimensionsFromEngine=function(page,forceWidth,forceHeight){var canvasBB=page.getCanvas().calculateBoundingBox(),width=forceWidth,height=forceHeight,minWidth=PagesService.currentPageProperties?MIN_WIDTH:0,minHeight=PagesService.currentPageProperties?MIN_HEIGHT:0;width||(width=Math.max(canvasBB.width,minWidth)),height||(height=Math.max(canvasBB.height,minHeight)),$scope.width=width,$scope.height=height,updateCanvasDimensions($scope.width,$scope.height)},updateCanvasDimensions=function(width,height){var currentPageSize=_.get(PagesService,"currentPageProperties.size",null),sketchArtboard=getSketchArtboard();width&&height||(currentPageSize&&(width=width||currentPageSize.width,height=height||currentPageSize.height),_.isEmpty(sketchArtboard)||(width=width||sketchArtboard.width,height=height||sketchArtboard.height)),$scope.dimensions={width:width*scale+"px",height:height*scale+"px"},$scope.overflow={"overflow-x":currentPageSize&&currentPageSize.scrollx?"auto":"hidden","overflow-y":currentPageSize&&currentPageSize.scrolly?"auto":"hidden"}},getElementsRefs=function(){canvasWrapper=$document[0].getElementById($scope.canvasWrapperId)},onLoad=function(page){var breakpointWidth=_.get(PagesService,"currentPageProperties.size.width",null),breakpointHeight=_.get(PagesService,"currentPageProperties.size.height",null);!_.isEmpty(getSketchArtboard())&&PagesService.currentPageProperties?updateCanvasDimensions(breakpointWidth,breakpointHeight):updateCanvasDimensionsFromEngine(page,breakpointWidth,breakpointHeight),onLoadAfterUpdate(),initCanvasMove(),getElementsRefs();var animation=Preview.getAnimation();animation&&($rootScope.$emit(PreviewEnums.PAGE_ANIMATION_START),Preview.setAnimation(null))},setFixedElementClass=function(enable){var canvasContainer=$document[0].querySelector(".ng-canvas-container");enable?canvasContainer.classList.add(WORKBENCH.CLASSES.WITH_FIXED_ELEMENT):canvasContainer.classList.remove(WORKBENCH.CLASSES.WITH_FIXED_ELEMENT)},onLoadAfterUpdate=function(){var page=Engine.getPage(),width=ApplicationConfiguration.isDesignSystem?$scope.width:PagesService.currentPageProperties.size.width,height=ApplicationConfiguration.isDesignSystem?$scope.height:PagesService.currentPageProperties.size.height;pageHasFixedElements=page.hasFixedElements(),disableContextMenuForInteractives(),setNgCanvasDimensions(page,height,width),setFixedElementClass(pageHasFixedElements)},clearPage=function(){var page=Engine.getPage();page.clear(),page.off($window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,onLoad),page.off($window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,onLoadAfterUpdate)},loadPage=function(pageId){PagesService.getCanvasData(pageId).then(function(data){var page=Engine.getPage()||Engine.initPage(container,content);if(data.pageId=parseInt(pageId),SpecificationService.setLastUpdateDate(data.last_update),data.pageId!==page.pageId){var currentPageSize=_.get(PagesService,"currentPageProperties.size",{}),width=currentPageSize.width,height=currentPageSize.height;Engine.updateOffset(),pNav.isModeActive(pNav.PREVIEW_MODES.SPEC)&&Engine.updateCanvasRectangle(),clearPage(),page.load(data,function(){page.on($window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,onLoad)}()),width&&(height=height||$scope.height||MIN_HEIGHT,updateCanvasDimensions(width,height)),PreloadService.preloadPageImages(page).then(function(){$scope.onContentLoaded()}).then(PreloadService.preloadAllPages)}})},onComments=$scope.$watchCollection("comments",function(value){value&&update()}),addComment=function(value){$scope.addingComment=value,$rootScope.$emit(PreviewEnums.ADDING_COMMENT,$scope.addingComment)},getContent=function(silent){var content,d=$q.defer(),isDocument=ProjectsService.isDocument();return isDocument?($scope.isLoading=!0,silent||$rootScope.$emit(PreviewEnums.LOADING,!0),content=DocumentsService.getDocument(DocumentsService.currentDocumentId),content.then(function(content){contentDimensions.width=content.size.width,contentDimensions.height=content.size.height,contentCropping=PagesService.getContentCropping(),$scope.contentPath=content.content+"?"+(new Date).getTime(),$scope.dimensions={width:contentDimensions.width*scale+"px",height:contentDimensions.height*scale+"px"},$scope.overflow={"overflow-x":contentCropping.x?"auto":"hidden","overflow-y":contentCropping.y?"auto":"hidden"},$scope.isUXTestDocument&&($scope.dimensions=null),d.resolve(content)}),d.promise):(d.resolve(),d.promise)},canScrollToComment=function(id,type){var comment=CommentsService.commentsMap[id];return!!comment&&(id&&"panel"===type&&comment.id_page===PagesService.currentPageId&&(Settings.showResolvedComments||!comment.resolved.is))},scrollToComment=function(id,type,delay){if(canScrollToComment(id,type)){var maxScrollTop=container.scrollHeight-container.offsetHeight,maxScrollLeft=container.scrollWidth-container.offsetWidth,commentPosition=CommentsService.commentsMap[id].position,left=commentPosition.x-container.offsetWidth/2,top=commentPosition.y-container.offsetHeight/2;left<0?left=0:left>maxScrollLeft&&(left=maxScrollLeft),top<0?top=0:top>maxScrollTop&&(top=maxScrollTop),delay>0?animate(container,delay,{ease:"easeInOutPower2",scrollLeft:left,scrollTop:top}):(container.scrollLeft=left,container.scrollTop=top)}},canDisplayComment=function(comment){return!comment._parent_comment&&comment.id_page===PagesService.currentPageId&&!Settings.disableComments&&(Settings.showResolvedComments||!comment.resolved.is)},update=function(){$scope.list=[],_.forEach($scope.comments,function(comment){CommentsFilter.canDisplayCanvasComment(comment)&&canDisplayComment(comment)&&$scope.list.push(comment)})},onProjectUpdate=function(data){var dataObject;try{dataObject=angular.isString(data)?angular.fromJson(data):data}catch(e){}var LiveSessionInstance=LiveSessionInstanceService.get();LiveSessionInstance&&LiveSessionInstance.isSession()||dataObject&&PagesService.currentPageId===parseInt(dataObject.id_page)&&updateCurrentPage()},disableContextMenuForInteractives=function(){for(var classNameToHandle=".interactive",elementList=$document[0].querySelectorAll(classNameToHandle),i=0,len=elementList.length;i<len;i++)elementList[i].addEventListener("contextmenu",function(e){e.preventDefault()},!1)},setNgCanvasDimensions=function(page,canvasContainerHeight,canvasContainerWidth){var canvasBB,width,height,ngCanvas=$document[0].querySelector(".ng-canvas"),sketchArtboard=getSketchArtboard();_.isEmpty(sketchArtboard)?(canvasBB=page.getCanvas().calculateBoundingBox(),width=Math.max(canvasBB.width,canvasContainerWidth),height=Math.max(canvasBB.height,canvasContainerHeight)):(width=sketchArtboard.width,height=sketchArtboard.height),ngCanvas.style.height=height+"px",ngCanvas.style.width=width+"px",setScrollableContainer(height)},setScrollableContainer=function(height){return _.isEmpty(getSketchArtboard())&&height!==CanvasContainerHeight.getHeight()?(PagesService.currentPageProperties&&PagesService.currentPageProperties.size.scrolly&&Engine.setScrollableContainer($document[0].querySelector(".ng-canvas-container")),void Engine.setScrollableWrapper($document[0].querySelector("#canvas-wrapper"))):Engine.setScrollableContainer(container)},handleAssignmentListOpen=function(event,elementId,commentType){"canvas"===commentType&&ScrollService.scrollToElement($scope.canvasWrapperId,elementId)},updateDimensions=function(){updateCanvasDimensions($scope.width,$scope.height),Engine.updateOffset(),pNav.isModeActive(pNav.PREVIEW_MODES.SPEC)&&Engine.updateCanvasRectangle()},adjustScrollPosition=function(delay){var setScrollPosition=function(){container.scrollLeft=horizontalScrollRatio*(Math.floor(parseInt($scope.dimensions.width,10))-container.offsetWidth),container.scrollTop=verticalScrollRatio*(Math.floor(parseInt($scope.dimensions.height,10))-container.offsetHeight)};delay?_.delay(setScrollPosition):setScrollPosition()},onShowCommentsResolvedChanged=$rootScope.$on(PreviewEnums.ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED,update.bind(this)),onCommentTypeUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,update.bind(this)),onCommentAssignedUserUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_ASSIGNED_USER_UPDATE,update.bind(this)),onCommentsFilterChange=$rootScope.$on(PreviewEnums.ON_COMMENTS_FILTER_CHANGE,update.bind(this)),onModeChanged=$rootScope.$on(PreviewEnums.ON_MODE_CHANGED,update.bind(this)),onAssignmentListOpen=$rootScope.$on(PreviewEnums.ON_ASSIGNMENT_LIST_OPEN,handleAssignmentListOpen),onZoomChange=$rootScope.$on(PreviewEnums.ON_ZOOM_CHANGE,function(e,value){var delay=!0,scrollLeft=container.scrollLeft,scrollTop=container.scrollTop,maxVerticalScrollPos=container.scrollHeight-container.offsetHeight,maxHorizontalScrollPos=container.scrollWidth-container.offsetWidth,oldScale=scale;verticalScrollRatio=scrollTop/maxVerticalScrollPos,horizontalScrollRatio=scrollLeft/maxHorizontalScrollPos,parseInt(100*Math.abs(scale-Engine.getScale()))<=1&&(delay=!1),updateScale(value),pageHasFixedElements&&(1===scale&&1!==oldScale?setFixedElementClass(!0):1!==scale&&1===oldScale&&setFixedElementClass(!1)),updateDimensions(),adjustScrollPosition(delay)});container=$document[0].querySelector("main > section.scrolled-container > section.scrolled-content"),content=$document[0].querySelector("main > section.scrolled-container > section.scrolled-content > section.canvas-container > section.preview-container"),container.addEventListener("scroll",function(e){if(e.metaKey||e.ctrlKey)return e.preventDefault(),!1});var initCanvasMove=function(){workbenchNode=$document[0].querySelector(".ng-canvas"),$document[0].addEventListener("keydown",handleKeyDown),$document[0].addEventListener("keyup",handleKeyUp),workbenchNode.addEventListener("mousedown",handleMouseDown,!0)},handleKeyDown=function(event){if(!(["input","textarea","select"].indexOf(event.target.tagName.toLowerCase())>-1)){if(event.keyCode===KEY_CODES.ESC&&pNav.isModeActive(pNav.PREVIEW_MODES.COMMENT)){if(event.preventDefault(),$scope.addingComment||$scope.visibleComments.length)return void $rootScope.$emit(PreviewEnums.SELECT_COMMENT,null);pNav.setActiveMode(pNav.PREVIEW_MODES.SIMULATE)}event.keyCode===KEY_CODES.SPACE&&scale>1&&(spaceHeld=!0,workbenchNode.classList.add(WORKBENCH.CLASSES.PRESS),event.preventDefault())}},handleKeyUp=function(event){event.keyCode===KEY_CODES.SPACE&&(spaceHeld=!1,workbenchNode.classList.remove(WORKBENCH.CLASSES.PRESS))},handleMouseMove=function(event){var scrollPaneContent=$document[0].querySelector("#canvas-wrapper");scrollPaneContent.scrollLeft=scrollStartPosition.x+(mouseStartPosition.x-event.screenX),scrollPaneContent.scrollTop=scrollStartPosition.y-(event.screenY-mouseStartPosition.y),event.preventDefault(),event.stopImmediatePropagation()},handleMouseUp=function(){mouseStartPosition={x:null,y:null},scrollStartPosition={x:null,y:null},workbenchNode.classList.remove(WORKBENCH.CLASSES.PRESS),workbenchNode.classList.remove(WORKBENCH.CLASSES.DRAG),$window.removeEventListener("mousemove",handleMouseMove,!0),$window.removeEventListener("mouseup",handleMouseUp)},handleMouseDown=function(event){if(spaceHeld){var scrollPaneContent=$document[0].querySelector("#canvas-wrapper");event.stopImmediatePropagation(),mouseStartPosition={x:event.screenX,y:event.screenY},scrollStartPosition={x:scrollPaneContent.scrollLeft,y:scrollPaneContent.scrollTop},workbenchNode.classList.add(WORKBENCH.CLASSES.DRAG),$window.addEventListener("mousemove",handleMouseMove,!0),$window.addEventListener("mouseup",handleMouseUp)}};return $scope.handleMouseDown=handleMouseDown,ApplicationConfiguration.isDesignSystem?void angular.element(document).ready(loadSymbol):($scope.$on("$viewContentLoaded",function(){return ProjectsService.isDocument()?void getContent():void loadPage(PagesService.currentPageId)}),CommentsService.getComments().then(function(comments){getContent().then(function(){$scope.comments=comments,$timeout(function(){scrollToComment(CommentsService.selectedCommentId,"panel",0)},0)})}),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){$scope.isLiveSession=!0}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){$scope.isLiveSession=!0,$scope.isUTSession=!0}),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,function(){$scope.isLiveSession=!1}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,function(){$scope.isLiveSession=!1,$scope.isUTSession=!1}),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_SAVED,onProjectUpdate.bind(this)),editorSocket.on(PreviewEnums.SOCKET.ON_COMMENT_CREATE,function(data){CommentsService.applyAddComment(data,{updateCommentsModelOnly:!0})}),editorSocket.on(PreviewEnums.SOCKET.ON_COMMENT_UPDATE,function(data){CommentsService.applyUpdateComment(data._id,data)}),editorSocket.on(PreviewEnums.SOCKET.ON_COMMENT_TYPE_UPDATE,function(data){CommentsService.applyUpdateCommentType(data._id,data.type)}),editorSocket.on(PreviewEnums.SOCKET.ON_COMMENT_CONTENT_UPDATE,function(data){CommentsService.applyUpdateCommentContent(data._id,data.comment)}),editorSocket.on(PreviewEnums.SOCKET.ON_COMMENT_ASSIGNED_USER_UPDATE,function(data){CommentsService.applyUpdateAssignedUser(data._id,data.assignedUserId)}),editorSocket.on(PreviewEnums.SOCKET.ON_COMMENT_DELETE,function(data){CommentsService.applyDeleteComment(data)}),void editorSocket.on(PreviewEnums.SOCKET.ON_ACCOUNT_TYPEKIT_KIT_UPDATED,function(data){Engine.updateTypekitKit(data)}))}angular.module("core").controller("CanvasController",CanvasController),CanvasController.$inject=["_","$document","$rootScope","$scope","$state","$timeout","$q","PagesService","DocumentsService","CommentsService","CommentsFilter","BreakpointsService","ProjectsService","Settings","animate","editorSocket","UsersService","LiveSessionInstanceService","UsabilityTestService","LiveShareService","AnalyticsService","ScrollService","Engine","PreloadService","PreviewNavigation","SpecificationService","PreviewCache","$window","DesignSystem","CanvasContainerHeight"]}(),angular.module("core").controller("DocumentController",["$rootScope","$scope","$state","$stateParams","DocumentsService","Settings","PreviewNavigation",function($rootScope,$scope,$state,$stateParams,DocumentsService,Settings,PreviewNavigation){"use strict";Settings.setMode($stateParams.mode),$stateParams.documentId||$state.go($state.current.name,{documentId:DocumentsService.currentDocumentId}),PreviewNavigation.initNavigation($state.params.previewMode,($state.params.panels||"").split(","))}]),function(){"use strict";angular.module("core").controller("HomeController",["$rootScope","$scope","$state","$timeout","$window","LiveShareService","UsabilityTestService","ProjectsService","PagesService","UsersService","AnalyticsService","Settings","editorSocket","socket","deviceDetectorHelper","AssignHelper","Engine","PageExitService","ApprovalsService","PreviewNavigation","FeatureToggler","hotkeys","_",function($rootScope,$scope,$state,$timeout,$window,LiveShareService,UsabilityTestService,ProjectsService,PagesService,UsersService,AnalyticsService,Settings,editorSocket,socket,deviceDetectorHelper,AssignHelper,Engine,PageExitService,ApprovalsService,PreviewNavigation,FeatureToggler,hotkeys,_){AnalyticsService.startDesignLoadTrack(),AnalyticsService.event("Opened preview"),AnalyticsService.kissEvent("Opened preview"),ApprovalsService.getIsActive()&&ApprovalsService.updateSeenAt(),socket.emit("addCollaborator",{socketRoomId:ProjectsService.currentProjectHash,isAnonymous:UsersService.isAnonymous(),isProject:UsersService.isInProjectsAccount()}),editorSocket.emit("addCollaborator",{socketRoomId:ProjectsService.currentProjectHash,isAnonymous:UsersService.isAnonymous(),isProject:UsersService.isInProjectsAccount(),accountId:window.ApplicationConfiguration.project.id_account});var BACKSPACE_KEY=(LiveShare.enums.SESSION_TYPES,8);$scope.PREVIEW_MODES=PreviewNavigation.PREVIEW_MODES,$scope.PREVIEW_PANELS=PreviewNavigation.PREVIEW_PANELS,$scope.MAIN_PANELS=PreviewNavigation.MAIN_PANELS,$scope.isModeActive=PreviewNavigation.isModeActive,$scope.isPanelVisible=PreviewNavigation.isPanelVisible,$scope.isPanelExpanded=PreviewNavigation.isPanelExpanded,$scope.leftPanelVisible=!1,$scope.rightPanelVisible=!1,$scope.tasksVisible=!1,$scope.specificationVisible=!1,$scope.panelFadeIn=!1,$scope.sitemapFadeIn=!1,$scope.specificationFadeIn=!1,$scope.isVisible=!1,$scope.breakpointsVisible=!ProjectsService.isDocument(),$scope.breakpoints=[],$scope.breadcrumbsVisible=!1,$scope.isLiveSession=!1,$scope.isUsabilityTestingSession=!1,$scope.dragging=!1,$scope.isLoading=!0,$scope.isParticipant=!1,$scope.isCommentsEnabled=!Settings.disableComments&&!ApprovalsService.getIsActive(),$scope.isAssignmentActive=AssignHelper.isAssignmentActive(),$scope.showCrosshairCursor=!1,$scope.isAppViewAvailable=deviceDetectorHelper.isAppViewAvailable(),$scope.isMac=deviceDetectorHelper.isMac(),$scope.isChrome=deviceDetectorHelper.isChrome(),$scope.isSafari=deviceDetectorHelper.isSafari(),$scope.isFirefox=deviceDetectorHelper.isFirefox(),$scope.isSpecModeFeature=FeatureToggler.specMode,$scope.isDocumentationModeFeature=FeatureToggler.documentationMode,$scope.canShowSpecMode=!1,$scope.canShowDocumentationMode=!1,$scope.keyDown=function(e){var rx=/INPUT|SELECT|TEXTAREA/i;e.which===BACKSPACE_KEY&&(!rx.test(e.target.tagName)||e.target.disabled||e.target.readOnly)&&e.preventDefault(),$rootScope.$emit("keyDown",e)};var updateCrosshairCursor=($rootScope.$on(PreviewEnums.LOADING,function(e,value){$scope.isLoading=value}),$rootScope.$on(PreviewEnums.SET_ANONYMOUS_NAME,function(e,name){name&&UsersService.setAnonymousName(name)}),$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(e){$scope.breakpointsVisible=PagesService.getPageBreakpoints(PagesService.currentPageId).length>1,$scope.breakpoints=PagesService.getPageBreakpoints(PagesService.currentPageId)}),$rootScope.$on(PreviewEnums.ON_MODE_CHANGED,function(e){$scope.isCommentsEnabled=!Settings.disableComments&&!ApprovalsService.getIsActive()}),function(){$scope.showCrosshairCursor=$scope.isModeActive($scope.PREVIEW_MODES.COMMENT)}),liveShareSessionstarted=($rootScope.$on(PreviewEnums.DRAGGING_COMMENT,function(e,value){$scope.dragging=value}),$rootScope.$on(PreviewEnums.FEATURES_AVAILABILITY,function(e,features){$scope.canShowDocumentationMode=features.documentation,$scope.canShowSpecMode=features.specification}),function(SessionService){$scope.isLiveSession=!0,SessionService.isHostSession()||($scope.breakpointsVisible=!1,$scope.breadcrumbsVisible=!0)}),usabilityTestSessionStarted=function(SessionService){$scope.isLiveSession=!0,$scope.isUsabilityTestingSession=!0,$scope.isVisible=!0,PreviewNavigation.setActiveMode(PreviewNavigation.PREVIEW_MODES.SIMULATE),PreviewNavigation.showPanel(PreviewNavigation.PREVIEW_PANELS.SITEMAP),$scope.isParticipant=!SessionService.isHostSession()};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveShareSessionstarted.bind(this,LiveShareService)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,usabilityTestSessionStarted.bind(this,UsabilityTestService));var liveSessionFinished=function(){$scope.breakpointsVisible=!ProjectsService.isDocument()&&$scope.breakpoints.length>1,$scope.breadcrumbsVisible=!1,$scope.isLiveSession=!1,$scope.isUsabilityTestingSession=!1,$scope.isParticipant=!1};_.forEach($window.shortcuts,function(data){_.isArray(data.shortcuts)&&_.forEach(data.shortcuts,function(shortcut){hotkeys.add({combo:shortcut,description:data.description,callback:function(event){event.preventDefault(),$rootScope.$emit(data.event)}})})}),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished.bind(this)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished.bind(this)),angular.element($window).bind("resize",function(){Settings.isResponsive&&PagesService.setPageResponsive($window.innerWidth)}),$rootScope.$on(PreviewEnums.ON_APP_VIEW_PROMO_CLOSE,function(){$scope.isAppViewAvailable=!1}),$rootScope.$on(PreviewEnums.ON_PREVIEW_MODE_CHANGED,function(e,mode){$scope.currentMode=mode,updateCrosshairCursor()}),$scope.$watchCollection(function(){return[PreviewNavigation.isLeftPanelVisible(),PreviewNavigation.isRightPanelVisible()]},function(val){$scope.leftPanelVisible=val[0],$scope.rightPanelVisible=val[1]})}])}(),function(){"use strict";function LayersController(_,$scope,$rootScope,Engine,ElementService,$timeout,PreviewNavigation){function onPanelChanged(e,mode){vm.isVisible=mode===PreviewNavigation.PREVIEW_PANELS.LAYERS,vm.isVisible&&vm.isInitializationNeeded&&init(),vm.isVisible&&vm.visibleItems&&vm.visibleItems.length&&(vm.visibleItems=vm.filteredCollection.slice(0,MAX_ITEM_COUNT))}function init(){var canvas=Engine.getPage().getCanvas();data=[];for(var i=canvas.children.length-1;i>=0;i--){var el=mapElement(canvas.children[i]);el.isHotspot||el.isTag||(addChildren(el,canvas.children[i].children),nodeMap[el.id]=el,data.push(el))}vm.collection=data,vm.filteredCollection=_.clone(vm.collection),vm.visibleItems=vm.filteredCollection.slice(0,MAX_ITEM_COUNT),vm.isInitializationNeeded=!1}function loadMore(){var length=vm.visibleItems.length,newItems=vm.filteredCollection.slice(length,length+MAX_ITEM_COUNT);newItems.length&&vm.visibleItems.push.apply(vm.visibleItems,newItems)}function focusInput(){vm.focused=!0}function resetSearch(){vm.searchFor="",vm.focused=!1,vm.filterCollection()}function keyDown(event){var keyCode=event.keyCode;event.stopPropagation(),keyCode===KEY_CODES.ESC&&(_.isEmpty(vm.searchFor)?resetSearch():(vm.searchFor="",vm.filterCollection())),keyCode===KEY_CODES.ENTER&&event.preventDefault()}function quote(str){return str.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function filterCollection(){var newCollection=[];return vm.searchFor.trim()?($timeout.cancel(timeout),void(timeout=$timeout(function(){angular.forEach(vm.collection,function(element){var regex=new RegExp(quote(vm.searchFor.trim()),"i"),filteredChildren=[];filterChildren(element.children,filteredChildren),(regex.test(element.name)||filteredChildren.length)&&newCollection.push(_.extend({},element,{children:filteredChildren}))}),vm.filteredCollection=newCollection,vm.visibleItems=vm.filteredCollection.slice(0,MAX_ITEM_COUNT)},100))):(vm.filteredCollection=_.clone(vm.collection),void(vm.visibleItems=vm.filteredCollection.slice(0,MAX_ITEM_COUNT)))}function filterChildren(children,filteredChildren){angular.forEach(children,function(element){var regex=new RegExp(quote(vm.searchFor),"i"),children=[];filterChildren(element.children,children),regex.test(element.name)&&filteredChildren.push(_.extend({},element,{children:children}))})}function addChildren(el,children){if(children&&children.length)for(var i=children.length-1;i>=0;i--){var child=mapElement(children[i]);child.isHotspot||child.isTag||(addChildren(child,children[i].children),el.children.push(child),nodeMap[child.id]=child);
}}function mapElement(el){return{children:[],id:el.id,type:el.type,name:el.name,isGroup:ElementService.isGroup(el),isHotspot:ElementService.isHotspot(el),isTag:ElementService.isTag(el),isVisible:el.isVisible(),raw:el}}var timeout,vm=this,data=[],nodeMap={},KEY_CODES=keysEnums.KEY_CODES,MAX_ITEM_COUNT=50;vm.searchFor="",vm.focused=!1,vm.focusInput=focusInput,vm.filterCollection=filterCollection,vm.resetSearch=resetSearch,vm.keyDown=keyDown,vm.nodeMap=nodeMap,vm.loadMore=loadMore,vm.isInitializationNeeded=!1,$rootScope.$on(PreviewEnums.ON_PANEL_CHANGED,onPanelChanged),$rootScope.$on(PreviewEnums.ON_PAGE_LOADED,function(){PreviewNavigation.isPanelVisible(PreviewNavigation.PREVIEW_PANELS.LAYERS)?init():vm.isInitializationNeeded=!0})}angular.module("core").controller("LayersController",LayersController),LayersController.$inject=["_","$scope","$rootScope","Engine","ElementService","$timeout","PreviewNavigation"]}(),angular.module("core").controller("LiveShareConfigurationController",["$scope","$state","$translate","$modal","$modalInstance","LiveShareService",function($scope,$state,$translate,$modal,$modalInstance,LiveShareService){"use strict";function getConfigurationOptions(){var options=[];return $scope.liveShareOptions.forEach(function(option){option.value&&options.push(option.param)}),options.join(",")}LiveShareService.getConfigurationOptions().then(function(options){$scope.liveShareOptions=options}),$scope.contributors=[],$scope.inviteUrl=null,LiveShareService.roomId()?$scope.inviteUrl=LiveShareService.getInviteURL(LiveShareService.roomId):LiveShareService.makeRoomReservation().then(function(roomId){$scope.inviteUrl=LiveShareService.getInviteURL(roomId)},function(){$modalInstance.close(),$state.reload()}),$scope.start=function(){LiveShareService.startInitializing({options:getConfigurationOptions()}),$modalInstance.close()},$scope.onClickLink=function($event){$event.target.select()}}]),angular.module("core").controller("LiveShareFinishController",["$scope","$state","$stateParams","$timeout","PagesService","ProjectsService","LiveSessionInstanceService",function($scope,$state,$stateParams,$timeout,PagesService,ProjectsService,LiveSessionInstanceService){"use strict";var TYPES=LiveShare.enums.SESSION_STATUS,LiveSessionInstance=LiveSessionInstanceService.get();$scope.backUrl=document.URL.split("#")[0],$scope.projectName=ProjectsService.currentProjectName,$scope.onClickBackToPreview=function($event){$event.preventDefault(),window.location.replace($scope.backUrl)};var isLiveShareSession;switch(LiveSessionInstance.getType()===LiveShare.enums.SESSION_TYPES.TESTING?(isLiveShareSession=!1,LiveSessionInstance.finishTestingSession()):isLiveShareSession=!0,$stateParams.type){case TYPES.QUIT:var REDIRECT_AFTER=3e3;$scope.message="LS_SESSION_QUIT",$timeout(function(){window.location.replace($scope.backUrl)},REDIRECT_AFTER);break;case TYPES.BANNED:$scope.message="LS_SESSION_BANNED";break;case TYPES.OVER:isLiveShareSession?$scope.message="LS_SESSION_OVER":($scope.backUrl=!1,$scope.message="UT_THANKS_FOR_CONTRIBUTION");break;default:$scope.message="LS_SESSION_404"}}]),function(){"use strict";function LiveShareInitializeCtrl(_,$q,$rootScope,$scope,$state,$stateParams,$timeout,$modal,ProjectsService,LiveSessionInstanceService,UsersService,UsabilityTestService,LiveShareService){function updateProgress(progress){$scope.loadingProgress=progress}function setName(){var d=$q.defer();return""!==$scope.userName.trim()&&d.resolve($scope.userName),$scope.$watch("userName",function(newValue){newValue&&""!==newValue.trim()&&d.resolve(newValue)}),d.promise}function generateSessionConfiguration(options,roomId){var settings;return settings=isLiveShareSession?{leadCursor:"host",triggerEvents:"host"}:{triggerEvents:"all",showCursor:"tester",leadCursor:"tester",toggleFollow:!1},options&&options.split(",").forEach(function(optionName){var option=LiveSessionInstance.translateOption(optionName,!0),key=Object.keys(option)[0];settings[key]=option[key]}),settings}function createSession(){var roomData={roomID:LiveSessionInstance.roomId(),url:LiveSessionInstance.getDestinationUrl(),name:ProjectsService.currentProjectName,roomSettings:generateSessionConfiguration($stateParams.options),type:LiveSessionInstance.getType()};if(myData=_.extend(myData,{sessionId:UsersService.me.id_session,name:$scope.userName}),isLiveShareSession)LiveSessionInstance.create(roomData,myData).then(sessionInitialized,sessionInitializationFailed);else{LiveSessionInstance.getTestData();LiveSessionInstance.save().then(function(testData){LiveSessionInstance.setDataId(testData._id),roomData.testDataId=testData._id,LiveSessionInstance.create(roomData,myData).then(function(roomData){sessionInitialized(roomData)},sessionInitializationFailed)})}}function joinToSession(){var onContentLoaded=$rootScope.$on(PreviewEnums.ON_CONTENT_LOADED,function(){onContentLoaded(),setName().then(function(name){myData=_.extend(myData,{name:$scope.userName}),LiveSessionInstance!==UsabilityTestService||UsabilityTestService.getTestData()?LiveSessionInstance.join($stateParams.sessionId,myData).then(sessionInitialized,sessionInitializationFailed):(myData=_.extend(myData,{type:LiveShare.enums.USER_TYPES.TESTER}),LiveSessionInstance.join($stateParams.sessionId,myData).then(function(roomData){UsabilityTestService.setDataId(roomData.testDataId),UsabilityTestService.fetch().then(sessionInitialized.bind(this,roomData),sessionInitializationFailed)},sessionInitializationFailed))})})}function sessionInitialized(roomData){var DELAY_AFTER_PROGRESS_BAR_ANIMATION=800;LiveSessionInstance.roomId(roomData.roomID),updateProgress(100),$timeout(function(){$state.go("home.page",{pageId:$stateParams.pageId}),isLiveShareSession||LiveSessionInstance.isHostSession()?LiveSessionInstance.startSession():$modal.open({templateUrl:"/scripts/modules/core/views/usabilityTest/introduction.view.html",controller:"UsabilityTestIntroductionController",keyboard:!1,closeBlocked:!0})},DELAY_AFTER_PROGRESS_BAR_ANIMATION)}function sessionInitializationFailed(event){$state.go("home.page.live-share-finish",{type:LiveShare.enums.SESSION_STATUS.OVER}),window.console.error(event.stack)}LiveSessionInstanceService.get()||($stateParams.type===LiveShare.enums.SESSION_TYPES.TESTING?LiveSessionInstanceService.set(UsabilityTestService):LiveSessionInstanceService.set(LiveShareService));var LiveSessionInstance=LiveSessionInstanceService.get(),isLiveShareSession=LiveSessionInstance===LiveShareService;if(LiveSessionInstance.isSession())return $state.go("home.page");var myData={settings:{muted:LiveSessionInstance.muted}};$scope.sessionTypeName=isLiveShareSession?"LS_NAME_SHARING":"LS_NAME_TESTING",$scope.loadingProgress=0,$scope.projectName=ProjectsService.currentProjectName,$scope.userName="",$scope.loginUrl=null,UsersService.isAnonymous()?($scope.name=UsersService.isAnonymousNameSet()?UsersService.me.name:"",$scope.loginUrl=ApplicationConfiguration.loginPageURL+"?cb="+encodeURIComponent(document.URL)):($scope.userName=UsersService.me.name||"",myData.customData={avatar:UsersService.me.avatar||null,uxpin_id:UsersService.me.id_user,id_session:UsersService.me.id_session}),$scope.onFormSubmit=function(name){$scope.working=!0,$scope.userName=name,UsersService.setAnonymousName(name)},$stateParams.sessionId?joinToSession():createSession()}angular.module("core").controller("LiveShareInitializeCtrl",LiveShareInitializeCtrl),LiveShareInitializeCtrl.$inject=["_","$q","$rootScope","$scope","$state","$stateParams","$timeout","$modal","ProjectsService","LiveSessionInstanceService","UsersService","UsabilityTestService","LiveShareService"]}(),angular.module("core").controller("NavController",["PreviewNavigation","_","$rootScope","$scope","$state","$stateParams","$modal","CommentsService","LiveShareService","UsabilityTestService","UsersService","ProjectsService","UXPinService","Settings","ApprovalsService","CommentsState","Engine","appStateManager",function(PreviewNavigation,_,$rootScope,$scope,$state,$stateParams,$modal,CommentsService,LiveShareService,UsabilityTestService,UsersService,ProjectsService,UXPinService,Settings,ApprovalsService,CommentsState,Engine,appStateManager){"use strict";function onStateChangeSuccess(event,toState,toParams,fromState,fromParams){toParams.mode!==fromParams.mode&&Settings.setMode(toParams.mode),toState.name===PreviewNavigation.getModeState()&&(toParams.previewMode===fromParams.previewMode&&toParams.mode===fromParams.mode||PreviewNavigation.setActiveMode(toParams.previewMode),toParams.panels===fromParams.panels&&toParams.mode===fromParams.mode||PreviewNavigation.setActivePanels((toParams.panels||"").split(",")))}function selectComment(commentId,redirect){CommentsService.selectedCommentId=commentId,CommentsState.selectedGroupId=commentId?"canvas-"+commentId:null,$rootScope.$emit(PreviewEnums.SELECT_COMMENT,CommentsService.selectedCommentId,null,redirect),commentId&&redirect&&CommentsService.groupToOpen.push(commentId)}function handleCommentState(){$state.params.commentId&&CommentsService.selectedCommentId!==$state.params.commentId&&CommentsService.getComments().then(function(){var id=CommentsService.getRedirectId($state.params.commentId);selectComment(id,id!==$state.params.commentId)})}function enterState(state,params,options){$state.go(state,params,options)}function onSelectComment(e,id,type,redirect){var options=function(){return redirect?{location:"replace"}:null}();if(id=CommentsService.getRedirectId(id)){UsersService.isAnonymous()||CommentsService.markAsRead(id);var pageId=CommentsService.commentsMap[id].id_page;CommentsService.selectedCommentId=id,CommentsState.selectedGroupId=type+"-"+id,enterState(PreviewNavigation.getAddCommentState(),{pageId:pageId,commentId:id},options)}else $state.current.name!==PreviewNavigation.getModeState()&&(CommentsService.selectedCommentId=null,CommentsState.selectedGroupId=null,enterState(PreviewNavigation.getModeState(),null,options))}function onDeleteComment(e,id){id===CommentsService.selectedCommentId&&selectComment(null)}var onContentLoadedOff,onSelectCommentOff,onDeleteCommentOff,onStateChangeSuccessOff,onModeChangedOff,onPanelChangedOff;$scope.$on("$destroy",function(){onSelectCommentOff(),onDeleteCommentOff(),onStateChangeSuccessOff(),onModeChangedOff(),onPanelChangedOff(),onContentLoadedOff&&onContentLoadedOff()}),$state.current.name===PreviewNavigation.getAddCommentState()&&(Engine.isPageLoaded()?handleCommentState():onContentLoadedOff=$rootScope.$on(PreviewEnums.ON_PAGE_LOADED,handleCommentState)),onSelectCommentOff=$rootScope.$on(PreviewEnums.SELECT_COMMENT,onSelectComment),onDeleteCommentOff=$rootScope.$on(PreviewEnums.DELETE_COMMENT,onDeleteComment),onStateChangeSuccessOff=$rootScope.$on("$stateChangeSuccess",onStateChangeSuccess),onModeChangedOff=$rootScope.$on(PreviewEnums.ON_PREVIEW_MODE_CHANGED,function(){var state={mode:PreviewNavigation.getCurrentMode()};appStateManager.saveState(state)}),onPanelChangedOff=$rootScope.$on(PreviewEnums.ON_PANEL_CHANGED,function(){var state={panels:PreviewNavigation.getCurrentPanels()};appStateManager.saveState(state)})}]),function(){"use strict";function PageController($window,$timeout,_,$rootScope,$scope,$state,$stateParams,PagesService,CommentsService,ExportService,Settings,isMobile,PreviewNavigation,appStateManager,initialData){if(isMobile||ExportService.isExport()){var modes=$stateParams.mode||"";Settings.setMode(PreviewEnums.MODES_FLAGS.COMMENTS+PreviewEnums.MODES_FLAGS.SPECIFICATION+modes)}else Settings.setMode($stateParams.mode);$scope.gotoPage=function(id,redirect,animation){id===parseInt($state.params.pageId)&&$timeout(function(){var animation=Preview.getAnimation();animation&&($rootScope.$emit(PreviewEnums.PAGE_ANIMATION_START),Preview.setAnimation(null))});var options=function(){return redirect?{location:"replace"}:null}();$state.go($state.current.name,{pageId:id},options)},$scope.previousPageId=PagesService.currentPageId;var appState=appStateManager.getCurrentState();if(initialData.redirectToPageId)PagesService.setCurrentPageId(initialData.redirectToPageId),appState.breakpoint?PagesService.changePageBreakpoint(appState.breakpoint):$scope.gotoPage(PagesService.currentPageId,!0);else{var pageId=parseInt($stateParams.pageId),changePage=!!PagesService.currentPageId;if(PagesService.pagesMap[pageId]&&null===PagesService.pagesMap[pageId].version_type){var page=_.find(pages,function(page){return page.version_type===PagesService.defaultBreakpointId&&page.version_of===pageId});return PagesService.setCurrentPageId(page.id_page),$scope.gotoPage(page.id_page,!0)}PagesService.pagesMap[pageId]?pageId!==PagesService.currentPageId&&(PagesService.setCurrentPageId(pageId),changePage&&($rootScope.$emit(PreviewEnums.ADDING_COMMENT,!1),$rootScope.$emit(PreviewEnums.LOADING_COMMENTS,!0),CommentsService.getComments().then(function(){$rootScope.$emit(PreviewEnums.LOADING_COMMENTS,!1)}))):(PagesService.setCurrentPageId(PagesService.getRootPage()),$scope.gotoPage(PagesService.currentPageId,!0))}var onNavigateToOff=$rootScope.$on(PreviewEnums.NAVIGATE_TO_PAGE,function(e,pageId,animation){animation?($rootScope.$emit(PreviewEnums.PAGE_ANIMATION_INIT,animation),$window.requestAnimationFrame(function(){$scope.gotoPage(pageId,!1,animation)})):$scope.gotoPage(pageId,!1)}),onNavigateBackOff=$rootScope.$on(PreviewEnums.NAVIGATE_HISTORY_BACK,function(){$scope.previousPageId&&$scope.gotoPage($scope.previousPageId)}),onPageInitializedOff=$rootScope.$on(PreviewEnums.ON_PAGE_INITIALIZED,function(){var currentState=appStateManager.getCurrentState();$state.current.name.indexOf("home.page.live")===-1&&$state.current.name.indexOf("home.page.usability-test")===-1&&PreviewNavigation.initNavigation($state.params.previewMode||currentState.mode,$state.params.panels?($state.params.panels||"").split(","):currentState.panels)});$scope.$on("$destroy",function(){onNavigateToOff(),onNavigateBackOff(),onPageInitializedOff()})}angular.module("core").controller("PageController",PageController),PageController.$inject=["$window","$timeout","_","$rootScope","$scope","$state","$stateParams","PagesService","CommentsService","ExportService","Settings","isMobile","PreviewNavigation","appStateManager","initialData"]}(),angular.module("core").controller("PlanUpgradeController",["$scope","$modal","$modalInstance","$transition","$window","localStorageService","UXPinService","$sce",function($scope,$modal,$modalInstance,$transition,$window,localStorageService,UXPinService,$sce){"use strict";var videoElem=null,onYoutubePlayerReady=null,videoId="DN81evKgaW8",movieOnClass="movie-on",moviePartSelector="section.movie-part";$scope.video={id:videoId,player:null},onYoutubePlayerReady=$scope.$on("youtube.player.ready",function($event,player){$scope.video.player=player,videoElem=angular.element(document.querySelector(moviePartSelector))}),$scope.getUpgradeUrl=function(){return $sce.trustAsResourceUrl(UXPinService.upgradePlanURL)},$scope.playMovie=function($event){$transition(videoElem,movieOnClass).then(function(){$scope.video.player.playVideo()})},$scope.closeMovie=function($event){$transition(videoElem,videoElem.removeClass(movieOnClass)).then(function(){$scope.video.player.stopVideo()})},$scope.closeModal=function($event){$modalInstance.close()},$scope.upgradePlan=function($event){$event.preventDefault(),$modalInstance.close(),$modal.open({templateUrl:"/scripts/modules/core/views/planUpgrade/modalUpgrade.view.html",controller:"PlanUpgradeController",windowClass:"iframe-modal-box upgrade-plan-modal-box"})},$scope.$on("$destroy",function(){onYoutubePlayerReady()})}]),function(){"use strict";function ScreencastifyDownloadCtrl($scope,$state,$stateParams,$timeout,$window,ScreencastifyService){function activate(){$scope.$on("$destroy",function(){timer&&$timeout.cancel(timer)})}function createUsabilityTest(event){event.preventDefault(),$state.go("home.page.usability-test",{pageId:$stateParams.pageId,page:1}),$scope.$close()}function verifyInstallation(){ScreencastifyService.isInstalled().then(function(isInstalled){isInstalled?$scope.$apply(function(){vm.isInstalled=!0}):timer=$timeout(verifyInstallation,1e3)})}var timer,vm=this;vm.isChrome=!!$window.chrome,vm.isInstalled=!1,vm.downloadURL="https://chrome.google.com/webstore/detail/screencastify-screen-vide/mmeijimgabbpbgpdklnllpncmdofkcpn",vm.helpPageURL="https://uxpin.desk.com/customer/portal/articles/1775664",vm.createUsabilityTest=createUsabilityTest,vm.verifyInstallation=verifyInstallation,activate()}angular.module("core").controller("ScreencastifyDownloadCtrl",ScreencastifyDownloadCtrl),ScreencastifyDownloadCtrl.$inject=["$scope","$state","$stateParams","$timeout","$window","ScreencastifyService"]}(),angular.module("core").controller("SitemapController",SitemapController),SitemapController.$inject=["_","$scope","$state","$q","CommentsService","PagesService","UsabilityTestService","Settings","editorSocket","EscapeHtmlService","PreviewNavigation","SitemapService","AnalyticsService","Engine","hotkeys","CanvasContainerHeight"],function(){"use strict";function TopBarController(_,$rootScope,$scope,$window,AnalyticsService,ApprovalsService,DesignSystem,DocumentationService,editorSocket,Engine,ExportService,FeatureToggler,LiveShareService,MODES,PagesService,PreviewNavigation,ProjectsService,Settings,SitemapService,SpecificationService,UsabilityTestService,UsersService,ScreencastifyRecorderApi){function onPanelChange(){vm.isExport&&Engine.updateCanvasRectangle()}function onChangeZenMode(event,zenMode){vm.isZenMode=zenMode,isSpecModeActive()&&!zenMode?Engine.setMode(MODES.SPEC):(Engine.setMode(MODES.PREVIEW),resetMultistates())}function getCanvasUpdateDate(){var lastUpdatedDate=SpecificationService.getLastUpdateDate();vm.lastUpdatedDate=lastUpdatedDate?lastUpdatedDate.fromNow:"",vm.lastUpdatedDateTitle=lastUpdatedDate?lastUpdatedDate.full:""}function setEngineMode(){isSpecModeActive()?(Engine.setMode(MODES.SPEC),Engine.setInteractionsEnabled(!1),Engine.clearSpecMode()):isDocumentationModeActive()?(Engine.setMode(MODES.DOCUMENTATION),Engine.setInteractionsEnabled(!1),resetMultistates()):(Engine.setMode(MODES.PREVIEW),Engine.setInteractionsEnabled(!isCommentsModeActive()),resetMultistates())}function getReferer(){return ApplicationConfiguration.loginPageURL+"/?cb="+encodeURIComponent($window.location.href)}function isCommentsModeActive(){return vm.isModeActive(vm.PREVIEW_MODES.COMMENT)}function isSpecModeActive(){return vm.isModeActive(vm.PREVIEW_MODES.SPEC)}function isDocumentationModeActive(){return vm.isModeActive(vm.PREVIEW_MODES.DOCUMENTATION)}function resetMultistates(){if(Engine.getPage()){var elements=Engine.getPage().ElementsManager.elements;_.forEach(elements,function(element){element.isMultistate()&&element.showDefaultState()})}}function onPageChange(e,id){var page=SitemapService.getPage(id),pageId=page&&page.version_of?page.version_of:id;vm.currentPageName=SitemapService.getPageName(pageId),vm.shouldShowIndicator=SitemapService.hasPageDocumentation(id)}function onPageDocumentationSet(data){if(data){var id=data.idPage;PagesService.getPages().then(function(){return vm.shouldShowIndicator=PagesService.currentPageId===id&&SitemapService.hasPageDocumentation(id),vm.hasProjectDocumentation=DocumentationService.hasProjectDocumentation(PagesService.pagesMap),!0})}}function finishUserTestingSession(){vm.isRecording?(vm.finishWhenVideoReady=!0,ScreencastifyRecorderApi.stopRecording(vm.recorderId)):(UsabilityTestService.quit(),PreviewNavigation.enablePanel(PreviewNavigation.PREVIEW_PANELS.SITEMAP),PreviewNavigation.setActivePanels(null))}function liveSessionStarted(SessionService){vm.toggleMode(!1,vm.PREVIEW_MODES.SIMULATE),vm.isLiveShareSession=!0,SessionService.isHostSession()&&(vm.isHostSession=!0),SessionService===UsabilityTestService&&(vm.isUserTestingSession=!0)}function liveSessionFinished(){vm.isLiveShareSession=!1,vm.isHostSession=!1,vm.isUserTestingSession=!1}var vm=this;vm.PREVIEW_MODES=PreviewNavigation.PREVIEW_MODES,vm.PREVIEW_PANELS=PreviewNavigation.PREVIEW_PANELS,vm.isModeActive=PreviewNavigation.isModeActive,vm.isAnonymous=UsersService.isAnonymous(),vm.isExport=ExportService.isExport(),vm.isExportMenuEnabled=!vm.isExport||ExportService.isMenuEnabled(),vm.isModeMenuEnabled=!vm.isExport||!!ApplicationConfiguration.modeMenuEnabled,vm.isSpecModeFeature=SpecificationService.isSpecificationVisible(),vm.isSpecModeStyleguideFeature=FeatureToggler.specModeStyleguide&&!ApplicationConfiguration.isDesignSystem,vm.isDocumentationModeFeature=FeatureToggler.documentationMode,vm.isApprovalMode=ApprovalsService.getIsActive(),vm.isHostSession=!1,vm.isLiveShareSession=!1,vm.isUserTestingSession=!1,vm.isRecording=!1,vm.finishWhenVideoReady=!1,vm.isLoaded=!1,vm.referer=getReferer(),vm.currentProjectHash=ProjectsService.currentProjectHash,vm.sessionStartTime=null,vm.hasProjectDocumentation=DocumentationService.hasProjectDocumentation(),vm.recorderId="UTRecorder",vm.isDesignSystem=ApplicationConfiguration.isDesignSystem,vm.symbolName=vm.isDesignSystem?DesignSystem.getSymbolContent().name:"",vm.toggleMode=function(event,mode){event&&event.target.classList.contains("icon-general-help")||PreviewNavigation.setActiveMode(mode)},vm.togglePanel=function(event,panel){event.preventDefault(),PreviewNavigation.togglePanel(panel),panel===vm.PREVIEW_PANELS.SITEMAP&&vm.isPanelVisible(vm.PREVIEW_PANELS.SITEMAP)&&AnalyticsService.kissEvent("Preview sitemap opened")},vm.isInteractionsHighlightDisabled=function(){return Settings.disableInteractionsHighlight},vm.isPanelVisible=function(panel){return PreviewNavigation.isPanelVisible(panel)},vm.canShowSitemap=function(){return!ProjectsService.isDocument()&&!Settings.disableSitemap&&!PreviewNavigation.isPanelDisabled(PreviewNavigation.PREVIEW_PANELS.SITEMAP)},vm.canShowActionsMenu=function(){return!(vm.isExport||vm.isApprovalMode||vm.isUserTestingSession||vm.isLiveShareSession||vm.isDesignSystem)},vm.canShowCommentMode=function(){return!vm.isUserTestingSession&&!vm.isLiveShareSession&&!Settings.disableComments},vm.canShowSpecMode=function(){return vm.isSpecModeFeature&&!vm.isApprovalMode&&!Settings.disableSpecification&&!vm.isUserTestingSession&&!vm.isLiveShareSession},vm.canShowZoom=function(){return(vm.isModeActive(vm.PREVIEW_MODES.SIMULATE)||vm.isModeActive(vm.PREVIEW_MODES.SPEC)||vm.isModeActive(vm.PREVIEW_MODES.DOCUMENTATION))&&!ProjectsService.isDocument()&&!vm.isUserTestingSession&&!vm.isLiveShareSession},vm.canShowDocumentationMode=function(){return vm.hasProjectDocumentation&&!Settings.disableDocumentation&&!vm.isApprovalMode&&!ProjectsService.isDocument()&&!vm.isUserTestingSession&&!vm.isLiveShareSession},vm.updateReferer=function(){vm.referer=getReferer()},vm.toggleInteractionsHighlightMode=function(event){event.preventDefault(),Settings.toggleSingleMode(PreviewEnums.MODES_FLAGS.INTERACTIONS)},vm.handleRecordingStart=function(){vm.isRecording=!0},vm.handleRecordingStop=function(){vm.isRecording=!1},vm.handleVideoReady=function(videoData){UsabilityTestService.storeVideoData(videoData),vm.finishWhenVideoReady&&(UsabilityTestService.quit(),PreviewNavigation.enablePanel(PreviewNavigation.PREVIEW_PANELS.SITEMAP),PreviewNavigation.setActivePanels(null))},vm.isZenMode=!1;var onPreviewModeChangedOff,openSimulateOff=$rootScope.$on(shortcutsEvents.OPEN_SIMULATE,vm.toggleMode.bind(this,!1,PreviewNavigation.PREVIEW_MODES.SIMULATE)),openSpecOff=$rootScope.$on(shortcutsEvents.OPEN_SPEC,vm.toggleMode.bind(this,!1,PreviewNavigation.PREVIEW_MODES.SPEC)),openCommentsOff=$rootScope.$on(shortcutsEvents.OPEN_COMMENTS,vm.toggleMode.bind(this,!1,PreviewNavigation.PREVIEW_MODES.COMMENT)),openDocOff=$rootScope.$on(shortcutsEvents.OPEN_DOC,vm.toggleMode.bind(this,!1,PreviewNavigation.PREVIEW_MODES.DOCUMENTATION)),onChangePageOff=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,onPageChange),onChangeZenModeOff=$rootScope.$on(PreviewEnums.ON_CHANGE_ZEN_MODE,onChangeZenMode),onPanelChangedOff=$rootScope.$on(PreviewEnums.ON_PANEL_CHANGED,onPanelChange),onPageDocumentationSetOff=editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_DOCUMENTATION_SET,onPageDocumentationSet);if($scope.$watch(SpecificationService.getLastUpdateDate,getCanvasUpdateDate),$scope.$on("$destroy",function(){openSimulateOff(),openSpecOff(),openCommentsOff(),openDocOff(),onChangePageOff(),onChangeZenModeOff(),onPanelChangedOff(),onPageDocumentationSetOff(),onPreviewModeChangedOff&&onPreviewModeChangedOff()}),!ProjectsService.isDocument()&&vm.isModeMenuEnabled)var onPageLoadOff=$rootScope.$on(PreviewEnums.ON_PAGE_LOADED,function(){var features={documentation:vm.canShowDocumentationMode(),specification:vm.canShowSpecMode()};setEngineMode(),$rootScope.$emit(PreviewEnums.FEATURES_AVAILABILITY,features),onPreviewModeChangedOff=$rootScope.$on(PreviewEnums.ON_PREVIEW_MODE_CHANGED,setEngineMode),onPanelChangedOff=$rootScope.$on(PreviewEnums.ON_PANEL_CHANGED,setEngineMode),vm.isLoaded=!0,onPageLoadOff()});else vm.isLoaded=!0;vm.isLiveSessionRunning=function(){return vm.isUserTestingSession||vm.isLiveShareSession},vm.finishLiveSession=function(){vm.isUserTestingSession?finishUserTestingSession():LiveShareService.quit()},ApplicationConfiguration.isDesignSystem||(LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveSessionStarted.bind(this,LiveShareService)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveSessionStarted.bind(this,UsabilityTestService)),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished))}angular.module("core").controller("TopBarController",TopBarController),TopBarController.$inject=["_","$rootScope","$scope","$window","AnalyticsService","ApprovalsService","DesignSystem","DocumentationService","editorSocket","Engine","ExportService","FeatureToggler","LiveShareService","MODES","PagesService","PreviewNavigation","ProjectsService","Settings","SitemapService","SpecificationService","UsabilityTestService","UsersService","ScreencastifyRecorderApi"]}(),angular.module("core").controller("UsabilityTestIntroductionController",["$rootScope","$scope","$sce","$filter","$modalInstance","UsabilityTestService","ProjectsService",function($rootScope,$scope,$sce,$filter,$modalInstance,UsabilityTestService,ProjectsService){"use strict";function formatNewLines(string){return $sce.trustAsHtml($filter("newLine")(string))}var testData=UsabilityTestService.getTestData();$scope.params={projectName:ProjectsService.currentProjectName,introduction:formatNewLines(angular.copy(testData.meta.introduction)),agreement:!1,activeStep:1,answerVideo:!1,blockVideo:!1},$scope.isActiveStep=function(number){return $scope.params.activeStep===number},$scope.onClickNextStep=function(number){$scope.params.activeStep=number},$scope.onClickStartSession=function(){var modalBoxWrapper=document.getElementById("modalBoxWrapper");$modalInstance.close(),document.body.removeChild(modalBoxWrapper),UsabilityTestService.startSession(LiveShare.enums.USER_TYPES.TESTER)},$scope.$on("$destroy",function(){onAllowCamera()});var onAllowCamera=$rootScope.$on(PreviewEnums.MEDIA_ACCESS,function(e,value){$scope.$apply(function(){$scope.params.answerVideo=!0,$scope.params.blockVideo=PreviewEnums.MEDIA_ACCESS_TYPE.DENIED===value})})}]),angular.module("core").controller("UsabilityTestTasksController",["$scope","$sce","$filter","UsabilityTestService",function($scope,$sce,$filter,UsabilityTestService){"use strict";function formatNewLines(string){if(!string||!angular.isString(string))throw new TypeError("String param required");return $sce.trustAsHtml($filter("newLine")(string))}function formatTasks(tasksCollection){function formatTask(task){return task.content=formatNewLines(task.content),task}return angular.isArray(tasksCollection)?tasksCollection.map(function(task){return formatTask(task)}):formatTask(tasksCollection)}var EVENTS=LiveShare.enums.EVENTS,ROOM_SETTINGS=LiveShare.enums.ROOM_SETTINGS;UsabilityTestService.registerObserverCallback(EVENTS.UPDATE_TASKS,function(tasks){$scope.$apply(function(){$scope.params.tasks=formatTasks(tasks)})}),$scope.isResolveButton=UsabilityTestService.getMyData().settings[ROOM_SETTINGS.CAN_CLOSE_TASKS],UsabilityTestService.registerObserverCallback(EVENTS.OPTIONS_CHANGED,function(data){data.key===ROOM_SETTINGS.CAN_CLOSE_TASKS&&$scope.$apply(function(){$scope.isResolveButton=data.val})}),UsabilityTestService.fetch().then(function(data){$scope.params={tasks:formatTasks(angular.copy(data.meta.tasks))}}),$scope.onClickResolveTask=function($event,task){$event.preventDefault(),UsabilityTestService.resolveTask(task.id)},UsabilityTestService.isHostSession()&&UsabilityTestService.startSession(LiveShare.enums.USER_TYPES.HOST)}]),angular.module("core").controller("UsabilityTestWizardController",["$q","_","$scope","$rootScope","$state","$timeout","$translate","$stateParams","UsabilityTestService","PagesService","ProjectsService","BreakpointsService","UsersService","animate",function($q,_,$scope,$rootScope,$state,$timeout,$translate,$stateParams,UsabilityTestService,PagesService,ProjectsService,BreakpointsService,UsersService,animate){"use strict";var newTaskTitleInput;$scope.forms={},$scope.params={loading:!1,projectName:ProjectsService.currentProjectName,activeStepIndex:0,steps:[{breadcrumbs:!0,label:"Introduction",introduction:""},{breadcrumbs:!0,label:"Tasks",tasks:[],newTask:{title:"",content:""},onStart:function(){setFocusToNewTaskTitle()}},{breadcrumbs:!0,label:"Settings",options:[],breakpoints:{name:"Display selected breakpoints",enabled:!1,list:PagesService.getCurrentPageBreakpoints().map(function(breakpoint){return breakpoint.value=0,breakpoint})}},{breadcrumbs:!0,label:"Participant",inviteURL:"",onStart:function(){var step=$scope.getStep(3);step.inviteURL||UsabilityTestService.makeRoomReservation().then(function(){step.inviteURL=UsabilityTestService.getInviteURL()})}},{breadcrumbs:!1,label:"Finish"}]},$translate("UT_INTRODUCTION_TEXT").then(function(UT_INTRODUCTION_TEXT){$scope.params.steps[0].introduction=UT_INTRODUCTION_TEXT}),UsabilityTestService.getConfigurationOptions().then(function(options){$scope.getStep(2).options=options}),$scope.getStepsWithBreadcrumbs=function(){return _.filter($scope.params.steps,"breadcrumbs")},$scope.getStep=function(index){var value;if(value="next"===index?$scope.params.steps[$scope.params.activeStepIndex+1]:"prev"===index?$scope.params.steps[$scope.params.activeStepIndex-1]:"undefined"!=typeof index?$scope.params.steps[index]:$scope.params.steps[$scope.params.activeStepIndex],!value)throw new RangeError('"'+index+'" is out of range');return value},$scope.getStepFormObject=function(index){return"undefined"==typeof index?$scope.forms["step"+$scope.params.activeStepIndex]:$scope.forms["step"+index]},$scope.isActiveStep=function(stepIndex){if("undefined"==typeof stepIndex)throw new TypeError("stepIndex argument is required.");return $scope.params.activeStepIndex===stepIndex},$scope.onClickNextStep=function(){var breakpoints=$scope.getStep().breakpoints;breakpoints&&breakpoints.enabled&&breakpoints.list&&checkIfCurrentBreakpointIsLocked(breakpoints.list,PagesService.currentBreakpointId)&&PagesService.setCurrentBreakpointId(getFirstUnlockedBreakpointId(breakpoints.list)),goToStep($scope.params.activeStepIndex+2)},$scope.onClickPrevStep=function(){goToStep($scope.params.activeStepIndex)},$scope.onClickAddNewTask=function(model){$scope.getStep(1).tasks.push(angular.copy(model)),model.title="",model.content="",scrollTaskListToBottom(),setFocusToNewTaskTitle()},$scope.onClickDeleteTask=function($event,$index){var DELETING_ANIMATION_DURATION=300,step=$scope.getStep(1);$event.preventDefault(),angular.isNumber($index)?(step.tasks[$index].deleting=!0,$timeout(function(){step.tasks.splice($index,1)},DELETING_ANIMATION_DURATION)):step.tasks.length?($index=step.tasks.length-1,step.tasks[$index].deleting=!0,step.newTask.title=step.tasks[$index].title,step.newTask.content=step.tasks[$index].content,$timeout(function(){step.tasks.splice($index,1);
},DELETING_ANIMATION_DURATION)):(step.newTask.title="",step.newTask.content="")};var scrollTaskListToBottom=function(){var contentWrapper=document.querySelector("#wizard-content"),ANIM_DURATION=1;animate(contentWrapper,ANIM_DURATION,{scrollTop:contentWrapper.scrollHeight-contentWrapper.scrollTop+contentWrapper.scrollTop})},setFocusToNewTaskTitle=function(){newTaskTitleInput||(newTaskTitleInput=document.getElementById("new-task-title")),newTaskTitleInput.focus()};$scope.onClickInput=function($event){$event.target.select()},$scope.onCopySuccess=function(){var COPY_MESSAGE_HIDE_DELAY=1e3;$scope.params.isCopied=!0,$timeout(function(){$scope.params.isCopied=!1},COPY_MESSAGE_HIDE_DELAY)};var getConfigurationOptions=function(){var options=[];return $scope.getStep(2).options.forEach(function(option){option.value&&options.push(option.param)}),options.join(",")};$scope.onClickSessionStart=function(){UsabilityTestService.startInitializing({testData:getStepsData(),options:getConfigurationOptions()})},$scope.$on("$destroy",function(){onStateChangeSuccess()});var checkIfCurrentBreakpointIsLocked=function(breakpoints,breakpointId){var locked=!1;return _.forEach(breakpoints,function(breakpoint){if(breakpoint.id===breakpointId&&!breakpoint.value)return locked=!0,!1}),locked},getFirstUnlockedBreakpointId=function(breakpoints){var breakpointId=null;return _.forEach(breakpoints,function(breakpoint){if(breakpoint.value)return breakpointId=breakpoint.id,!1}),breakpointId},goToStep=function(stepNumber){$scope.params.activeStepIndex!==stepNumber-1&&$state.go("home.page.usability-test",_.extend($stateParams,{step:stepNumber,pageId:PagesService.getPageByBreakpoint($stateParams.pageId)}))},onStateChangeSuccess=$rootScope.$on("$stateChangeSuccess",function(e,toState,toParams){if($state.includes("**.usability-test.**")){var currentStepIndex=parseInt(toParams.step,10)-1;if(!isNaN(currentStepIndex)){$scope.params.activeStepIndex=currentStepIndex||0;var step=$scope.getStep();angular.isFunction(step.onStart)&&$timeout(step.onStart,100)}}}),getStepsData=function(){return{meta:{introduction:angular.copy($scope.getStep(0).introduction),tasks:function(){var step=$scope.getStep(1),tasks=angular.copy(step.tasks);return step.newTask.title.trim()&&step.newTask.content.trim()&&tasks.push(angular.copy(step.newTask)),tasks.map(function(task,index){return task.id=index+1,task})}()},user:{id:UsersService.me.id_user,is_trial:UsersService.me.is_trial},settings:function(){var options=[];return $scope.getStep(2).options.forEach(function(option){option.value&&options.push({param:option.param})}),options}(),project:{hash:ProjectsService.currentProjectHash,available_breakpoints:function(){var breakpoints=$scope.getStep(2).breakpoints;if(breakpoints.enabled&&breakpoints.list){var available=[];return breakpoints.list.forEach(function(breakpoint){breakpoint.value&&available.push({id:breakpoint.id})}),available}return null}()}}}}]),function(){"use strict";function VideoUploadCtrl($scope,$window,ProjectsService,UXPinService,UsabilityTestService,UTVideoService){function activate(){vm.videoData=UsabilityTestService.getVideoData(),vm.videoName=getVideoName(),vm.downloadURL=getDownloadUrl(vm.videoData.file),initEvents(),prepareUploadData().then(upload)}function initEvents(){$window.addEventListener("beforeunload",handleBeforeUnload),$scope.$on("$destroy",function(){$window.removeEventListener("beforeunload",handleBeforeUnload)})}function prepareUploadData(){return UTVideoService.getUploadUrl(vm.videoName,vm.projectData).then(function(res){vm.uploadData=res.data},handleUploadError)}function upload(){setUploadState(vm.uploadStates.UPLOADING),UTVideoService.uploadVideo({url:vm.uploadData.uploadUrl,data:vm.videoData.file,uploadEventHandlers:{progress:handleUploadProgress}}).then(createDocument,handleUploadError)}function createDocument(){var recordingTime=getCurrentTime();UTVideoService.createDocument({id_collection:vm.projectData.collectionId,video_url:vm.uploadData.downloadUrl,test_name:vm.videoName,height:vm.videoData.height,width:vm.videoData.width,duration:vm.videoData.duration,recording_time:recordingTime}).then(handleUploadSuccess,handleUploadError)}function retry(){vm.uploadProgress=0,vm.uploadData?upload():prepareUploadData().then(upload)}function handleUploadProgress(event){event.loaded&&event.total&&(vm.uploadProgress=Math.floor(event.loaded/event.total*100))}function handleUploadSuccess(){setUploadState(vm.uploadStates.UPLOADED),$window.removeEventListener("beforeunload",handleBeforeUnload)}function handleUploadError(){setUploadState(vm.uploadStates.ERROR)}function handleBeforeUnload(event){event.returnValue=!0}function setUploadState(state){vm.uploadState=state}function getVideoName(){return vm.projectName+".webm"}function getCurrentTime(){return(new Date).getTime()}function getDownloadUrl(file){return $window.URL.createObjectURL(file,{type:"video/webm"})}var vm=this;vm.uploadStates={UPLOADING:"uploading",UPLOADED:"uploaded",ERROR:"error"},vm.projectData={collectionId:ProjectsService.currentCollectionId,projectId:ProjectsService.currentProjectId},vm.projectName=ProjectsService.currentProjectName,vm.dashboardURL=UXPinService.getCurrentCollectionURL(),vm.downloadURL="",vm.videoName="",vm.videoData=null,vm.uploadState=vm.uploadStates.UPLOADING,vm.uploadData=null,vm.uploadProgress=0,vm.retry=retry,activate()}angular.module("core").controller("VideoUploadCtrl",VideoUploadCtrl),VideoUploadCtrl.$inject=["$scope","$window","ProjectsService","UXPinService","UsabilityTestService","UTVideoService"]}(),function(global){"use strict";var AnimationEnums=function(){var EASING_MODES={LINEAR:"easeNone",IN:"easeIn",OUT:"easeOut",IN_OUT:"easeInOut"},EASING_CSS_MODES={LINEAR:"linear",IN:"ease-in",OUT:"ease-out",IN_OUT:"ease-in-out"},DEFAULT_EASING_MODE=EASING_MODES.OUT,DEFAULT_DURATION_TIME=250;return{EASING_MODES:EASING_MODES,EASING_CSS_MODES:EASING_CSS_MODES,DEFAULT_EASING_MODE:DEFAULT_EASING_MODE,DEFAULT_DURATION_TIME:DEFAULT_DURATION_TIME}}();global.AnimationEnums=AnimationEnums}(window),function(global){"use strict";var ElementEnums=function(){return{TYPE:{CANVAS:"canvas",COMPONENT:"component",ELEMENT:"element",GROUP:"group",HOTSPOT:"hotspot",IMAGE:"image",IMAGE_SKETCH:"imagesketch",MULTISTATE:"multistate",TAG:"tag",TEXT:"text",TEXT_ELEMENT:"textelement"},TYPE_CLASSES:{ELEMENT:"icon-general-element",SMART_ELEMENT:"icon-general-smart-element",FOLDER:"icon-general-folder",MULTISTATE:"icon-general-state",TEXT:"icon-general-text-element",IMAGE:"icon-general-image-element",IMAGE_SKETCH:"icon-general-sketch-element",HOTSPOT:"icon-general-hotspot-element"}}}();global.ElementEnums=ElementEnums}(window),function(global){"use strict";var keysEnums=function(){return{KEY_CODES:{ENTER:13,ESC:27,SPACE:32,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40}}}();global.keysEnums=keysEnums}(window),function(global){"use strict";var PreviewEnums=function(){return{PIN_RADIUS:14,COMMENT_FORM_DELTA_X:40,COMMENT_FORM_DELTA_Y:-24,SHOW_RESOLVED_TIMEOUT:5e3,UNDO_TIMEOUT:6e3,INSPECTOR_SOURCE_CHANGED:"inspectorSourceChanged",INSPECTOR_TARGET_CHANGED:"inspectorTargetChanged",SUBMIT_COMMENT:"submitComment",ADD_COMMENT:"addComment",COMMENT_POINT_CLASS:"comment-point",ADDING_COMMENT:"addingComment",SELECT_COMMENT:"selectComment",RESOLVE_COMMENT:"resolveComment",DELETING_COMMENT:"deletingComment",DELETE_COMMENT:"deleteComment",REPLYING_COMMENT:"replyingComment",DRAGGING_COMMENT:"draggingComment",SORT_COMMENTS:"sortComments",LOADING_COMMENTS:"loadingComments",ON_CHANGE_PAGE:"onChangePage",ON_CHANGE_ZEN_MODE:"onChangeZenMode",LAYER_SELECTED:"onLayerSelected",LAYER_HOVERED:"onLayerHovered",ON_PAGE_SCROLL:"onPageScroll",NAVIGATE_HISTORY_BACK:"navigateHistoryBack",NAVIGATE_TO_PAGE:"navigateToPage",ON_CONTENT_LOADED:"onContentLoaded",ON_PAGE_LOADED:"onPageLoaded",ON_PAGE_INITIALIZED:"onPageInitialized",SPEC_MODE_REFRESH_ELEMENT_SELECTION:"specModeRefreshElementSelection",SPEC_MODE_RESET_ELEMENT_SELECTION:"specModeResetElementSelection",ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED:"onShowCommentsResolvedSettingsChanged",ON_MODE_CHANGED:"onModeChanged",ON_PREVIEW_MODE_CHANGED:"onPreviewModeChanged",ON_PANEL_CHANGED:"onPanelChanged",ON_PANEL_TOGGLE_EXPAND:"onPanelToggleExpand",LOADING:"loading",MEDIA_ACCESS:"mediaAccess",SET_ANONYMOUS_NAME:"setAnonymousName",ANONYMOUS_ADD_COMMENT:"anonymousAddComment",ON_ASSIGNMENT_LIST_OPEN:"onOpenAssignmentList",ON_CHANGE_NOTIFICATIONS:"onChangeNotifications",ON_NOTIFICATIONS_UPDATE:"onNotificationsUpdate",ON_SHOW_MENTIONS_LIST:"onShowMentionsList",SELECT_MENTIONS_LIST:"selectMentionsList",SEARCH_MENTIONS_LIST:"searchMentionsList",ON_SELECT_MENTIONS_LIST:"onSelectMentionsList",ON_HIDE_MENTIONS_LIST:"onHideMentionsList",ON_UPDATE_MENTIONS_LIST_POSITION:"onUpdateMentionsListPosition",ON_COMMENT_TYPE_UPDATE:"onCommentTypeUpdate",ON_COMMENT_EDIT:"onCommentEdit",ON_COMMENT_EDIT_EXIT:"onCommentEditExit",ON_COMMENT_CONTENT_UPDATE:"onCommentContentUpdate",ON_COMMENT_ASSIGNED_USER_UPDATE:"onCommentAssignedUserUpdate",ON_APP_VIEW_PROMO_CLOSE:"appViewPromoClose",ON_COMMENTS_FILTER_CHANGE:"onCommentsFilterChange",ON_ZOOM_CHANGE:"onZoomChange",ON_ZOOM_IN:"zoomIn",ON_ZOOM_OUT:"zoomOut",ON_ZOOM_RESET:"zoomReset",APP_VIEW_PROMO_VIEWED:"appViewPromoViewed",ON_STYLEGUIDE_DATA_LOAD_STARTED:"onStyleGuideDataLoadStarted",ON_STYLEGUIDE_DATA_LOAD_FINISHED:"onStyleGuideDataLoadFinished",COMMENT_NOTIFY_ALL:2,COMMENT_NOTIFY_NONE:0,COMMENT_NOTIFY_CHOSEN:1,FEATURES_AVAILABILITY:"featuresAvailability",DOCUMENTATION_EXISTS:"documentationExists",PAGE_ANIMATION_START:"pageAnimationStart",PAGE_ANIMATION_INIT:"pageAnimationInit",MODES_FLAGS:{ALL:"cmhid",COMMENTS:"c",DOCUMENTATION:"d",INTERACTIONS:"i",SITEMAP:"m",SPECIFICATION:"h"},MEDIA_ACCESS_TYPE:{REQUEST:"request",ALLOWED:"allowed",DENIED:"denied",HIDE:"hide"},SOCKET:{WILD_CART:"*",ON_ACCOUNT_TYPEKIT_KIT_UPDATED:"accountTypekitKitUpdated",ON_CHANGE_PROPERTIES:"changeProperties",ON_DELETE_COMPONENT:"deleteComponent",ON_PAGE_SAVED:"pageSaved",ON_PAGE_CREATE:"addNewPage",ON_PAGE_UPDATE:"updatePage",ON_PAGE_DELETE:"deletePage",ON_PAGE_REORDER:"savePagesOrder",ON_PAGE_DOCUMENTATION_SET:"pageDocumentationSet",ON_COMMENT_CREATE:"createComment",ON_COMMENT_UPDATE:"updateComment",ON_COMMENT_DELETE:"deleteComment",ON_COMMENT_TYPE_UPDATE:"commentTypeUpdate",ON_COMMENT_CONTENT_UPDATE:"commentContentUpdate",ON_COMMENT_ASSIGNED_USER_UPDATE:"commentAssignedUserUpdate",ON_EDIT_VERSION:"editVersion"},KM_EVENTS:{DELETE_UNDONE:"Preview - comments - delete undone",VIEW_MODE_SET:"Preview - Comments - View mode set",EDITED_COMMENTS:"Preview - Comments - Edited comments",COMMENT_ADDED:"Preview - Comments - Comment added",COMMENT_TYPE_CHANGED:"Preview - Comments - Comment type changed",NOTIFICATION_CHANGED:"Preview - Comments - Notification changed"},APPROVALS:{LABEL:{APPROVE:"Approve",REJECT:"Reject"},STATUS:{APPROVED:"approved",REJECTED:"rejected",PENDING:"pending"}},UPDATE_INFO:{LS:{SEEN:"updateInfoSeen"},MODAL_CONTENT_DIR:"/scripts/modules/core/directives/updateInfo/modal-content"}}}();global.PreviewEnums=PreviewEnums}(window),function(global){"use strict";var shortcutsEvents={OPEN_SIMULATE:"OPEN_SIMULATE",OPEN_COMMENTS:"OPEN_COMMENTS",OPEN_SPEC:"OPEN_SPEC",OPEN_DOC:"OPEN_DOC"},shortcuts=[{shortcuts:["mod+1","ctrl+1"],description:"Open simulate mode",event:shortcutsEvents.OPEN_SIMULATE},{shortcuts:["mod+2","ctrl+2"],description:"Open comments mode",event:shortcutsEvents.OPEN_COMMENTS},{shortcuts:["mod+3","ctrl+3"],description:"Open spec mode",event:shortcutsEvents.OPEN_SPEC},{shortcuts:["mod+4","ctrl+4"],description:"Open documentation mode",event:shortcutsEvents.OPEN_DOC}];global.shortcuts=shortcuts,global.shortcutsEvents=shortcutsEvents}(window),function(global){"use strict";var UpdateInfoModals=function(){return{SPEC_MODE_ENTERPRISE:{content:"spec-mode-enterprise.html",start:"2016-10-11T00:00:00",end:"2016-10-17T23:59:59",type:"all",plan:"enterprise",loggedInOnly:!0},SPEC_MODE:{content:"spec-mode.html",start:"2016-10-18T00:00:00",end:"2016-10-18T23:59:59",type:"all",plan:"enterprise",loggedInOnly:!0}}}();global.UpdateInfoModals=UpdateInfoModals}(window),angular.module("core").directive("previewCloud",function($document){"use strict";var ACTIVE_CLASS="active",VISIBLE_CLASS="visible",CLOUD_CLASS="cloud",PreviewCloud=function($scope,$element){this.$scope=$scope,this.$element=$element,this.eventRefs={},this.cloudEl=$element[0].querySelector("."+CLOUD_CLASS)};return PreviewCloud.prototype.start=function(){angular.element(this.$element[0].querySelector("[preview-cloud-trigger]")).on("click",this.onClickToggle.bind(this)),this.$scope.$watch("previewCloud",function(value){value?this.open():this.close()}.bind(this))},PreviewCloud.prototype.open=function(){this.$element[0].classList.add(ACTIVE_CLASS),this.cloudEl.classList.add(VISIBLE_CLASS),this.attachEvents()},PreviewCloud.prototype.close=function(){this.$element[0].classList.remove(ACTIVE_CLASS),this.cloudEl.classList.remove(VISIBLE_CLASS),this.detachEvents()},PreviewCloud.prototype.clickOnDocument=function(e){e.target===this.$element[0]||this.$element[0].contains(e.target)||this.toggle(!1)},PreviewCloud.prototype.keyDown=function(e){27===e.keyCode&&this.toggle(!1)},PreviewCloud.prototype.attachEvents=function(){this.eventRefs.clickOnDocument=this.clickOnDocument.bind(this),this.eventRefs.keyDown=this.keyDown.bind(this),$document.on("click",this.eventRefs.clickOnDocument),$document.on("keydown",this.eventRefs.keyDown)},PreviewCloud.prototype.detachEvents=function(){$document.off("click",this.eventRefs.clickOnDocument),$document.off("keydown",this.eventRefs.keyDown)},PreviewCloud.prototype.onClickToggle=function(){this.toggle()},PreviewCloud.prototype.toggle=function(isOpen){var value=!this.$scope.previewCloud;"undefined"!=typeof isOpen&&(value=!!isOpen),this.$scope.$apply(function(){this.$scope.previewCloud=value}.bind(this))},{restrict:"A",scope:{previewCloud:"=?"},link:function(scope,element){var previewCloud=new PreviewCloud(scope,element);previewCloud.start()}}}),function(){"use strict";angular.module("core").directive("autoHeight",function($timeout){return{restrict:"A",link:function($scope,element,attrs){var resize=function(){var el=element[0];$timeout(function(){el.style.height="auto",el.style.height=el.offsetHeight-el.clientHeight+el.scrollHeight+"px"},0)};$scope.$watch(attrs.ngModel,resize)}}})}(),angular.module("core").directive("captureVideo",["$rootScope","$timeout",function($rootScope,$timeout){"use strict";navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var link=function($scope,$element,attrs){var localMediaStream,video=$element[0];attrs.width&&($element.width=attrs.width),attrs.height&&($element.height=attrs.height),$element.on("$destroy",function(){localMediaStream&&(localMediaStream.stop(),video.src="")}),navigator.getUserMedia&&navigator.getUserMedia({video:!0,audio:!0},function(stream){localMediaStream=stream,video.src=window.URL.createObjectURL(stream),$rootScope.$emit(PreviewEnums.MEDIA_ACCESS,PreviewEnums.MEDIA_ACCESS_TYPE.ALLOWED)},function(err){window.console.error(err.stack),$rootScope.$emit(PreviewEnums.MEDIA_ACCESS,PreviewEnums.MEDIA_ACCESS_TYPE.DENIED)})};return{restrict:"E",replace:!0,template:"<video autoplay></video>",link:link}}]),angular.module("core").directive("clickOutside",["$compile","$document",function($compile,$document){"use strict";var ClickOutside=function(scope,element){this._scope=scope,this._element=element,this._eventsRef={},this.attachEvents()};ClickOutside.prototype.attachEvents=function(){this._eventsRef.onClick=this.clickOutside.bind(this),document.addEventListener("click",this._eventsRef.onClick),this._element.on("$destroy",function(){this.detachEvents()}.bind(this))},ClickOutside.prototype.detachEvents=function(){document.removeEventListener("click",this._eventsRef.onClick)},ClickOutside.prototype.clickOutside=function(e){e.target===this._element[0]||this._element[0].contains(e.target)||this._scope.callback()};var link=function(scope,element,attrs){new ClickOutside(scope,element)};return{restrict:"A",scope:{callback:"&"},link:link}}]),function(){"use strict";function clipboardCopy(ClipboardService,$timeout,AnalyticsService,_){return{restrict:"A",scope:{successContainerClass:"@?",childSelector:"@?",skipCopyInfo:"=?"},link:function(scope,element,attrs){function getContainerClass(){return scope.successContainerClass?findParent(element,scope.successContainerClass):element}function toggleClass(e,el){if(addCopyInfo(),AnalyticsService.kissEvent("Spec - Copy value"),$timeout.cancel(timeout),codeMirror){for(var lineCount=codeMirror.lineCount(),i=0;i<lineCount;i++)removeLineClass(i);clickedLine=indexInParent(e.trigger.parentElement)}if(codeMirror&&scope.childSelector){var codeMirrorTriggered=findParent(angular.element(e.trigger),CODE_MIRROR.WRAPPER_CLASS);if(!_.isEqual(codeMirrorTriggered[0].CodeMirror,codeMirror))return}$timeout(function(){codeMirror&&scope.childSelector?addLineClass(clickedLine):el.addClass(SUCCES_CLASSNAME)},0),timeout=$timeout(function(){codeMirror&&scope.childSelector?removeLineClass(clickedLine):el.removeClass(SUCCES_CLASSNAME)},TIMEOUT_DELAY),$timeout(function(){removeCopyInfo()},TIMEOUT_DELAY+ANIMATION_DELAY)}function addLineClass(lineNumber){codeMirror.addLineClass(lineNumber,CODE_MIRROR.COPIED_PLACE,CODE_MIRROR.COPIED_CLASS)}function removeLineClass(lineNumber){codeMirror.removeLineClass(lineNumber,CODE_MIRROR.COPIED_PLACE,CODE_MIRROR.COPIED_CLASS)}function indexInParent(node){for(var children=node.parentNode.childNodes,num=0,i=0;i<children.length;i++){if(children[i]==node)return num;1==children[i].nodeType&&num++}return-1}function addCopyInfo(){if(!_.isEmpty(container)&&!scope.skipCopyInfo)return copyInfoElement=angular.element(COPIED_INFO),container.append(copyInfoElement)}function removeCopyInfo(){if(copyInfoElement)return copyInfoElement.remove()}function findParent(el,className){for(;el[0]&&(el=el.parent())&&!el.hasClass(className););return el}var clipboard,copyInfoElement,codeMirror,clickedLine,timeout,COPIED_INFO='<span class="copied-info custom-color">Copied</span>',SUCCES_CLASSNAME="copied",ANIMATION_DELAY=200,MOUNT_DELAY=100,TIMEOUT_DELAY=400,container=getContainerClass(),CODE_MIRROR={WRAPPER_CLASS:"CodeMirror",COPIED_PLACE:"gutter",COPIED_CLASS:"copied"};clipboard=scope.childSelector?new ClipboardService(scope.childSelector,{text:function(trigger){return trigger.textContent}}):new ClipboardService(element[0]),scope.childSelector&&setTimeout(function(){var codeMirrorEl=element[0].querySelector("."+CODE_MIRROR.WRAPPER_CLASS);codeMirrorEl&&(codeMirror=codeMirrorEl.CodeMirror)},MOUNT_DELAY),clipboard.on("success",function(e){return toggleClass(e,container)})}}}angular.module("core").directive("clipboardCopy",clipboardCopy),clipboardCopy.$inject=["ClipboardService","$timeout","AnalyticsService","_"]}(),angular.module("core").directive("highlight",["$compile",function($compile){"use strict";var comparatorSearch=function(search,comment){return!(!comment||!search)&&comment.toLocaleLowerCase().indexOf(search.toLocaleLowerCase())!==-1},highlight=function(search,comment){return angular.isString(comment)&&(comment=comment.replace(/&#10;/g,"<br>").replace(/\n/g,"<br>")),comparatorSearch(search,comment)?comment.replace(new RegExp(search,"gi"),function(match){return'<span class="highlight">'+match+"</span>"}):comment},link=function(scope,element,attrs){scope.$watch("inputText",function(value){element.html(highlight(scope.searchFor,value)),$compile(element.contents())(scope)}),scope.$watch("searchFor",function(value){element.html(highlight(value,scope.inputText)),$compile(element.contents())(scope)})};return{restrict:"A",scope:{inputText:"=",searchFor:"="},link:link}}]),function(){"use strict";function overflowedPage($rootScope,PagesService,CommentsService,$timeout){return{restrict:"A",scope:!0,link:function(scope,element){function isVisibleX(pinX,scrollX){return!pageInfo||pinX+PreviewEnums.PIN_RADIUS-scrollX>0&&pinX-scrollX<pageInfo.width-PreviewEnums.PIN_RADIUS}function isVisibleY(pinY,scrollY){return!pageInfo||pinY-scrollY>0&&pinY-scrollY<pageInfo.height-PreviewEnums.PIN_RADIUS}function resetScroll(domElement){domElement.scrollTop=0,domElement.scrollLeft=0}function fixScrollbars(){var auto="auto",hidden="hidden",domElement=element[0],initialOverflowX=domElement.style.overflowX,initialOverflowY=domElement.style.overflowY;initialOverflowX!==auto&&initialOverflowY!==auto||(domElement.style.overflowX=hidden,domElement.style.overflowY=hidden,$timeout(function(){domElement.style.overflowX=initialOverflowX,domElement.style.overflowY=initialOverflowY},300))}var pageInfo,DEBOUNCE_RATE=100;element.on("scroll",function(e){var domElement=element[0];$rootScope.$emit(PreviewEnums.ON_PAGE_SCROLL,domElement.scrollLeft,domElement.scrollTop)});var debounceFixScrollbars=_.debounce(fixScrollbars.bind(this,!0),DEBOUNCE_RATE),onChangePage=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(){resetScroll(element[0])}),onPageLoaded=$rootScope.$on(PreviewEnums.ON_PAGE_LOADED,function(){debounceFixScrollbars()}),onZoomChange=$rootScope.$on(PreviewEnums.ON_ZOOM_CHANGE,function(e){debounceFixScrollbars()}),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id,type){if(id&&PagesService&&PagesService.currentPageProperties&&(PagesService.currentPageProperties.size.scrollx||PagesService.currentPageProperties.size.scrolly)){var pin=CommentsService.commentsMap[id],overflowedPage=element[0],scrollX=overflowedPage.scrollLeft,scrollY=overflowedPage.scrollTop;if(pageInfo||(pageInfo=overflowedPage.getBoundingClientRect()),!isVisibleX(pin.position.x,scrollX)){var left=pin.position.x+PreviewEnums.PIN_RADIUS-Math.round(overflowedPage.offsetWidth/2);left=Math.min(pageInfo.width,left),overflowedPage.scrollLeft=left}if(!isVisibleY(pin.position.y,scrollY)){var top=pin.position.y+PreviewEnums.PIN_RADIUS-Math.round(overflowedPage.offsetHeight/2);top=Math.min(pageInfo.height,top),overflowedPage.scrollTop=top}}});scope.$on("$destroy",function(){onChangePage(),onPageLoaded(),onZoomChange(),onSelectComment()})}}}angular.module("core").directive("overflowedPage",overflowedPage),overflowedPage.$inject=["$rootScope","PagesService","CommentsService","$timeout"]}(),function(){"use strict";function pageAnimation($rootScope,PageAnimationFactory){function link(scope,element){$rootScope.$on(PreviewEnums.PAGE_ANIMATION_INIT,function(e,animation){Preview.setAnimation(animation),PageAnimationFactory.init(element,animation)}),$rootScope.$on(PreviewEnums.PAGE_ANIMATION_START,function(){PageAnimationFactory.startAnimation()})}return{restrict:"A",link:link}}angular.module("core").directive("pageAnimation",pageAnimation),pageAnimation.$inject=["$rootScope","PageAnimationFactory"]}(),function(){"use strict";function pvHideEmpty($timeout){function link(scope,el,attrs){$timeout(function(){_.isEmpty(el[0].innerHTML.trim())&&(el[0].style.display="none")})}return{restrict:"A",link:link}}angular.module("core").directive("pvHideEmpty",pvHideEmpty),pvHideEmpty.$inject=["$timeout"]}(),angular.module("core").directive("script",[function(){"use strict";var link=function(scope,element,attrs){if("text/javascript"===attrs.type&&"1"===attrs.evaluate){var code=element.text(),re=/(window.location.href)(\s*=\s*)([\w]+((\.)?[\w]+)*)/gim,subst="Preview.gotoPage($3)",codeParsed=code.replace(re,subst),f=new Function(codeParsed);f()}};return{restrict:"E",scope:!1,link:link}}]),angular.module("core").directive("syncFocusWith",function($timeout,$rootScope){"use strict";return{restrict:"A",scope:{focusValue:"=syncFocusWith"},link:function($scope,$element,attrs){$scope.$watch("focusValue",function(currentValue,previousValue){currentValue!==!0||previousValue?currentValue===!1&&previousValue&&$element[0].blur():$timeout(function(){$element[0].focus()},10)})}}}),angular.module("core").directive("timeCounter",["moment",function(moment){"use strict";function startCounting(from){interval=setInterval(function(){var diff=moment(new Date).diff(moment(startTime));element.textContent=moment(diff).format("mm:ss")},1e3)}function stopCounting(){clearInterval(interval)}var startTime,element,interval,link=function($scope,$element,attrs){if(element=$element[0],attrs.class&&(element.className=attrs.class),!attrs.startTime)throw new Error("start-time attribute is required");startTime=attrs.startTime,startCounting(),$element.on("$destroy",function(){stopCounting()})};return{restrict:"E",replace:!0,template:"<time></time>",link:link}}]),function(){"use strict";angular.module("core").directive("toggleable",["$document","$rootScope",function($document,$rootScope){function isPointInsideRect(point,rect){return point.x>=rect.left&&point.x<=rect.right&&point.y>=rect.top&&point.y<=rect.bottom}function notContainsTarget(target,elementsToIgnore){return Array.prototype.every.call(elementsToIgnore,function(el){return el!==target&&!el.contains(target)})}function commentWindowNotHit(x,y){var comments=$document[0].querySelectorAll("section.comments-group");return!comments||Array.prototype.every.call(comments,function(el){return!isPointInsideRect({x:x,y:y},el.getBoundingClientRect())})}function onClick(e){var elementsToIgnore=$document[0].querySelectorAll("section.comments-group");notContainsTarget(e.target,elementsToIgnore)&&commentWindowNotHit(e.clientX,e.clientY)&&$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null)}var Toggleable=function(scope,element){this._scope=scope,this._element=element};Toggleable.prototype.toggle=function(e){this._scope.toggle(e)};var link=function(scope,element){var el=new Toggleable(scope,element);element.on("click",function(e){el.toggle(e),e.stopPropagation()}),$document.on("click",onClick),scope.$on("$destroy",function(){$document.off("click",onClick)})};return{restrict:"A",link:link}}])}(),function(){"use strict";angular.module("core").directive("whenScrolled",function(){return{restrict:"A",link:function(scope,element,attrs){var MARGIN=100,raw=element[0];element.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>=raw.scrollHeight-MARGIN&&scope.$apply(attrs.whenScrolled)})}}})}(),function(){"use strict";function capitalizeFirstLetters(_){return function(string){if(!string)return"";if(parseInt(string))return string;var wordsArray=string.split(" "),wordsUpper=[],wordUpper="";return _.forEach(wordsArray,function(word){wordUpper=word.charAt(0).toUpperCase()+word.slice(1),wordsUpper.push(wordUpper)}),wordsUpper.join(" ")}}angular.module("core").filter("capitalizeFirstLetters",capitalizeFirstLetters),capitalizeFirstLetters.$inject=["_"]}(),angular.module("core").filter("moment",function(){"use strict";return function(dateString,format){return moment(dateString).format(format)}}),angular.module("core").filter("momentFromNow",function(){"use strict";return function(dateString){return moment(dateString).fromNow()}}),angular.module("core").filter("newLine",function(){"use strict";return function(text){return text.replace(/\n/g,"<br/>")}}),function(){"use strict";function notifyLabel(){return function(input,filters){switch(!0){case filters.all:return"All";case filters.none:return"None";case filters.projectMembers:return"Project members";case 1===input:return"1 person";default:return input+" people"}}}angular.module("core").filter("notifyLabel",notifyLabel)}(),function(){"use strict";function getUrlRegex(){var protocol="(?:(?:[a-z]+:)?//)",auth="(?:\\S+(?::\\S*)?@)?",host="(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)",domain="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",tld="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?",port="(?::\\d{2,5})?",path='(?:[/?#][^\\s"]*)?',regex="(?:"+protocol+"|www\\.)"+auth+"(?:"+host+domain+tld+")"+port+path;return new RegExp(regex,"ig")}function parseUrl(){function getTextNodes(el){for(var node,textNodes=[],walk=document.createTreeWalker(el,NodeFilter.SHOW_TEXT,null,!1);node=walk.nextNode();)textNodes.push(node);return textNodes}function getLink(url){var href="";return href=/^https?:/.test(url)?url:"http://"+url,'<a class="underline-link blue-link" target="_blank"href="'+href+'">'+url+"</a>"}var URL_REGEXP=getUrlRegex(),element=document.createElement("div");return function(html){var textNodes,uniqueUrls=[],urlsSeen={};if(!html)return html;if(element.innerHTML=html,textNodes=getTextNodes(element),angular.forEach(textNodes,function(textNode){var match=textNode.textContent.match(URL_REGEXP);angular.forEach(match,function(url){url=url.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),urlsSeen[url]||(uniqueUrls.push(url),urlsSeen[url]=!0)})}),!uniqueUrls.length)return html;var regex=new RegExp(uniqueUrls.join("|"),"gi");return html=html.replace(regex,function(matched){return getLink(matched,"url")})}}angular.module("core").filter("parseUrl",parseUrl)}(),angular.module("core").filter("simpleMarkdown",function(){"use strict";function parseEmail(text){var pattern=/\[(.*?)\]\(mailto:(.*?)\)/g;return text.replace(pattern,'<a class="md-email" href="mailto:$2">$1</a>')}return function(text){return parseEmail(text)}}),function(){"use strict";function timer(_){function formatNumber(number){return number<10?"0"+number:number}var SEC_IN_HOUR=3600,SEC_IN_MINUTE=60;return function(input){var hours,minutes,seconds;return!_.isNumber(input)||input<=0?"00:00:00":(hours=Math.floor(input/SEC_IN_HOUR),minutes=Math.floor((input-hours*SEC_IN_HOUR)/SEC_IN_MINUTE),seconds=Math.floor(input-hours*SEC_IN_HOUR-minutes*SEC_IN_MINUTE),formatNumber(hours)+":"+formatNumber(minutes)+":"+formatNumber(seconds))}}angular.module("core").filter("timer",timer),timer.$inject=["_"]}(),function(){"use strict";function toFloatFilter(){return function(data){var number=parseFloat(data);return number||data}}angular.module("core").filter("toFloat",toFloatFilter)}(),angular.module("core").filter("toInt",function(){"use strict";return function(data){var number=parseInt(data);return number||data}}),angular.module("core").filter("toPx",["_",function(_){"use strict";return function(data){var number=parseInt(data);return number&&_.isNumber(number)?number+"px":data}}]),function(){"use strict";function unitFilter(_,UnitService){function filter(value,isFont){return _.isNumber(value)?UnitService.convertPx(value,isFont):value}return filter.$stateful=!0,filter}angular.module("core").filter("unit",unitFilter),unitFilter.$inject=["_","UnitService"]}(),function(){"use strict";function AssignHelper(UsersService,FeatureToggler){function getOptions(){var projectMembers=UsersService.getProjectMembersWithoutMe(),otherMembers=UsersService.getOtherMembers(),options=[],me=_.clone(UsersService.me);return me.id_user=parseInt(me.id_user),options.push(me),options=options.concat(projectMembers,otherMembers)}function isAssignmentActive(){return FeatureToggler.commentsAssignment&&UsersService.isInProjectsAccount()}return{getOptions:getOptions,isAssignmentActive:isAssignmentActive}}angular.module("core").factory("AssignHelper",AssignHelper),AssignHelper.$inject=["UsersService","FeatureToggler"]}(),angular.module("core").factory("CommentsHelper",[function(){"use strict";return{getDiscussionRootCommentId:function(comment){return comment._parent_comment?comment._parent_comment:comment._id},stripText:function(text){return text.replace(/(<([^>]+)>)/gi,"")},encodeMentions:function(text){var pattern=/\[(.*?)\]\(mailto:(.*?)\)/g,matches=text.match(pattern);if(matches){matches.forEach(function(string){text=text.replace(string,encodeURIComponent(string))})}return text},decodeMentions:function(text){var pattern=/%5B(.*?)%5D\(mailto%3A(.*?)\)/g,matches=text.match(pattern);if(matches){matches.forEach(function(string){text=text.replace(string,decodeURIComponent(string))})}return text}}}]),function(){"use strict";function deviceDetectorHelper(_,localStorageService){var ua=new UAParser(navigator.userAgent);return _.extend(ua,{isAppViewAvailable:function(){var uaData=this.getResult();return"iOS"===uaData.os.name&&"Mobile Safari"===uaData.browser.name?!window.navigator.standalone&&!localStorageService.get(PreviewEnums.APP_VIEW_PROMO_VIEWED):"Android"===uaData.os.name&&"Chrome"===uaData.browser.name&&!localStorageService.get(PreviewEnums.APP_VIEW_PROMO_VIEWED);
},isMac:function(){var uaData=this.getResult();return"Mac OS"===uaData.os.name},isChrome:function(){var uaData=this.getResult();return"Chrome"===uaData.browser.name},isSafari:function(){var uaData=this.getResult();return"Safari"===uaData.browser.name},isFirefox:function(){var uaData=this.getResult();return"Firefox"===uaData.browser.name}})}angular.module("core").factory("deviceDetectorHelper",deviceDetectorHelper),deviceDetectorHelper.$inject=["_","localStorageService"]}(),function(){"use strict";function NotifyHelper($cookies,NotificationsService,UsersService){function getPeople(){var guestEmails=getGuestsEmails(),people=[];return _.each(UsersService.collaboratorsMap,function(collaborator){people.push(getPersonObject(collaborator))}),_.each(guestEmails,function(email){people.push(getGuestObject(email))}),_.sortBy(people,function(person){return(person.name||person.email).toLowerCase()})}function getGuestsEmails(){var collaboratorsEmails=UsersService.collaboratorEmails,guestEmails=[];return _.each(NotificationsService.notificationsMap,function(notifiacation){_.each(notifiacation.emails,function(item){collaboratorsEmails.indexOf(item.email)===-1&&guestEmails.push(item.email)})}),_.uniq(guestEmails)}function getSelectedEmails(commentId){var notification=NotificationsService.notificationsMap[commentId];return!commentId||_.isEmpty(notification)?remindSelection()||getDefaultSelectedEmails():_.map(notification.emails,function(item){return item.email})}function getDefaultSelectedEmails(){var emails=[];return _.each(UsersService.collaboratorsMap,function(collaborator){collaborator.is_owner&&emails.push(collaborator.email)}),emails}function formatNotify(selectedEmails,mentionEmails){var map={};return _.each(selectedEmails,function(email){map[email]=getNotifyObject(email,0)}),_.each(mentionEmails,function(email){map[email]?map[email].is_mention=1:map[email]=getNotifyObject(email,1)}),_.toArray(map)}function rememberSelection(selection){$cookies[NOTIFY_SELECTION_COOKIE_NAME]=angular.toJson(selection)}function remindSelection(){var cookie=$cookies[NOTIFY_SELECTION_COOKIE_NAME];return"undefined"===cookie||_.isEmpty(cookie)||(cookie=angular.fromJson(cookie)),_.isArray(cookie)?cookie:null}function getPersonObject(collaborator){return{id:collaborator.id_user,name:collaborator.name,email:collaborator.email,avatar:collaborator.avatar,isOwner:collaborator.is_owner}}function getGuestObject(email){return{id:MD5(email),name:email,email:email}}function getNotifyObject(email,isMention){return{email:email,is_mention:isMention}}var NOTIFY_SELECTION_COOKIE_NAME="notifyselection";return{getPeople:getPeople,getGuestsEmails:getGuestsEmails,getSelectedEmails:getSelectedEmails,getDefaultSelectedEmails:getDefaultSelectedEmails,formatNotify:formatNotify,rememberSelection:rememberSelection,remindSelection:remindSelection}}angular.module("core").factory("NotifyHelper",NotifyHelper),NotifyHelper.$inject=["$cookies","NotificationsService","UsersService"]}(),angular.module("core").factory("ValidationHelper",[function(){"use strict";return{isEmail:function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)}}}]),function(){"use strict";function pvScrollTo($parse,$document,$timeout,animate){function link(scope,el,attrs){function handleScroll(){scope.$apply(function(){model.assign(scope,null),el.off("scroll",handleScroll)})}function calculateScrollTopPosition(targetEl){return targetEl.getBoundingClientRect().top-el[0].getBoundingClientRect().top+el[0].scrollTop}var ANIMATION_DURATION=.5,SCROLL_MARGIN=10,model=$parse(attrs.pvScrollTo);scope.$watch(model,function(value){$timeout(function(){var targetEl=$document[0].getElementById(value);targetEl&&(animate(el[0],ANIMATION_DURATION,{ease:"easeInOutPower2",scrollTop:calculateScrollTopPosition(targetEl)-SCROLL_MARGIN}),el.on("scroll",handleScroll))})})}return{restrict:"A",link:link}}angular.module("core").directive("pvScrollTo",pvScrollTo),pvScrollTo.$inject=["$parse","$document","$timeout","animate"]}(),function(){"use strict";function pvScrollToBottom($parse){function link(scope,el,attrs){function onScroll(){var scrollOnBottom=isScrollOnBottom();scope.$apply(function(){model.assign(scope,scrollOnBottom),scrollOnBottom||el.off("scroll",onScroll)})}function isScrollOnBottom(){return el[0].scrollTop>0&&el[0].scrollHeight-el[0].scrollTop===el[0].clientHeight}var model=$parse(attrs.pvScrollToBottom);scope.$watch(model,function(value){value&&(el[0].scrollTop=el[0].scrollHeight,el.on("scroll",onScroll))})}return{restrict:"A",link:link}}angular.module("core").directive("pvScrollToBottom",pvScrollToBottom),pvScrollToBottom.$inject=["$parse"]}(),function(){"use strict";function CssKeyFramesAnimation(){return window.CssKeyframesAnimation.default}angular.module("core").factory("CssKeyFramesAnimation",CssKeyFramesAnimation)}(),function(){angular.module("core").service("CodeMirror",function(){"use strict";return window.CodeMirror})}(),angular.module("core").factory("LiveSessionInstanceService",[function(){"use strict";var instance=null;return{set:function(newInstance){instance=newInstance},get:function(){return instance}}}]),angular.module("core").factory("LocalDataService",["$window","$document","$q",function($window,$document,$q){"use strict";return{getData:function(file){var d=$q.defer(),scr=document.createElement("script");return scr.setAttribute("src",file),scr.setAttribute("type","text/javascript"),scr.addEventListener("load",function(){d.resolve($window.DATA),delete $window.DATA,$document[0].body.removeChild(scr)}),$document[0].body.appendChild(scr),d.promise}}}]),function(){"use strict";function PageAnimationFactory($document,$timeout,FlowAnimation,FlipXAnimation,PushXAnimation,PushYAnimation,SlideXAnimation,SlideYAnimation,FadeAnimation,SlideNFadeAnimation,CssKeyFramesAnimation){function getEasingMap(){var EASING_MODES=AnimationEnums.EASING_MODES,EASING_CSS_MODES=AnimationEnums.EASING_CSS_MODES,map={};return map[EASING_MODES.LINEAR]=EASING_CSS_MODES.LINEAR,map[EASING_MODES.IN]=EASING_CSS_MODES.IN,map[EASING_MODES.OUT]=EASING_CSS_MODES.OUT,map[EASING_MODES.IN_OUT]=EASING_CSS_MODES.IN_OUT,map}function appendAnimation(animation){var style=angular.element("<style>");style.attr("type","text/css"),style.html(animation.generateKeyframesAnimation()),$document[0].querySelector("head").appendChild(style[0])}function onAnimationEnd(event){event.target===animatedContainer[0]&&(animatedContainer.off(animationEndEventsNames,onAnimationEnd),currentAnimation.onAnimationEnd())}function init(container,animation){var name=animation.name,easing=easingMap[animation.easing||AnimationEnums.DEFAULT_EASING_MODE],duration=animation.duration||AnimationEnums.DEFAULT_DURATION_TIME,animationData=animationsMap[name];if(currentAnimation=null,angular.isArray(animationData)?currentAnimation=new animationData[0](container,duration,null,easing,animationData[1]):animationsMap[name]&&(currentAnimation=new animationsMap[name](container,duration,null,easing)),!currentAnimation||!currentAnimation.canDoAnimation())return!1;var keyframesObj=currentAnimation.onAnimationInit();currentAnimationNames={};for(var i in keyframesObj)if(keyframesObj.hasOwnProperty(i)){var cssAnimationKeyFrames=new CssKeyFramesAnimation(keyframesObj[i]),checksum=cssAnimationKeyFrames.checksum;keyframesCache[checksum]?currentAnimationNames[i]=keyframesCache[checksum].name:(appendAnimation(cssAnimationKeyFrames),keyframesCache[checksum]=cssAnimationKeyFrames,currentAnimationNames[i]=cssAnimationKeyFrames.name)}animatedContainer=currentAnimation.prepareAnimationContainer(),animatedContainer.on(animationEndEventsNames,onAnimationEnd)}function startAnimation(){return!(!currentAnimation||!currentAnimation.canDoAnimation())&&void $timeout(function(){currentAnimation.prepareNextPage().then(function(){currentAnimation.startAnimation(currentAnimationNames)})})}var currentAnimation,animatedContainer,keyframesCache={},animationEndEventsNames="webkitAnimationEnd mozAnimationEnd msAnimationEnd oAnimationEnd animationEnd",animationsMap={fade:FadeAnimation,"flow-left":[FlowAnimation,"left"],"flow-right":[FlowAnimation,"right"],"push-right":[PushXAnimation,"right"],"push-left":[PushXAnimation,"left"],"push-up":[PushYAnimation,"up"],"push-down":[PushYAnimation,"down"],"slide-right":[SlideXAnimation,"right"],"slide-left":[SlideXAnimation,"left"],"slide-down":[SlideYAnimation,"down"],"slide-up":[SlideYAnimation,"up"],"flip-right-x":[FlipXAnimation,"right"],"flip-left-x":[FlipXAnimation,"left"],"slide-and-fade-left":[SlideNFadeAnimation,"left"],"slide-and-fade-right":[SlideNFadeAnimation,"right"]},easingMap=getEasingMap(),currentAnimationNames={};return{init:init,startAnimation:startAnimation}}angular.module("core").factory("PageAnimationFactory",PageAnimationFactory),PageAnimationFactory.$inject=["$document","$timeout","FlowAnimation","FlipXAnimation","PushXAnimation","PushYAnimation","SlideXAnimation","SlideYAnimation","FadeAnimation","SlideNFadeAnimation","CssKeyFramesAnimation"]}(),function(){"use strict";function PreviewNavigation(_,$state,$rootScope,Settings,FeatureToggler,Engine){function changeUrl(){if(!ApplicationConfiguration.isDesignSystem){var newPanels=visiblePanels.join(","),previewMode=$state.params.previewMode,panels=$state.params.panels;commentId=$state.params.commentId||"",previewMode===PREVIEW_PANELS.COMMENTS&&panels.indexOf(PREVIEW_PANELS)===-1?(currentMode=PREVIEW_MODES.COMMENT,visiblePanels.push(PREVIEW_PANELS.COMMENTS),commentId=panels||"",$state.go(baseState+".mode.comment",getCurrentUrlParams())):previewMode===currentMode&&panels===newPanels||$state.go(baseState+".mode",getCurrentUrlParams())}}function isValidMode(mode){return(mode!==PREVIEW_MODES.SPEC||!Settings.disableSpecification)&&((mode!==PREVIEW_MODES.COMMENT||!Settings.disableComments)&&((mode!==PREVIEW_MODES.DOCUMENTATION||!Settings.disableDocumentation)&&_.values(PREVIEW_MODES).indexOf(mode)!==-1))}function isValidPanel(panel){return!(panel===PREVIEW_PANELS.SITEMAP&&Settings.disableSitemap||isPanelDisabled(panel))&&((panel!==PREVIEW_PANELS.LAYERS||!Settings.disableSpecification)&&_.values(PREVIEW_PANELS).indexOf(panel)!==-1)}function isValidMainPanel(panel){return _.values(MAIN_PANELS).indexOf(panel)!==-1}function updatePanels(mode){visiblePanels=visiblePanels.filter(function(panel){return MODE_PANELS_MAP[mode].indexOf(panel)!==-1})}function initNavigation(mode,panels){currentMode=isValidMode(mode)?mode:PREVIEW_MODES.SIMULATE,$rootScope.$emit(PreviewEnums.ON_PREVIEW_MODE_CHANGED,mode),angular.forEach(panels,function(panel){addToVisiblePanels(panel)}),changeUrl()}function removeFromVisiblePanels(panel){visiblePanels=_.without(visiblePanels,panel)}function addToVisiblePanels(panel){if(MODE_PANELS_MAP[currentMode].indexOf(panel)===-1)return removeFromVisiblePanels(panel),$rootScope.$emit(PreviewEnums.ON_PANEL_CHANGED,panel),!1;switch(panel){case PREVIEW_PANELS.COMMENTS:removeFromVisiblePanels(PREVIEW_PANELS.FILTERS);break;case PREVIEW_PANELS.FILTERS:removeFromVisiblePanels(PREVIEW_PANELS.COMMENTS);break;case PREVIEW_PANELS.SITEMAP:removeFromVisiblePanels(PREVIEW_PANELS.LAYERS);break;case PREVIEW_PANELS.LAYERS:removeFromVisiblePanels(PREVIEW_PANELS.SITEMAP)}return!(!isValidPanel(panel)||visiblePanels.indexOf(panel)!==-1)&&(visiblePanels.push(panel),$rootScope.$emit(PreviewEnums.ON_PANEL_CHANGED,panel),!0)}function removeFromExpandedPanels(panel){expandedPanels=_.without(expandedPanels,panel)}function addToExpandedPanels(panel){return!!isValidMainPanel(panel)&&(expandedPanels.push(panel),!0)}function getCurrentUrlParams(){return{previewMode:currentMode||PREVIEW_MODES.SIMULATE,panels:(visiblePanels||[]).join(",")||NO_PANELS,commentId:commentId}}function disablePanel(panel){disabledPanels.push(panel)}function enablePanel(panel){disabledPanels=disabledPanels.filter(function(disabledPanel){return disabledPanel!==panel})}function isPanelDisabled(panel){return disabledPanels.indexOf(panel)!==-1}var PREVIEW_MODES={SPEC:"specification",COMMENT:"comment",SIMULATE:"simulate",DOCUMENTATION:"documentation"},PREVIEW_PANELS={SITEMAP:"sitemap",TASKS:"tasks",COMMENTS:"comments",FILTERS:"filters",LAYERS:"layers"},MAIN_PANELS={RIGHT:"right",LEFT:"left"},disabledPanels=[],MODE_PANELS_MAP={};MODE_PANELS_MAP[PREVIEW_MODES.SIMULATE]=[PREVIEW_PANELS.SITEMAP,PREVIEW_PANELS.TASKS],MODE_PANELS_MAP[PREVIEW_MODES.SPEC]=[PREVIEW_PANELS.LAYERS,PREVIEW_PANELS.SITEMAP],MODE_PANELS_MAP[PREVIEW_MODES.DOCUMENTATION]=[PREVIEW_PANELS.SITEMAP],MODE_PANELS_MAP[PREVIEW_MODES.COMMENT]=[PREVIEW_PANELS.COMMENTS,PREVIEW_PANELS.FILTERS,PREVIEW_PANELS.SITEMAP];var LEFT_PANELS=[PREVIEW_PANELS.SITEMAP,PREVIEW_PANELS.LAYERS],RIGHT_PANELS=[PREVIEW_PANELS.COMMENTS,PREVIEW_PANELS.FILTERS],NO_PANELS="no-panels",currentMode=null,visiblePanels=[],expandedPanels=[],commentId=null,baseState="W"===ApplicationConfiguration.project.type?"home.page":"home.document";return{PREVIEW_MODES:PREVIEW_MODES,PREVIEW_PANELS:PREVIEW_PANELS,MAIN_PANELS:MAIN_PANELS,getCurrentMode:function(){return currentMode},getCurrentPanels:function(){return visiblePanels},isPanelVisible:function(panel){return visiblePanels.indexOf(panel)!==-1},isLeftPanelVisible:function(){for(var i=0;i<LEFT_PANELS.length;i++)if(visiblePanels.indexOf(LEFT_PANELS[i])!==-1)return!0;return!1},isRightPanelVisible:function(){for(var i=0;i<RIGHT_PANELS.length;i++)if(visiblePanels.indexOf(RIGHT_PANELS[i])!==-1)return!0;return!1},isModeActive:function(mode){return mode===currentMode},showPanel:function(panel){addToVisiblePanels(panel)&&changeUrl()},hidePanel:function(panel){removeFromVisiblePanels(panel),changeUrl()},setActiveMode:function(mode){currentMode!==mode&&isValidMode(mode)?(currentMode=mode,$rootScope.$emit(PreviewEnums.ON_PREVIEW_MODE_CHANGED,mode),updatePanels(currentMode),changeUrl()):isValidMode(mode)||(currentMode=PREVIEW_MODES.SIMULATE,updatePanels(currentMode),changeUrl())},setActivePanels:function(panels){return panels?void(_.isEqual(panels,visiblePanels)||angular.forEach(panels,function(panel){addToVisiblePanels(panel)})):(visiblePanels=[],void $rootScope.$emit(PreviewEnums.ON_PANEL_CHANGED,NO_PANELS))},togglePanel:function(panel){this.isPanelVisible(panel)?this.hidePanel(panel):this.showPanel(panel)},getBaseState:function(){return baseState},getAddCommentState:function(){return baseState+".mode.comment"},getModeState:function(){return baseState+".mode"},isPanelExpanded:function(panel){return expandedPanels.indexOf(panel)!==-1},expandPanel:function(panel){addToExpandedPanels(panel),$rootScope.$emit(PreviewEnums.ON_PANEL_TOGGLE_EXPAND,panel)},collapsePanel:function(panel){removeFromExpandedPanels(panel),$rootScope.$emit(PreviewEnums.ON_PANEL_TOGGLE_EXPAND,panel)},initNavigation:initNavigation,getCurrentUrlParams:getCurrentUrlParams,disablePanel:disablePanel,enablePanel:enablePanel,isPanelDisabled:isPanelDisabled}}angular.module("core").factory("PreviewNavigation",PreviewNavigation),PreviewNavigation.$inject=["_","$state","$rootScope","Settings","FeatureToggler","Engine"]}(),function(){"use strict";function ScreencastifyService($window){return $window.screencastify.setAppId(ApplicationConfiguration.screencastify.appId),$window.screencastify}angular.module("core").factory("ScreencastifyService",ScreencastifyService),ScreencastifyService.$inject=["$window"]}(),function(){"use strict";function UTVideoService(_,$http){function getUploadUrl(fileName,projectData){var key=generateKey(fileName,projectData);return $http({url:"/api/live-presentation/usability-test/get-video-upload-url",method:"POST",data:{id_collection:projectData.collectionId,title:key}})}function uploadVideo(config){return config=_.extend(config,{method:"PUT",headers:{"Content-Type":"video/webm","x-amz-acl":"public-read"}}),$http(config)}function createDocument(documentData){return $http({url:"/api/live-presentation/usability-test/create-document",method:"POST",data:documentData})}function generateKey(fileName,projectData){return fileName=fileName.replace(/\s+/g,""),projectData.collectionId+"-"+projectData.projectId+"/"+genereateUUID()+"/"+fileName}function genereateUUID(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"===c?r:3&r|8;return v.toString(16)})}return{getUploadUrl:getUploadUrl,uploadVideo:uploadVideo,createDocument:createDocument}}angular.module("core").factory("UTVideoService",UTVideoService),UTVideoService.$inject=["_","$http"]}(),function(){"use strict";angular.module("core").factory("AnalyticsService",["$analytics","$timeout","PreviewCache","$window",function($analytics,$timeout,PreviewCache,$window){function sendEventsRegardingCaching(id,time){3===requestsInCacheForThisPage[id]?(this.event("Preview - Page from cache loaded",{category:"Navigation",label:"Page from cache time",value:time}),this.kissEvent("Preview - Page from cache loaded",{"Preview - page from cache loaded: Load time":time})):2===requestsInCacheForThisPage[id]?(this.event("Preview - Page partially from cache loaded",{category:"Navigation",label:"Page partially from cache time",value:time}),this.kissEvent("Preview - Page partially from cache loaded",{"Preview - page partially from cache loaded: Load time":time})):(this.event("Preview - Page from server loaded",{category:"Navigation",label:"Page from server time",value:time}),this.kissEvent("Preview - Page from server loaded",{"Preview - page from server loaded: Load time":time})),delete requestsInCacheForThisPage[id]}var pageSwitchTimers={},designLoadTimer=null,requestsInCacheForThisPage={};return{startPageSwitchTrack:function(hash,id){pageSwitchTimers[id]=+new Date,requestsInCacheForThisPage[id]=PreviewCache.isPageDataInCache(hash,id)},finishPageSwitchTrack:function(hash,id){var time;pageSwitchTimers[id]&&(time=+new Date-pageSwitchTimers[id],delete pageSwitchTimers[id],$timeout(function(){this.event("Page switch",{category:"Navigation",label:"Page switch",value:time})}.bind(this))),time?$timeout(sendEventsRegardingCaching.bind(this,id,time)):delete requestsInCacheForThisPage[id],this.finishDesignLoadTrack()},startDesignLoadTrack:function(){designLoadTimer=+new Date},finishDesignLoadTrack:function(){var time;designLoadTimer>0&&(time=+new Date-designLoadTimer,designLoadTimer=null,this.event("Design load",{category:"Navigation",label:"Design load",value:time}))},trackComment:function(comment){var properties={category:"Comments"};0===comment.notify.length?properties.value=PreviewEnums.COMMENT_NOTIFY_NONE:comment.notify.length===comment.collaborators_all?properties.value=PreviewEnums.COMMENT_NOTIFY_ALL:properties.value=PreviewEnums.COMMENT_NOTIFY_CHOSEN,$timeout(function(){this.event("appuse_addcomment",properties)}.bind(this))},event:function(name,properties){$analytics.eventTrack(name,properties)},kissEvent:function(event,props){return new Promise(function(resolve,reject){try{if(!$window._kmq)return resolve();$window._kmq.push(["record",event,props,resolve])}catch(e){reject(e)}})},countPageviews:function(pageId,accountId){return new Promise(function(resolve,reject){try{var eventProperties={page_id:pageId,account_id:accountId};if(!$window.amplitude)return resolve();$window.amplitude.getInstance().logEvent("Pageviews",eventProperties,resolve)}catch(e){reject(e)}})},addDesignView:function(pageId,accountId){return new Promise(function(resolve,reject){try{var eventProperties={page_id:pageId,account_id:accountId};if(!$window.amplitude)return resolve();$window.amplitude.getInstance().logEvent("Collaborator View",eventProperties,resolve)}catch(e){reject(e)}})}}}])}(),angular.module("core").service("animate",function(){"use strict";var getElements=function(selector){if(angular.isString(selector)){var el=document.querySelectorAll(selector);if(el)return Array.prototype.slice.call(el)}else{if("undefined"!=typeof selector.tagName)return[selector];if(/NodeList|HTMLCollection/.test(Object.prototype.toString.call(selector)))return Array.prototype.slice.call(selector)}return null};return function(selector,duration,properties){var elements=getElements(selector);elements&&elements.forEach(function(el){TweenLite.to(el,duration,properties)})}}),function(){function appStateManager(_,localStorageService,$rootScope,ProjectsService){"use strict";function loadState(){return localStorageService.get(LOCAL_STORAGE_KEY)}function saveState(currentState){localStorageService.set(LOCAL_STORAGE_KEY,_.extend(getCurrentState(),currentState))}function getCurrentState(){return loadState()||state}var state={panels:null,breakpoint:null,mode:null,isZenMode:null},LOCAL_STORAGE_KEY="appState_"+ProjectsService.currentProjectId;return{getCurrentState:getCurrentState,saveState:saveState}}angular.module("core").factory("appStateManager",appStateManager),appStateManager.$inject=["_","localStorageService","$rootScope","ProjectsService"]}(),function(){"use strict";function ApprovalsService(Rest){function getIsPending(){return serviceData.isPending}function getIsActive(){return serviceData.isActive}function getApprovalStatus(){return serviceData.approvalStatus}function getIdApproval(){return serviceData.idApproval}function getIdRequest(){return serviceData.idRequest}function sendApproval(data){var approvalData={status:data.status};return data.feedback&&(approvalData.feedback=data.feedback),Rest.one("approvals",data.idApproval).one("requests",data.idRequest).customPUT(approvalData)}function updateSeenAt(){return Rest.one("approvals",serviceData.idApproval).one("requests",serviceData.idRequest).customPUT({seenAt:!0})}function setApprovalStatus(status){serviceData.isPending=!1,serviceData.approvalStatus=status}var serviceData={idApproval:ApplicationConfiguration.approval&&ApplicationConfiguration.approval.id,idRequest:ApplicationConfiguration.approvalRequest&&ApplicationConfiguration.approvalRequest.id,isActive:!(!ApplicationConfiguration.approval||!ApplicationConfiguration.approval.id),isPending:ApplicationConfiguration.approvalRequest&&"pending"===ApplicationConfiguration.approvalRequest.status,approvalStatus:ApplicationConfiguration.approvalRequest&&ApplicationConfiguration.approvalRequest.status};return{status:null,sendApproval:sendApproval,getIsPending:getIsPending,getIsActive:getIsActive,getApprovalStatus:getApprovalStatus,setApprovalStatus:setApprovalStatus,getIdApproval:getIdApproval,getIdRequest:getIdRequest,updateSeenAt:updateSeenAt}}angular.module("core").factory("ApprovalsService",ApprovalsService),ApprovalsService.$inject=["Rest"]}(),function(){"use strict";function BreakpointsService(_,$q,$rootScope,ExportService,LocalDataService,ProjectsService,RestWithCache){function _getBreakpoints(projectHash){return ExportService.isExport()?LocalDataService.getData("data/breakpoints.js"):RestWithCache.one("projects",projectHash).all("breakpoints").getList()}return{breakpointsMap:{},breakpointWidths:[],getBreakpoints:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getBreakpoints(projectHash).then(function(breakpoints){this.generateBreakpointsMap(breakpoints),this.generateBreakpointWidths(breakpoints),d.resolve(breakpoints)}.bind(this),function(error){d.reject(error)}),d.promise},generateBreakpointsMap:function(breakpoints){_.forIn(this.breakpointsMap,function(value,key){delete this.breakpointsMap[key]}.bind(this)),breakpoints.forEach(function(breakpoint){this.breakpointsMap[breakpoint.version]=Object.assign({},breakpoint,{name:this.parseBreakpointName(breakpoint)})}.bind(this))},parseBreakpointName:function(breakpoint){return _.isEmpty(breakpoint.name)?breakpoint.width>0?breakpoint.width+"px":"unnamed":breakpoint.name.replace("&infin;","")},generateBreakpointWidths:function(breakpoints){for(;this.breakpointWidths.length;)this.breakpointWidths.pop();breakpoints.forEach(function(breakpoint){this.breakpointWidths.push(breakpoint)}.bind(this)),this.breakpointWidths=_.sortBy(this.breakpointWidths,"width")},getBreakpointName:function(id){return this.breakpointsMap[id].name}}}angular.module("core").factory("BreakpointsService",BreakpointsService),BreakpointsService.$inject=["_","$q","$rootScope","ExportService","LocalDataService","ProjectsService","RestWithCache"]}(),function(){"use strict";function CanvasContainerHeight($document){function saveHeightFromDom(){return containerPadded||(containerPadded=$document[0].querySelector("main > section.scrolled-container > section.scrolled-content > section.canvas-container")),containerPaddedOffsetHeight=containerPadded.offsetHeight}function getHeight(){return containerPaddedOffsetHeight}var containerPaddedOffsetHeight,containerPadded;return{saveHeightFromDom:saveHeightFromDom,getHeight:getHeight}}angular.module("core").factory("CanvasContainerHeight",CanvasContainerHeight),CanvasContainerHeight.$inject=["$document"]}(),function(){"use strict";function ClipboardService(){return window.Clipboard}angular.module("core").factory("ClipboardService",ClipboardService)}(),angular.module("core").factory("Color",["ntc","tinycolor",function(ntc,tinycolor){"use strict";function name(color){return ntc.name(color)[1]}function getRgbaValues(color){var match=color.match(/\((.*)\)/)[1],rgba=match.split(",");return rgba.length<4&&rgba.push(1),rgba}function isReadable(color){return tinycolor.readability(color,$scope.backgroundColor||BACKGROUND_COLOR)>=($scope.readabilityLevel||READABILITY_LEVEL)}function isBright(color){return tinycolor(color).getBrightness()>BRIGHTNESS_LEVEL}function getSelectedColorType(){return selectedColorType}function setSelectedColorType(colorType){selectedColorType=colorType}function getColorsSet(color){var tinyColor=tinycolor(color);return tinyColor.isValid()?{hex:tinyColor.toHexString(),rgba:tinyColor.toRgbString(),alpha:tinyColor.getAlpha()}:{}}function isWhite(color){return!(255!==tinycolor(color).getBrightness())}var COLOR_TYPES={HEX:"hex",RGBA:"rgba"},BACKGROUND_COLOR="#FFF",READABILITY_LEVEL=1.2,BRIGHTNESS_LEVEL=200,selectedColorType=COLOR_TYPES.HEX;return{COLOR_TYPES:COLOR_TYPES,name:name,getColorsSet:getColorsSet,getSelectedColorType:getSelectedColorType,setSelectedColorType:setSelectedColorType,getRgbaValues:getRgbaValues,isReadable:isReadable,isBright:isBright,isWhite:isWhite}}]),function(){"use strict";function DesignSystem($http){function fetchDesignSystems(projectHash){return $http({method:"GET",url:uxpinApi+"/designSystems/project/"+projectHash}).then(function(response){return response.data}).catch(function(){throw new Error("Design systems fetching error")})}function getSymbolContent(){return symbolContent}function getAccountPageOptions(){return accountPageOptions}var uxpinApi=window.ApplicationConfiguration.uxpinApi,symbolContent=window.ApplicationConfiguration.symbol,accountPageOptions=window.ApplicationConfiguration.accountPageOptions;return{fetchDesignSystems:fetchDesignSystems,getSymbolContent:getSymbolContent,getAccountPageOptions:getAccountPageOptions}}angular.module("core").factory("DesignSystem",DesignSystem),DesignSystem.$inject=["$http"]}(),function(){"use strict";function DesignViewsService($cookies,Rest,UsersService,ProjectsService){function isDesignViewCounted(projectHash,pageId){var cookie=$cookies.get("dv"+projectHash);return cookie&&(cookie=JSON.parse(cookie)),!!cookie&&-1!==cookie.indexOf(pageId)}function addCookie(projectHash,pageId){var pagesIds=$cookies.get("dv"+projectHash);pagesIds=pagesIds?JSON.parse(pagesIds):[],pagesIds.push(pageId);var now=new Date,exp=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1,now.getHours());$cookies.put("dv"+projectHash,JSON.stringify(pagesIds),{expires:exp})}function addDesignView(projectHash,pageId){addCookie(projectHash,pageId);var viewData={};return UsersService.me.id_user&&!UsersService.me.is_anonymous&&(viewData.idUser=UsersService.me.id_user),Rest.one("design-views",window.ApplicationConfiguration.project.id_account).one("projects",ProjectsService.currentProjectId).customPUT(viewData)}return{addDesignView:addDesignView,addCookie:addCookie,isDesignViewCounted:isDesignViewCounted}}angular.module("core").factory("DesignViewsService",DesignViewsService),DesignViewsService.$inject=["$cookies","Rest","UsersService","ProjectsService"]}(),function(){"use strict";function DocumentationService(_,SitemapService){function hasProjectDocumentation(pages){return pages?_.some(pages,DOCUMENTATION_EXISTS):_.some(pagesMap,DOCUMENTATION_EXISTS)}var DOCUMENTATION_EXISTS=PreviewEnums.DOCUMENTATION_EXISTS,pagesMap=SitemapService.pagesMap;return{hasProjectDocumentation:hasProjectDocumentation}}angular.module("core").factory("DocumentationService",DocumentationService),DocumentationService.$inject=["_","SitemapService"]}(),angular.module("core").factory("DocumentsService",["$q","$rootScope","$state","Rest","ProjectsService","BreakpointsService",function($q,$rootScope,$state,Rest,ProjectsService,BreakpointsService){"use strict";return{currentDocumentId:null,currentDocumentProperties:null,getDocuments:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return Rest.one("projects",projectHash).all("documents").getList().then(function(documents){this.currentDocumentId=documents[0].id_document,d.resolve(documents)}.bind(this),function(error){d.reject(error)}),d.promise},getDocument:function(id){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return Rest.one("projects",projectHash).one("documents",id).get().then(function(document){this.currentDocumentProperties=document,d.resolve(document)}.bind(this)),d.promise}}}]),angular.module("core").factory("DOMService",["$rootScope","$window",function($rootScope,$window){"use strict";return{container:null,getContainerDimensions:function(){this.container||(this.container=document.querySelector("main > section.scrolled-container > section.scrolled-content"));var w=0,h=0;if(this.container){var style=window.getComputedStyle(this.container);w=parseInt(style.width),h=parseInt(style.height)}return{width:w,height:h}},getWindowWidth:function(){return $window.innerWidth}}}]),angular.module("core").factory("editorSocket",["$rootScope",function($rootScope){"use strict";return SocketServiceHelper(ApplicationConfiguration.socketEditorServerURL,$rootScope,!0)}]),function(){"use strict";function ElementClassService(){function getListItemClassByType(type){if(type)return map[type.toLowerCase()]||map.defaults}var map={},TYPE=ElementEnums.TYPE,TYPE_CLASSES=ElementEnums.TYPE_CLASSES;return map[TYPE.TEXT_ELEMENT]=TYPE_CLASSES.TEXT,map[TYPE.TEXT]=TYPE_CLASSES.TEXT,map[TYPE.IMAGE]=TYPE_CLASSES.IMAGE,map[TYPE.COMPONENT]=TYPE_CLASSES.SMART_ELEMENT,map[TYPE.GROUP]=TYPE_CLASSES.FOLDER,map[TYPE.MULTISTATE]=TYPE_CLASSES.MULTISTATE,map[TYPE.HOTSPOT]=TYPE_CLASSES.HOTSPOT,map[TYPE.IMAGE_SKETCH]=TYPE_CLASSES.IMAGE_SKETCH,map.defaults=TYPE_CLASSES.ELEMENT,{getListItemClassByType:getListItemClassByType}}angular.module("core").factory("ElementClassService",ElementClassService)}(),function(){"use strict";angular.module("core").factory("Engine",["_","$rootScope","$window","MODES","$q","$timeout",function(_,$rootScope,$window,MODES,$q,$timeout){function isPageLoaded(){return pageLoaded}function getTypekitData(){return ApplicationConfiguration.isDesignSystem?ApplicationConfiguration.accountPageOptions.typekit.kit:ApplicationConfiguration.project.kit}function getCustomFontUrl(){return ApplicationConfiguration.isDesignSystem?ApplicationConfiguration.accountPageOptions.customFontCssUrl:ApplicationConfiguration.project.custom_font_css_url}function initPage(container,content,customOptions){return _content=content,_container=container,_scrollableContainer=null,_scrollableWrapper=null,customOptions=customOptions||{},_page=new $window.uxpinEngine(_.extend({},{mode:$window.ApplicationConfiguration.mode||$window.uxpinEngine.Modes.PREVIEW,userContentPrefix:$window.ApplicationConfiguration.userContentPrefix,userContentPrefixCached:$window.ApplicationConfiguration.userContentPrefixCached,staticContentPrefixCached:$window.ApplicationConfiguration.staticContentPrefixCached,customFontCssUrl:getCustomFontUrl(),
typekit:{kit:getTypekitData()}},customOptions)),$rootScope.$emit(PreviewEnums.ON_PAGE_INITIALIZED),_page.on(window.uxpinEngine.Events.NAVIGATE,function(action,data,animation){if(!Preview.getAnimation()){var pageAnimation;animation&&(pageAnimation={},pageAnimation.name=animation.show,pageAnimation.duration=animation.duration,pageAnimation.easing=animation.easing);var target=data&&data.target||"_self";"link_back"===action?$rootScope.$emit(PreviewEnums.NAVIGATE_HISTORY_BACK):"link_page"===action?"_blank"===data.target?$window.open(window.location.href.split("/pages/")[0]+"/pages/"+data.id_page,target):pageAnimation&&pageAnimation.name?$rootScope.$emit(PreviewEnums.NAVIGATE_TO_PAGE,data.id_page,pageAnimation):$rootScope.$emit(PreviewEnums.NAVIGATE_TO_PAGE,data.id_page,null):"link_url"===action&&$window.open(data.url,target)}}),_page.on(window.uxpinEngine.Events.SCROLL_TO_Y,function(y,animation,delay){setTimeout(function(){$window.InteractionsAnimations.processScroll(_scrollableContainer||_container,y,animation.duration,animation)},delay||0)}),_page.on(window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,function(){setTimeout(function(){updateOffset(),$rootScope.$emit(PreviewEnums.ON_PAGE_LOADED),pageLoaded=!0},0)}),_page.on(window.uxpinEngine.Events.ZOOM_IN,function(params){$rootScope.$emit(PreviewEnums.ON_ZOOM_IN,params)}),_page.on(window.uxpinEngine.Events.ZOOM_OUT,function(params){$rootScope.$emit(PreviewEnums.ON_ZOOM_OUT,params)}),_page.on(window.uxpinEngine.Events.ZOOM_RESET,function(){$rootScope.$emit(PreviewEnums.ON_ZOOM_RESET)}),$window.addEventListener("resize",onResize),$window.addEventListener("keydown",onKeyDown),_page}function getPage(){return _page}function getCanvasSpecProperties(){var canvas=_page.getCanvas(),specProperties=canvas.getSpecProperties(),data={};return ApplicationConfiguration.isDesignSystem&&(data.canvasViewWidth=canvas.width,data.canvasViewHeight=canvas.height),_.extend({},specProperties,data)}function getCanvasSketchArtboard(){return _page.getCanvas().getSketchArtboard()}function isGridVisible(){return gridVisibility}function setGridDisplay(isVisible){gridVisibility=isVisible,_page.getCanvas().setGridOption("gridDisplay",isVisible)}function isSpecMode(){return!!_page&&_page.MODE===MODES.SPEC}function isPageWithKeyboardActions(){return _page&&_page.hasKeyboardInteractions([KEY_CODES.ARROW_LEFT,KEY_CODES.ARROW_RIGHT])}function setInteractionsEnabled(status){_page&&status?_page.enableInteractions():_page&&!status&&_page.disableInteractions()}function triggerWindowLoad(){_page&&_page.triggerWindowLoad()}function setGuides(data){guidesVisibility=!0,_page.setGuides(data)}function resetGuides(){guidesVisibility=!1,_page.getCanvas().resetGuides()}function onResize(){updateOffset(),_page.updateRelativeRectangle()}function deselectAllElements(){_page&&_page.deselectAllElements()}function selectElement(element,replaceSelection){replaceSelection=!!_.isUndefined(replaceSelection)||replaceSelection,_page&&_page.selectElement(element.id,replaceSelection)}function updateOffset(){if(_page){var rect=_content.getClientRects()[0];_page.setOffset(rect.left+_container.scrollLeft,rect.top+_container.scrollTop,_container.scrollLeft,_container.scrollTop)}}function onKeyDown(e){_page&&!_.isEmpty(_page.InteractionsManager.interactionsElements)&&_page.triggerKeyDown(e)}function onScroll(e){_page&&(_page.updateRelativeRectangle(),_page.triggerScroll(e),updateOffset())}function setScrollableContainer(scrollableContainer){_scrollableContainer&&_scrollableContainer.removeEventListener("scroll",onScroll),_scrollableContainer=scrollableContainer,_scrollableContainer.addEventListener("scroll",onScroll)}function setScrollableWrapper(scrollableWrapper){_scrollableWrapper&&_scrollableWrapper.removeEventListener("scroll",onScroll),_scrollableWrapper=scrollableWrapper,_scrollableWrapper.addEventListener("scroll",onScroll)}function setMode(mode){_page.setMode(mode),updateCanvasRectangle(),updateOffset()}function clearSpecMode(){return _page.clearSpecMode()}function updateCanvasRectangle(){_page&&setTimeout(function(){updateOffset(),_page.updateRelativeRectangle()},INTERFACE_DELAY)}function areGuidesVisible(){return guidesVisibility}function loadPageInContainer(containerEl,data){var page,deferred=$q.defer();return data||deferred.reject(null),page=new $window.uxpinEngine({containerEl:containerEl,userContentPrefix:$window.ApplicationConfiguration.userContentPrefix,userContentPrefixCached:$window.ApplicationConfiguration.userContentPrefixCached,staticContentPrefixCached:$window.ApplicationConfiguration.staticContentPrefixCached,customFontCssUrl:getCustomFontUrl(),typekit:{kit:getTypekitData()}}),page.on(window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,function(){window.requestAnimationFrame(function(){deferred.resolve(page.getCanvas()),$timeout(function(){page.clear(),page=null})})}),$timeout(function(){page.load(data)}),deferred.promise}function updateTypekitKit(data){_page.updateTypekitKit(data)}function setScale(value){_page&&(scale=value,_page.setScale(value),requestAnimationFrame(updateOffset))}function getScale(){return scale}function getDocumentation(){return _page?_page.getCanvas().annotations||[]:[]}function isDocumentationAvailable(){if(!_page)return!1;var documentation=getDocumentation();return!!documentation.length&&(_.some(documentation,DOCS_CONTENT)||_.some(documentation,DOCS_PIN_ID))}function isDocumentationMode(){return!!_page&&_page.isDocumentationMode()}function countAnnotations(){return _page?getDocumentation().length:0}function setAnnotationHighlight(id,shouldHighlight){_page.setAnnotationHighlight(id,shouldHighlight)}function setAnnotationSelection(id,shouldSelect){_page.setAnnotationSelection(id,shouldSelect)}function isInteractionsShare(){return _isInteractionsShare}function enableInteractionsShare(){_isInteractionsShare||(_isInteractionsShare=!0,_page.InteractionsManager.on(window.uxpinEngine.Events.INTERACTION_TRIGGERED,handleInteraction))}function disableInteractionsShare(){_isInteractionsShare&&(_isInteractionsShare=!1,_page.InteractionsManager.off(window.uxpinEngine.Events.INTERACTION_TRIGGERED,handleInteraction))}function handleInteraction(elementId,trigger,event){event&&Interactions.handleEvent(elementId,trigger,event)}var _page,_content,_container,_scrollableContainer,_scrollableWrapper,_isInteractionsShare=!1,pageLoaded=!1,INTERFACE_DELAY=100,guidesVisibility=!1,gridVisibility=!1,scale=1,DOCS_CONTENT="content",DOCS_PIN_ID="idPin",KEY_CODES=keysEnums.KEY_CODES;return{getDocumentation:getDocumentation,countAnnotations:countAnnotations,isDocumentationMode:isDocumentationMode,isDocumentationAvailable:isDocumentationAvailable,setAnnotationHighlight:setAnnotationHighlight,setAnnotationSelection:setAnnotationSelection,areGuidesVisible:areGuidesVisible,setGuides:setGuides,loadPageInContainer:loadPageInContainer,resetGuides:resetGuides,initPage:initPage,getPage:getPage,updateOffset:updateOffset,setScrollableContainer:setScrollableContainer,setScrollableWrapper:setScrollableWrapper,getCanvasSpecProperties:getCanvasSpecProperties,getCanvasSketchArtboard:getCanvasSketchArtboard,isPageLoaded:isPageLoaded,setMode:setMode,setGridDisplay:setGridDisplay,isGridVisible:isGridVisible,clearSpecMode:clearSpecMode,updateCanvasRectangle:updateCanvasRectangle,isSpecMode:isSpecMode,isPageWithKeyboardActions:isPageWithKeyboardActions,deselectAllElements:deselectAllElements,selectElement:selectElement,updateTypekitKit:updateTypekitKit,setScale:setScale,getScale:getScale,isInteractionsShare:isInteractionsShare,enableInteractionsShare:enableInteractionsShare,disableInteractionsShare:disableInteractionsShare,setInteractionsEnabled:setInteractionsEnabled,triggerWindowLoad:triggerWindowLoad}}])}(),angular.module("core").factory("EscapeHtmlService",[function(){"use strict";function htmlentities(string,quote_style,charset,double_encode){var hash_map=get_html_translation_table("HTML_ENTITIES",quote_style),symbol="";if(string=null===string?"":string+"",!hash_map)return!1;if(quote_style&&"ENT_QUOTES"===quote_style&&(hash_map["'"]="&#039;"),double_encode||null===double_encode)for(symbol in hash_map)hash_map.hasOwnProperty(symbol)&&(string=string.split(symbol).join(hash_map[symbol]));else string=string.replace(/([\s\S]*?)(&(?:#\d+|#x[\da-f]+|[a-zA-Z][\da-z]*);|$)/g,function(ignore,text,entity){for(symbol in hash_map)hash_map.hasOwnProperty(symbol)&&(text=text.split(symbol).join(hash_map[symbol]));return text+entity});return string}function html_entity_decode(string,quote_style){var hash_map={},symbol="",tmp_str="",entity="";if(tmp_str=string.toString(),(hash_map=get_html_translation_table("HTML_ENTITIES",quote_style))===!1)return!1;delete hash_map["&"],hash_map["&"]="&amp;";for(symbol in hash_map)entity=hash_map[symbol],tmp_str=tmp_str.split(entity).join(symbol);return tmp_str=tmp_str.split("&#039;").join("'")}function get_html_translation_table(table,quote_style){var decimal,entities={},hash_map={},constMappingTable={},constMappingQuoteStyle={},useTable={},useQuoteStyle={};if(constMappingTable[0]="HTML_SPECIALCHARS",constMappingTable[1]="HTML_ENTITIES",constMappingQuoteStyle[0]="ENT_NOQUOTES",constMappingQuoteStyle[2]="ENT_COMPAT",constMappingQuoteStyle[3]="ENT_QUOTES",useTable=isNaN(table)?table?table.toUpperCase():"HTML_SPECIALCHARS":constMappingTable[table],useQuoteStyle=isNaN(quote_style)?quote_style?quote_style.toUpperCase():"ENT_COMPAT":constMappingQuoteStyle[quote_style],"HTML_SPECIALCHARS"!==useTable&&"HTML_ENTITIES"!==useTable)throw new Error("Table: "+useTable+" not supported");"HTML_ENTITIES"===useTable&&(entities[160]="&nbsp;",entities[161]="&iexcl;",entities[162]="&cent;",entities[163]="&pound;",entities[164]="&curren;",entities[165]="&yen;",entities[166]="&brvbar;",entities[167]="&sect;",entities[168]="&uml;",entities[169]="&copy;",entities[170]="&ordf;",entities[171]="&laquo;",entities[172]="&not;",entities[173]="&shy;",entities[174]="&reg;",entities[175]="&macr;",entities[176]="&deg;",entities[177]="&plusmn;",entities[178]="&sup2;",entities[179]="&sup3;",entities[180]="&acute;",entities[181]="&micro;",entities[182]="&para;",entities[183]="&middot;",entities[184]="&cedil;",entities[185]="&sup1;",entities[186]="&ordm;",entities[187]="&raquo;",entities[188]="&frac14;",entities[189]="&frac12;",entities[190]="&frac34;",entities[191]="&iquest;",entities[192]="&Agrave;",entities[193]="&Aacute;",entities[194]="&Acirc;",entities[195]="&Atilde;",entities[196]="&Auml;",entities[197]="&Aring;",entities[198]="&AElig;",entities[199]="&Ccedil;",entities[200]="&Egrave;",entities[201]="&Eacute;",entities[202]="&Ecirc;",entities[203]="&Euml;",entities[204]="&Igrave;",entities[205]="&Iacute;",entities[206]="&Icirc;",entities[207]="&Iuml;",entities[208]="&ETH;",entities[209]="&Ntilde;",entities[210]="&Ograve;",entities[211]="&Oacute;",entities[212]="&Ocirc;",entities[213]="&Otilde;",entities[214]="&Ouml;",entities[215]="&times;",entities[216]="&Oslash;",entities[217]="&Ugrave;",entities[218]="&Uacute;",entities[219]="&Ucirc;",entities[220]="&Uuml;",entities[221]="&Yacute;",entities[222]="&THORN;",entities[223]="&szlig;",entities[224]="&agrave;",entities[225]="&aacute;",entities[226]="&acirc;",entities[227]="&atilde;",entities[228]="&auml;",entities[229]="&aring;",entities[230]="&aelig;",entities[231]="&ccedil;",entities[232]="&egrave;",entities[233]="&eacute;",entities[234]="&ecirc;",entities[235]="&euml;",entities[236]="&igrave;",entities[237]="&iacute;",entities[238]="&icirc;",entities[239]="&iuml;",entities[240]="&eth;",entities[241]="&ntilde;",entities[242]="&ograve;",entities[243]="&oacute;",entities[244]="&ocirc;",entities[245]="&otilde;",entities[246]="&ouml;",entities[247]="&divide;",entities[248]="&oslash;",entities[249]="&ugrave;",entities[250]="&uacute;",entities[251]="&ucirc;",entities[252]="&uuml;",entities[253]="&yacute;",entities[254]="&thorn;",entities[255]="&yuml;"),"ENT_NOQUOTES"!==useQuoteStyle&&(entities[34]="&quot;"),"ENT_QUOTES"===useQuoteStyle&&(entities[39]="&#39;"),entities[60]="&lt;",entities[62]="&gt;";for(decimal in entities)entities.hasOwnProperty(decimal)&&(hash_map[String.fromCharCode(decimal)]=entities[decimal]);return hash_map}function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}return{escape:function(value){return htmlentities(value,"ENT_QUOTES","UTF-8")},escapeRegExp:function(value){return escapeRegExp(value)},decode:function(value){return html_entity_decode(value,"ENT_QUOTES")}}}]),function(){"use strict";function ExportService(){function isExport(){return"export"===ApplicationConfiguration.mode}function isMenuEnabled(){return ApplicationConfiguration.menuEnabled}return{isExport:isExport,isMenuEnabled:isMenuEnabled}}angular.module("core").factory("ExportService",ExportService)}(),function(){"use strict";function FeatureToggler(){var features=_.clone(ApplicationConfiguration.features||ApplicationConfiguration.project.features)||{};return{teamComments:features.team_comments,commentsAssignment:features.comments_assignment,specMode:features.spec_mode,specModeStyleguide:features.spec_mode_styleguide,designViews:features.design_views,documentationMode:features.docs}}angular.module("core").factory("FeatureToggler",FeatureToggler)}(),angular.module("core").factory("FileService",[function(){"use strict";function isCorrectUrl(url){var urlReg=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/;return urlReg.test(url)}function getFilename(url,returnFullname){var filename,fileData=[];if(url&&isCorrectUrl(url))return filename=url.split("/").pop(),fileData.push(filename.replace(/\.[^\/.]+$/,"")),filename.indexOf(".")!==-1&&fileData.push(/[^.]+$/.exec(filename)[0]),2===fileData.length&&(fileData=returnFullname?fileData.join("."):{name:fileData[0],extension:fileData[1]}),fileData}return{getFilename:getFilename}}]),function(){function Font(_,$http,$q){"use strict";function downloadCustomFont(fontName,variants){var idAccount=window.ApplicationConfiguration.project.id_account,uxpinApi=window.ApplicationConfiguration.uxpinApi,key=fontName+variants.join("_"),deferred=$q.defer();return zipCache[key]?(deferred.resolve(zipCache[key]),deferred.promise):(zipCache[key]={isDownloading:!0},$http({method:"POST",url:uxpinApi+"/fonts/custom/zip/",data:{idAccount:idAccount,variants:variants,family:fontName}}).then(function(response){var data=response&&response.data?response.data:null;return zipCache[key]={url:data,isDownloading:!1},zipCache[key]}).catch(function(){throw zipCache[key]=null,new Error("Font download error "+key)}))}function getVariantName(variant,displayVariant){return displayVariant||variantsToNamesMap[variant]||customVariantsToNamesMap[variant]||variant}function findVariant(variants,variantPriorities){var variant;if(_.isArray(variantPriorities))for(var i=0;i<variantPriorities.length;i++)if(variant=variantPriorities[i],_.find(variants,function(v){return v.shorthand===variant}))return variant}function getFontFamilyName(fontData,variants,variantPriorities){var variant=_.isString(variants)?variants:findVariant(variants,variantPriorities);return fontData.type+"-"+fontData.family+"-"+variant}function getFontFamily(font,variants){var fontData=font.fontData;if(fontData)return fontData.type&&"S"!==fontData.type?"C"===fontData.type?getFontFamilyName(fontData,variants,customFontVariantPriorities):getFontFamilyName(fontData,variants,fontVariantPriorities):font.fontFamily}function getCompareVariantsFn(){return function(a,b){return namesToIndexesMap[a.name]<namesToIndexesMap[b.name]?-1:1}}function getCompareFontSizeFn(){return function(a,b){return parseInt(a)-parseInt(b)}}function isBold(font){return font&&"bold"===font.fontWeight||parseInt(font.fontWeight)>400}function isItalic(font){return font&&"italic"===font.fontStyle}function hasUnderlineDecoration(font){return font&&_.isString(font.textDecoration)&&font.textDecoration.indexOf("underline")!==-1}function hasLineThroughDecoration(font){return font&&_.isString(font.textDecoration)&&font.textDecoration.indexOf("line-through")!==-1}function isGoogleFont(fontData){return fontData.type===FONT_TYPES.GOOGLE}function isTypekitFont(fontData){return fontData.type===FONT_TYPES.TYPEKIT}function isCustomFont(fontData){return fontData.type===FONT_TYPES.CUSTOM}function getGoogleFontLink(fontName){return"https://fonts.google.com/specimen/"+fontName}function getTypekitFontLink(fontName){return"https://typekit.com/fonts/"+(fontName||"").toLowerCase().replace(/ /g,"-")}function getTransform(font){var textTransform=font&&"none"!==font.textTransform?font.textTransform:null,fontVariant=font&&"normal"!==font.fontVariant?font.fontVariant:null;return textTransform||fontVariant}var FONT_TYPES={CUSTOM:"C",TYPEKIT:"T",GOOGLE:"G",STANDARD:"S"},FONT_VARIANTS_NAMES={HAIRLINE:"Hairline",HAIRLINE_ITALIC:"Hairline Italic",ULTRA_LIGHT_ITALIC:"Ultra-Light Italic",THIN:"Thin",THIN_ITALIC:"Thin Italic",EXTRA_LIGHT:"Extra-Light",EXTRA_LIGHT_ITALIC:"Extra-Light Italic",LIGHT:"Light",LIGHT_ITALIC:"Light Italic",REGULAR:"Regular",ITALIC:"Italic",MEDIUM:"Medium",MEDIUM_ITALIC:"Medium Italic",BOOK:"Book",BOOK_ITALIC:"Book Italic",SEMI_BOLD:"Semi-Bold",SEMI_BOLD_ITALIC:"Semi-Bold Italic",BOLD:"Bold",BOLD_ITALIC:"Bold Italic",EXTRA_BOLD:"Extra-Bold",EXTRA_BOLD_ITALIC:"Extra-Bold Italic",HEAVY:"Heavy",HEAVY_ITALIC:"Heavy Italic",BLACK:"Black",BLACK_ITALIC:"Black Italic",ULTRA_LIGHT:"Ultra-Light"},FONT_VARIANTS={THIN:"n1",EXTRA_LIGHT:"n2",LIGHT:"n3",REGULAR:"n4",MEDIUM:"n5",SEMI_BOLD:"n6",BOLD:"n7",EXTRA_BOLD:"n8",BLACK:"n9",THIN_ITALIC:"i1",EXTRA_LIGHT_ITALIC:"i2",LIGHT_ITALIC:"i3",ITALIC:"i4",MEDIUM_ITALIC:"i5",SEMI_BOLD_ITALIC:"i6",BOLD_ITALIC:"i7",EXTRA_BOLD_ITALIC:"i8",BLACK_ITALIC:"i9"},customVariantsToNamesMap={0:"Hairline",1:"Hairline Italic",2:"Ultra-Light",3:"Ultra-Light Italic",4:"Thin",5:"Thin Italic",6:"Extra-Light",7:"Extra-Light Italic",8:"Light",9:"Light Italic",10:"Regular",11:"Italic",12:"Medium",13:"Medium Italic",14:"Book",15:"Book Italic",16:"Semi-Bold",17:"Semi-Bold Italic",18:"Bold",19:"Bold Italic",20:"Extra-Bold",21:"Extra-Bold Italic",22:"Heavy",23:"Heavy Italic",24:"Black",25:"Black Italic"},namesToIndexesMap={};namesToIndexesMap[FONT_VARIANTS_NAMES.HAIRLINE]=0,namesToIndexesMap[FONT_VARIANTS_NAMES.HAIRLINE_ITALIC]=1,namesToIndexesMap[FONT_VARIANTS_NAMES.ULTRA_LIGHT]=2,namesToIndexesMap[FONT_VARIANTS_NAMES.ULTRA_LIGHT_ITALIC]=3,namesToIndexesMap[FONT_VARIANTS_NAMES.THIN]=4,namesToIndexesMap[FONT_VARIANTS_NAMES.THIN_ITALIC]=5,namesToIndexesMap[FONT_VARIANTS_NAMES.EXTRA_LIGHT]=6,namesToIndexesMap[FONT_VARIANTS_NAMES.EXTRA_LIGHT_ITALIC]=7,namesToIndexesMap[FONT_VARIANTS_NAMES.LIGHT]=8,namesToIndexesMap[FONT_VARIANTS_NAMES.LIGHT_ITALIC]=9,namesToIndexesMap[FONT_VARIANTS_NAMES.REGULAR]=10,namesToIndexesMap[FONT_VARIANTS_NAMES.ITALIC]=11,namesToIndexesMap[FONT_VARIANTS_NAMES.MEDIUM]=12,namesToIndexesMap[FONT_VARIANTS_NAMES.MEDIUM_ITALIC]=13,namesToIndexesMap[FONT_VARIANTS_NAMES.BOOK]=14,namesToIndexesMap[FONT_VARIANTS_NAMES.BOOK_ITALIC]=15,namesToIndexesMap[FONT_VARIANTS_NAMES.SEMI_BOLD]=16,namesToIndexesMap[FONT_VARIANTS_NAMES.SEMI_BOLD_ITALIC]=17,namesToIndexesMap[FONT_VARIANTS_NAMES.BOLD]=18,namesToIndexesMap[FONT_VARIANTS_NAMES.BOLD_ITALIC]=19,namesToIndexesMap[FONT_VARIANTS_NAMES.EXTRA_BOLD]=20,namesToIndexesMap[FONT_VARIANTS_NAMES.EXTRA_BOLD_ITALIC]=21,namesToIndexesMap[FONT_VARIANTS_NAMES.HEAVY]=22,namesToIndexesMap[FONT_VARIANTS_NAMES.HEAVY_ITALIC]=23,namesToIndexesMap[FONT_VARIANTS_NAMES.BLACK]=24,namesToIndexesMap[FONT_VARIANTS_NAMES.BLACK_ITALIC]=25;var variantsToNamesMap={};variantsToNamesMap[FONT_VARIANTS.THIN]="Thin",variantsToNamesMap[FONT_VARIANTS.EXTRA_LIGHT]="Extra-Light",variantsToNamesMap[FONT_VARIANTS.LIGHT]="Light",variantsToNamesMap[FONT_VARIANTS.REGULAR]="Regular",variantsToNamesMap[FONT_VARIANTS.MEDIUM]="Medium",variantsToNamesMap[FONT_VARIANTS.SEMI_BOLD]="Semi-Bold",variantsToNamesMap[FONT_VARIANTS.BOLD]="Bold",variantsToNamesMap[FONT_VARIANTS.EXTRA_BOLD]="Extra-Bold",variantsToNamesMap[FONT_VARIANTS.BLACK]="Black",variantsToNamesMap[FONT_VARIANTS.THIN_ITALIC]="Thin Italic",variantsToNamesMap[FONT_VARIANTS.EXTRA_LIGHT_ITALIC]="Extra-Light Italic",variantsToNamesMap[FONT_VARIANTS.LIGHT_ITALIC]="Light Italic",variantsToNamesMap[FONT_VARIANTS.ITALIC]="Italic",variantsToNamesMap[FONT_VARIANTS.MEDIUM_ITALIC]="Medium Italic",variantsToNamesMap[FONT_VARIANTS.SEMI_BOLD_ITALIC]="Bold Italic",variantsToNamesMap[FONT_VARIANTS.BOLD_ITALIC]="Bold Italic",variantsToNamesMap[FONT_VARIANTS.EXTRA_BOLD_ITALIC]="Extra-Bold Italic",variantsToNamesMap[FONT_VARIANTS.BLACK_ITALIC]="Black Italic";var fontVariantPriorities=["n4","n5","n3","n6","n2","n7","n1","n8","n9","i4","i5","i3","i6","i2","i7","i1","i8","i9"],customFontVariantPriorities=["9","10","8","11","7","12","6","13","5","14","4","15","3","16","2","17","1","18","0","19","20","21","22","23","24","25"],zipCache={};return{variantsToNamesMap:variantsToNamesMap,FONT_VARIANTS:FONT_VARIANTS,FONT_TYPES:FONT_TYPES,isGoogleFont:isGoogleFont,isCustomFont:isCustomFont,isTypekitFont:isTypekitFont,getGoogleFontLink:getGoogleFontLink,getTypekitFontLink:getTypekitFontLink,getVariantName:getVariantName,getCompareVariantsFn:getCompareVariantsFn,getCompareFontSizeFn:getCompareFontSizeFn,getFontFamily:getFontFamily,isBold:isBold,isItalic:isItalic,hasUnderlineDecoration:hasUnderlineDecoration,hasLineThroughDecoration:hasLineThroughDecoration,downloadCustomFont:downloadCustomFont,getTransform:getTransform}}angular.module("core").factory("Font",Font),Font.$inject=["_","$http","$q"]}(),function(){"use strict";function Grid(_){function mapSavedVersionKey(versionKey){for(var patterns=[{regexp:/default/,replacement:"0"},{regexp:/resp(\d+)/,replacement:"$1"}],i=0;i<patterns.length;i++)if(patterns[i].regexp.test(versionKey))return versionKey.replace(patterns[i].regexp,patterns[i].replacement);return!1}function mapSettingsForEngine(settings,version){return _.transform(settings,function(result,value,key){"versions"===key?_.extend(result,value[version]):result[key]=value})}function mapSavedVersionsSettings(settings){var mapped={};return _.forEach(settings,function(versionSettings,versionKey){var mappedVersionKey=mapSavedVersionKey(versionKey);mappedVersionKey&&(mapped[mappedVersionKey]=_.mapValues(extractVersionSettings(SETTINGS_MAP),function(legacyKey,key){return"gridMaxWidth"!==key||versionSettings[LEGACY_SETTINGS.fixedWidth]?versionSettings[legacyKey]:"100%"}))}),mapped}function mapSavedSettings(settings){var mapped={gridDisplay:!1,gridOnTop:!0,versions:{}};return settings&&(_.forEach(extractGlobalSettings(SETTINGS_MAP),function(legacyKey,key){mapped[key]=settings[legacyKey]}),mapped.versions=mapSavedVersionsSettings(settings)),mapped}function extractGlobalSettings(settings){return _.pick(settings,GLOBAL_SETTINGS)}function extractVersionSettings(settings){return _.pick(settings,_.difference(_.keys(SETTINGS_MAP),GLOBAL_SETTINGS))}var SETTINGS_MAP={gridDisplay:"enabled",gridOnTop:"grid_on_top",gridMaxWidth:"width",gridMargin:"margin",gridColumnWidth:"col_width",gridGutter:"col_spacing",gridColumns:"cols_count"},LEGACY_SETTINGS={fixedWidth:"fixed_width"},GLOBAL_SETTINGS=["gridDisplay","gridOnTop"];return{mapSavedSettings:mapSavedSettings,mapSettingsForEngine:mapSettingsForEngine}}angular.module("core").factory("Grid",["_",Grid])}(),angular.module("core").factory("ImageService",["$http","$q","_",function($http,$q,_){"use strict";function getImageDimensions(imageUrl){var img,deferred=$q.defer();return dimensionsCache[imageUrl]?deferred.resolve(dimensionsCache[imageUrl]):(img=new Image,img.addEventListener("load",function(){dimensionsCache[imageUrl]={width:img.naturalWidth,height:img.naturalHeight},deferred.resolve(dimensionsCache[imageUrl])}),img.addEventListener("error",function(){deferred.reject()}),img.src=imageUrl),deferred.promise}function downloadImages(projectName,files){var idAccount=window.ApplicationConfiguration.project.id_account,key=(window.ApplicationConfiguration.uxpinApi,projectName+idAccount),deferred=$q.defer();return zipCache[key]?(deferred.resolve(zipCache[key]),deferred.promise):(zipCache[key]={isDownloading:!0},$http({method:"POST",url:"/api/projects/assets",data:{idAccount:idAccount,projectName:projectName,files:files}}).then(function(response){var data=response&&response.data?response.data:null;return zipCache[key]={url:data,isDownloading:!1},zipCache[key]}).catch(function(){throw zipCache[key]=null,new Error("Download images error "+key)}))}function getImageSize(imageUrl){var deferred=$q.defer();return sizeCache[imageUrl]?(deferred.resolve(sizeCache[imageUrl]),deferred.promise):$http({method:"POST",url:"/api/utils/file/size",data:{file:imageUrl}}).then(function(response){var size=response&&response.data?response.data.size:null;return sizeCache[imageUrl]=size,size})}var sizeCache={},dimensionsCache={},zipCache={};return{getImageSize:getImageSize,getImageDimensions:getImageDimensions,downloadImages:downloadImages}}]),angular.module("core").factory("LiveSessionService",["$window","$q","$rootScope","$state","$location","$translate","$log","Restangular","ProjectsService","PagesService","UsersService","LiveSessionInstanceService","Engine",function($window,$q,$rootScope,$state,$location,$translate,$log,Restangular,ProjectsService,PagesService,UsersService,LiveSessionInstanceService,Engine){"use strict";var EVENTS=LiveShare.enums.EVENTS,ROOM_SETTINGS=LiveShare.enums.ROOM_SETTINGS,SESSION_TYPES=LiveShare.enums.SESSION_TYPES,debug=!1,debugConsole={log:function(){debug&&$log.log.apply($log,arguments)},count:function(){debug&&$window.console.count.apply($window.console,arguments)}},LiveSession=function(type){this.type=type,this.liveShare=null,this.muted=!1,this.roomID=null,this.roomConfigurationOptions=null,this.onContentLoaded,this.onChangePageDuringSession,this.observerCallbacks=[],this.restangular=Restangular.withConfig(function(RestangularConfigurer){RestangularConfigurer.setBaseUrl("/api/live-presentation/")}),this.onChangePage=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(){this.roomId(null)}.bind(this))};return LiveSession.prototype.initializeLiveShare=function(){var liveShare=new LiveShare({socketURL:ApplicationConfiguration.socketServerURL+"/live-presentation",scrolledElement:"main .scrolled-content",relativeElement:".preview-container",canvasElement:".ng-canvas"});return liveShare.on(EVENTS.START,this.onLiveSessionStart.bind(this)),liveShare.on(EVENTS.FINISH,this.onLiveSessionFinish.bind(this)),liveShare.on(EVENTS.COLLABORATOR_JOIN,this.fireObserverCallback.bind(this,EVENTS.COLLABORATOR_JOIN)),liveShare.on(EVENTS.COLLABORATOR_LEFT,this.fireObserverCallback.bind(this,EVENTS.COLLABORATOR_LEFT)),liveShare.on(EVENTS.FOLLOW_CURSOR_ON,this.fireObserverCallback.bind(this,EVENTS.FOLLOW_CURSOR_ON)),liveShare.on(EVENTS.FOLLOW_CURSOR_OFF,this.fireObserverCallback.bind(this,EVENTS.FOLLOW_CURSOR_OFF)),liveShare.on(EVENTS.TESTER_JOINED,this.fireObserverCallback.bind(this,EVENTS.TESTER_JOINED)),liveShare.on(EVENTS.ALLOW_START,this.fireObserverCallback.bind(this,EVENTS.ALLOW_START)),liveShare.on(EVENTS.VIDEO_PARTICIPANT_JOINED,this.fireObserverCallback.bind(this,EVENTS.VIDEO_PARTICIPANT_JOINED)),liveShare.on(EVENTS.VIDEO_PARTICIPANT_LEFT,this.fireObserverCallback.bind(this,EVENTS.VIDEO_PARTICIPANT_LEFT)),liveShare.on(EVENTS.MUTE,this.fireObserverCallback.bind(this,EVENTS.MUTE)),liveShare.on(EVENTS.DOM,this.onDOMEvent.bind(this)),liveShare.on(EVENTS.MEDIA_ACCESS,this.onMediaAccess.bind(this)),liveShare},LiveSession.prototype.shouldEnableInteractionsShare=function(){var isHostSession=this.isHostSession();return this.type===SESSION_TYPES.SHARING&&isHostSession||this.type===SESSION_TYPES.TESTING&&!isHostSession},LiveSession.prototype.getType=function(){return this.type},LiveSession.prototype.onDOMEvent=function(data){Interactions.dispatchEvent(data.serializedEvent,data.id)},LiveSession.prototype.onMediaAccess=function(value){$rootScope.$emit(PreviewEnums.MEDIA_ACCESS,value)},LiveSession.prototype.onLiveSessionStart=function(){angular.isFunction(Interactions.handleFormEvents)&&Interactions.handleFormEvents(),this.shouldEnableInteractionsShare()&&Engine.enableInteractionsShare(),this.onChangePageDuringSession=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(e,id){var newURL=document.URL.split("#")[0]+$state.href("home.page",{pageId:id});try{this.liveShare.eventDispatcher.handleEvent({},{eventCategory:"HashChangeEvent",selector:"window",type:"hashchange",newURL:newURL,oldURL:document.URL})}catch(err){return void $log.error(err)}this.liveShare.onPageChangeStart()}.bind(this)),this.fireObserverCallback(LiveShare.enums.EVENTS.START),this.onContentLoaded=$rootScope.$on(PreviewEnums.ON_CONTENT_LOADED,function(){this.liveShare.onPageChangeFinish()}.bind(this))},LiveSession.prototype.onLiveSessionFinish=function(data){angular.isFunction(Interactions.unhandleFormEvents)&&Interactions.unhandleFormEvents(),Engine.isInteractionsShare()&&Engine.enableInteractionsShare(),this.onChangePageDuringSession(),this.onContentLoaded(),this.fireObserverCallback("finish",data)},LiveSession.prototype.getCurrentPortForUrl=function(){var port=$location.port();return port&&80!==port?":"+port:""},LiveSession.prototype.roomId=function(id){return id?void(this.roomID=id):this.roomID},LiveSession.prototype.registerObserverCallback=function(event,callback){this.observerCallbacks[event]||(this.observerCallbacks[event]=[]),debugConsole.count("Registering callback for "+event),this.observerCallbacks[event].push(callback)},LiveSession.prototype.fireObserverCallback=function(event,data){debugConsole.count("Fire: "+event),debugConsole.log("Data",data),this.observerCallbacks[event]?(debugConsole.log("Callbacks count: "+this.observerCallbacks[event].length),this.observerCallbacks[event].forEach(function(callback){debugConsole.count("Callback for "+event+" fired"),callback(data)})):debugConsole.log("Callbacks count: 0")},LiveSession.prototype.makeRoomReservation=function(){var d=$q.defer(),queryParams={sessionId:UsersService.me.id_session,url:this.getDestinationUrl(),name:ProjectsService.currentProjectName,type:this.type};return this.restangular.one("").post("make-room-reservation",queryParams).then(function(data){this.roomId(data),d.resolve(this.roomId())}.bind(this),function(err){$log.error(err),d.reject(err)}),d.promise},LiveSession.prototype.startInitializing=function(data){LiveSessionInstanceService.set(this);var queryParams={};data.options&&(queryParams.options=data.options),data.type&&(queryParams.type=data.type),$state.go("home.page.live-share-start",queryParams)},LiveSession.prototype.create=function(settings,userData){return this.liveShare=this.initializeLiveShare(),this.liveShare.create(settings,userData)},LiveSession.prototype.join=function(sessionId,userData){return this.liveShare=this.initializeLiveShare(),this.liveShare.join({roomID:sessionId},userData)},LiveSession.prototype.quit=function(){this.liveShare.quit()},LiveSession.prototype.isSession=function(){return!!this.liveShare&&this.liveShare.isSession()},LiveSession.prototype.isHostSession=function(){return this.liveShare.isHostSession()},LiveSession.prototype.getInviteURL=function(){return $location.protocol()+"://"+$location.host()+this.getCurrentPortForUrl()+"/live-presentation/"+this.roomId()},LiveSession.prototype.getDestinationUrl=function(){return $state.href("home.page",{pageId:PagesService.currentPageId},{absolute:!0})},LiveSession.prototype.getCollaboratorsData=function(){return this.liveShare.getCollaboratorsData()},LiveSession.prototype.getHostData=function(){return this.liveShare.getHostData()},LiveSession.prototype.removeCollaborator=function(id){return this.liveShare.removeCollaborator(id)},LiveSession.prototype.getConfigurationOptions=function(){},LiveSession.prototype.setOption=function(key,val){var option=this.translateOption(key,val),optionName=Object.keys(option)[0];this.liveShare.setOption(optionName,option[optionName])},LiveSession.prototype.translateOption=function(key,val){
var option={};return key===ROOM_SETTINGS.ALLWAYS_FOLLOW_HOST?option.toggleFollow=!val:key===ROOM_SETTINGS.SHOW_CURSOR?option.showCursor=val?"all":"host":key===ROOM_SETTINGS.CAN_CLOSE_TASKS?option[ROOM_SETTINGS.CAN_CLOSE_TASKS]=val?"all":"host":key===ROOM_SETTINGS.SEE_SITEMAP?option[ROOM_SETTINGS.SEE_SITEMAP]=val?"all":"host":option[key]=val,option},LiveSession.prototype.followCursor=function(id){this.liveShare.followCursor(id)},LiveSession.prototype.executeEventsQueue=function(){return this.liveShare.collaboration.executeEventsQueue()},LiveSession.prototype.mute=function(value){this.liveShare.mute(value)},LiveSession.prototype.getMyData=function(){return this.liveShare.getMyData()},LiveSession}]),angular.module("core").factory("LiveShareService",["_","$translate","LiveSessionService",function(_,$translate,LiveSessionService){"use strict";var LiveShareService=function(){LiveSessionService.apply(this,arguments)},proto=LiveShareService.prototype;return proto=_.extend(proto,LiveSessionService.prototype),proto.constructor=LiveShareService,proto.getConfigurationOptions=function(){return $translate(["LS_OPTION_SHOW_CURSOR","LS_OPTION_FOLLOW_CURSOR"]).then(function(translations){return this.roomConfigurationOptions||(this.roomConfigurationOptions=[{name:translations.LS_OPTION_SHOW_CURSOR,value:!1,param:"showCursor"},{name:translations.LS_OPTION_FOLLOW_CURSOR,value:!1,param:"alwaysFollowHost"}]),this.roomConfigurationOptions}.bind(this))},proto.startSession=function(){this.liveShare.startLPSession()},new LiveShareService(LiveShare.enums.SESSION_TYPES.SHARING)}]),angular.module("core").factory("_",[function(){"use strict";return window._}]),angular.module("core").service("moment",function(){"use strict";return window.moment}),function(){"use strict";function NotificationsService(_,$rootScope,$q,Rest,ProjectsService,ExportService){return{notificationsMap:{},getNotifications:function(){var projectHash=ProjectsService.currentProjectHash;return ExportService.isExport()?$q.when([]):Rest.one("projects",projectHash).all("notifications").getList().then(function(notifications){this.generateNotificationsMap(notifications)}.bind(this))},addToNotifications:function(commentId,emails){return this.updateNotification(commentId,emails,"add")},removeFromNotification:function(commentId,emails){return this.updateNotification(commentId,emails,"remove")},updateNotification:function(commentId,emails,type){var projectHash=ProjectsService.currentProjectHash,deferred=$q.defer();return _.isEmpty(emails)?deferred.reject():Rest.one("projects",projectHash).all("notifications").customPOST({commentId:commentId,emails:emails},type).then(function(notification){this.addToNotificationsMap(notification),$rootScope.$emit(PreviewEnums.ON_CHANGE_NOTIFICATIONS,commentId,notification)}.bind(this))},generateNotificationsMap:function(notifications){_.forIn(this.notificationsMap,function(value,key){delete this.notificationsMap[key]}.bind(this)),notifications.forEach(function(notification){this.addToNotificationsMap(notification)}.bind(this))},addToNotificationsMap:function(notification){this.notificationsMap[notification._id]=notification}}}angular.module("core").factory("NotificationsService",NotificationsService),NotificationsService.$inject=["_","$rootScope","$q","Rest","ProjectsService","ExportService"]}(),function(){"use strict";function NtcService(){var ntc={init:function(){for(var color,rgb,hsl,i=0;i<ntc.names.length;i++)color="#"+ntc.names[i][0],rgb=ntc.rgb(color),hsl=ntc.hsl(color),ntc.names[i].push(rgb[0],rgb[1],rgb[2],hsl[0],hsl[1],hsl[2])},name:function(color){if(color=color.toUpperCase(),color.length<3||color.length>7)return["#000000","Invalid Color: "+color,!1];color.length%3==0&&(color="#"+color),4==color.length&&(color="#"+color.substr(1,1)+color.substr(1,1)+color.substr(2,1)+color.substr(2,1)+color.substr(3,1)+color.substr(3,1));for(var rgb=ntc.rgb(color),r=rgb[0],g=rgb[1],b=rgb[2],hsl=ntc.hsl(color),h=hsl[0],s=hsl[1],l=hsl[2],ndf1=0,ndf2=0,ndf=0,cl=-1,df=-1,i=0;i<ntc.names.length;i++){if(color=="#"+ntc.names[i][0])return["#"+ntc.names[i][0],ntc.names[i][1],!0];ndf1=Math.pow(r-ntc.names[i][2],2)+Math.pow(g-ntc.names[i][3],2)+Math.pow(b-ntc.names[i][4],2),ndf2=Math.pow(h-ntc.names[i][5],2)+Math.pow(s-ntc.names[i][6],2)+Math.pow(l-ntc.names[i][7],2),ndf=ndf1+2*ndf2,(df<0||df>ndf)&&(df=ndf,cl=i)}return cl<0?["#000000","Invalid Color: "+color,!1]:["#"+ntc.names[cl][0],ntc.names[cl][1],!1]},hsl:function(color){var min,max,delta,h,s,l,rgb=[parseInt("0x"+color.substring(1,3))/255,parseInt("0x"+color.substring(3,5))/255,parseInt("0x"+color.substring(5,7))/255],r=rgb[0],g=rgb[1],b=rgb[2];return min=Math.min(r,Math.min(g,b)),max=Math.max(r,Math.max(g,b)),delta=max-min,l=(min+max)/2,s=0,l>0&&l<1&&(s=delta/(l<.5?2*l:2-2*l)),h=0,delta>0&&(max==r&&max!=g&&(h+=(g-b)/delta),max==g&&max!=b&&(h+=2+(b-r)/delta),max==b&&max!=r&&(h+=4+(r-g)/delta),h/=6),[parseInt(255*h),parseInt(255*s),parseInt(255*l)]},rgb:function(color){return[parseInt("0x"+color.substring(1,3)),parseInt("0x"+color.substring(3,5)),parseInt("0x"+color.substring(5,7))]},names:[["000000","Black"],["000080","Navy Blue"],["0000C8","Dark Blue"],["0000FF","Blue"],["000741","Stratos"],["001B1C","Swamp"],["002387","Resolution Blue"],["002900","Deep Fir"],["002E20","Burnham"],["002FA7","International Klein Blue"],["003153","Prussian Blue"],["003366","Midnight Blue"],["003399","Smalt"],["003532","Deep Teal"],["003E40","Cyprus"],["004620","Kaitoke Green"],["0047AB","Cobalt"],["004816","Crusoe"],["004950","Sherpa Blue"],["0056A7","Endeavour"],["00581A","Camarone"],["0066CC","Science Blue"],["0066FF","Blue Ribbon"],["00755E","Tropical Rain Forest"],["0076A3","Allports"],["007BA7","Deep Cerulean"],["007EC7","Lochmara"],["007FFF","Azure Radiance"],["008080","Teal"],["0095B6","Bondi Blue"],["009DC4","Pacific Blue"],["00A693","Persian Green"],["00A86B","Jade"],["00CC99","Caribbean Green"],["00CCCC","Robin's Egg Blue"],["00FF00","Green"],["00FF7F","Spring Green"],["00FFFF","Cyan / Aqua"],["010D1A","Blue Charcoal"],["011635","Midnight"],["011D13","Holly"],["012731","Daintree"],["01361C","Cardin Green"],["01371A","County Green"],["013E62","Astronaut Blue"],["013F6A","Regal Blue"],["014B43","Aqua Deep"],["015E85","Orient"],["016162","Blue Stone"],["016D39","Fun Green"],["01796F","Pine Green"],["017987","Blue Lagoon"],["01826B","Deep Sea"],["01A368","Green Haze"],["022D15","English Holly"],["02402C","Sherwood Green"],["02478E","Congress Blue"],["024E46","Evening Sea"],["026395","Bahama Blue"],["02866F","Observatory"],["02A4D3","Cerulean"],["03163C","Tangaroa"],["032B52","Green Vogue"],["036A6E","Mosque"],["041004","Midnight Moss"],["041322","Black Pearl"],["042E4C","Blue Whale"],["044022","Zuccini"],["044259","Teal Blue"],["051040","Deep Cove"],["051657","Gulf Blue"],["055989","Venice Blue"],["056F57","Watercourse"],["062A78","Catalina Blue"],["063537","Tiber"],["069B81","Gossamer"],["06A189","Niagara"],["073A50","Tarawera"],["080110","Jaguar"],["081910","Black Bean"],["082567","Deep Sapphire"],["088370","Elf Green"],["08E8DE","Bright Turquoise"],["092256","Downriver"],["09230F","Palm Green"],["09255D","Madison"],["093624","Bottle Green"],["095859","Deep Sea Green"],["097F4B","Salem"],["0A001C","Black Russian"],["0A480D","Dark Fern"],["0A6906","Japanese Laurel"],["0A6F75","Atoll"],["0B0B0B","Cod Gray"],["0B0F08","Marshland"],["0B1107","Gordons Green"],["0B1304","Black Forest"],["0B6207","San Felix"],["0BDA51","Malachite"],["0C0B1D","Ebony"],["0C0D0F","Woodsmoke"],["0C1911","Racing Green"],["0C7A79","Surfie Green"],["0C8990","Blue Chill"],["0D0332","Black Rock"],["0D1117","Bunker"],["0D1C19","Aztec"],["0D2E1C","Bush"],["0E0E18","Cinder"],["0E2A30","Firefly"],["0F2D9E","Torea Bay"],["10121D","Vulcan"],["101405","Green Waterloo"],["105852","Eden"],["110C6C","Arapawa"],["120A8F","Ultramarine"],["123447","Elephant"],["126B40","Jewel"],["130000","Diesel"],["130A06","Asphalt"],["13264D","Blue Zodiac"],["134F19","Parsley"],["140600","Nero"],["1450AA","Tory Blue"],["151F4C","Bunting"],["1560BD","Denim"],["15736B","Genoa"],["161928","Mirage"],["161D10","Hunter Green"],["162A40","Big Stone"],["163222","Celtic"],["16322C","Timber Green"],["163531","Gable Green"],["171F04","Pine Tree"],["175579","Chathams Blue"],["182D09","Deep Forest Green"],["18587A","Blumine"],["19330E","Palm Leaf"],["193751","Nile Blue"],["1959A8","Fun Blue"],["1A1A68","Lucky Point"],["1AB385","Mountain Meadow"],["1B0245","Tolopea"],["1B1035","Haiti"],["1B127B","Deep Koamaru"],["1B1404","Acadia"],["1B2F11","Seaweed"],["1B3162","Biscay"],["1B659D","Matisse"],["1C1208","Crowshead"],["1C1E13","Rangoon Green"],["1C39BB","Persian Blue"],["1C402E","Everglade"],["1C7C7D","Elm"],["1D6142","Green Pea"],["1E0F04","Creole"],["1E1609","Karaka"],["1E1708","El Paso"],["1E385B","Cello"],["1E433C","Te Papa Green"],["1E90FF","Dodger Blue"],["1E9AB0","Eastern Blue"],["1F120F","Night Rider"],["1FC2C2","Java"],["20208D","Jacksons Purple"],["202E54","Cloud Burst"],["204852","Blue Dianne"],["211A0E","Eternity"],["220878","Deep Blue"],["228B22","Forest Green"],["233418","Mallard"],["240A40","Violet"],["240C02","Kilamanjaro"],["242A1D","Log Cabin"],["242E16","Black Olive"],["24500F","Green House"],["251607","Graphite"],["251706","Cannon Black"],["251F4F","Port Gore"],["25272C","Shark"],["25311C","Green Kelp"],["2596D1","Curious Blue"],["260368","Paua"],["26056A","Paris M"],["261105","Wood Bark"],["261414","Gondola"],["262335","Steel Gray"],["26283B","Ebony Clay"],["273A81","Bay of Many"],["27504B","Plantation"],["278A5B","Eucalyptus"],["281E15","Oil"],["283A77","Astronaut"],["286ACD","Mariner"],["290C5E","Violent Violet"],["292130","Bastille"],["292319","Zeus"],["292937","Charade"],["297B9A","Jelly Bean"],["29AB87","Jungle Green"],["2A0359","Cherry Pie"],["2A140E","Coffee Bean"],["2A2630","Baltic Sea"],["2A380B","Turtle Green"],["2A52BE","Cerulean Blue"],["2B0202","Sepia Black"],["2B194F","Valhalla"],["2B3228","Heavy Metal"],["2C0E8C","Blue Gem"],["2C1632","Revolver"],["2C2133","Bleached Cedar"],["2C8C84","Lochinvar"],["2D2510","Mikado"],["2D383A","Outer Space"],["2D569B","St Tropaz"],["2E0329","Jacaranda"],["2E1905","Jacko Bean"],["2E3222","Rangitoto"],["2E3F62","Rhino"],["2E8B57","Sea Green"],["2EBFD4","Scooter"],["2F270E","Onion"],["2F3CB3","Governor Bay"],["2F519E","Sapphire"],["2F5A57","Spectra"],["2F6168","Casal"],["300529","Melanzane"],["301F1E","Cocoa Brown"],["302A0F","Woodrush"],["304B6A","San Juan"],["30D5C8","Turquoise"],["311C17","Eclipse"],["314459","Pickled Bluewood"],["315BA1","Azure"],["31728D","Calypso"],["317D82","Paradiso"],["32127A","Persian Indigo"],["32293A","Blackcurrant"],["323232","Mine Shaft"],["325D52","Stromboli"],["327C14","Bilbao"],["327DA0","Astral"],["33036B","Christalle"],["33292F","Thunder"],["33CC99","Shamrock"],["341515","Tamarind"],["350036","Mardi Gras"],["350E42","Valentino"],["350E57","Jagger"],["353542","Tuna"],["354E8C","Chambray"],["363050","Martinique"],["363534","Tuatara"],["363C0D","Waiouru"],["36747D","Ming"],["368716","La Palma"],["370202","Chocolate"],["371D09","Clinker"],["37290E","Brown Tumbleweed"],["373021","Birch"],["377475","Oracle"],["380474","Blue Diamond"],["381A51","Grape"],["383533","Dune"],["384555","Oxford Blue"],["384910","Clover"],["394851","Limed Spruce"],["396413","Dell"],["3A0020","Toledo"],["3A2010","Sambuca"],["3A2A6A","Jacarta"],["3A686C","William"],["3A6A47","Killarney"],["3AB09E","Keppel"],["3B000B","Temptress"],["3B0910","Aubergine"],["3B1F1F","Jon"],["3B2820","Treehouse"],["3B7A57","Amazon"],["3B91B4","Boston Blue"],["3C0878","Windsor"],["3C1206","Rebel"],["3C1F76","Meteorite"],["3C2005","Dark Ebony"],["3C3910","Camouflage"],["3C4151","Bright Gray"],["3C4443","Cape Cod"],["3C493A","Lunar Green"],["3D0C02","Bean  "],["3D2B1F","Bistre"],["3D7D52","Goblin"],["3E0480","Kingfisher Daisy"],["3E1C14","Cedar"],["3E2B23","English Walnut"],["3E2C1C","Black Marlin"],["3E3A44","Ship Gray"],["3EABBF","Pelorous"],["3F2109","Bronze"],["3F2500","Cola"],["3F3002","Madras"],["3F307F","Minsk"],["3F4C3A","Cabbage Pont"],["3F583B","Tom Thumb"],["3F5D53","Mineral Green"],["3FC1AA","Puerto Rico"],["3FFF00","Harlequin"],["401801","Brown Pod"],["40291D","Cork"],["403B38","Masala"],["403D19","Thatch Green"],["405169","Fiord"],["40826D","Viridian"],["40A860","Chateau Green"],["410056","Ripe Plum"],["411F10","Paco"],["412010","Deep Oak"],["413C37","Merlin"],["414257","Gun Powder"],["414C7D","East Bay"],["4169E1","Royal Blue"],["41AA78","Ocean Green"],["420303","Burnt Maroon"],["423921","Lisbon Brown"],["427977","Faded Jade"],["431560","Scarlet Gum"],["433120","Iroko"],["433E37","Armadillo"],["434C59","River Bed"],["436A0D","Green Leaf"],["44012D","Barossa"],["441D00","Morocco Brown"],["444954","Mako"],["454936","Kelp"],["456CAC","San Marino"],["45B1E8","Picton Blue"],["460B41","Loulou"],["462425","Crater Brown"],["465945","Gray Asparagus"],["4682B4","Steel Blue"],["480404","Rustic Red"],["480607","Bulgarian Rose"],["480656","Clairvoyant"],["481C1C","Cocoa Bean"],["483131","Woody Brown"],["483C32","Taupe"],["49170C","Van Cleef"],["492615","Brown Derby"],["49371B","Metallic Bronze"],["495400","Verdun Green"],["496679","Blue Bayoux"],["497183","Bismark"],["4A2A04","Bracken"],["4A3004","Deep Bronze"],["4A3C30","Mondo"],["4A4244","Tundora"],["4A444B","Gravel"],["4A4E5A","Trout"],["4B0082","Pigment Indigo"],["4B5D52","Nandor"],["4C3024","Saddle"],["4C4F56","Abbey"],["4D0135","Blackberry"],["4D0A18","Cab Sav"],["4D1E01","Indian Tan"],["4D282D","Cowboy"],["4D282E","Livid Brown"],["4D3833","Rock"],["4D3D14","Punga"],["4D400F","Bronzetone"],["4D5328","Woodland"],["4E0606","Mahogany"],["4E2A5A","Bossanova"],["4E3B41","Matterhorn"],["4E420C","Bronze Olive"],["4E4562","Mulled Wine"],["4E6649","Axolotl"],["4E7F9E","Wedgewood"],["4EABD1","Shakespeare"],["4F1C70","Honey Flower"],["4F2398","Daisy Bush"],["4F69C6","Indigo"],["4F7942","Fern Green"],["4F9D5D","Fruit Salad"],["4FA83D","Apple"],["504351","Mortar"],["507096","Kashmir Blue"],["507672","Cutty Sark"],["50C878","Emerald"],["514649","Emperor"],["516E3D","Chalet Green"],["517C66","Como"],["51808F","Smalt Blue"],["52001F","Castro"],["520C17","Maroon Oak"],["523C94","Gigas"],["533455","Voodoo"],["534491","Victoria"],["53824B","Hippie Green"],["541012","Heath"],["544333","Judge Gray"],["54534D","Fuscous Gray"],["549019","Vida Loca"],["55280C","Cioccolato"],["555B10","Saratoga"],["556D56","Finlandia"],["5590D9","Havelock Blue"],["56B4BE","Fountain Blue"],["578363","Spring Leaves"],["583401","Saddle Brown"],["585562","Scarpa Flow"],["587156","Cactus"],["589AAF","Hippie Blue"],["591D35","Wine Berry"],["592804","Brown Bramble"],["593737","Congo Brown"],["594433","Millbrook"],["5A6E9C","Waikawa Gray"],["5A87A0","Horizon"],["5B3013","Jambalaya"],["5C0120","Bordeaux"],["5C0536","Mulberry Wood"],["5C2E01","Carnaby Tan"],["5C5D75","Comet"],["5D1E0F","Redwood"],["5D4C51","Don Juan"],["5D5C58","Chicago"],["5D5E37","Verdigris"],["5D7747","Dingley"],["5DA19F","Breaker Bay"],["5E483E","Kabul"],["5E5D3B","Hemlock"],["5F3D26","Irish Coffee"],["5F5F6E","Mid Gray"],["5F6672","Shuttle Gray"],["5FA777","Aqua Forest"],["5FB3AC","Tradewind"],["604913","Horses Neck"],["605B73","Smoky"],["606E68","Corduroy"],["6093D1","Danube"],["612718","Espresso"],["614051","Eggplant"],["615D30","Costa Del Sol"],["61845F","Glade Green"],["622F30","Buccaneer"],["623F2D","Quincy"],["624E9A","Butterfly Bush"],["625119","West Coast"],["626649","Finch"],["639A8F","Patina"],["63B76C","Fern"],["6456B7","Blue Violet"],["646077","Dolphin"],["646463","Storm Dust"],["646A54","Siam"],["646E75","Nevada"],["6495ED","Cornflower Blue"],["64CCDB","Viking"],["65000B","Rosewood"],["651A14","Cherrywood"],["652DC1","Purple Heart"],["657220","Fern Frond"],["65745D","Willow Grove"],["65869F","Hoki"],["660045","Pompadour"],["660099","Purple"],["66023C","Tyrian Purple"],["661010","Dark Tan"],["66B58F","Silver Tree"],["66FF00","Bright Green"],["66FF66","Screamin' Green"],["67032D","Black Rose"],["675FA6","Scampi"],["676662","Ironside Gray"],["678975","Viridian Green"],["67A712","Christi"],["683600","Nutmeg Wood Finish"],["685558","Zambezi"],["685E6E","Salt Box"],["692545","Tawny Port"],["692D54","Finn"],["695F62","Scorpion"],["697E9A","Lynch"],["6A442E","Spice"],["6A5D1B","Himalaya"],["6A6051","Soya Bean"],["6B2A14","Hairy Heath"],["6B3FA0","Royal Purple"],["6B4E31","Shingle Fawn"],["6B5755","Dorado"],["6B8BA2","Bermuda Gray"],["6B8E23","Olive Drab"],["6C3082","Eminence"],["6CDAE7","Turquoise Blue"],["6D0101","Lonestar"],["6D5E54","Pine Cone"],["6D6C6C","Dove Gray"],["6D9292","Juniper"],["6D92A1","Gothic"],["6E0902","Red Oxide"],["6E1D14","Moccaccino"],["6E4826","Pickled Bean"],["6E4B26","Dallas"],["6E6D57","Kokoda"],["6E7783","Pale Sky"],["6F440C","Cafe Royale"],["6F6A61","Flint"],["6F8E63","Highland"],["6F9D02","Limeade"],["6FD0C5","Downy"],["701C1C","Persian Plum"],["704214","Sepia"],["704A07","Antique Bronze"],["704F50","Ferra"],["706555","Coffee"],["708090","Slate Gray"],["711A00","Cedar Wood Finish"],["71291D","Metallic Copper"],["714693","Affair"],["714AB2","Studio"],["715D47","Tobacco Brown"],["716338","Yellow Metal"],["716B56","Peat"],["716E10","Olivetone"],["717486","Storm Gray"],["718080","Sirocco"],["71D9E2","Aquamarine Blue"],["72010F","Venetian Red"],["724A2F","Old Copper"],["726D4E","Go Ben"],["727B89","Raven"],["731E8F","Seance"],["734A12","Raw Umber"],["736C9F","Kimberly"],["736D58","Crocodile"],["737829","Crete"],["738678","Xanadu"],["74640D","Spicy Mustard"],["747D63","Limed Ash"],["747D83","Rolling Stone"],["748881","Blue Smoke"],["749378","Laurel"],["74C365","Mantis"],["755A57","Russett"],["7563A8","Deluge"],["76395D","Cosmic"],["7666C6","Blue Marguerite"],["76BD17","Lima"],["76D7EA","Sky Blue"],["770F05","Dark Burgundy"],["771F1F","Crown of Thorns"],["773F1A","Walnut"],["776F61","Pablo"],["778120","Pacifika"],["779E86","Oxley"],["77DD77","Pastel Green"],["780109","Japanese Maple"],["782D19","Mocha"],["782F16","Peanut"],["78866B","Camouflage Green"],["788A25","Wasabi"],["788BBA","Ship Cove"],["78A39C","Sea Nymph"],["795D4C","Roman Coffee"],["796878","Old Lavender"],["796989","Rum"],["796A78","Fedora"],["796D62","Sandstone"],["79DEEC","Spray"],["7A013A","Siren"],["7A58C1","Fuchsia Blue"],["7A7A7A","Boulder"],["7A89B8","Wild Blue Yonder"],["7AC488","De York"],["7B3801","Red Beech"],["7B3F00","Cinnamon"],["7B6608","Yukon Gold"],["7B7874","Tapa"],["7B7C94","Waterloo "],["7B8265","Flax Smoke"],["7B9F80","Amulet"],["7BA05B","Asparagus"],["7C1C05","Kenyan Copper"],["7C7631","Pesto"],["7C778A","Topaz"],["7C7B7A","Concord"],["7C7B82","Jumbo"],["7C881A","Trendy Green"],["7CA1A6","Gumbo"],["7CB0A1","Acapulco"],["7CB7BB","Neptune"],["7D2C14","Pueblo"],["7DA98D","Bay Leaf"],["7DC8F7","Malibu"],["7DD8C6","Bermuda"],["7E3A15","Copper Canyon"],["7F1734","Claret"],["7F3A02","Peru Tan"],["7F626D","Falcon"],["7F7589","Mobster"],["7F76D3","Moody Blue"],["7FFF00","Chartreuse"],["7FFFD4","Aquamarine"],["800000","Maroon"],["800B47","Rose Bud Cherry"],["801818","Falu Red"],["80341F","Red Robin"],["803790","Vivid Violet"],["80461B","Russet"],["807E79","Friar Gray"],["808000","Olive"],["808080","Gray"],["80B3AE","Gulf Stream"],["80B3C4","Glacier"],["80CCEA","Seagull"],["81422C","Nutmeg"],["816E71","Spicy Pink"],["817377","Empress"],["819885","Spanish Green"],["826F65","Sand Dune"],["828685","Gunsmoke"],["828F72","Battleship Gray"],["831923","Merlot"],["837050","Shadow"],["83AA5D","Chelsea Cucumber"],["83D0C6","Monte Carlo"],["843179","Plum"],["84A0A0","Granny Smith"],["8581D9","Chetwode Blue"],["858470","Bandicoot"],["859FAF","Bali Hai"],["85C4CC","Half Baked"],["860111","Red Devil"],["863C3C","Lotus"],["86483C","Ironstone"],["864D1E","Bull Shot"],["86560A","Rusty Nail"],["868974","Bitter"],["86949F","Regent Gray"],["871550","Disco"],["87756E","Americano"],["877C7B","Hurricane"],["878D91","Oslo Gray"],["87AB39","Sushi"],["885342","Spicy Mix"],["886221","Kumera"],["888387","Suva Gray"],["888D65","Avocado"],["893456","Camelot"],["893843","Solid Pink"],["894367","Cannon Pink"],["897D6D","Makara"],["8A3324","Burnt Umber"],["8A73D6","True V"],["8A8360","Clay Creek"],["8A8389","Monsoon"],["8A8F8A","Stack"],["8AB9F1","Jordy Blue"],["8B00FF","Electric Violet"],["8B0723","Monarch"],["8B6B0B","Corn Harvest"],["8B8470","Olive Haze"],["8B847E","Schooner"],["8B8680","Natural Gray"],["8B9C90","Mantle"],["8B9FEE","Portage"],["8BA690","Envy"],["8BA9A5","Cascade"],["8BE6D8","Riptide"],["8C055E","Cardinal Pink"],["8C472F","Mule Fawn"],["8C5738","Potters Clay"],["8C6495","Trendy Pink"],["8D0226","Paprika"],["8D3D38","Sanguine Brown"],["8D3F3F","Tosca"],["8D7662","Cement"],["8D8974","Granite Green"],["8D90A1","Manatee"],["8DA8CC","Polo Blue"],["8E0000","Red Berry"],["8E4D1E","Rope"],["8E6F70","Opium"],["8E775E","Domino"],["8E8190","Mamba"],["8EABC1","Nepal"],["8F021C","Pohutukawa"],["8F3E33","El Salva"],["8F4B0E","Korma"],["8F8176","Squirrel"],["8FD6B4","Vista Blue"],["900020","Burgundy"],["901E1E","Old Brick"],["907874","Hemp"],["907B71","Almond Frost"],["908D39","Sycamore"],["92000A","Sangria"],["924321","Cumin"],["926F5B","Beaver"],["928573","Stonewall"],["928590","Venus"],["9370DB","Medium Purple"],["93CCEA","Cornflower"],["93DFB8","Algae Green"],["944747","Copper Rust"],["948771","Arrowtown"],["950015","Scarlett"],["956387","Strikemaster"],["959396","Mountain Mist"],["960018","Carmine"],["964B00","Brown"],["967059","Leather"],["9678B6","Purple Mountain's Majesty"],["967BB6","Lavender Purple"],["96A8A1","Pewter"],["96BBAB","Summer Green"],["97605D","Au Chico"],["9771B5","Wisteria"],["97CD2D","Atlantis"],["983D61","Vin Rouge"],["9874D3","Lilac Bush"],["98777B","Bazaar"],["98811B","Hacienda"],["988D77","Pale Oyster"],["98FF98","Mint Green"],["990066","Fresh Eggplant"],["991199","Violet Eggplant"],["991613","Tamarillo"],["991B07","Totem Pole"],["996666","Copper Rose"],["9966CC","Amethyst"],["997A8D","Mountbatten Pink"],["9999CC","Blue Bell"],["9A3820","Prairie Sand"],["9A6E61","Toast"],["9A9577","Gurkha"],["9AB973","Olivine"],["9AC2B8","Shadow Green"],["9B4703","Oregon"],["9B9E8F","Lemon Grass"],["9C3336","Stiletto"],["9D5616","Hawaiian Tan"],["9DACB7","Gull Gray"],["9DC209","Pistachio"],["9DE093","Granny Smith Apple"],["9DE5FF","Anakiwa"],["9E5302","Chelsea Gem"],["9E5B40","Sepia Skin"],["9EA587","Sage"],["9EA91F","Citron"],["9EB1CD","Rock Blue"],["9EDEE0","Morning Glory"],["9F381D","Cognac"],["9F821C","Reef Gold"],["9F9F9C","Star Dust"],["9FA0B1","Santas Gray"],["9FD7D3","Sinbad"],["9FDD8C","Feijoa"],["A02712","Tabasco"],["A1750D","Buttered Rum"],["A1ADB5","Hit Gray"],["A1C50A","Citrus"],["A1DAD7","Aqua Island"],["A1E9DE","Water Leaf"],["A2006D","Flirt"],["A23B6C","Rouge"],["A26645","Cape Palliser"],["A2AAB3","Gray Chateau"],["A2AEAB","Edward"],["A3807B","Pharlap"],["A397B4","Amethyst Smoke"],["A3E3ED","Blizzard Blue"],["A4A49D","Delta"],["A4A6D3","Wistful"],["A4AF6E","Green Smoke"],["A50B5E","Jazzberry Jam"],["A59B91","Zorba"],["A5CB0C","Bahia"],["A62F20","Roof Terracotta"],["A65529","Paarl"],["A68B5B","Barley Corn"],["A69279","Donkey Brown"],["A6A29A","Dawn"],["A72525","Mexican Red"],["A7882C","Luxor Gold"],["A85307","Rich Gold"],["A86515","Reno Sand"],["A86B6B","Coral Tree"],["A8989B","Dusty Gray"],["A899E6","Dull Lavender"],["A8A589","Tallow"],["A8AE9C","Bud"],["A8AF8E","Locust"],["A8BD9F","Norway"],["A8E3BD","Chinook"],["A9A491","Gray Olive"],["A9ACB6","Aluminium"],["A9B2C3","Cadet Blue"],["A9B497","Schist"],["A9BDBF","Tower Gray"],["A9BEF2","Perano"],["A9C6C2","Opal"],["AA375A","Night Shadz"],["AA4203","Fire"],["AA8B5B","Muesli"],["AA8D6F","Sandal"],["AAA5A9","Shady Lady"],["AAA9CD","Logan"],["AAABB7","Spun Pearl"],["AAD6E6","Regent St Blue"],["AAF0D1","Magic Mint"],["AB0563","Lipstick"],["AB3472","Royal Heath"],["AB917A","Sandrift"],["ABA0D9","Cold Purple"],["ABA196","Bronco"],["AC8A56","Limed Oak"],["AC91CE","East Side"],["AC9E22","Lemon Ginger"],["ACA494","Napa"],["ACA586","Hillary"],["ACA59F","Cloudy"],["ACACAC","Silver Chalice"],["ACB78E","Swamp Green"],["ACCBB1","Spring Rain"],["ACDD4D","Conifer"],["ACE1AF","Celadon"],["AD781B","Mandalay"],["ADBED1","Casper"],["ADDFAD","Moss Green"],["ADE6C4","Padua"],["ADFF2F","Green Yellow"],["AE4560","Hippie Pink"],["AE6020","Desert"],["AE809E","Bouquet"],["AF4035","Medium Carmine"],["AF4D43","Apple Blossom"],["AF593E","Brown Rust"],["AF8751","Driftwood"],["AF8F2C","Alpine"],["AF9F1C","Lucky"],["AFA09E","Martini"],["AFB1B8","Bombay"],["AFBDD9","Pigeon Post"],["B04C6A","Cadillac"],["B05D54","Matrix"],["B05E81","Tapestry"],["B06608","Mai Tai"],["B09A95","Del Rio"],["B0E0E6","Powder Blue"],["B0E313","Inch Worm"],["B10000","Bright Red"],["B14A0B","Vesuvius"],["B1610B","Pumpkin Skin"],["B16D52","Santa Fe"],["B19461","Teak"],["B1E2C1","Fringy Flower"],["B1F4E7","Ice Cold"],["B20931","Shiraz"],["B2A1EA","Biloba Flower"],["B32D29","Tall Poppy"],["B35213","Fiery Orange"],["B38007","Hot Toddy"],["B3AF95","Taupe Gray"],["B3C110","La Rioja"],["B43332","Well Read"],["B44668","Blush"],["B4CFD3","Jungle Mist"],["B57281","Turkish Rose"],["B57EDC","Lavender"],["B5A27F","Mongoose"],["B5B35C","Olive Green"],["B5D2CE","Jet Stream"],["B5ECDF","Cruise"],["B6316C","Hibiscus"],["B69D98","Thatch"],["B6B095","Heathered Gray"],["B6BAA4","Eagle"],["B6D1EA","Spindle"],["B6D3BF","Gum Leaf"],["B7410E","Rust"],["B78E5C","Muddy Waters"],["B7A214","Sahara"],["B7A458","Husk"],["B7B1B1","Nobel"],["B7C3D0","Heather"],["B7F0BE","Madang"],["B81104","Milano Red"],["B87333","Copper"],["B8B56A","Gimblet"],["B8C1B1","Green Spring"],["B8C25D","Celery"],["B8E0F9","Sail"],["B94E48","Chestnut"],["B95140","Crail"],["B98D28","Marigold"],["B9C46A","Wild Willow"],["B9C8AC","Rainee"],["BA0101","Guardsman Red"],["BA450C","Rock Spray"],["BA6F1E","Bourbon"],["BA7F03","Pirate Gold"],["BAB1A2","Nomad"],["BAC7C9","Submarine"],["BAEEF9","Charlotte"],["BB3385","Medium Red Violet"],["BB8983","Brandy Rose"],["BBD009","Rio Grande"],["BBD7C1","Surf"],["BCC9C2","Powder Ash"],["BD5E2E","Tuscany"],["BD978E","Quicksand"],["BDB1A8","Silk"],["BDB2A1","Malta"],["BDB3C7","Chatelle"],["BDBBD7","Lavender Gray"],["BDBDC6","French Gray"],["BDC8B3","Clay Ash"],["BDC9CE","Loblolly"],["BDEDFD","French Pass"],["BEA6C3","London Hue"],["BEB5B7","Pink Swan"],["BEDE0D","Fuego"],["BF5500","Rose of Sharon"],["BFB8B0","Tide"],["BFBED8","Blue Haze"],["BFC1C2","Silver Sand"],["BFC921","Key Lime Pie"],["BFDBE2","Ziggurat"],["BFFF00","Lime"],["C02B18","Thunderbird"],["C04737","Mojo"],["C08081","Old Rose"],["C0C0C0","Silver"],["C0D3B9","Pale Leaf"],["C0D8B6","Pixie Green"],["C1440E","Tia Maria"],["C154C1","Fuchsia Pink"],["C1A004","Buddha Gold"],["C1B7A4","Bison Hide"],["C1BAB0","Tea"],["C1BECD","Gray Suit"],["C1D7B0","Sprout"],["C1F07C","Sulu"],["C26B03","Indochine"],["C2955D","Twine"],["C2BDB6","Cotton Seed"],["C2CAC4","Pumice"],["C2E8E5","Jagged Ice"],["C32148","Maroon Flush"],["C3B091","Indian Khaki"],["C3BFC1","Pale Slate"],["C3C3BD","Gray Nickel"],["C3CDE6","Periwinkle Gray"],["C3D1D1","Tiara"],["C3DDF9","Tropical Blue"],["C41E3A","Cardinal"],["C45655","Fuzzy Wuzzy Brown"],["C45719","Orange Roughy"],["C4C4BC","Mist Gray"],["C4D0B0","Coriander"],["C4F4EB","Mint Tulip"],["C54B8C","Mulberry"],["C59922","Nugget"],["C5994B","Tussock"],["C5DBCA","Sea Mist"],["C5E17A","Yellow Green"],["C62D42","Brick Red"],["C6726B","Contessa"],["C69191","Oriental Pink"],["C6A84B","Roti"],["C6C3B5","Ash"],["C6C8BD","Kangaroo"],["C6E610","Las Palmas"],["C7031E","Monza"],["C71585","Red Violet"],["C7BCA2","Coral Reef"],["C7C1FF","Melrose"],["C7C4BF","Cloud"],["C7C9D5","Ghost"],["C7CD90","Pine Glade"],["C7DDE5","Botticelli"],["C88A65","Antique Brass"],["C8A2C8","Lilac"],["C8A528","Hokey Pokey"],["C8AABF","Lily"],["C8B568","Laser"],["C8E3D7","Edgewater"],["C96323","Piper"],["C99415","Pizza"],["C9A0DC","Light Wisteria"],["C9B29B","Rodeo Dust"],["C9B35B","Sundance"],["C9B93B","Earls Green"],["C9C0BB","Silver Rust"],["C9D9D2","Conch"],["C9FFA2","Reef"],["C9FFE5","Aero Blue"],["CA3435","Flush Mahogany"],["CABB48","Turmeric"],["CADCD4","Paris White"],["CAE00D","Bitter Lemon"],["CAE6DA","Skeptic"],["CB8FA9","Viola"],["CBCAB6","Foggy Gray"],["CBD3B0","Green Mist"],["CBDBD6","Nebula"],["CC3333","Persian Red"],["CC5500","Burnt Orange"],["CC7722","Ochre"],["CC8899","Puce"],["CCCAA8","Thistle Green"],["CCCCFF","Periwinkle"],["CCFF00","Electric Lime"],["CD5700","Tenn"],["CD5C5C","Chestnut Rose"],["CD8429","Brandy Punch"],["CDF4FF","Onahau"],["CEB98F","Sorrell Brown"],["CEBABA","Cold Turkey"],["CEC291","Yuma"],["CEC7A7","Chino"],["CFA39D","Eunry"],["CFB53B","Old Gold"],["CFDCCF","Tasman"],["CFE5D2","Surf Crest"],["CFF9F3","Humming Bird"],["CFFAF4","Scandal"],["D05F04","Red Stage"],["D06DA1","Hopbush"],["D07D12","Meteor"],["D0BEF8","Perfume"],["D0C0E5","Prelude"],["D0F0C0","Tea Green"],["D18F1B","Geebung"],["D1BEA8","Vanilla"],["D1C6B4","Soft Amber"],["D1D2CA","Celeste"],["D1D2DD","Mischka"],["D1E231","Pear"],["D2691E","Hot Cinnamon"],["D27D46","Raw Sienna"],["D29EAA","Careys Pink"],["D2B48C","Tan"],["D2DA97","Deco"],["D2F6DE","Blue Romance"],["D2F8B0","Gossip"],["D3CBBA","Sisal"],["D3CDC5","Swirl"],["D47494","Charm"],["D4B6AF","Clam Shell"],["D4BF8D","Straw"],["D4C4A8","Akaroa"],["D4CD16","Bird Flower"],["D4D7D9","Iron"],["D4DFE2","Geyser"],["D4E2FC","Hawkes Blue"],["D54600","Grenadier"],["D591A4","Can Can"],["D59A6F","Whiskey"],["D5D195","Winter Hazel"],["D5F6E3","Granny Apple"],["D69188","My Pink"],["D6C562","Tacha"],["D6CEF6","Moon Raker"],["D6D6D1","Quill Gray"],["D6FFDB","Snowy Mint"],["D7837F","New York Pink"],["D7C498","Pavlova"],["D7D0FF","Fog"],["D84437","Valencia"],["D87C63","Japonica"],["D8BFD8","Thistle"],["D8C2D5","Maverick"],["D8FCFA","Foam"],["D94972","Cabaret"],["D99376","Burning Sand"],["D9B99B","Cameo"],["D9D6CF","Timberwolf"],["D9DCC1","Tana"],["D9E4F5","Link Water"],["D9F7FF","Mabel"],["DA3287","Cerise"],["DA5B38","Flame Pea"],["DA6304","Bamboo"],["DA6A41","Red Damask"],["DA70D6","Orchid"],["DA8A67","Copperfield"],["DAA520","Golden Grass"],["DAECD6","Zanah"],["DAF4F0","Iceberg"],["DAFAFF","Oyster Bay"],["DB5079","Cranberry"],["DB9690","Petite Orchid"],["DB995E","Di Serria"],["DBDBDB","Alto"],["DBFFF8","Frosted Mint"],["DC143C","Crimson"],["DC4333","Punch"],["DCB20C","Galliano"],["DCB4BC","Blossom"],["DCD747","Wattle"],["DCD9D2","Westar"],["DCDDCC","Moon Mist"],["DCEDB4","Caper"],["DCF0EA","Swans Down"],["DDD6D5","Swiss Coffee"],["DDF9F1","White Ice"],["DE3163","Cerise Red"],["DE6360","Roman"],["DEA681","Tumbleweed"],["DEBA13","Gold Tips"],["DEC196","Brandy"],["DECBC6","Wafer"],["DED4A4","Sapling"],["DED717","Barberry"],["DEE5C0","Beryl Green"],["DEF5FF","Pattens Blue"],["DF73FF","Heliotrope"],["DFBE6F","Apache"],["DFCD6F","Chenin"],["DFCFDB","Lola"],["DFECDA","Willow Brook"],["DFFF00","Chartreuse Yellow"],["E0B0FF","Mauve"],["E0B646","Anzac"],["E0B974","Harvest Gold"],["E0C095","Calico"],["E0FFFF","Baby Blue"],["E16865","Sunglo"],["E1BC64","Equator"],["E1C0C8","Pink Flare"],["E1E6D6","Periglacial Blue"],["E1EAD4","Kidnapper"],["E1F6E8","Tara"],["E25465","Mandy"],["E2725B","Terracotta"],["E28913","Golden Bell"],["E292C0","Shocking"],["E29418","Dixie"],["E29CD2","Light Orchid"],["E2D8ED","Snuff"],["E2EBED","Mystic"],["E2F3EC","Apple Green"],["E30B5C","Razzmatazz"],["E32636","Alizarin Crimson"],["E34234","Cinnabar"],["E3BEBE","Cavern Pink"],["E3F5E1","Peppermint"],["E3F988","Mindaro"],["E47698","Deep Blush"],["E49B0F","Gamboge"],["E4C2D5","Melanie"],["E4CFDE","Twilight"],["E4D1C0","Bone"],["E4D422","Sunflower"],["E4D5B7","Grain Brown"],["E4D69B","Zombie"],["E4F6E7","Frostee"],["E4FFD1","Snow Flurry"],["E52B50","Amaranth"],["E5841B","Zest"],["E5CCC9","Dust Storm"],["E5D7BD","Stark White"],["E5D8AF","Hampton"],["E5E0E1","Bon Jour"],["E5E5E5","Mercury"],["E5F9F6","Polar"],["E64E03","Trinidad"],["E6BE8A","Gold Sand"],["E6BEA5","Cashmere"],["E6D7B9","Double Spanish White"],["E6E4D4","Satin Linen"],["E6F2EA","Harp"],["E6F8F3","Off Green"],["E6FFE9","Hint of Green"],["E6FFFF","Tranquil"],["E77200","Mango Tango"],["E7730A","Christine"],["E79F8C","Tonys Pink"],["E79FC4","Kobi"],["E7BCB4","Rose Fog"],["E7BF05","Corn"],["E7CD8C","Putty"],["E7ECE6","Gray Nurse"],["E7F8FF","Lily White"],["E7FEFF","Bubbles"],["E89928","Fire Bush"],["E8B9B3","Shilo"],["E8E0D5","Pearl Bush"],["E8EBE0","Green White"],["E8F1D4","Chrome White"],["E8F2EB","Gin"],["E8F5F2","Aqua Squeeze"],["E96E00","Clementine"],["E97451","Burnt Sienna"],["E97C07","Tahiti Gold"],["E9CECD","Oyster Pink"],["E9D75A","Confetti"],["E9E3E3","Ebb"],["E9F8ED","Ottoman"],["E9FFFD","Clear Day"],["EA88A8","Carissma"],["EAAE69","Porsche"],["EAB33B","Tulip Tree"],["EAC674","Rob Roy"],["EADAB8","Raffia"],["EAE8D4","White Rock"],["EAF6EE","Panache"],["EAF6FF","Solitude"],["EAF9F5","Aqua Spring"],["EAFFFE","Dew"],["EB9373","Apricot"],["EBC2AF","Zinnwaldite"],["ECA927","Fuel Yellow"],["ECC54E","Ronchi"],["ECC7EE","French Lilac"],["ECCDB9","Just Right"],["ECE090","Wild Rice"],["ECEBBD","Fall Green"],["ECEBCE","Aths Special"],["ECF245","Starship"],["ED0A3F","Red Ribbon"],["ED7A1C","Tango"],["ED9121","Carrot Orange"],["ED989E","Sea Pink"],["EDB381","Tacao"],["EDC9AF","Desert Sand"],["EDCDAB","Pancho"],["EDDCB1","Chamois"],["EDEA99","Primrose"],["EDF5DD","Frost"],["EDF5F5","Aqua Haze"],["EDF6FF","Zumthor"],["EDF9F1","Narvik"],["EDFC84","Honeysuckle"],["EE82EE","Lavender Magenta"],["EEC1BE","Beauty Bush"],["EED794","Chalky"],["EED9C4","Almond"],["EEDC82","Flax"],["EEDEDA","Bizarre"],["EEE3AD","Double Colonial White"],["EEEEE8","Cararra"],["EEEF78","Manz"],["EEF0C8","Tahuna Sands"],["EEF0F3","Athens Gray"],["EEF3C3","Tusk"],["EEF4DE","Loafer"],["EEF6F7","Catskill White"],["EEFDFF","Twilight Blue"],["EEFF9A","Jonquil"],["EEFFE2","Rice Flower"],["EF863F","Jaffa"],["EFEFEF","Gallery"],["EFF2F3","Porcelain"],["F091A9","Mauvelous"],["F0D52D","Golden Dream"],["F0DB7D","Golden Sand"],["F0DC82","Buff"],["F0E2EC","Prim"],["F0E68C","Khaki"],["F0EEFD","Selago"],["F0EEFF","Titan White"],["F0F8FF","Alice Blue"],["F0FCEA","Feta"],["F18200","Gold Drop"],["F19BAB","Wewak"],["F1E788","Sahara Sand"],["F1E9D2","Parchment"],["F1E9FF","Blue Chalk"],["F1EEC1","Mint Julep"],["F1F1F1","Seashell"],["F1F7F2","Saltpan"],["F1FFAD","Tidal"],["F1FFC8","Chiffon"],["F2552A","Flamingo"],["F28500","Tangerine"],["F2C3B2","Mandys Pink"],["F2F2F2","Concrete"],["F2FAFA","Black Squeeze"],["F34723","Pomegranate"],["F3AD16","Buttercup"],["F3D69D","New Orleans"],["F3D9DF","Vanilla Ice"],["F3E7BB","Sidecar"],["F3E9E5","Dawn Pink"],["F3EDCF","Wheatfield"],["F3FB62","Canary"],["F3FBD4","Orinoco"],["F3FFD8","Carla"],["F400A1","Hollywood Cerise"],["F4A460","Sandy brown"],["F4C430","Saffron"],["F4D81C","Ripe Lemon"],["F4EBD3","Janna"],["F4F2EE","Pampas"],["F4F4F4","Wild Sand"],["F4F8FF","Zircon"],["F57584","Froly"],["F5C85C","Cream Can"],["F5C999","Manhattan"],["F5D5A0","Maize"],["F5DEB3","Wheat"],["F5E7A2","Sandwisp"],["F5E7E2","Pot Pourri"],["F5E9D3","Albescent White"],["F5EDEF","Soft Peach"],["F5F3E5","Ecru White"],["F5F5DC","Beige"],["F5FB3D","Golden Fizz"],["F5FFBE","Australian Mint"],["F64A8A","French Rose"],["F653A6","Brilliant Rose"],["F6A4C9","Illusion"],["F6F0E6","Merino"],["F6F7F7","Black Haze"],["F6FFDC","Spring Sun"],["F7468A","Violet Red"],["F77703","Chilean Fire"],["F77FBE","Persian Pink"],["F7B668","Rajah"],["F7C8DA","Azalea"],["F7DBE6","We Peep"],["F7F2E1","Quarter Spanish White"],["F7F5FA","Whisper"],["F7FAF7","Snow Drift"],["F8B853","Casablanca"],["F8C3DF","Chantilly"],["F8D9E9","Cherub"],["F8DB9D","Marzipan"],["F8DD5C","Energy Yellow"],["F8E4BF","Givry"],["F8F0E8","White Linen"],["F8F4FF","Magnolia"],["F8F6F1","Spring Wood"],["F8F7DC","Coconut Cream"],["F8F7FC","White Lilac"],["F8F8F7","Desert Storm"],["F8F99C","Texas"],["F8FACD","Corn Field"],["F8FDD3","Mimosa"],["F95A61","Carnation"],["F9BF58","Saffron Mango"],["F9E0ED","Carousel Pink"],["F9E4BC","Dairy Cream"],["F9E663","Portica"],["F9EAF3","Amour"],["F9F8E4","Rum Swizzle"],["F9FF8B","Dolly"],["F9FFF6","Sugar Cane"],["FA7814","Ecstasy"],["FA9D5A","Tan Hide"],["FAD3A2","Corvette"],["FADFAD","Peach Yellow"],["FAE600","Turbo"],["FAEAB9","Astra"],["FAECCC","Champagne"],["FAF0E6","Linen"],["FAF3F0","Fantasy"],["FAF7D6","Citrine White"],["FAFAFA","Alabaster"],["FAFDE4","Hint of Yellow"],["FAFFA4","Milan"],["FB607F","Brink Pink"],["FB8989","Geraldine"],["FBA0E3","Lavender Rose"],["FBA129","Sea Buckthorn"],["FBAC13","Sun"],["FBAED2","Lavender Pink"],["FBB2A3","Rose Bud"],["FBBEDA","Cupid"],["FBCCE7","Classic Rose"],["FBCEB1","Apricot Peach"],["FBE7B2","Banana Mania"],["FBE870","Marigold Yellow"],["FBE96C","Festival"],["FBEA8C","Sweet Corn"],["FBEC5D","Candy Corn"],["FBF9F9","Hint of Red"],["FBFFBA","Shalimar"],["FC0FC0","Shocking Pink"],["FC80A5","Tickle Me Pink"],["FC9C1D","Tree Poppy"],["FCC01E","Lightning Yellow"],["FCD667","Goldenrod"],["FCD917","Candlelight"],["FCDA98","Cherokee"],["FCF4D0","Double Pearl Lusta"],["FCF4DC","Pearl Lusta"],["FCF8F7","Vista White"],["FCFBF3","Bianca"],["FCFEDA","Moon Glow"],["FCFFE7","China Ivory"],["FCFFF9","Ceramic"],["FD0E35","Torch Red"],["FD5B78","Wild Watermelon"],["FD7B33","Crusta"],["FD7C07","Sorbus"],["FD9FA2","Sweet Pink"],["FDD5B1","Light Apricot"],["FDD7E4","Pig Pink"],["FDE1DC","Cinderella"],["FDE295","Golden Glow"],["FDE910","Lemon"],["FDF5E6","Old Lace"],["FDF6D3","Half Colonial White"],["FDF7AD","Drover"],["FDFEB8","Pale Prim"],["FDFFD5","Cumulus"],["FE28A2","Persian Rose"],["FE4C40","Sunset Orange"],["FE6F5E","Bittersweet"],["FE9D04","California"],["FEA904","Yellow Sea"],["FEBAAD","Melon"],["FED33C","Bright Sun"],["FED85D","Dandelion"],["FEDB8D","Salomie"],["FEE5AC","Cape Honey"],["FEEBF3","Remy"],["FEEFCE","Oasis"],["FEF0EC","Bridesmaid"],["FEF2C7","Beeswax"],["FEF3D8","Bleach White"],["FEF4CC","Pipi"],["FEF4DB","Half Spanish White"],["FEF4F8","Wisp Pink"],["FEF5F1","Provincial Pink"],["FEF7DE","Half Dutch White"],["FEF8E2","Solitaire"],["FEF8FF","White Pointer"],["FEF9E3","Off Yellow"],["FEFCED","Orange White"],["FF0000","Red"],["FF007F","Rose"],["FF00CC","Purple Pizzazz"],["FF00FF","Magenta / Fuchsia"],["FF2400","Scarlet"],["FF3399","Wild Strawberry"],["FF33CC","Razzle Dazzle Rose"],["FF355E","Radical Red"],["FF3F34","Red Orange"],["FF4040","Coral Red"],["FF4D00","Vermilion"],["FF4F00","International Orange"],["FF6037","Outrageous Orange"],["FF6600","Blaze Orange"],["FF66FF","Pink Flamingo"],["FF681F","Orange"],["FF69B4","Hot Pink"],["FF6B53","Persimmon"],["FF6FFF","Blush Pink"],["FF7034","Burning Orange"],["FF7518","Pumpkin"],["FF7D07","Flamenco"],["FF7F00","Flush Orange"],["FF7F50","Coral"],["FF8C69","Salmon"],["FF9000","Pizazz"],["FF910F","West Side"],["FF91A4","Pink Salmon"],["FF9933","Neon Carrot"],["FF9966","Atomic Tangerine"],["FF9980","Vivid Tangerine"],["FF9E2C","Sunshade"],["FFA000","Orange Peel"],["FFA194","Mona Lisa"],["FFA500","Web Orange"],["FFA6C9","Carnation Pink"],["FFAB81","Hit Pink"],["FFAE42","Yellow Orange"],["FFB0AC","Cornflower Lilac"],["FFB1B3","Sundown"],["FFB31F","My Sin"],["FFB555","Texas Rose"],["FFB7D5","Cotton Candy"],["FFB97B","Macaroni and Cheese"],["FFBA00","Selective Yellow"],["FFBD5F","Koromiko"],["FFBF00","Amber"],["FFC0A8","Wax Flower"],["FFC0CB","Pink"],["FFC3C0","Your Pink"],["FFC901","Supernova"],["FFCBA4","Flesh"],["FFCC33","Sunglow"],["FFCC5C","Golden Tainoi"],["FFCC99","Peach Orange"],["FFCD8C","Chardonnay"],["FFD1DC","Pastel Pink"],["FFD2B7","Romantic"],["FFD38C","Grandis"],["FFD700","Gold"],["FFD800","School bus Yellow"],["FFD8D9","Cosmos"],["FFDB58","Mustard"],["FFDCD6","Peach Schnapps"],["FFDDAF","Caramel"],["FFDDCD","Tuft Bush"],["FFDDCF","Watusi"],["FFDDF4","Pink Lace"],["FFDEAD","Navajo White"],["FFDEB3","Frangipani"],["FFE1DF","Pippin"],["FFE1F2","Pale Rose"],["FFE2C5","Negroni"],["FFE5A0","Cream Brulee"],["FFE5B4","Peach"],["FFE6C7","Tequila"],["FFE772","Kournikova"],["FFEAC8","Sandy Beach"],["FFEAD4","Karry"],["FFEC13","Broom"],["FFEDBC","Colonial White"],["FFEED8","Derby"],["FFEFA1","Vis Vis"],["FFEFC1","Egg White"],["FFEFD5","Papaya Whip"],["FFEFEC","Fair Pink"],["FFF0DB","Peach Cream"],["FFF0F5","Lavender blush"],["FFF14F","Gorse"],["FFF1B5","Buttermilk"],["FFF1D8","Pink Lady"],["FFF1EE","Forget Me Not"],["FFF1F9","Tutu"],["FFF39D","Picasso"],["FFF3F1","Chardon"],["FFF46E","Paris Daisy"],["FFF4CE","Barley White"],["FFF4DD","Egg Sour"],["FFF4E0","Sazerac"],["FFF4E8","Serenade"],["FFF4F3","Chablis"],["FFF5EE","Seashell Peach"],["FFF5F3","Sauvignon"],["FFF6D4","Milk Punch"],["FFF6DF","Varden"],["FFF6F5","Rose White"],["FFF8D1","Baja White"],["FFF9E2","Gin Fizz"],["FFF9E6","Early Dawn"],["FFFACD","Lemon Chiffon"],["FFFAF4","Bridal Heath"],["FFFBDC","Scotch Mist"],["FFFBF9","Soapstone"],["FFFC99","Witch Haze"],["FFFCEA","Buttery White"],["FFFCEE","Island Spice"],["FFFDD0","Cream"],["FFFDE6","Chilean Heath"],["FFFDE8","Travertine"],["FFFDF3","Orchid White"],["FFFDF4","Quarter Pearl Lusta"],["FFFEE1","Half and Half"],["FFFEEC","Apricot White"],["FFFEF0","Rice Cake"],["FFFEF6","Black White"],["FFFEFD","Romance"],["FFFF00","Yellow"],["FFFF66","Laser Lemon"],["FFFF99","Pale Canary"],["FFFFB4","Portafino"],["FFFFF0","Ivory"],["FFFFFF","White"]]
};return ntc.init(),ntc}angular.module("core").factory("ntc",NtcService)}(),function(){"use strict";var deletOnExit={};angular.module("core").factory("PageExitService",["$window","$timeout","$rootScope","CommentsService",function($window,$timeout,$rootScope,CommentsService){return $rootScope.$on(PreviewEnums.DELETING_COMMENT,function(e,id,value){value?deletOnExit[id]=$timeout(function(){delete deletOnExit[id]},PreviewEnums.UNDO_TIMEOUT):_.isUndefined(deletOnExit[id])||($timeout.cancel(deletOnExit[id]),delete deletOnExit[id])}),$window.addEventListener("beforeunload",function(event){return _.isEmpty(deletOnExit)||Object.keys(deletOnExit).forEach(function(commentId){var timeoutId=deletOnExit[commentId];$timeout.cancel(timeoutId),CommentsService.fastDeletOnExit(commentId),delete deletOnExit[commentId]}),null}),{}}])}(),function(){"use strict";angular.module("core").factory("PagesService",["appStateManager","_","$q","$rootScope","$state","Rest","RestWithCache","ProjectsService","BreakpointsService","ExportService","LocalDataService","DesignViewsService","FeatureToggler","AnalyticsService",function(appStateManager,_,$q,$rootScope,$state,Rest,RestWithCache,ProjectsService,BreakpointsService,ExportService,LocalDataService,DesignViewsService,FeatureToggler,AnalyticsService){function _getPage(projectHash,pageId){return ExportService.isExport()?LocalDataService.getData("data/page_size_"+pageId+".js"):RestWithCache.one("projects",projectHash).one("pages",pageId).get()}function _getPageContent(projectHash,pageId){return Rest.one("projects",projectHash).one("pages",pageId).one("content").get()}function _getPageCanvasData(projectHash,pageId){return ExportService.isExport()?LocalDataService.getData("data/page_"+pageId+".js"):RestWithCache.one("projects",projectHash).one("pages",pageId).one("canvasData").get()}function _getPages(projectHash){return ExportService.isExport()?LocalDataService.getData("data/pages.js"):RestWithCache.one("projects",projectHash).all("pages").getList()}return{rootPageId:null,currentPageId:null,currentMainPageId:null,defaultBreakpointId:null,currentBreakpointId:null,currentPageProperties:null,pagesFlatList:[],pagesMap:{},pagesChildrenMap:{},pagesTree:{},pagesBreakpoints:{},breakpointIds:{},setCurrentPageId:function(id){this.currentPageId=id,this.currentMainPageId=id,angular.isDefined(this.pagesMap[id])&&angular.isDefined(this.pagesMap[id].version_type)&&(this.currentBreakpointId=this.pagesMap[id].version_type),angular.isDefined(this.pagesMap[id])&&this.pagesMap[id].version_of>0&&(this.currentMainPageId=this.pagesMap[id].version_of);var projectHash=ProjectsService.currentProjectHash,pageId=this.currentPageId;FeatureToggler.designViews&&!DesignViewsService.isDesignViewCounted(projectHash,pageId)?DesignViewsService.addDesignView(projectHash,pageId):FeatureToggler.designViews||DesignViewsService.isDesignViewCounted(projectHash,pageId)||(DesignViewsService.addCookie(projectHash,pageId),AnalyticsService.addDesignView(pageId,ProjectsService.currentProjectAccount)),$rootScope.$emit(PreviewEnums.ON_CHANGE_PAGE,id)},setCurrentBreakpointId:function(id){appStateManager.saveState({breakpoint:id}),this.currentBreakpointId=id},setPageResponsive:function(width){if(_.size(this.breakpointIds)>1){var breakpointId=0;_.each(BreakpointsService.breakpointWidths,function(breakpoint){this.breakpointIds.indexOf(breakpoint.version)>-1&&breakpoint.width<=width&&(breakpointId=breakpoint.version)}.bind(this)),angular.isDefined(breakpointId)&&this.currentBreakpointId!==breakpointId&&this.changePageBreakpoint(breakpointId)}},changePageBreakpoint:function(id){this.setCurrentBreakpointId(id),$state.go($state.current.name,{pageId:this.getPageByBreakpoint(this.currentPageId)})},getCanvasData:function(pageId){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return Promise.all([_getPage(projectHash,pageId),_getPageCanvasData(projectHash,pageId)]).then(function(resolvedValues){this.currentPageProperties=resolvedValues[0],d.resolve(resolvedValues[1])}.bind(this)),d.promise},getAllPagesData:function(pagesIds){var promises=[];return _.forEach(pagesIds,function(pageId){promises.push(this.getCanvasData(pageId))}.bind(this)),$q.all(promises)},getPages:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getPages(projectHash).then(function(pages){this.generatePagesFlatList(pages),this.generatePagesMap(pages),this.generatePagesTree(pages),this.generatePagesBreakpoints(pages),this.breakpointIds=this.getBreakpoints(pages),this.rootPageId=this.pagesTree.nodes[0].id,this.defaultBreakpointId=this.getDefaultBreakpointId(pages),d.resolve(pages)}.bind(this),function(error){d.reject(error)}),d.promise},getPage:function(id){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getPage(projectHash,id).then(function(page){this.currentPageProperties=page,d.resolve(page)}.bind(this)),d.promise},getPageContent:function(id){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getPageContent(projectHash,id).then(function(content){d.resolve(content)}),d.promise},getPageByBreakpoint:function(id){if(!this.pagesMap[id])return{};this.pagesMap[id].version_of&&(id=this.pagesMap[id].version_of);var breakpointId=null!==this.currentBreakpointId?this.currentBreakpointId:this.defaultBreakpointId,pId=this.pagesBreakpoints[id][breakpointId];return pId?pId:this.pagesBreakpoints[id][parseInt(_.findKey(this.pagesBreakpoints[id]))]},getRootPage:function(){return this.getPageByBreakpoint(this.rootPageId)},getNextPageId:function(){var currentIndex=this.pagesFlatList.indexOf(this.currentMainPageId);return currentIndex!==this.pagesFlatList.length-1&&this.pagesFlatList[currentIndex+1]},getPrevPageId:function(){var currentIndex=this.pagesFlatList.indexOf(this.currentMainPageId);return 0!==currentIndex&&this.pagesFlatList[currentIndex-1]},getContentWidth:function(){var breakpointId=this.pagesMap[this.currentPageId].version_type;return 0!==breakpointId?BreakpointsService.breakpointsMap[breakpointId].width:this.currentPageProperties.size.width},getContentCropping:function(){var scrollSize={};return this.currentPageProperties?{x:this.currentPageProperties.size.scrollx,y:this.currentPageProperties.size.scrolly}:scrollSize},generatePagesFlatList:function(pages){this.pagesFlatList=_.reduce(pages,function(list,page){return page.version_type||list.push(page.id_page),list},[])},generatePagesMap:function(pages){_.forIn(this.pagesMap,function(value,key){delete this.pagesMap[key]}.bind(this)),pages.forEach(function(page){this.pagesMap[page.id_page]=page}.bind(this))},generatePagesTree:function(pages){_.forIn(this.pagesTree,function(value,key){delete this.pagesTree[key]}.bind(this)),_.forIn(this.pagesChildrenMap,function(value,key){delete this.pagesChildrenMap[key]}.bind(this)),this.pagesTree=this.getChildren(null,pages)},getChildren:function(id,pages){var node={id:id,nodes:[]};return this.pagesChildrenMap[node.id]=[],pages.forEach(function(page){page.parent===id&&null===page.version_of&&(this.pagesChildrenMap[node.id].push(page.id_page),node.nodes.push(this.getChildren(page.id_page,pages)))}.bind(this)),node},generatePagesBreakpoints:function(pages){_.forIn(this.pagesBreakpoints,function(value,key){delete this.pagesBreakpoints[key]}.bind(this));var breakpoints;pages.forEach(function(page){page.version_of||(this.pagesBreakpoints[page.id_page]={},breakpoints=this.pagesBreakpoints[page.id_page],pages.forEach(function(breakpointPage){breakpointPage.version_of===page.id_page&&(breakpoints[breakpointPage.version_type]=breakpointPage.id_page)}),_.isNumber(page.version_type)&&(breakpoints[page.version_type]=page.id_page))}.bind(this))},getBreakpoints:function(pages){var breakpoints=[];return pages.forEach(function(page){_.isNumber(page.version_type)&&breakpoints.indexOf(page.version_type)===-1&&breakpoints.push(page.version_type)}),breakpoints},getPageBreakpoints:function(id){var p=this.pagesMap[id];if(!p)return[];var pId=p.version_of?p.version_of:id,pageBreakpoints=this.pagesBreakpoints[pId],b=[];return _.forEach(pageBreakpoints,function(pageId,breakpointId){if("null"!==breakpointId){var id=parseInt(breakpointId,10);b.push({id:id,name:BreakpointsService.getBreakpointName(id)})}}),b},getCurrentPageBreakpoints:function(){return this.getPageBreakpoints(this.currentPageId)},getDefaultBreakpointId:function(pages){return pages.length?0===pages[0].main_version&&null===pages[0].version_type?this.breakpointIds[1]:pages[0].main_version:null},getVisiblePagesIds:function(){return _.reduce(this.pagesMap,function(result,page){return _.includes(this.breakpointIds,page.version_type)&&result.push(page.id_page),result}.bind(this),[])}}}])}(),function(){"use strict";function PreloadService(_,$log,$window,$timeout,$q,Engine,PagesService,ProjectsService,PreviewCache,RestWithCache,ExportService,editorSocket){function preloadPageImages(page){return $q(function(resolve){$timeout(function(){var urls=_.map(page.getAllImages(),function(image){return image.getCDNUrl()});preloadImages(urls).then(resolve)})})}function preloadPage(pageId){if(loadedPages[pageId]||loadedPagesCount>=pageLimit)return Promise.resolve();var pageRequest=RestWithCache.one("projects",ProjectsService.currentProjectHash).one("pages",pageId),promises=[pageRequest.get(),pageRequest.one("canvasData").get(),pageRequest.all("comments").getList()];return loadedPages[pageId]=!0,loadedPagesCount=_.size(loadedPages),Promise.all(promises).then(function(data){var canvasData=data[1];return new Promise(function(resolve){var imageUrls=extractImages(canvasData);$timeout(function(){preloadImages(imageUrls).then(resolve)})})})}function preloadMultiplePages(pageIds){if(_.isEmpty(pageIds))return Promise.resolve();var pagesSlice=pageIds.splice(0,concurrentNetworkCalls);return Promise.all(_.map(pagesSlice,preloadPage)).then(preloadMultiplePages.bind(null,pageIds))}function preloadRelatedPages(pageId){var projectHash=ProjectsService.currentProjectHash,canvasData=RestWithCache.one("projects",projectHash).one("pages",pageId).one("canvasData");return canvasData.get().then(function(data){var relatedPagesIds=_.map(_.keys(data._links),function(idPage){return parseInt(idPage,10)}),existingPagesIds=_.map(PagesService.pagesMap,"id_page"),filteredExisting=_.intersection(relatedPagesIds,existingPagesIds);return preloadMultiplePages(filteredExisting)})}function preloadPageBreakpoints(pageId){return PagesService.getPages().then(function(allPages){var currentBreakpoint=_.find(allPages,{id_page:pageId});if(currentBreakpoint){var versionOf=currentBreakpoint.version_of||pageId,breakpointsToLoad=_.reduce(allPages,function(breakpoints,breakpoint){return breakpoint.id_page===pageId?breakpoints:breakpoint.version_of===versionOf||breakpoint.id_page===versionOf?breakpoints.concat(breakpoint.id_page):breakpoints},[]);return preloadMultiplePages(breakpointsToLoad).then(function(){return Promise.all(_.map(breakpointsToLoad,preloadRelatedPages))})}})}function preloadRestPages(){return PagesService.getPages().then(function(allPages){return preloadMultiplePages(_.difference(_.map(allPages,"id_page"),_.keys(loadedPages)))})}function preloadAllPages(){var pageId=PagesService.currentPageId;preload||ExportService.isExport()||!PagesService.pagesMap[pageId]||(preload=!0,requestAnimationFrame(function(){preloadRelatedPages(pageId).then(preloadPageBreakpoints.bind(null,pageId)).then(preloadRestPages)}))}function getElementSrc(element){var src=element&&element.props&&(element.props.src||element.props.backgroundImage);return src&&SRC_REGEXP.test(src)?src:""}function extractImages(canvasData){var imageUrls=[],putImageUrl=function(element){var src=getElementSrc(element);src&&imageUrls.push(Engine.getPage().getCDNUrl(src))};return _.each(canvasData.page,putImageUrl),_.each(canvasData.components,function(component){_.each(component,putImageUrl)}),imageUrls}function preloadImage(url){return loadedImages[url]||!SRC_REGEXP.exec(url)?Promise.resolve():(loadedImages[url]=!0,new Promise(function(resolve,reject){var image=new Image;image.addEventListener("load",function(){resolve()}),image.addEventListener("error",function(){reject()}),image.src=url,image.complete&&resolve()}).catch(function(e){$log.warn("can't preload image: "+url,e)}))}function preloadImages(imageUrls){if(_.isEmpty(imageUrls))return Promise.resolve();var urlsSlice=imageUrls.splice(0,concurrentNetworkCalls);return Promise.all(_.map(urlsSlice,preloadImage)).then(preloadImages.bind(void 0,imageUrls))}function getInitialData(pageId,width){return $q(function(resolve){if(ExportService.isExport())return resolve({});var projectHash=ProjectsService.currentProjectHash;RestWithCache.one("projects",projectHash).one("all").get({pageId:pageId,width:width}).then(function(data){return PreviewCache.setInitialData(projectHash,data),data}).then(resolve)})}function handlePageChanged(data){requestAnimationFrame(function(){delete loadedPages[data.id_page],preloadPage(parseInt(data.id_page,10))})}function handlePageCreated(data){requestAnimationFrame(function(){var pageId=parseInt(data.id_page,10);preloadPage(pageId).then(preloadPageBreakpoints.bind(null,pageId))})}var SRC_REGEXP=/^(https?:\/)?\//i,concurrentNetworkCalls=5,loadedImages={},loadedPages={},preload=!1,cacheCapacity=$window.ApplicationConfiguration&&$window.ApplicationConfiguration.clientSideCacheSize,pageLimit=Math.floor(cacheCapacity/3),loadedPagesCount=0;return editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_CREATE,handlePageCreated),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_SAVED,handlePageChanged),{getInitialData:getInitialData,preloadAllPages:preloadAllPages,preloadPageImages:preloadPageImages}}angular.module("core").factory("PreloadService",PreloadService),PreloadService.$inject=["_","$log","$window","$timeout","$q","Engine","PagesService","ProjectsService","PreviewCache","RestWithCache","ExportService","editorSocket"]}(),function(){"use strict";function PreviewCache(_,$cacheFactory,ProjectsService,$window){function removePagesList(){cache.remove(getPagesUrl(ProjectsService.currentProjectHash))}function getAllDataWithoutRedirect(data){return _.isArray(data)?[data[0],JSON.stringify(_.omit(JSON.parse(data[1]),"redirect")),data[2],data[3]]:data}function getCoreAllUrl(url){var matched=url&&url.match(/^(\/api\/projects\/([^\/]+)\/all)([\?\&]\w+=\d*)*$/);return _.isArray(matched)&&matched[1]?matched[1]:null}function getPageIdFromUrl(url){var matchedPageIds=url.match(/^\/api\/projects\/([^\/]+)\/pages\/(\d+)$/);return _.isArray(matchedPageIds)&&matchedPageIds[2]?matchedPageIds[2]:null}function putToCache(url,data){cache.put(url,[200,JSON.stringify(data),{"content-type":"application/json; charset=utf-8"},"OK"])}function setInitialData(projectHash,data){data.breakpoints&&putToCache(getBreakpointsUrl(projectHash),data.breakpoints),data.pages&&putToCache(getPagesUrl(projectHash),data.pages),_.forEach(data.pagesData,function(pageData,pageId){var canvasDataUrl=getCanvasDataUrl(projectHash,pageId),cachedCanvasData=cache.get(canvasDataUrl);cachedCanvasData||(putToCache(canvasDataUrl,pageData.canvasData),putToCache(getPageUrl(projectHash,pageId),pageData.metaData))})}function isPageDataInCache(projectHash,pageId){var pageUrl=getPageUrl(projectHash,pageId),canvasDataUrl=getCanvasDataUrl(projectHash,pageId),commentsUrl=getCommentsUrl(projectHash,pageId),requestsInCache=0;return _.each([pageUrl,canvasDataUrl,commentsUrl],function(url){requestsInCache=cache.get(url)?requestsInCache+1:requestsInCache}),requestsInCache}function removeComments(projectHash,idPage){var commentsUrl=getCommentsUrl(projectHash,idPage);cache.remove(commentsUrl)}function removeCanvasData(idProject,idPage){var canvasDataUrl=getCanvasDataUrl(projectIdToHash(idProject),idPage);cache.remove(canvasDataUrl)}function removePages(){_.each(cachedPages,function(pageUrl){cache.remove(pageUrl)}),cachedPages={}}function projectIdToHash(projectId){return ProjectsService.currentProjectId===projectId?ProjectsService.currentProjectHash:null}function getBreakpointsUrl(projectHash){return"/api/projects/"+projectHash+"/breakpoints"}function getPagesUrl(projectHash){return"/api/projects/"+projectHash+"/pages"}function getPageUrl(projectHash,pageId){return"/api/projects/"+projectHash+"/pages/"+pageId}function getCanvasDataUrl(projectHash,pageId){return getPageUrl(projectHash,pageId)+"/canvasData"}function getCommentsUrl(projectHash,pageId){return getPageUrl(projectHash,pageId)+"/comments"}var cachedPages={},minimumCacheSize=3,cache=$cacheFactory("http",{capacity:$window.ApplicationConfiguration&&$window.ApplicationConfiguration.clientSideCacheSize||minimumCacheSize}),originalGet=cache.get,originalPut=cache.put;return cache.get=function(url){var coreAllUrl=getCoreAllUrl(url);return coreAllUrl?originalGet.call(cache,coreAllUrl):originalGet.apply(cache,arguments)},cache.put=function(url,value){if(url){var coreAllUrl=getCoreAllUrl(url),pageId=getPageIdFromUrl(url);if(coreAllUrl)return originalPut.call(cache,coreAllUrl,getAllDataWithoutRedirect(value));pageId&&(cachedPages[pageId]=url)}originalPut.apply(cache,arguments)},{removeComments:removeComments,removeCanvasData:removeCanvasData,removePages:removePages,removePagesList:removePagesList,cache:cache,isPageDataInCache:isPageDataInCache,setInitialData:setInitialData}}angular.module("core").factory("PreviewCache",PreviewCache),PreviewCache.$inject=["_","$cacheFactory","ProjectsService","$window"]}(),function(){"use strict";function ProjectsService(){return{currentCollectionId:ApplicationConfiguration.project.id_collection,currentDocumentType:ApplicationConfiguration.project.type,currentIterationName:ApplicationConfiguration.project.iteration_name,currentIterationNumber:ApplicationConfiguration.project.iteration_number,currentOriginalProjectId:ApplicationConfiguration.project.id_original_project,currentProjectAccount:ApplicationConfiguration.project.id_account,currentProjectFeatures:ApplicationConfiguration.project.features||{},currentProjectHash:ApplicationConfiguration.project.hash,currentProjectId:ApplicationConfiguration.project.id_project,currentProjectName:ApplicationConfiguration.project.name,currentProjectSettings:ApplicationConfiguration.project.settings||{},currentProjectType:ApplicationConfiguration.project.type,DOCUMENT_TYPE_UXTEST:"DUXTEST",DOCUMENT_TYPE_PERSONA:"DPERSONA",DOCUMENT_TYPE_BMC:"DBMC",DOCUMENT_TYPE_PC:"DPC",DOCUMENT_TYPE_WIREFRAME:"W",isDocument:function(){return this.currentProjectType!==this.DOCUMENT_TYPE_WIREFRAME&&!ApplicationConfiguration.isDesignSystem},isUXTestDocument:function(){return this.DOCUMENT_TYPE_UXTEST===this.currentProjectType},getType:function(){return this.currentDocumentType},isOriginalProject:function(){return!this.currentOriginalProjectId&&!this.currentIterationNumber}}}angular.module("core").factory("ProjectsService",ProjectsService)}(),function(){"use strict";function Rest(Restangular){return Restangular.withConfig(function(RestangularConfigurer){RestangularConfigurer.setBaseUrl("/api")})}angular.module("core").factory("Rest",Rest),Rest.$inject=["Restangular"]}(),function(){"use strict";function RestWithCache(_,Restangular,editorSocket,PreviewCache){return editorSocket.on(PreviewEnums.SOCKET.WILD_CART,function(){var idProject,idPage,projectHash,eventName=arguments[0]&&arguments[0].data&&arguments[0].data[0],properties=arguments[0]&&arguments[0].data&&arguments[0].data[1];PreviewCache.cache&&eventName&&properties&&(idPage=properties.id_page&&parseInt(properties.id_page,10),idPage&&(_.includes(CANVAS_DATA_EVENTS,eventName)?(idProject=properties.id_project&&parseInt(properties.id_project,10),PreviewCache.removeCanvasData(idProject,idPage)):_.includes(COMMENT_EVENTS,eventName)&&(projectHash=properties.project_hash,PreviewCache.removeComments(projectHash,idPage))),_.includes(PAGE_EVENTS,eventName)&&PreviewCache.removePages(),_.includes(SITEMAP_EVENTS,eventName)&&PreviewCache.removePagesList())}),Restangular.withConfig(function(RestangularProvider){RestangularProvider.setBaseUrl("/api"),RestangularProvider.setDefaultHttpFields({cache:PreviewCache.cache})})}var COMMENT_EVENTS=[PreviewEnums.SOCKET.ON_COMMENT_CREATE,PreviewEnums.SOCKET.ON_COMMENT_UPDATE,PreviewEnums.SOCKET.ON_COMMENT_DELETE,PreviewEnums.SOCKET.ON_COMMENT_TYPE_UPDATE,PreviewEnums.SOCKET.ON_COMMENT_CONTENT_UPDATE,PreviewEnums.SOCKET.ON_COMMENT_ASSIGNED_USER_UPDATE],CANVAS_DATA_EVENTS=[PreviewEnums.SOCKET.ON_CHANGE_PROPERTIES,PreviewEnums.SOCKET.ON_PAGE_SAVED],SITEMAP_EVENTS=[PreviewEnums.SOCKET.ON_PAGE_CREATE,PreviewEnums.SOCKET.ON_PAGE_UPDATE,PreviewEnums.SOCKET.ON_PAGE_REORDER,PreviewEnums.SOCKET.ON_PAGE_DOCUMENTATION_SET,PreviewEnums.SOCKET.ON_PAGE_DELETE],PAGE_EVENTS=[PreviewEnums.SOCKET.ON_EDIT_VERSION];angular.module("core").factory("RestWithCache",RestWithCache),RestWithCache.$inject=["_","Restangular","editorSocket","PreviewCache"]}(),function(){"use strict";function ScrollService($document){function scrollToElement(containerId,elementId){var containerEl=getElement(containerId),elClientRect=getElementClientRect(elementId),bottomSpace=containerEl.clientHeight-elClientRect.top;elClientRect.height<bottomSpace||(containerEl.scrollTop+=elClientRect.height-bottomSpace)}function getElement(id){return $document[0].getElementById(id)}function getElementClientRect(id){var el=getElement(id);return el.getBoundingClientRect()}return{scrollToElement:scrollToElement}}angular.module("core").factory("ScrollService",ScrollService),ScrollService.$inject=["$document"]}(),function(){"use strict";function Settings($rootScope,$location,localStorageService,ProjectsService,PagesService,SpecificationService,DOMService){var modesFlag=PreviewEnums.MODES_FLAGS,isSpecModeFeature=SpecificationService.isSpecificationVisible(),isDocumentationModeFeature=!0,getValue=function(value,defaultValue){return angular.isString(value)?"true"===value:defaultValue};return{showResolvedComments:getValue(localStorageService.get("showResolvedComments"),!0),showCurrentPageOnly:getValue(localStorageService.get("showCurrentPageOnly"),!0),isResponsive:!1,disableComments:!1,disableSitemap:!1,disableSpecification:!isSpecModeFeature,disableDocumentation:!isDocumentationModeFeature,disableInteractionsHighlight:!1,disableLayers:!1,minimized:localStorageService.get("minimized")?localStorageService.get("minimized").split(","):[],fullMode:"",getMode:function(){return this.fullMode},setShowCurrentPageOnly:function(value){localStorageService.set("showCurrentPageOnly",value),this.showCurrentPageOnly=value},setShowResolvedComments:function(value){localStorageService.set("showResolvedComments",value),this.showResolvedComments=value,$rootScope.$emit(PreviewEnums.ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED,value)},setResponsive:function(value){this.isResponsive=value,value&&PagesService.setPageResponsive(DOMService.getWindowWidth())},updateMinimized:function(){localStorageService.set("minimized",this.minimized.join(","))},getModeSettings:function(mode){return mode=mode||"",{comments:mode.indexOf(modesFlag.COMMENTS)===-1,sitemap:mode.indexOf(modesFlag.SITEMAP)===-1,specification:mode.indexOf(modesFlag.SPECIFICATION)===-1,documentation:mode.indexOf(modesFlag.DOCUMENTATION)===-1,interactionsHighlight:mode.indexOf(modesFlag.INTERACTIONS)===-1}},toggleSingleMode:function(singleMode){if(singleMode&&!(singleMode.length>1)){var mode=this.getMode(),isMode=mode.indexOf(singleMode)!==-1;mode=isMode?mode.replace(singleMode,""):mode+""+singleMode,this.setMode(mode),$location.search("mode",mode)}},setMode:function(mode){var settings=this.getModeSettings(mode);mode&&angular.isString(mode)?(this.fullMode=mode,this.disableComments=!settings.comments,this.disableSitemap=!settings.sitemap,this.disableSpecification=!settings.specification||!isSpecModeFeature,this.disableDocumentation=!settings.documentation||!isDocumentationModeFeature,this.disableInteractionsHighlight=!settings.interactionsHighlight):(this.fullMode="",this.disableComments=!1,this.disableSitemap=!1,this.disableSpecification=!isSpecModeFeature,this.disableDocumentation=!isDocumentationModeFeature,this.disableInteractionsHighlight=!1),ProjectsService.isDocument()&&(this.disableSitemap=!0,this.disableSpecification=!0),ProjectsService.isUXTestDocument()&&(this.disableComments=!0),$rootScope.$emit(PreviewEnums.ON_MODE_CHANGED)}}}angular.module("core").factory("Settings",Settings),Settings.$inject=["$rootScope","$location","localStorageService","ProjectsService","PagesService","SpecificationService","DOMService"]}(),function(){"use strict";function SitemapService(_,EscapeHtmlService,PagesService){function getPage(id){return PagesService.pagesMap[id]}function getPageName(id){var unescapedString=getPage(id).name;return EscapeHtmlService.escape(unescapedString)}function hasPageDocumentation(id){return getPage(id).documentationExists}function mapTree(tree){return _.map(tree,function(node){return{id:node.id,name:getPageName(node.id),documentationExists:hasPageDocumentation(node.id),nodes:mapTree(node.nodes)}})}var pagesMap=PagesService.pagesMap;PagesService.pagesTree.nodes;return{getPage:getPage,getPageName:getPageName,hasPageDocumentation:hasPageDocumentation,mapTree:mapTree,pagesMap:pagesMap}}angular.module("core").factory("SitemapService",SitemapService),SitemapService.$inject=["_","EscapeHtmlService","PagesService"]}(),angular.module("core").factory("socket",["$rootScope",function($rootScope){"use strict";return SocketServiceHelper(ApplicationConfiguration.socketServerURL,$rootScope)}]),function(){angular.module("core").service("tinycolor",function($window){"use strict";return $window.tinycolor})}(),angular.module("core").factory("UsabilityTestService",["_","$q","$translate","LiveSessionService",function(_,$q,$translate,LiveSessionService){"use strict";var EVENTS=LiveShare.enums.EVENTS,STATUS_FINISHED=2,UsabilityTestService=function(){LiveSessionService.apply(this,arguments),this.isWizardOpen=!1,this.testDataId=null,this.testData=null,this.videoData=null,this.fetchPromise=null,this.getIdDefer=$q.defer()},proto=UsabilityTestService.prototype;return proto=_.extend(proto,LiveSessionService.prototype),proto.constructor=UsabilityTestService,proto.startInitializing=function(data){var config={};data.options&&(config.options=data.options),this.storeData(data.testData),LiveSessionService.prototype.startInitializing.call(this,config)},proto.initializeLiveShare=function(){var liveShare=LiveSessionService.prototype.initializeLiveShare.apply(this);return liveShare.on(EVENTS.UPDATE_TASKS,this.fireObserverCallback.bind(this,EVENTS.UPDATE_TASKS)),liveShare.on(EVENTS.OPTIONS_CHANGED,this.fireObserverCallback.bind(this,EVENTS.OPTIONS_CHANGED)),liveShare.on(EVENTS.TESTER_JOINED,this.onTesterJoined.bind(this)),liveShare},proto.hasVideoData=function(){return!_.isEmpty(this.videoData)},proto.storeVideoData=function(videoData){this.videoData=videoData},proto.getVideoData=function(){return this.videoData},proto.storeData=function(data){this.testData=data},proto.getTestData=function(){return this.testData},proto.save=function(){var d=$q.defer();return this.restangular.one("").post("usability-test",this.testData).then(function(testData){this.testData=testData,d.resolve(testData)}.bind(this),function(err){d.reject(new Error(err))}),d.promise},proto.getConfigurationOptions=function(){return $translate(["UT_OPTION_CAN_CLOSE_TASK","UT_OPTION_SEE_SITEMAP"]).then(function(translations){return this.roomConfigurationOptions||(this.roomConfigurationOptions=[{name:translations.UT_OPTION_CAN_CLOSE_TASK,value:!1,param:"canCloseTasks"},{name:translations.UT_OPTION_SEE_SITEMAP,value:!1,param:"seeSitemap"}]),this.roomConfigurationOptions}.bind(this))},proto.setDataId=function(dataId){this.testDataId=dataId,this.getIdDefer.resolve(dataId)},proto.getDataId=function(){return this.getIdDefer.promise},proto.fetch=function(){if(this.fetchPromise)return this.fetchPromise;var d=$q.defer();return this.testData?d.resolve(this.testData):this.getDataId().then(function(){this.restangular.one("usability-test",this.testDataId).get().then(function(data){this.testData=data,d.resolve(data)}.bind(this),function(err){d.reject(err)})}.bind(this)),this.fetchPromise=d.promise,d.promise},proto.resolveTask=function(id){this.liveShare.resolveTask(id)},proto.startSession=function(userType){this.liveShare.startUTSession(userType)},proto.onTesterJoined=function(data){this.testData.started_at=data.started_at,this.fireObserverCallback(EVENTS.TESTER_JOINED,data)},proto.finishTestingSession=function(){if(this.testData)return this.restangular.one("usability-test",this.testData._id).customPUT({started_at:this.testData.started_at,finished_at:new Date,status:STATUS_FINISHED})},new UsabilityTestService(LiveShare.enums.SESSION_TYPES.TESTING)}]),function(){"use strict";function UsersService(_,$q,Rest,ExportService,localStorageService,ProjectsService){function _getCollaborators(projectHash,collectionId){var deferred;return ExportService.isExport()?(deferred=$q.defer(),deferred.resolve([]),deferred.promise):Rest.one("projects",projectHash).one("collections",collectionId).all("collaborators").getList()}function filterCollaborators(collaborators,callback){var filtered=_.filter(collaborators,callback);return _.sortBy(filtered,function(collaborator){return(collaborator.name||collaborator.email).toLowerCase()})}function hasAccessToEditor(){return"yes"===permissions.has_access_to_editor}var permissions=ApplicationConfiguration.permissions||{};return{collaboratorsMap:{},collaboratorEmails:[],hasAccessToEditor:hasAccessToEditor,me:function(userData){return userData.is_anonymous&&localStorageService.get("anonymousName")&&(userData.name=localStorageService.get("anonymousName")),userData}(ApplicationConfiguration.userData),getCollaborators:function(){var projectHash=ProjectsService.currentProjectHash,collectionId=ProjectsService.currentCollectionId;return _getCollaborators(projectHash,collectionId).then(function(collaborators){return this.generateCollaboratorsMap(collaborators),this.generateCollaboratorEmails(collaborators),collaborators}.bind(this))},generateCollaboratorsMap:function(collaborators){_.forIn(this.collaboratorsMap,function(value,key){delete this.collaboratorsMap[key]}.bind(this)),collaborators.forEach(function(collaborator){this.collaboratorsMap[collaborator.id_user]=collaborator}.bind(this))},generateCollaboratorEmails:function(collaborators){collaborators.forEach(function(collaborator){this.collaboratorEmails.push(collaborator.email)}.bind(this))},isAnonymous:function(){return this.me.is_anonymous},isAnonymousNameSet:function(){return"anonymous"!==this.me.name},isInProjectsAccount:function(){return this.me.is_in_projects_account},setAnonymousName:function(name){this.me.name=name,localStorageService.set("anonymousName",name)},getAnonymousName:function(){return this.me.name},getProjectMembers:function(){var collaborators=_.values(this.collaboratorsMap);return filterCollaborators(collaborators,function(collaborator){return collaborator.is_owner})},getProjectMembersWithoutMe:function(){var collaborators=_.values(this.collaboratorsMap);return filterCollaborators(collaborators,function(collaborator){return collaborator.id_user!==parseInt(this.me.id_user)&&collaborator.is_owner}.bind(this))},getOtherMembers:function(){var collaborators=_.values(this.collaboratorsMap);return filterCollaborators(collaborators,function(collaborator){return!collaborator.is_owner})}}}angular.module("core").factory("UsersService",UsersService),UsersService.$inject=["_","$q","Rest","ExportService","localStorageService","ProjectsService"]}(),angular.module("core").factory("UXPinService",["ProjectsService","PagesService","DocumentsService",function(ProjectsService,PagesService,DocumentsService){"use strict";var uxpinURL=ApplicationConfiguration.uxpinURL,homepageURL=ApplicationConfiguration.homepageURL,wireframeURL=uxpinURL+"/edit/";return{applicationURL:uxpinURL,collectionURL:uxpinURL+"/dms/Collections/Show/",wireframeURL:wireframeURL,documentURL:uxpinURL+"/dms/Documents/Default/",dashboardURL:uxpinURL+"/dms/Dashboard/Default/",homepageURL:homepageURL,logOutURL:uxpinURL+"/mod/Login/Logout",
upgradePlanURL:uxpinURL+"/dms/DashboardModals/Upgrade/?source=preview&withoutCloseIcon=true",designSystemURL:uxpinURL+"/design-system/",getCurrentDocumentURL:function(){switch(ProjectsService.currentProjectType){case ProjectsService.DOCUMENT_TYPE_WIREFRAME:return this.wireframeURL+ProjectsService.currentProjectId+"#?id_page="+PagesService.currentPageId;case ProjectsService.DOCUMENT_TYPE_PERSONA:case ProjectsService.DOCUMENT_TYPE_BMC:case ProjectsService.DOCUMENT_TYPE_PC:return this.documentURL+DocumentsService.currentDocumentId;default:return null}},getCurrentCollectionURL:function(){return this.collectionURL+ProjectsService.currentCollectionId},getDashboardURL:function(){return this.dashboardURL},getHomepageURL:function(){return this.homepageURL},getLogOutURL:function(){return this.logOutURL},getDesignSystemURL:function(libraryHash){return this.designSystemURL+libraryHash}}}]),angular.module("core").run(["$templateCache",function($templateCache){$templateCache.put("/scripts/modules/comments/views/commentsFilters.view.html",'<section class="right-panel aside-panel" id="comments-filters" ng-if="vm.isVisible()">\n    <section id="comments-filter-panel" class="panel-container" ng-class="{\'loading\' : loading}">\n       <header>\n         <h2>Filter comments</h2>\n       </header>\n\n      <section class="scrolled-container">\n        <section class="scrolled-content">\n\n          <comments-type-filters ng-if="!vm.isAnonymous && vm.isCommentTypeActive"></comments-type-filters>\n          <comments-assignee-filters ng-if="!vm.isAnonymous && vm.isAssignmentActive"></comments-assignee-filters>\n          <comments-other-filters></comments-other-filters>\n\n        </section>\n      </section>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/comments/views/commentsNotes.view.html",'<section class="right-panel aside-panel" id="comments-notes">\n    <section id="comments-panel" class="panel-container" ng-class="{\'loading\' : vm.loading}" ng-if="vm.isVisible()">\n        <header>\n            <h2 class="title">\n                {{::\'LBL_COMMENTS\' | translate}}\n                <div class="filter">\n                    <input type="checkbox" id="show-current-page-only-comments" class="state-helper" ng-model="vm.showCurrentPageOnly" ng-change="vm.onShowCurrentPageOnly()" ng-disabled="vm.isDocument">\n                    <label for="show-current-page-only-comments" class="fake-choose-label fake-checkbox">{{::\'LBL_CURRENT_PAGE\' | translate}}</label>\n                </div>\n            </h2>\n            <pv-comments-search search-for="vm.searchFor" on-search="vm.handleSearch($searchText)"></pv-comments-search>\n        </header>\n        <pv-comments-list\n          ng-if="vm.showCurrentPageOnly"\n          list-id="{{::vm.commentsListId}}"\n          min-item-height="{{::vm.minItemHeight}}"\n          comments="vm.list">\n        </pv-comments-list>\n        <pv-comments-tree\n          ng-if="!vm.showCurrentPageOnly"\n          tree-id="{{::vm.commentsListId}}"\n          min-item-height="{{::vm.minItemHeight}}"\n          tree="vm.tree"\n          show-breakpoints="vm.showBreakpoints()">\n        </pv-comments-tree>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/breadcrumbs.view.html",'<li ng-repeat="breadcrumb in breadcrumbs">\n    <span>{{breadcrumb}}</span>\n    <span ng-if="$last" class="breakpoint" ng-bind-html="breakpoint"></span>\n</li>\n'),$templateCache.put("/scripts/modules/core/views/canvas.view.html",'<main class="canvas-main-container" ng-class="{\'no-logo\': firstTimeLoaded}">\n    <section class="scrolled-container">\n\n        <section id="{{canvasWrapperId}}" class="scrolled-content">\n            <section class="canvas-container" ng-style="dimensions" ng-class="{\'document-uxtest\': isUXTestDocument}">\n                <inspector ng-if="isSpecMode()"></inspector>\n                <section class="preview-container" add-comment ng-click="highlightInteractions($event)">\n                    <div ng-if="isDocument" ng-include="contentPath" onload="onContentLoaded()" class="canvas-content" ng-style="overflow">\n                    </div>\n\n                    <div ng-if="isDocument">\n                      <preview-pin ng-show="addingComment" comment x="{{clickX}}" y="{{clickY}}"></preview-pin>\n                      <preview-pin\n                          ng-if="isModeActive(PREVIEW_MODES.COMMENT)"\n                          ng-repeat="comment in list track by comment._id"\n                          comment="comment"\n                          x="{{comment.position.x}}"\n                          y="{{comment.position.y}}">\n                      </preview-pin>\n                    </div>\n\n                    <div ng-if="!isDocument" overflowed-page class="ng-canvas-container" page-animation ng-style="overflow">\n                      <div comment-tooltip class="ng-canvas" ng-mousedown="handleMouseDown($event)"></div>\n                      <div class="ng-overlay"></div>\n\n                      <preview-pin ng-show="addingComment" comment x="{{clickX}}" y="{{clickY}}"></preview-pin>\n                      <preview-pin\n                          ng-if="isModeActive(PREVIEW_MODES.COMMENT)"\n                          ng-repeat="comment in list track by comment._id"\n                          comment="comment"\n                          x="{{comment.position.x}}"\n                          y="{{comment.position.y}}">\n                      </preview-pin>\n                    </div>\n\n                    <preview-comment-container\n                      ng-if="addingComment"\n                      comment\n                      group-id="groupId"\n                      comment-type="commentType"\n                      type="canvas"\n                      x="clickX"\n                      y="clickY" >\n                    </preview-comment-container>\n\n                    <preview-comment-container\n                      ng-repeat="comment in visibleComments"\n                      comment="comment"\n                      group-id="groupId"\n                      comment-type="commentType"\n                      type="canvas"\n                      x="comment.position.x"\n                      y="comment.position.y" >\n                    </preview-comment-container>\n                </section>\n            </section>\n        </section>\n    </section>\n\n    <media-access-tip ng-if="isLiveSession || isUTSession"></media-access-tip>\n</main>\n'),$templateCache.put("/scripts/modules/core/views/home.view.html","<ui-view></ui-view>\n\n"),$templateCache.put("/scripts/modules/core/views/layers.view.html",'<section class="left-panel aside-panel" id="layers">\n  <section id="layers-panel" class="panel-container">\n    <header>\n      <h2>Layers</h2>\n      <form action="#" class="search" ng-submit="$event.preventDefault()">\n        <label for="layers-search" class="icon-font-search only-icon-font" ng-click="onSearchClick($event)">Search</label>\n        <input type="text"\n               placeholder="Type to search..."\n               id="layers-search"\n               ng-class="{\'active\' : vm.searchFor}"\n               ng-model="vm.searchFor"\n               ng-change="vm.filterCollection()"\n               ng-focus="vm.focusInput()"\n               ng-keydown="vm.keyDown($event)"\n               sync-focus-with="vm.focused"\n               autocomplete="off">\n        <span class="reset-search" ng-click="vm.resetSearch()">Reset search</span>\n      </form>\n    </header>\n    <section class="scrolled-container section-layers">\n      <layers-list  when-scrolled="vm.loadMore()" ng-if="vm.isVisible" collection="vm.visibleItems" node-map="vm.nodeMap"></layers-list>\n    </section>\n  </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/sitemap.view.html",'<script type="text/ng-template" id="node_template.html">\n    <input class="state-helper expander-state-helper"\n           ng-if="node.nodes.length"\n           type="checkbox"\n           id="{{::\'node-\' + node.id}}"\n           ng-model="minimized[node.id]"\n           ng-change="toggleMinimized(node.id)">\n    <label class="expander" ng-if="node.nodes.length" for="{{::\'node-\' + node.id}}"></label>\n    <div class="option-name element-with-action-menu" ng-init="init(node.id)" ng-class="{\'selected\' : isActive(node.id)}" ng-click="onClick($event,node.id)">\n      <span ng-if="node.documentationExists" class="only-icon-font icon-general-documentation"></span>\n      <a class="action-context-menu-available" ng-href="">\n        <span class="option-name-text" highlight search-for="searchData.searchFor" input-text="::node.name"></span>\n      </a>\n    </div>\n    <ul ng-if="minimized[node.id]" class="branch">\n        <li ng-repeat="node in node.nodes | filter : filterSearch : comparatorSearch" ng-include="\'node_template.html\'"></li>\n    </ul>\n</script>\n\n<section ng-if="isSitemapAvailable && isVisible()" class="left-panel aside-panel"\n         id="sitemap">\n    <section id="sitemap-panel" class="panel-container">\n      <header>\n        <h2>Sitemap</h2>\n        <form action="#" class="search">\n          <label for="pages-list-search" class="icon-font-search only-icon-font">Search</label>\n          <input type="text"\n                 placeholder="{{::\'INFO_SEARCH_SITEMAP\' | translate}}"\n                 id="pages-list-search"\n                 ng-class="{\'active\' : searchData.searchFor}"\n                 ng-model="searchData.searchFor"\n                 ng-keydown="keyDown($event)"\n                 ng-focus="focusInput($event)"\n                 sync-focus-with="searchData.focused"\n                 autocomplete="off">\n          <span class="reset-search" ng-click="searchData.searchFor=\'\'; focused=false;">Reset search</span>\n        </form>\n      </header>\n      <section class="scrolled-container">\n        <section class="pages-list scrolled-content" ng-class="{\'indent\' : isIndent()}">\n          <ul class="sitemap nav-tree">\n            <li ng-repeat="node in treeMapped | filter : searchData.searchFor" ng-include="\'node_template.html\'"></li>\n          </ul>\n        </section>\n      </section>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/tasks.view.html",'<section class="right-panel aside-panel" id="tasks">\n  <section id="tasks-panel" class="panel-container">\n    <header>\n      <h2>Tasks</h2>\n    </header>\n    <section class="scrolled-container">\n      <section id="tasks-list" class="tasks-list scrolled-content">\n        <ul>\n          <li class="task-container" ng-repeat="task in params.tasks" ng-class="{\'resolved\': task.resolved}">\n            <h3><span>Task {{$index + 1}}:</span>{{task.title}}</h3>\n            <section class="task-body">\n              <p ng-bind-html="task.content"></p>\n\n              <button class="btn-solid blue"\n                      ng-if="isResolveButton"\n                      ng-click="onClickResolveTask($event, task)"\n                      ng-disabled="task.resolved">Mark as resolved</button>\n            </section>\n          </li>\n        </ul>\n      </section>\n    </section>\n  </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/topBar.view.html",'<header id="top-bar" ng-if="vm.isLoaded">\n  <div class="left-actions" ng-class="{\'with-sitemap\': vm.canShowSitemap()}" ng-if="!vm.isZenMode">\n    <ul class="options-list">\n      <li ng-if="!vm.isAnonymous && vm.canShowActionsMenu()" class="actions">\n        <actions></actions>\n      </li>\n      <li ng-if="vm.isAnonymous && vm.canShowActionsMenu()" class="sign-in">\n        <a class="underline-link blue-link"\n           ng-href="{{vm.referer}}"\n           ng-mouseover="vm.updateReferer()">Sign in</a>\n      </li>\n      <li class="separator reduce-right" ng-if="!vm.isDesignSystem && (vm.canShowActionsMenu() && vm.canShowSitemap() || vm.isModeActive(vm.PREVIEW_MODES.SPEC))"></li>\n      <li class="layers" ng-if="vm.isModeActive(vm.PREVIEW_MODES.SPEC)">\n        <a href="#layers"\n           ng-click="vm.togglePanel($event, vm.PREVIEW_PANELS.LAYERS)"\n           class="icon-general-layers button-style"\n           ng-class="{\'active\': vm.isPanelVisible(vm.PREVIEW_PANELS.LAYERS)}">\n            <span class="ellipsis-helper" title="{{vm.currentPageName}}">\n              <span class="underline">\n                Layers\n              </span>\n            </span>\n        </a>\n      </li>\n      <li class="sitemap" ng-if="vm.canShowSitemap() && vm.isExportMenuEnabled && !vm.isDesignSystem">\n          <a href="#sitemap"\n             ng-click="vm.togglePanel($event, vm.PREVIEW_PANELS.SITEMAP)"\n             class="icon-general-sitemap button-style"\n             ng-class="{\'active\': vm.isPanelVisible(vm.PREVIEW_PANELS.SITEMAP)}"\n             data-show-node="tooltip">\n           <span class="label">Sitemap:</span>\n            <span class="ellipsis-helper" title="{{vm.currentPageName}}">\n              <span class="underline">\n                {{vm.currentPageName}}\n              </span>\n            </span>\n            <em class="tooltip">Sitemap</em>\n          </a>\n      </li>\n      <li class="breakpoints" ng-if="!vm.isDesignSystem">\n        <pv-breakpoints breakpoints="breakpoints"></pv-breakpoints>\n      </li>\n      <li class="symbol-name" ng-if="vm.isDesignSystem">\n        <h2>{{vm.symbolName}}</h2>\n      </li>\n    </ul>\n  </div>\n\n  <nav class="main-actions nav-tabbed nav-top-bar" ng-if="vm.isModeMenuEnabled && !vm.isZenMode && !vm.isDesignSystem">\n    <ul class="tabs-wrapper">\n      <li class="tab with-icon"\n          ng-if="!vm.isLiveSessionRunning()"\n          ng-click="vm.toggleMode($event, vm.PREVIEW_MODES.SIMULATE)"\n          ng-class="{active: vm.isModeActive(vm.PREVIEW_MODES.SIMULATE)}">\n        <a href class="tab-link icon-general-simulate">Simulate</a>\n      </li>\n      <li class="tab with-icon"\n          ng-if="vm.canShowCommentMode()"\n          ng-click="vm.toggleMode($event, vm.PREVIEW_MODES.COMMENT)"\n          ng-class="{active: vm.isModeActive(vm.PREVIEW_MODES.COMMENT)}">\n        <a href class="tab-link icon-general-comment">Comment</a>\n      </li>\n      <li class="tab with-icon"\n          ng-if="vm.canShowSpecMode()"\n          ng-click="vm.toggleMode($event, vm.PREVIEW_MODES.SPEC)"\n          ng-class="{active: vm.isModeActive(vm.PREVIEW_MODES.SPEC)}">\n        <a href class="tab-link icon-general-spec">Spec</a>\n      </li>\n      <li class="tab with-icon"\n          ng-if="vm.canShowDocumentationMode()"\n          ng-click="vm.toggleMode($event, vm.PREVIEW_MODES.DOCUMENTATION)"\n          ng-class="{active: vm.isModeActive(vm.PREVIEW_MODES.DOCUMENTATION), indicator: vm.shouldShowIndicator}">\n        <a href class="tab-link icon-general-documentation">\n          Documentation\n        </a>\n      </li>\n      <li class="tab-button wide red"\n          ng-if="vm.isLiveSessionRunning()"\n          ng-click="vm.finishLiveSession()"\n          ng-class="{\'red\': vm.isHostSession}">\n        {{vm.isHostSession ? \'End session\' : \'Leave session\'}}\n      </li>\n      <pv-screencastify-recorder\n        ng-if="vm.isUserTestingSession && vm.isHostSession"\n        id="{{vm.recorderId}}"\n        on-start-recording="vm.handleRecordingStart()"\n        on-stop-recording="vm.handleRecordingStop()"\n        on-video-ready="vm.handleVideoReady($videoData)"></pv-screencastify-recorder>\n    </ul>\n  </nav>\n\n  <div class="right-actions">\n    <live-share ng-if="vm.isLiveSessionRunning()"\n                is-host-session="vm.isHostSession"\n                is-live-share-session="vm.isLiveShareSession"\n                is-user-testing-session="vm.isUserTestingSession"></live-share>\n    <ul class="options-list">\n      <li ng-if="vm.canShowZoom()" class="zoom-option">\n        <zoom></zoom>\n      </li>\n      <li ng-if="vm.isModeActive(vm.PREVIEW_MODES.SPEC) && vm.isSpecModeStyleguideFeature && !vm.isZenMode">\n        <a href="/styleguide/{{vm.currentProjectHash}}"\n           class="icon-general-external-link with-icon underline-link"\n           target="_blank">\n          Styleguide\n        </a>\n      </li>\n      <li ng-if="(vm.isModeActive(vm.PREVIEW_MODES.SPEC) && vm.isSpecModeStyleguideFeature || vm.isDesignSystem) && !vm.isZenMode" class="last-updated">\n        Updated:\n        <time title="{{vm.lastUpdatedDateTitle}}">\n          {{vm.lastUpdatedDate}}\n        </time>\n      </li>\n      <li ng-if="vm.isModeActive(vm.PREVIEW_MODES.SIMULATE) && !vm.isLiveSessionRunning() && !vm.isZenMode">\n        <a href="#interactions"\n           class="btn-icon icon-general-interaction"\n           ng-class="{\'active\': !vm.isInteractionsHighlightDisabled()}"\n           ng-click="vm.toggleInteractionsHighlightMode($event)"\n           data-show-node="tooltip">\n          <em class="tooltip float-right">Highlight Interactions</em>\n        </a>\n      </li>\n      <li ng-if="vm.isModeActive(vm.PREVIEW_MODES.SIMULATE) && !vm.isLiveSessionRunning() && !vm.isExport">\n        <a zen-mode\n           href="#full-screen"\n           class="btn-icon icon-general-fullscreen"\n           data-show-node="tooltip">\n          <em class="tooltip" ng-class="{\'float-right\': vm.isModeActive(vm.PREVIEW_MODES.SIMULATE)}">Full screen</em>\n        </a>\n      </li>\n      <filter ng-if="vm.isModeActive(vm.PREVIEW_MODES.COMMENT) && !vm.isZenMode" toggle-panel="vm.togglePanel" is-panel-visible="vm.isPanelVisible"></filter>\n      <li ng-if="vm.isModeActive(vm.PREVIEW_MODES.COMMENT) && !vm.isZenMode">\n        <a href="#comments"\n           ng-click="vm.togglePanel($event, vm.PREVIEW_PANELS.COMMENTS)"\n           class="icon-general-comments-multiple comments button-style"\n           ng-class="{\'active\': vm.isPanelVisible(vm.PREVIEW_PANELS.COMMENTS)}">\n          <span class="underline">Comments</span>\n        </a>\n      </li>\n      <li ng-if="vm.isUserTestingSession && !vm.isZenMode">\n        <a href="#tasks"\n           ng-click="vm.togglePanel($event, vm.PREVIEW_PANELS.TASKS)"\n           class="tasks button-style"\n           ng-class="{\'active\': vm.isPanelVisible(vm.PREVIEW_PANELS.TASKS)}">\n          <span class="underline">Tasks list</span>\n        </a>\n      </li>\n      <li ui-view="approvalProcess"></li>\n    </ul>\n  </div>\n</header>\n'),$templateCache.put("/scripts/modules/documentation/views/documentation.view.html",'<section class="right-panel aside-panel" id="documentation" ng-if="vm.isVisible()">\n  <section class="panel-container">\n    <section class="scrolled-container">\n      <section class="scrolled-content">\n          <annotations-list\n              ng-if="vm.hasPageDocumentation"\n              data="vm.documentation">\n          </annotations-list>\n          <div class="empty-annotations"\n               ng-if="!vm.hasPageDocumentation">\n            <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIxLjAuMiwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeD0iMHB4IiB5PSIwcHgiCgkgdmlld0JveD0iMCAwIDEyOS44IDE0OC4zIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMjkuOCAxNDguMzsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtkaXNwbGF5Om5vbmU7fQoJLnN0MXtkaXNwbGF5OmlubGluZTtvcGFjaXR5OjAuNTtmaWxsOm5vbmU7ZW5hYmxlLWJhY2tncm91bmQ6bmV3ICAgIDt9Cgkuc3Qye2Rpc3BsYXk6aW5saW5lO2ZpbGw6bm9uZTtlbmFibGUtYmFja2dyb3VuZDpuZXcgICAgO30KCS5zdDN7b3BhY2l0eTowLjU7ZmlsbDojRDVERUU0O30KCS5zdDR7ZmlsbDpub25lO3N0cm9rZTojQ0NENkRCO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cgkuc3Q1e2ZpbGw6bm9uZTtzdHJva2U6I0UwRTBFMDtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fQoJLnN0NntmaWxsOm5vbmU7c3Ryb2tlOiNFMEUwRTA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEwO30KPC9zdHlsZT4KPGcgaWQ9IkxheWVyXzEiIGNsYXNzPSJzdDAiPgoJCgkJPGltYWdlIHN0eWxlPSJkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlOyIgd2lkdGg9IjYwIiBoZWlnaHQ9IjgwIiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUR3QUFBQlFBZ01BQUFBNHBQN0FBQUFBQkdkQlRVRUFBTEdQQy94aEJRQUFBQ0JqU0ZKTgpBQUI2SmdBQWdJUUFBUG9BQUFDQTZBQUFkVEFBQU9wZ0FBQTZtQUFBRjNDY3VsRThBQUFBREZCTVZFWFUzdVBVM3VQVTN1TUFBQUQ0Ck8vV01BQUFBQTNSU1RsTXNkb0JmL0NZS0FBQUFBV0pMUjBRREVReE04Z0FBQUFsd1NGbHpBQUFMRWdBQUN4SUIwdDErL0FBQUFBZDAKU1UxRkIrRUNDZ2s2TXVZZVpmVUFBQUFwU1VSQlZEakxZNUJhaFF5V01HU2g4RmN5ckVJRm8veFIvaWgvbEQ5aytGa28zSlVNVWlqOApKUUJyZmh0Z3hPRnBEZ0FBQUFCSlJVNUVya0pnZ2c9PSIgdHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgMSAzNC4wNTg0IDQyLjQ0OTYpIj4KCTwvaW1hZ2U+Cgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJ6Ii8+CgkKCQk8aW1hZ2Ugc3R5bGU9ImRpc3BsYXk6aW5saW5lO292ZXJmbG93OnZpc2libGU7IiB3aWR0aD0iMTMwIiBoZWlnaHQ9IjE0OCIgeGxpbms6aHJlZj0iZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFJSUFBQUNVQ0FNQUFBQm9VZ0ZKQUFBQUJHZEJUVUVBQUxHUEMveGhCUUFBQUNCalNGSk4KQUFCNkpnQUFnSVFBQVBvQUFBQ0E2QUFBZFRBQUFPcGdBQUE2bUFBQUYzQ2N1bEU4QUFBQ0VGQk1WRVVBQUFETTFkdk0xZHZNMWR2TQoxZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNCjFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZmMzkvZjM5L2YzOS9mMzkvZjM5L2YKMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZgozOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mCjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YKMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZgozOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvZjM5L2YzOS9mCjM5L2YzOS9mMzkvZjM5L2YzOS9mMzkvTTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0KMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZNMWR2TTFkdk0xZHZmMzk4QQpBQUM0Z0MxZUFBQUFyWFJTVGxNQUFYSGU2SWdJbHRkSEVEYkR1Q3J6R2dyZFVHeXNoWk9yOHR4Rk5NRzVBblBnNllrREIxb2x6UmxiCjhZYmZPQXVlNkVYQVZTM1h1aGVqY21iemVRS1A3bjBWYUtzQlE3TDJMMHZKSTVEeWUrY05iOXY5S2xZUXF1b3ljUkprUFR2bW53a1kKWXIvTW5QbnRFK0Z1THJBUEE3bW1yOXlDMUhZbVAwaWdqWWs1RWRWbm1zbzZ3dnIwZ0V4UkhQc2ZwVGpBL1BxM0xEdjBkQmtjZ2U0cgp5VzZHc2cwamI3RTVkaDJEdi92NXRSVTRYbGtBQUFBQllrdEhSQUNJQlIxSUFBQUFDWEJJV1hNQUFBc1NBQUFMRWdIUzNYNzhBQUFBCkIzUkpUVVVINFFJS0NUb3k1aDVsOVFBQUFkMUpSRUZVZU5ydDNPay9WR0VZeHZGNzJoUTFUQkVSU28xOTdNdklJR3BRR1pTdDBHSmYKeWs1WlNwWVNxUWhKbHV3Vk5lZHY3RG42QjNwM2ZYQjlYOXozeS9QN1BPYzhiNCtJem5Ea3FQUFk4Uk1DNUhMeWxLdmI2VE1HWElIUgozVU5OMDlsenVBUlByNzExM2h1WTRBTlBNRjd3VU5Qa0Mzd1I2blAwYzczb0h4QUlUREJjdXV3TXVnSzlsTXBWOFBPSmlJaUlpSWhvCmZ6RUhvd3RDUXJVd2JFRjRSS1FsQ2hrUUhSTWJKL0VKd0lMRXBHU3JTTW8xWEVHcUxTMWRyY2dNWEVMbzljd3N0VzdjeENYWXMzTnkKWTI3SjdUdTRCQ1hQa1I5ZlVBaE5FTGw3cjZnWW5DQ1NYb0l1SUNJaW92M0JYRnFHVHJqL3dGS09MYWl3VkZiWUhpSUxIdG5VRVR4KwpVbFVOSzZncHJOV1h0YTdlakVxb2EvaTNveHF6VUFsTm1YWjlOVDk5aGlxUWxxTFdOcEgyams1WWdVaGJWM2VMOUR5UEJpYUkvWVhOCkVkR0xMRkQ2T3ZyQkJVUkVSRVJFUkVSMHFGUU5vQXZrcFJZbjFsZUR5SVRYVFVOcCtkb3c5QmhHTkczMERUS2cvSzAyOXE0U1dWQTIKbGpzK29UbVFDZkorVWlUbncwZG9nNUwzeVlwT0lDSWlJaUlpb2dNdEVQaXptejFUMDU5blp1ZVFCVi9tdnk1OFcxeGFCaWFzZk5mbgo2aHF1d09SYzE5ZkcvS0ZPa0pWTmZhNXVBUk8yM1g4cy9QeTFaQVFtaU52Tzd1OC8vM1VoL2dKdUpsUkFqS1YwSHdBQUFBQkpSVTVFCnJrSmdnZz09IiB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAxIDUuODQxMTQwZS0wMiAtMC41NTA0KSI+Cgk8L2ltYWdlPgoJPHBhdGggY2xhc3M9InN0MiIgZD0ieiIvPgoJCgkJPGltYWdlIHN0eWxlPSJkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlOyIgd2lkdGg9IjYyIiBoZWlnaHQ9IjgyIiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUQ0QUFBQlNDQVFBQUFDbS9xL3VBQUFBQkdkQlRVRUFBTEdQQy94aEJRQUFBQ0JqU0ZKTgpBQUI2SmdBQWdJUUFBUG9BQUFDQTZBQUFkVEFBQU9wZ0FBQTZtQUFBRjNDY3VsRThBQUFBQW1KTFIwUUFBS3FOSXpJQUFBQUpjRWhaCmN3QUFDeElBQUFzU0FkTGRmdndBQUFBSGRFbE5SUWZoQWdvSk9qTG1IbVgxQUFBQitrbEVRVlJvM3UyYVAyNGFRUnhHSDhQeVQ2c0EKY2RaWWRrbVJCbEZGTkpZb2ZBOXVZWVhFa1F0a3lRWWM1Ulk1aDgrUTFoMFZVbVFqd0dZeGEyQW56WHBFTHNCWGVGLzViZkUwMHVvMwp1ek1mM0dHWmtPT05VMklzbGpsbGx6WFpZTEdFMUZ4V0o4SmlpYWk3ckVhSXhiS2g2Ykl5Y3l5V21GT1g1WmhndWZNNDR3Ky9XYnNICjk5eFNCUDZ5Y05tSUlUNHdaZXF5TVFNcXdKeXh5NmJjOGhFSUdibHN3WUFqWU1XOXk5YmMwT0VNSGpoSHdUa1A0RW5Vb0RTbnlNalMKWnNsU1lEN2tDOFFNSmNzZUVoc3lGQ1R5QWhrakVTZVkvOGJqUGhremh4SVppVHhEU2VKTmtaS2x4WktWd0Z5bENWdjZrbVgzMlJxTQo2SlV2WWNRVEx1UlJZbjRraEFNMHF6Y2NTTHdwVXJJMFdPNzhMTzBQbjgrdzVscXk3R3ZXQmc5Zkl2Znh4Qk11WWlZeHo0amdlT2RnCllKL2tPSlo0VThUVUtVcThSZW9RY1NXUlh4RVo4anZuYmZ1a1RGNDg0VjU1a3BpZmVCVy9jQ252RCttV3VxSW5rZmRZR1FwVUpmSXEKQmZHRTJ4Qkt6Q0ViYU1nK25Sc1NiNG9ZNmJISWdrdUovSktGd1NlUXlBTjg4WVNMZVpHWVg0aWhKZHRZV2hKdmloanAxZGFNcmtUZQpaV2FvY0NLUm4xQVJUemhMSkRGSFdHaHpLSkVIdENYZUZESFNlcEt3bU9VUjBBRit1ZkFUWDVOSzJwQTR5VDd3UGFtazNiajdtQ0lYClNTV3Q3MjZoYy94SUtta0RucFBNOEMycHBQMWtzcVB1RUtBczQvMER2anViMnNTTHZyOEFBQUFBU1VWT1JLNUNZSUk9IiB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAxIDI0LjA1ODQgMzIuNDQ5NikiPgoJPC9pbWFnZT4KCTxwYXRoIGNsYXNzPSJzdDIiIGQ9InoiLz4KPC9nPgo8ZyBpZD0iTGF5ZXJfNCI+Cgk8cGF0aCBjbGFzcz0ic3QzIiBkPSJNOTIuMSwxMjIuNGgtNTZjLTEuMSwwLTItMC45LTItMnYtNzZjMC0xLjEsMC45LTIsMi0yaDU2YzEuMSwwLDIsMC45LDIsMnY3NgoJCUM5NC4xLDEyMS42LDkzLjIsMTIyLjQsOTIuMSwxMjIuNHoiLz4KPC9nPgo8ZyBpZD0iTGF5ZXJfMiI+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZD0iTTg1LjMsMTE0LjZoLTEuNWMtMC40LDAtMC44LTAuMy0wLjgtMC44czAuMy0wLjgsMC44LTAuOGgwLjh2LTAuOGMwLTAuNCwwLjMtMC44LDAuOC0wLjhzMC44LDAuMywwLjgsMC44djEuNQoJCQkJTDg1LjMsMTE0LjZ6Ii8+CgkJPC9nPgoJCTxnPgoJCQk8cGF0aCBkPSJNNzYuNiwxMTQuNmgtMi45Yy0wLjQsMC0wLjgtMC4zLTAuOC0wLjhzMC4zLTAuOCwwLjgtMC44aDIuOWMwLjQsMCwwLjgsMC4zLDAuOCwwLjhTNzcsMTE0LjYsNzYuNiwxMTQuNnogTTY2LjYsMTE0LjYKCQkJCWgtMi45Yy0wLjQsMC0wLjgtMC4zLTAuOC0wLjhzMC4zLTAuOCwwLjgtMC44aDIuOWMwLjQsMCwwLjgsMC4zLDAuOCwwLjhTNjcsMTE0LjYsNjYuNiwxMTQuNnogTTU2LjUsMTE0LjZoLTIuOQoJCQkJYy0wLjQsMC0wLjgtMC4zLTAuOC0wLjhzMC4zLTAuOCwwLjgtMC44aDIuOWMwLjQsMCwwLjgsMC4zLDAuOCwwLjhTNTYuOSwxMTQuNiw1Ni41LDExNC42eiBNNDYuNCwxMTQuNmgtMi45CgkJCQljLTAuNCwwLTAuOC0wLjMtMC44LTAuOHMwLjMtMC44LDAuOC0wLjhoMi45YzAuNCwwLDAuOCwwLjMsMC44LDAuOFM0Ni45LDExNC42LDQ2LjQsMTE0LjZ6IE0zNi40LDExNC42aC0yLjkKCQkJCWMtMC40LDAtMC44LTAuMy0wLjgtMC44czAuMy0wLjgsMC44LTAuOGgyLjljMC40LDAsMC44LDAuMywwLjgsMC44UzM2LjgsMTE0LjYsMzYuNCwxMTQuNnoiLz4KCQk8L2c+CgkJPGc+CgkJCTxwYXRoIGQ9Ik0yNi4zLDExNC42aC0xLjVsLTAuOC0wLjh2LTEuNWMwLTAuNCwwLjMtMC44LDAuOC0wLjhzMC44LDAuMywwLjgsMC44djAuOGgwLjhjMC40LDAsMC44LDAuMywwLjgsMC44CgkJCQlTMjYuNywxMTQuNiwyNi4zLDExNC42eiIvPgoJCTwvZz4KCQk8Zz4KCQkJPHBhdGggZD0iTTI0LjgsMTA1LjljLTAuNCwwLTAuOC0wLjMtMC44LTAuOHYtMi45YzAtMC40LDAuMy0wLjgsMC44LTAuOHMwLjgsMC4zLDAuOCwwLjh2Mi45QzI1LjYsMTA1LjYsMjUuMiwxMDUuOSwyNC44LDEwNS45egoJCQkJIE0yNC44LDk1LjljLTAuNCwwLTAuOC0wLjMtMC44LTAuOHYtMi45YzAtMC40LDAuMy0wLjgsMC44LTAuOHMwLjgsMC4zLDAuOCwwLjh2Mi45QzI1LjYsOTUuNSwyNS4yLDk1LjksMjQuOCw5NS45eiBNMjQuOCw4NS44CgkJCQljLTAuNCwwLTAuOC0wLjMtMC44LTAuOHYtMi45YzAtMC40LDAuMy0wLjgsMC44LTAuOHMwLjgsMC4zLDAuOCwwLjhWODVDMjUuNiw4NS40LDI1LjIsODUuOCwyNC44LDg1Ljh6IE0yNC44LDc1LjcKCQkJCWMtMC40LDAtMC44LTAuMy0wLjgtMC44di0yLjljMC0wLjQsMC4zLTAuOCwwLjgtMC44czAuOCwwLjMsMC44LDAuOFY3NUMyNS42LDc1LjQsMjUuMiw3NS43LDI0LjgsNzUuN3ogTTI0LjgsNjUuNwoJCQkJYy0wLjQsMC0wLjgtMC4zLTAuOC0wLjhWNjJjMC0wLjQsMC4zLTAuOCwwLjgtMC44czAuOCwwLjMsMC44LDAuOHYyLjlDMjUuNiw2NS4zLDI1LjIsNjUuNywyNC44LDY1Ljd6IE0yNC44LDU1LjYKCQkJCWMtMC40LDAtMC44LTAuMy0wLjgtMC44VjUyYzAtMC40LDAuMy0wLjgsMC44LTAuOHMwLjgsMC4zLDAuOCwwLjh2Mi45QzI1LjYsNTUuMywyNS4yLDU1LjYsMjQuOCw1NS42eiBNMjQuOCw0NS41CgkJCQljLTAuNCwwLTAuOC0wLjMtMC44LTAuOHYtMi45YzAtMC40LDAuMy0wLjgsMC44LTAuOHMwLjgsMC4zLDAuOCwwLjh2Mi45QzI1LjYsNDUuMiwyNS4yLDQ1LjUsMjQuOCw0NS41eiIvPgoJCTwvZz4KCQk8Zz4KCQkJPHBhdGggZD0iTTI0LjgsMzUuNWMtMC40LDAtMC44LTAuMy0wLjgtMC44di0xLjVsMC44LTAuOGgxLjVjMC40LDAsMC44LDAuMywwLjgsMC44UzI2LjcsMzQsMjYuMywzNGgtMC44djAuOAoJCQkJQzI1LjYsMzUuMSwyNS4yLDM1LjUsMjQuOCwzNS41eiIvPgoJCTwvZz4KCQk8Zz4KCQkJPHBhdGggZD0iTTc2LjYsMzRoLTIuOWMtMC40LDAtMC44LTAuMy0wLjgtMC44czAuMy0wLjgsMC44LTAuOGgyLjljMC40LDAsMC44LDAuMywwLjgsMC44Uzc3LDM0LDc2LjYsMzR6IE02Ni42LDM0aC0yLjkKCQkJCWMtMC40LDAtMC44LTAuMy0wLjgtMC44czAuMy0wLjgsMC44LTAuOGgyLjljMC40LDAsMC44LDAuMywwLjgsMC44UzY3LDM0LDY2LjYsMzR6IE01Ni41LDM0aC0yLjljLTAuNCwwLTAuOC0wLjMtMC44LTAuOAoJCQkJczAuMy0wLjgsMC44LTAuOGgyLjljMC40LDAsMC44LDAuMywwLjgsMC44UzU2LjksMzQsNTYuNSwzNHogTTQ2LjQsMzRoLTIuOWMtMC40LDAtMC44LTAuMy0wLjgtMC44czAuMy0wLjgsMC44LTAuOGgyLjkKCQkJCWMwLjQsMCwwLjgsMC4zLDAuOCwwLjhTNDYuOSwzNCw0Ni40LDM0eiBNMzYuNCwzNGgtMi45Yy0wLjQsMC0wLjgtMC4zLTAuOC0wLjhzMC4zLTAuOCwwLjgtMC44aDIuOWMwLjQsMCwwLjgsMC4zLDAuOCwwLjgKCQkJCVMzNi44LDM0LDM2LjQsMzR6Ii8+CgkJPC9nPgoJCTxnPgoJCQk8cGF0aCBkPSJNODUuMywzNS41Yy0wLjQsMC0wLjgtMC4zLTAuOC0wLjhWMzRoLTAuOGMtMC40LDAtMC44LTAuMy0wLjgtMC44czAuMy0wLjgsMC44LTAuOGgxLjVsMC44LDAuOHYxLjUKCQkJCUM4Ni4xLDM1LjEsODUuNywzNS41LDg1LjMsMzUuNXoiLz4KCQk8L2c+CgkJPGc+CgkJCTxwYXRoIGQ9Ik04NS4zLDEwNS45Yy0wLjQsMC0wLjgtMC4zLTAuOC0wLjh2LTIuOWMwLTAuNCwwLjMtMC44LDAuOC0wLjhzMC44LDAuMywwLjgsMC44djIuOUM4Ni4xLDEwNS42LDg1LjcsMTA1LjksODUuMywxMDUuOXoKCQkJCSBNODUuMyw5NS44Yy0wLjQsMC0wLjgtMC4zLTAuOC0wLjh2LTIuOWMwLTAuNCwwLjMtMC44LDAuOC0wLjhzMC44LDAuMywwLjgsMC44djIuOUM4Ni4xLDk1LjUsODUuNyw5NS44LDg1LjMsOTUuOHogTTg1LjMsODUuOAoJCQkJYy0wLjQsMC0wLjgtMC4zLTAuOC0wLjh2LTIuOWMwLTAuNCwwLjMtMC44LDAuOC0wLjhzMC44LDAuMywwLjgsMC44Vjg1Qzg2LjEsODUuNCw4NS43LDg1LjgsODUuMyw4NS44eiBNODUuMyw3NS43CgkJCQljLTAuNCwwLTAuOC0wLjMtMC44LTAuOHYtMi45YzAtMC40LDAuMy0wLjgsMC44LTAuOHMwLjgsMC4zLDAuOCwwLjhWNzVDODYuMSw3NS40LDg1LjcsNzUuNyw4NS4zLDc1Ljd6IE04NS4zLDY1LjcKCQkJCWMtMC40LDAtMC44LTAuMy0wLjgtMC44VjYyYzAtMC40LDAuMy0wLjgsMC44LTAuOHMwLjgsMC4zLDAuOCwwLjh2Mi45Qzg2LjEsNjUuMyw4NS43LDY1LjcsODUuMyw2NS43eiBNODUuMyw1NS42CgkJCQljLTAuNCwwLTAuOC0wLjMtMC44LTAuOFY1MmMwLTAuNCwwLjMtMC44LDAuOC0wLjhzMC44LDAuMywwLjgsMC44djIuOUM4Ni4xLDU1LjMsODUuNyw1NS42LDg1LjMsNTUuNnogTTg1LjMsNDUuNQoJCQkJYy0wLjQsMC0wLjgtMC4zLTAuOC0wLjh2LTIuOWMwLTAuNCwwLjMtMC44LDAuOC0wLjhzMC44LDAuMywwLjgsMC44djIuOUM4Ni4xLDQ1LjIsODUuNyw0NS41LDg1LjMsNDUuNXoiLz4KCQk8L2c+Cgk8L2c+CjwvZz4KPGcgaWQ9IkxheWVyXzMiPgoJPGc+CgkJPGNpcmNsZSBjbGFzcz0ic3Q0IiBjeD0iOC44IiBjeT0iNC41IiByPSIzLjUiLz4KCQk8Y2lyY2xlIGNsYXNzPSJzdDQiIGN4PSI5MC42IiBjeT0iMTQzLjgiIHI9IjMuNSIvPgoJPC9nPgoJPGc+CgkJPGxpbmUgY2xhc3M9InN0NSIgeDE9IjU0LjciIHkxPSIxMDYuMSIgeDI9IjQ4LjYiIHkyPSIxMDkuNiIvPgoJCTxsaW5lIGNsYXNzPSJzdDUiIHgxPSI0OS45IiB5MT0iMTA0LjgiIHgyPSI1My40IiB5Mj0iMTEwLjkiLz4KCTwvZz4KCTxwb2x5Z29uIGNsYXNzPSJzdDYiIHBvaW50cz0iMTIwLjksNDEuNiAxMjcuOCwzNi40IDEyOC44LDQ1IAkiLz4KCTxwYXRoIGNsYXNzPSJzdDYiIGQ9Ik01LjEsNzJsLTMuNy0yLjljLTAuNC0wLjMtMC41LTEtMC4yLTEuNGwyLjktMy43YzAuMy0wLjQsMS0wLjUsMS40LTAuMmwzLjcsMi45YzAuNCwwLjMsMC41LDEsMC4yLDEuNAoJCWwtMi45LDMuN0M2LjIsNzIuMiw1LjYsNzIuMyw1LjEsNzJ6Ii8+CjwvZz4KPC9zdmc+Cg==" width="130" height="148" />\n            <h3>\n              No Documentation has been <br />\n              added to this page\n            </h3>\n            <p>\n              Go to the sitemap and choose the <br />\n              page with documentation icon <span class="icon-general-documentation"></span> or add the <br />\n              documentation in the editor.\n            </p>\n          </div>\n      </section>\n    </section>\n  </section>\n</section>\n'),$templateCache.put("/scripts/modules/specification/views/specification.view.html",'<section class="right-panel aside-panel" id="specification" ng-hide="!vm.isLoaded">\n  <section class="panel-container" ng-class="{\'with-parent-info\': !!vm.activeElementDSInfo}">\n    <header-canvas\n        ng-if="vm.isActiveObject(vm.SPEC_OBJECT_TYPES.CANVAS)"\n        current-page-name="vm.currentPageName"\n        last-updated-date="vm.lastUpdatedDate"\n        last-updated-date-title="vm.lastUpdatedDateTitle">\n    </header-canvas>\n    <header-element\n        ng-if="vm.isActiveObject(vm.SPEC_OBJECT_TYPES.ELEMENT)"\n        name="vm.name"\n        class="vm.typeClass"\n        has-parent="vm.hasParent"\n        element-parent="vm.elementParent"\n        element-parent-type="vm.elementParentType"\n        element-parent-type-class="vm.elementParentTypeClass"\n        select-element="vm.selectElement">\n    </header-element>\n    <header-group\n        ng-if="vm.isActiveObject(vm.SPEC_OBJECT_TYPES.GROUP)"\n        name="vm.name"\n        type="vm.type"\n        class="vm.typeClass"\n        has-parent="vm.hasParent"\n        element-parent="vm.elementParent"\n        element-parent-type="vm.elementParentType"\n        element-parent-type-class="vm.elementParentTypeClass"\n        select-element="vm.selectElement"\n        is-multistate="vm.isMultistate"\n        selected-state="vm.selectedState"\n        change-state="vm.changeState"\n        states="vm.states">\n    </header-group>\n    <header-design-system\n        ng-if="vm.activeElementDSInfo"\n        documentation="vm.activeElementDSInfo.documentation"\n        element="vm.activeElementDSInfo.element"\n        select-element="vm.selectElement">\n    </header-design-system>\n    <ul class="panel-tabs" ng-if="vm.metadata.length || vm.interactions.length">\n      <li ng-class="{\'active\': vm.activeTab === vm.SPEC_TABS.PROPERTIES}"\n          ng-click="vm.changeTab(vm.SPEC_TABS.PROPERTIES)">\n        <a href="#properties" class="icon-general-drop">Properties</a>\n      </li>\n      <li ng-if="vm.metadata.length"\n          ng-class="{\'active\': vm.activeTab === vm.SPEC_TABS.METADATA}"\n          ng-click="vm.changeTab(vm.SPEC_TABS.METADATA)">\n        <a href="#specification" class="icon-general-info">Specification</a>\n      </li>\n      <li ng-if="vm.interactions.length"\n          ng-class="{\'active\': vm.activeTab === vm.SPEC_TABS.INTERACTIONS}"\n          ng-click="vm.changeTab(vm.SPEC_TABS.INTERACTIONS)">\n        <a href="#interactions" class="icon-general-thunder">Interactions</a>\n      </li>\n    </ul>\n    <section class="scrolled-container">\n      <section class="scrolled-content">\n        <div class="content" ng-if="vm.activeTab === vm.SPEC_TABS.PROPERTIES">\n          <canvas-data\n            width="vm.width"\n            height="vm.height"\n            left="vm.left"\n            top="vm.top"\n            fixed="vm.fixed"\n            name="vm.name"\n            type="vm.currentObjectType"\n            angle="vm.angle"\n            opacity="vm.opacity">\n          </canvas-data>\n\n          <grid-data\n          ng-if="vm.isActiveObject(vm.SPEC_OBJECT_TYPES.CANVAS)"\n            grid="vm.grid">\n          </grid-data>\n\n          <colors-list\n            colors="vm.colors"\n            canvas-bg="vm.canvasBg"\n            gradients="vm.gradients"\n            type="vm.currentObjectType">\n          </colors-list>\n\n          <fonts-list\n            fonts="vm.fonts"\n            type="vm.currentObjectType">\n          </fonts-list>\n\n          <border-data\n            ng-if="vm.isActiveObject(vm.SPEC_OBJECT_TYPES.ELEMENT)"\n            should-show-border="vm.shouldShowBorder"\n            should-show-border-radius="vm.shouldShowBorderRadius"\n            is-border-radius-set="vm.isBorderRadiusSet"\n            border="vm.border">\n          </border-data>\n\n          <design-system\n            ng-if="vm.isActiveObject(vm.SPEC_OBJECT_TYPES.GROUP) && vm.activeElementDocumentation"\n            documentation="vm.activeElementDocumentation">\n          </design-system>\n\n          <blur-data\n            ng-if="(vm.isActiveObject(vm.SPEC_OBJECT_TYPES.ELEMENT) || vm.isActiveObject(vm.SPEC_OBJECT_TYPES.GROUP)) && vm.blur"\n            blur="vm.blur">\n          </blur-data>\n\n          <shadows-list\n            ng-if="(vm.isActiveObject(vm.SPEC_OBJECT_TYPES.ELEMENT) || vm.isActiveObject(vm.SPEC_OBJECT_TYPES.GROUP)) && vm.shadows.length"\n            shadows="vm.shadows"\n            section-label="Shadows">\n          </shadows-list>\n\n          <shadows-list\n            ng-if="(vm.isActiveObject(vm.SPEC_OBJECT_TYPES.ELEMENT) || vm.isActiveObject(vm.SPEC_OBJECT_TYPES.GROUP)) && vm.innerShadows.length"\n            shadows="vm.innerShadows"\n            section-label="Inner Shadows">\n          </shadows-list>\n\n          <css-code\n            ng-if="vm.isActiveObject(vm.SPEC_OBJECT_TYPES.ELEMENT)"\n            value="vm.cssCode">\n          </css-code>\n\n          <content-data\n            value-trimmed="vm.textContentTrimmed"\n            is-text-list="vm.isTextList">\n          </content-data>\n\n          <images-list\n            ng-if="vm.isActiveObject(vm.SPEC_OBJECT_TYPES.ELEMENT) || vm.isActiveObject(vm.SPEC_OBJECT_TYPES.CANVAS)"\n            images="vm.images"\n            background="vm.background">\n          </images-list>\n        </div>\n\n        <metadata metadata="vm.metadata" ng-if="vm.metadata.length && vm.activeTab === vm.SPEC_TABS.METADATA"></metadata>\n        <interactions ng-if="vm.interactions.length && vm.activeTab === vm.SPEC_TABS.INTERACTIONS"></interactions>\n        </section>\n      </section>\n    </section>\n  </section>\n</section>\n'),
$templateCache.put("/scripts/modules/styleguide/views/styleguide.view.html",'<div id="styleguide" ng-if="vm.isLoaded">\n  <header class="header">\n    <h2 class="name">\n      Styleguide\n      <a href="/{{vm.currentProjectHash}}" class="underline-link">\n        {{vm.currentProjectName}}\n      </a>\n    </h2>\n    <h5 ng-if="vm.lastUpdatedDate" class="last-updated">\n      Updated:\n      <time title="{{vm.lastUpdatedDateTitle}}">\n        {{vm.lastUpdatedDate}}\n      </time>\n    </h5>\n    <a href="{{vm.homepageURL}}" class="uxpin-logo" target="_blank">\n      <h2 class="icon-general-uxpin-logo only-icon-font">UXPin</h2>\n    </a>\n  </header>\n\n  <div class="content" ng-class="{empty: vm.isProjectEmpty()}">\n    <div ng-if="vm.isProjectEmpty()">\n      <figure>\n        <img src="/img/empty-styleguide.svg" width="200" height="200" />\n      </figure>\n      <h3 class="empty-title">There is nothing here, yet</h3>\n      <p class="empty-info">Styleguide is autogenerated summary for your document. Add some elements<br />to get info about <strong>colors</strong>, <strong>typography</strong> and <strong>assets</strong> used in this document.</p>\n    </div>\n    <aside ng-if="!vm.isProjectEmpty()" class="aside-nav">\n      <ul nav-bar data-initial-section="{{vm.initialSection}}" du-scroll-container="scroll-container" class="nav-list">\n        <li ng-if="vm.colors.length"><a du-scrollspy du-smooth-scroll  offset="30" href="#colors-guide">Colors</a></li>\n        <li ng-if="vm.fonts.length"><a du-scrollspy du-smooth-scroll offset="20"  href="#typography-guide">Typography</a></li>\n        <li ng-if="vm.images.length || vm.svgs.length"><a du-scrollspy du-smooth-scroll offset="60" href="#assets-guide">Assets</a></li>\n      </ul>\n    </aside>\n\n    <article ng-if="!vm.isProjectEmpty()" id="scroll-container" class="scrolled-content"  image-lazy-loading image-lazy-loading-parent-tag-name="li">\n      <colors-guide-list\n        ng-if="vm.colors.length"\n        colors="vm.colors">\n      </colors-guide-list>\n      <fonts-guide-list\n        ng-if="vm.fonts.length"\n        fonts="vm.fonts">\n      </fonts-guide-list>\n      <images-guide-list ng-if="vm.images.length || vm.svgs.length"\n        images="vm.images"\n        project-name="vm.currentProjectName"\n        svgs="vm.svgs"\n      ></images-guide-list>\n    </article>\n  </div>\n</div>\n<page-loader pages-ids="vm.pagesIds"></page-loader>\n'),$templateCache.put("/scripts/libs/uiBootstrapCustom/views/modal/window.view.html",'<section id="modalBoxWrapper" tabindex="-1" role="dialog" class="modal-box" ng-class="{\'visible\': animate}" ng-click="close($event)"> <!--ng-click="close($event)"-->\n    <section class="modal-box-wrapper">\n        <a ng-if="!isClosingBlocked" href="#" class="close-modal-button icon-general-close only-icon-font" ng-click="close($event)">Close modal</a>\n        <div modal-transclude></div>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/comments/directives/commentsAssigneeFilters/commentsAssigneeFilters.html",'<dl class="assign-filters" ng-class="{disabled: vm.isDisabled}">\n  <dt>By assignee</dt>\n  <dd>\n    <input id="show-me"\n           class="state-helper"\n           ng-click="$event.preventDefault()"\n           ng-checked="vm.isSelected(vm.me)"\n           type="checkbox" />\n    <label ng-click="vm.onSelect(vm.me)" class="fake-choose-label fake-checkbox" for="show-me">\n      Me\n    </label>\n  </dd>\n  <dd>\n    <input id="show-not-assigned"\n           class="state-helper"\n           ng-click="$event.preventDefault()"\n           ng-checked="vm.isSelected(null)"\n           type="checkbox" />\n    <label ng-click="vm.onSelect(null)" class="fake-choose-label fake-checkbox" for="show-not-assigned">\n      Not assigned\n    </label>\n  </dd>\n  <dd ng-if="vm.options.length">\n    <cloud default-position="bottom"\n           on-open="vm.onCloudOpen"\n           on-close="vm.onCloudClose"\n           offset="vm.cloudOffset"\n           auto-fit="true">\n        <input id="show-selected"\n               class="state-helper"\n               ng-click="$event.preventDefault()"\n               ng-checked="vm.isUserSelected() || vm.isAllUsersSelected()"\n               type="checkbox" />\n        <label class="fake-choose-label fake-checkbox"\n               for="show-selected"\n               ng-click="vm.onUserSelect(vm.getUsersIds(), true)"></label>\n        <div data-trigger class="with-ellipsis">\n          <span>Selected:</span>\n          <a href="#"\n             class="underline-link icon-general-chevron"\n             ng-class="{active: vm.isOpen}">\n            <span>{{vm.getLabelName()}}</span>\n          </a>\n        </div>\n      <div data-cloud class="cloud options-cloud assignee-filters-cloud">\n        <span class="selection-trigger">\n          <a href ng-class="{\'active\' : vm.isAllUsersSelected()}" ng-click="vm.onUserSelect(vm.getUsersIds())">All</a>\n          <a href ng-class="{\'active\' : !vm.isUserSelected()}" ng-click="vm.onUserSelect([])">None</a>\n        </span>\n        <div class="separator more-spacing"></div>\n        <pv-multi-select-list\n          class="list-wrapper"\n          options="vm.options"\n          key="id_user"\n          ng-model="vm.selectedUsers"\n          ng-change="vm.onUserSelect()">\n        </pv-multi-select-list>\n      </div>\n    </cloud>\n  </dd>\n</dl>\n'),$templateCache.put("/scripts/modules/comments/directives/commentsList/pvCommentsList.html",'<section id="{{::vm.listId}}" class="scrolled-content" pv-when-scroll-ends="vm.loadMoreRecords()" pv-when-height-known="vm.onHeightKnown($height)" pv-when-scroll-top="vm.unloadRecords($scrollTop)" pv-scroll-to="vm.scrollTo">\n  <preview-comment-container ng-repeat="comment in vm.visibleItems track by comment._id" type="panel" comment="comment"></preview-comment-container>\n  <section class="empty-list" ng-class="{\'hidden\' : vm.comments.length}">\n    <h1>{{::\'INFO_NO_COMMENTS\' | translate}}</h1>\n  </section>\n</section>\n'),$templateCache.put("/scripts/modules/comments/directives/commentsOtherFilters/commentsOtherFilters.html",'<dl class="other-filters">\n  <dd>\n    <input id="show-comment-pins"\n           class="state-helper"\n           ng-click="$event.preventDefault()"\n           ng-checked="vm.arePinsVisible()"\n           type="checkbox" />\n    <label ng-click="vm.togglePinsVisibility()" class="fake-choose-label fake-checkbox" for="show-comment-pins">\n      Show comment pins\n    </label>\n    <span class="hint">\n        <span class="only-icon-font icon-font-shift-key">Shift</span> + Alt + H\n    </span>\n  </dd>\n  <dd>\n    <input id="show-resolved"\n           class="state-helper"\n           ng-click="$event.preventDefault()"\n           ng-checked="vm.areResolvedCommentsVisible()"\n           type="checkbox" />\n    <label ng-click="vm.toggleResolvedCommentsVisibility()" class="fake-choose-label fake-checkbox" for="show-resolved">\n      Show resolved\n    </label>\n  </dd>\n</dl>\n'),$templateCache.put("/scripts/modules/comments/directives/commentsSearch/pvCommentsSearch.html",'<form class="search">\n  <label for="comments-list-search" class="icon-font-search only-icon-font">Search</label>\n  <input id="comments-list-search"\n         type="text"\n         ng-class="{\'active\' : vm.searchFor}"\n         placeholder="{{::\'INFO_SEARCH\' | translate}}"\n         ng-model="vm.searchFor"\n         ng-model-options="{ debounce: 300 }"\n         ng-focus="vm.handleFocus()"\n         ng-keydown="vm.handleKeyDown($event)"\n         sync-focus-with="vm.focused">\n  <span class="reset-search" ng-click="vm.resetSearch()">Reset search</span>\n</form>\n'),$templateCache.put("/scripts/modules/comments/directives/commentsTree/pvCommentsTree.html",'<section id="{{::vm.treeId}}" class="scrolled-content" pv-scroll-to="vm.scrollTarget" pv-when-scroll-ends="vm.loadMoreRecords()" pv-when-scroll-top="vm.unloadRecords($scrollTop)" pv-when-height-known="vm.onHeightKnown($height)">\n  <section ng-if="vm.showBreakpoints">\n    <section class="page-grouped-comments" ng-repeat="page in vm.visibleTree track by page.id" ng-class="{\'all-page-comments-hidden\' : vm.hiddenPages[page.id]}">\n      <h3 highlight search-for="vm.searchFor" input-text="page.name" ng-click="vm.togglePage(page.id)"></h3>\n      <section ng-if="!vm.hiddenPages[page.id]" class="page-grouped-breakpoints" ng-repeat="breakpoint in page.breakpoints track by breakpoint.id">\n        <h4 ng-bind-html="breakpoint.name"></h4>\n        <preview-comment-container ng-repeat="comment in breakpoint.comments track by comment._id" type="panel" comment="comment"></preview-comment-container>\n      </section>\n    </section>\n  </section>\n  <section ng-if="!vm.showBreakpoints">\n    <section class="page-grouped-comments" ng-repeat="page in vm.visibleTree track by page.id" ng-class="{\'all-page-comments-hidden\' : vm.hiddenPages[page.id]}">\n      <h3 highlight search-for="vm.searchFor" input-text="page.name" ng-click="vm.togglePage(page.id)"></h3>\n      <section ng-if="!vm.hiddenPages[page.id]" class="page-grouped-breakpoints" ng-repeat="breakpoint in page.breakpoints track by breakpoint.id">\n        <preview-comment-container ng-repeat="comment in breakpoint.comments track by comment._id" type="panel" comment="comment"></preview-comment-container>\n      </section>\n    </section>\n  </section>\n  <section class="empty-list" ng-class="{\'hidden\' : vm.tree.length}">\n    <h1>{{::\'INFO_NO_COMMENTS\' | translate}}</h1>\n  </section>\n</section>\n'),$templateCache.put("/scripts/modules/comments/directives/commentsTypeFilters/commentsTypeFilters.html",'<dl class="type-filters">\n  <dt>By type</dt>\n  <dd ng-repeat="option in vm.filterOptions track by $index"\n      ng-class="{\'selected\': vm.isSelected(option)}">\n    <input class="state-helper"\n           type="checkbox"\n           ng-click="$event.preventDefault()"\n           ng-checked="vm.isSelected(option)" />\n    <label ng-click="vm.changeActiveFilter(option.value)" class="fake-choose-label fake-checkbox">\n                <span class="comment-type" ng-class="option.className">\n                  {{option.text}}\n                </span>\n    </label>\n    <span class="hint">\n        <span class="only-icon-font icon-font-shift-key">Shift</span> + Alt + {{option.hint}}\n    </span>\n  </dd>\n</dl>\n'),$templateCache.put("/scripts/modules/comments/directives/preview-comment/pvComment.html",'<article class="single-comment" ng-class="{\'new-comment\' : isNew(), \'reply\' : reply, \'reply-form active\' : replyForm}">\n  <section\n    ng-if="isNew()"\n    class="comment-body"\n    ng-click="newCommentClick($event)"\n    ng-include="\'/scripts/modules/comments/directives/preview-comment/pvNewComment.html\'">\n  </section>\n\n  <div\n    ng-if="isEditMode()"\n    ng-include="\'/scripts/modules/comments/directives/preview-comment/pvEditComment.html\'">\n  </div>\n\n  <div\n    ng-if="isPreviewMode()"\n    ng-include="\'/scripts/modules/comments/directives/preview-comment/pvPreviewComment.html\'">\n  </div>\n</article>\n'),$templateCache.put("/scripts/modules/comments/directives/preview-comment/pvEditComment.html",'<pv-avatar\n  url="::avatarUrl"\n  name="::userName"\n  avatar-class="light-bg">\n</pv-avatar>\n\n<section class="comment-wrapper edit-mode">\n  <div class="comment-body edit-mode">\n    <form novalidate>\n      <div class="mention-container">\n        <textarea\n          pv-mention\n          pv-collaborator-mention\n          pv-focus-me="form.focused"\n          ng-class="{\'error\' : isError, \'disabled\' : inputDisabled}"\n          class="fake-textarea"\n          ng-model="form.text"\n          mentions="form.mentions"\n          ng-disabled="inputDisabled"\n          ng-mousedown="onTextareaMouseDown($event)"\n          ng-keydown="onTextareaKeyDown($event)"\n          placeholder="Edit your comment"></textarea>\n\n        <div\n          ng-class="{ \'visible\': $pvMention.searching }"\n          class="cloud options-cloud mention-cloud"\n          ng-style="$pvMention.menuPosition">\n\n          <ul class="mention-people-list scroll-helper">\n            <li ng-repeat="option in $pvMention.options track by $index"\n                ng-class="{\'active\': $pvMention.activeOption === option}"\n                ng-click="$pvMention.select(option)">\n              <a href="">{{option.name}}</a>\n            </li>\n            <li>\n              <span ng-if="$pvMention.options.length === 0" class="no-users disabled">\n                No users found\n              </span>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n      <ul class="submit-menu btns-group">\n        <li>\n          <button\n              type="button"\n              class="btn-solid blue add-comment"\n              ng-mousedown="submitMe($event)"\n              ng-class="{\'working\' : working}"\n              ng-disabled="inputDisabled">\n            Save\n          </button>\n        </li>\n        <li>\n          <a href="" ng-click="cancelEdit($event)">Cancel</a>\n        </li>\n      </ul>\n    </form>\n  </div>\n</section>\n\n'),$templateCache.put("/scripts/modules/comments/directives/preview-comment/pvNewComment.html",'<anonymous-name ng-if="isAnonymousWithName()"></anonymous-name>\n<form novalidate ng-class="{\'form-hidden\': isFormHidden(), \'without-footer\': isAnonymous}">\n  <div class="mention-container">\n    <textarea\n      pv-mention\n      pv-collaborator-mention\n      pv-focus-me="form.focused"\n      ng-class="{\'error\' : isError}"\n      class="fake-textarea"\n      ng-model="form.text"\n      mentions="form.mentions"\n      ng-trim="false"\n      ng-mousedown="onTextareaMouseDown($event)"\n      ng-keydown="onTextareaKeyDown($event)"\n      placeholder="{{inputPlaceholder}}"></textarea>\n\n    <div\n      ng-class="{ \'visible\': $pvMention.searching }"\n      class="cloud standard options-cloud mention-cloud"\n      ng-style="$pvMention.menuPosition">\n\n      <ul class="mention-people-list scroll-helper">\n        <li ng-repeat="option in $pvMention.options track by $index"\n            ng-class="{\'active\': $pvMention.activeOption === option}"\n            ng-click="$pvMention.select(option)">\n          <a href="">{{option.name}}</a>\n        </li>\n        <li>\n          <span ng-if="$pvMention.options.length === 0" class="no-users disabled">\n            No users found\n          </span>\n        </li>\n      </ul>\n    </div>\n  </div>\n\n  <section class="submit-menu">\n    <button\n      type="button"\n      class="btn-solid blue add-comment"\n      ng-mousedown="submitMe($event)"\n      ng-class="{\'working\' : working}">\n      {{::\'BTN_ADD_COMMENT\' | translate}}\n    </button>\n  </section>\n\n  <footer class="comment-footer" ng-if="!isAnonymous">\n    <div ng-if="isAssignmentActive" class="assign-wrapper">\n      <pv-select\n        config="assign.config"\n        options="assign.options"\n        ng-model="assign.selected"\n        ng-change="assign.onChange()"\n        on-open="onAssignOpen()">\n      </pv-select>\n    </div>\n    <div ng-if="replyForm" class="resolve-wrapper" ng-class="{\'resolved\' : parentComment.resolved.is}">\n      <pv-toggler\n        ng-model="parentComment.resolved.is"\n        title="Resolve"\n        true-label="Solved"\n        false-label="Resolve"\n        ng-change="resolveMe(parentComment.resolved.is)"></pv-toggler>\n    </div>\n  </footer>\n</form>\n'),$templateCache.put("/scripts/modules/comments/directives/preview-comment/pvPreviewComment.html",'<pv-avatar\n  url="::avatarUrl"\n  name="::userName"\n  avatar-class="light-bg">\n</pv-avatar>\n\n<section class="comment-wrapper">\n  <div class="comment-body">\n    <p>\n      <strong class="author-name">{{::comment.user.name}}:&nbsp;</strong>\n      <span highlight search-for="searchFor" input-text="previewText"></span>\n    </p>\n  </div>\n\n  <div class="comment-options">\n    <span class="time-stamp" data-timestamp="{{commentCreatedAt}}"></span>\n    <a ng-href=""\n       class="love-it icon-general-heart-outline"\n       ng-class="{\'active\' : isLoved()}"\n       ng-click="loveMe($event)"\n       title="{{getLoveIconTitle()}}">\n      <span ng-if="comment.lovers.length" data-lovers-count="{{comment.lovers.length}}"></span>\n    </a>\n  </div>\n\n  <menu class="cloud-wrapper comment-menu" data-show-node="cloud" ng-if="canEdit">\n    <a class="icon-general-cog only-icon-font"></a>\n    <ul class="cloud standard options-cloud small">\n      <li>\n        <a ng-href=""\n           class="edit"\n           ng-if="canEditContent"\n           ng-class="{\'disabled\': isEditDisabled()}"\n           ng-click="editMe($event)">\n          Edit comment\n        </a>\n        <a ng-href="" class="delete danger" ng-click="deleteMe($event)">\n          Delete comment\n        </a>\n      </li>\n    </ul>\n  </menu>\n</section>\n\n'),$templateCache.put("/scripts/modules/comments/directives/preview-comment-anonymous/preview-comment-anonymous.directive.html",'<article class="single-comment">\n  <h2>\n    Hi stranger! In order to comment<br />\n    you need first to <a ng-href="{{vm.referer}}" class="underline-link blue-link">Log in</a>.\n  </h2>\n</article>\n<article class="single-comment">\n  <p>\n    Don\'t have UXPin account? At least set your<br />\n    name so others know who you are.\n  </p>\n  <anonymous-name></anonymous-name>\n</article>\n'),$templateCache.put("/scripts/modules/comments/directives/preview-comment-container/preview-comment-container.directive.html",'<section\n  class="comments-group"\n  id="group-{{comment ? comment._id : \'new\'}}-{{type}}"\n  ng-class="classes"\n  ng-click="toggle($event)">\n\n  <section class="comment-top-bar" ng-if="!isAnonymous">\n    <pv-select\n      class="left-column"\n      link-class="comment-type"\n      ng-if="commentTypesActive"\n      options="commentType.options"\n      ng-model="commentType.selected"\n      ng-change="handleCommentTypeChange()">\n    </pv-select>\n\n    <pv-notify\n      class="right-column"\n      people="notify.people"\n      ng-model="notify.selected"\n      on-open="onNotifyOpen()"\n      on-close="onNotifyClose()">\n    </pv-notify>\n  </section>\n\n  <preview-comment-group\n    ng-if="isNew() && !isAnonymousWithoutName()"\n    type="{{type}}"\n    x="{{x}}"\n    y="{{y}}"\n    comment-type="commentType.selected"\n    notifications="notify.selected">\n  </preview-comment-group>\n\n  <preview-comment-anonymous\n    ng-if="isNew() && isAnonymousWithoutName()"\n    class="comment-anonymous"\n    x="{{x}}"\n    y="{{y}}">\n  </preview-comment-anonymous>\n\n  <preview-comment-group\n    ng-if="!isNew()"\n    type="{{type}}"\n    reply="selected"\n    group-id="groupId"\n    comment="comment"\n    comment-type="commentType.selected"\n    comment-children="children"\n    notifications="notify.selected">\n  </preview-comment-group>\n\n  <section class="deleting-info" ng-if="deleting">\n    <p>\n      {{::\'INFO_DELETED\' | translate}}\n      <a ng-href="" class="undo-delete" ng-click="onClickUndo($event)">\n        {{::\'BTN_UNDO\' | translate}}\n      </a>\n    </p>\n  </section>\n</section>\n'),$templateCache.put("/scripts/modules/comments/directives/preview-comment-group/preview-comment-group.directive.html",'<section>\n  <preview-comment-panel\n    ng-if="!isNew() && isPanel()"\n    group-id="groupId"\n    comment="comment"\n    comment-type="commentType"\n    notifications="notifications">\n  </preview-comment-panel>\n\n  <div\n    ng-if="!isNew() && isGroup() && !isCanvas() && toggler.isVisible"\n    class="toggle-replies"\n    ng-click="onTogglerClick($event)"\n    ng-class="{\'replies-hidden\': toggler.isOpen}">\n    <span class="underline-helper">{{toggler.isOpen ? \'Hide\' : commentCountInfo()}} replies</span>\n  </div>\n\n  <preview-comment-panel\n    ng-if="!isNew() && isPanel()"\n    ng-repeat="c in childrenToDisplay track by c._id"\n    group-id="groupId"\n    comment="c"\n    comment-type="commentType"\n    reply="{{reply}}"\n    notifications="notifications">\n  </preview-comment-panel>\n\n  <preview-comment-panel\n    ng-if="!isNew() && reply && isPanel() && !isAnonymousWithoutName()"\n    group-id="groupId"\n    comment-type="commentType"\n    notifications="notifications"\n    parent-id="{{comment._id}}"\n    reply-form="{{reply}}">\n  </preview-comment-panel>\n\n  <preview-comment-canvas\n    ng-if="isNew() && isCanvas()"\n    comment-type="commentType"\n    notifications="notifications"\n    x="{{x}}"\n    y="{{y}}">\n  </preview-comment-canvas>\n\n  <preview-comment-canvas\n    ng-if="!isNew() && isCanvas()"\n    group-id="groupId"\n    comment="comment"\n    comment-type="commentType"\n    notifications="notifications">\n  </preview-comment-canvas>\n\n  <div\n    ng-if="!isNew() && isGroup() && isCanvas() && toggler.isVisible"\n    class="toggle-replies"\n    ng-click="onTogglerClick($event)"\n    ng-class="{\'replies-hidden\': toggler.isOpen}">\n    <span class="underline-helper">{{toggler.isOpen ? \'Hide\' : commentCountInfo()}} replies</span>\n  </div>\n\n  <preview-comment-canvas\n    ng-if="!isNew() && isCanvas()"\n    ng-repeat="c in childrenToDisplay track by c._id"\n    group-id="groupId"\n    comment="c"\n    comment-type="commentType"\n    notifications="notifications"\n    reply="{{reply}}">\n  </preview-comment-canvas>\n\n  <preview-comment-canvas\n    ng-if="!isNew() && reply && isCanvas() && !isAnonymousWithoutName()"\n    group-id="groupId"\n    comment-type="commentType"\n    notifications="notifications"\n    group-id="groupId"\n    parent-id="{{comment._id}}"\n    reply-form="{{reply}}">\n  </preview-comment-canvas>\n\n  <preview-comment-anonymous\n      ng-if="!isNew() && reply && isCanvas() && isAnonymousWithoutName()"\n      class="comment-anonymous">\n  </preview-comment-anonymous>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/anonymousName/anonymousName.directive.html",'<section class="anonymous-login-form"\n         ng-class="vm.displayForm ? \'show-form\' : \'\'">\n  <form>\n    <input\n        type="text"\n        placeholder="Your name"\n        ng-class="{error: vm.showError}"\n        ng-model="vm.anonymousName"\n        ng-keydown="vm.onKeyDown($event)"\n        ng-change="vm.onChange()"\n        sync-focus-with="vm.displayForm"\n        required />\n    <button class="btn-solid btn-wide"\n            ng-click="vm.setName()"\n            ng-show="vm.displayBtn"\n            type="button">Save</button>\n  </form>\n  <p ng-if="vm.isAnonymousNameSet" class="anonymous-name">\n    <span class="label">Commenting as:</span>\n    <strong class="ellipsis-helper" title="{{vm.anonymousName}}">{{vm.anonymousName}}</strong>\n    <a href="#" class="underline-link" ng-click="vm.changeName($event)">Change</a>\n  </p>\n</section>'),$templateCache.put("/scripts/modules/core/directives/appViewPromo/appViewPromo.directive.html",'<section id="install-on-device" class="mobile-overlay" ng-class="{\'is-android\': isAndroid, \'is-ios\': !isAndroid}">\n    <div class="centering-container">\n        <div class="white-cloud" ng-if="!isAndroid">\n            <p>Add prototypes to your Home Screen<br>to view them  without browser toolbars.</p>\n            <p class="instruction">Tap<span class="mobile-share ios-share icon-general-ios-share only-icon-font"></span>then "Add to Home Screen"</p>\n\n            <a ng-click="close()" class="close-overlay only-icon-font icon-general-close">close</a>\n        </div>\n        <div class="white-cloud" ng-if="isAndroid">\n            <p>Add prototypes to your Home Screen<br>to view them  without browser toolbars.</p>\n            <p class="instruction">Tap<span class="mobile-share android-share icon-general-ellipsis only-icon-font"></span>then "Add to Home Screen"</p>\n\n            <a ng-click="close()" class="close-overlay only-icon-font icon-general-close">close</a>\n        </div>\n    </div>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/avatar/pvAvatar.html",'<figure class="user-avatar {{ avatarClass }}" >\n  <img ng-src="{{ vm.getUserAvatar() }}" alt="">\n  <strong class="initials" ng-if="!vm.url">{{ vm.initials }}</strong>\n</figure>'),$templateCache.put("/scripts/modules/core/directives/breakpoints/pvBreakpoints.html",'<cloud ng-if="vm.areBreakpointsVisible"\n       on-open="vm.onCloudOpen"\n       on-close="vm.onCloudClose"\n       default-position="bottom"\n       auto-close="{{true}}">\n  <a href="#actions" ng-class="{active: vm.isOpen}"  class="breakpoints-trigger icon-general-chevron" data-trigger>\n    <span>{{vm.getActiveBreakPoint().name}}</span>\n  </a>\n\n  <div data-cloud class="cloud options-cloud brakepoints-cloud">\n    <ul class="options-list scroll-ready">\n      <li ng-repeat="breakpoint in vm.breakpoints track by breakpoint.id">\n        <a ng-class="{\'active\' : vm.isActive(breakpoint.id)}"\n           ng-click="vm.onClick(breakpoint.id)"\n           class="icon-general-live-presentation"\n           title="{{breakpoint.name}}">\n          {{breakpoint.name}}\n        </a>\n      </li>\n\n    </ul>\n    <form class="separator" ng-if="!vm.isUTSession && !vm.isLiveSession">\n      <input ng-model="vm.isResponsive" ng-change="vm.onResponsive()" type="checkbox" id="auto-set-brakepoints" class="state-helper" value="on">\n      <label class="fake-choose-label fake-checkbox inside-cloud" for="auto-set-brakepoints">Auto set breakpoints</label>\n    </form>\n  </div>\n</cloud>\n'),$templateCache.put("/scripts/modules/core/directives/cloud/cloud.html","<div ng-transclude></div>\n"),$templateCache.put("/scripts/modules/core/directives/codeEditor/codeMirror.html","<textarea></textarea>\n"),$templateCache.put("/scripts/modules/core/directives/controls/pvToggler.html",'<a ng-href="" class="mark-resolved icon-general-ticker" title="{{title}}"></a>'),$templateCache.put("/scripts/modules/core/directives/imageDownloader/imageDownloader.html",'<form action="/api/utils/image/download" method="post">\n  <input type="hidden" name="name" value="{{name}}" />\n  <input type="hidden" name="content" value="{{content}}" />\n  <input type="hidden" name="type" value="{{type}}" />\n</form>\n'),$templateCache.put("/scripts/modules/core/directives/input/inputMinMax.view.html",'<input\n  type="text"\n  ng-focus="vm.handleFocus($event)"\n  ng-blur="vm.handleBlur($event)"\n  ng-keydown="vm.handleKeyDown($event)"\n  ng-model="vm.model"\n  class="ds-input__field ds-input__field--size-s ds-input__field--weight-light"\n/>\n'),$templateCache.put("/scripts/modules/core/directives/layers/layersList.view.html",'<section id="layers-list" class="layers-list scrolled-content">\n  <script type="text/ng-template" id="layer_node_template.html">\n    <input ng-if="node.isGroup" type="checkbox" id="expand-group-elements-{{::node.id}}" ng-click="vm.toggleExpandStatus($event, node.id)"  class="state-helper expander-state-helper">\n    <label ng-if="node.isGroup" for="expand-group-elements-{{::node.id}}" class="group-expander only-icon-font icon-general-expander">Expand group elements</label>\n\n    <div class="layer-item" draggable="true">\n      <span class="layer-name" title="{{::node.name}}">\n        <span class="layer-name-helper">{{::node.name}}</span>\n      </span>\n      <fieldset class="visibility-state-helper">\n        <input type="checkbox" id="{{::node.name}}" class="state-helper">\n        <label ng-click="vm.toggleVisibility($event, node)" class="only-icon-font icon-general-visibility" for="{{::node.name}}" title="Hide element"></label>\n      </fieldset>\n    </div>\n\n    <ul ng-if="node.children && node.children.length && vm.expandStatus[node.id]" class="branch">\n        <li\n            ng-mouseover="vm.onMouseEnter($event, node)"\n            ng-mouseout="vm.onMouseLeave($event,node)"\n            ng-click="vm.select($event, node)"\n            ng-class="{\'group\': node.isGroup, \'selected\': vm.isSelected(node.id), \'hidden\': vm.isHidden(node.id)}"\n            class="{{::vm.getListItemClassByType(node.type)}}"\n            ng-repeat="node in node.children track by node.id"\n            ng-include="\'layer_node_template.html\'">\n        </li>\n    </ul>\n  </script>\n\n  <ul>\n    <li\n      ng-class="{\'group\': node.isGroup, \'selected\': vm.isSelected(node.id), \'hidden\': vm.isHidden(node.id)}"\n      class="{{::vm.getListItemClassByType(node.type)}}"\n      ng-click="vm.select($event, node)"\n      ng-mouseover="vm.onMouseEnter($event,node)"\n      ng-mouseout="vm.onMouseLeave($event,node)"\n      ng-repeat="node in vm.collection track by node.id"\n      ng-include="\'layer_node_template.html\'">\n    </li>\n  </ul>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/mediaAccessTip/mediaAccessTip.directive.html",'<section ng-class="{\'visible\': isTipVisible, \'denied\': isDenied}" class="warning-tooltip">\n    <p ng-if="!isDenied">\n      UXPin needs <strong>access to your microphone and camera</strong> to record audio or to embed a camera feed.\n    </p>\n    <p ng-if="isDenied">\n      You have denied access. You are not able to record Usability testing. <strong>Change your browser settings.</strong>\n    </p>\n\n    <a ng-click="onClickClose()" class="icon-general-close only-icon-font close-info">close info</a>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/notify/pvNotify.html",'<div class="notify-wrapper">\n  <a ng-href="" class="icon-general-chevron" ng-class="{\'active\': vm.isOpen}" ng-click="vm.toggle()">\n    <span class="underline-helper">\n      <span class="label">Notify:</span>\n      <span class="ellipsis-helper">{{vm.selected.length | notifyLabel:vm.filters}}</span>\n    </span>\n  </a>\n\n  <section ng-if="vm.isOpen" class="cloud big standard notify-users options-cloud visible">\n    <span class="selection-trigger">\n      <a\n        href=""\n        id="select-all"\n        ng-class="{\'active\': vm.filters.all}"\n        ng-click="vm.selectAll()">\n        All</a>\n       <a\n         href=""\n         id="select-project-members"\n         ng-class="{\'active\': vm.filters.projectMembers}"\n         ng-click="vm.selectProjectMembers()">\n        Project members</a>\n      <a\n        href=""\n        id="select-none"\n        ng-class="{\'active\': vm.filters.none}"\n        ng-click="vm.selectNone()">\n        None</a>\n    </span>\n\n    <pv-multi-select-list\n      class="list-wrapper"\n      options="vm.people"\n      scroll-to-bottom="vm.scrollToBottom"\n      ng-model="vm.selected"\n      ng-change="vm.updateFilters()">\n    </pv-multi-select-list>\n\n    <textarea\n      class="dark-style"\n      cols="30"\n      rows="3"\n      placeholder="Not on the list? Add email address and send notification"\n      ng-model="vm.customEmails"\n      ng-keydown="$event.stopPropagation()"\n      pv-enter="vm.onTextareaEnter()"\n      pv-emails-parser=",">\n    </textarea>\n  </section>\n</div>\n'),$templateCache.put("/scripts/modules/core/directives/preview-pin/preview-pin.directive.html",'<section class="comment-point pin"\n         ng-class="classes"\n         ng-dblclick="onDblclick($event)"\n         ng-style="getCommentPointStyle()">\n\n    <section class="comment-pin" ng-mousedown="startDrag($event)" ng-mouseup="endDrag($event)" toggleable>{{index}}</section>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/progressBar/pvProgressBar.html",'<div class="progressbar static with-percentage">\n    <span class="progress" ng-style="{ width: (value < 100 ? value : 100) + \'%\'}"></span>\n    <span class="percentages" ng-transclude></span>\n</div>\n'),$templateCache.put("/scripts/modules/core/directives/screencastify/pvScreencastifyRecorder.html",'<ul class="ut-recorder">\n  <li class="tab-button wide with-spacing"\n      ng-if="!vm.isRecording"\n      ng-click="vm.startRecording()">\n    Start recording\n  </li>\n  <li class="tab-button recording with-spacing"\n      ng-if="vm.isRecording">\n    Recording {{ vm.duration | timer }}\n  </li>\n</ul>\n'),
$templateCache.put("/scripts/modules/core/directives/search/pvSearch.html",'<form class="search-form">\n  <label class="icon-general-search only-icon-font" for="search-form-generic">\n    {{vm.config.label}}\n  </label>\n  <input\n    id="search-form-generic"\n    class="with-icon old-input"\n    type="text"\n    autocomplete="off"\n    placeholder="{{vm.config.placeholder}}"\n    ng-model="vm.searchValue"\n    ng-keyup="vm.search()"\n    ng-keydown="$event.stopPropagation()"/>\n  <button\n    class="icon-general-close only-icon-font"\n    type="reset"\n    ng-click="vm.resetSearch()">\n    Clear\n  </button>\n</form>'),$templateCache.put("/scripts/modules/core/directives/select/pvMultiSelectList.html",'<div ng-transclude></div>\n\n<form class="search-form">\n  <label class="icon-general-search only-icon-font" for="search-form-generic">Search for the user...</label>\n  <input\n      id="search-form-generic"\n      class="with-icon old-input"\n      type="text"\n      placeholder="Type to search..."\n      ng-model="vm.searchValue"\n      ng-keyup="vm.search()"\n      ng-keydown="$event.stopPropagation()"/>\n  <button class="icon-general-close only-icon-font" type="reset" ng-click="vm.resetSearch()">Clear</button>\n</form>\n\n<ul class="checkbox-list" pv-scroll-to-bottom="scrollToBottom">\n  <li class="fake-checkbox-with-image" ng-repeat="option in vm.filteredOptions track by $index">\n    <form>\n      <input type="checkbox" id=user_{{$index}} class="state-helper" ng-model="option.checked" ng-change="vm.select(option)">\n      <label class="fake-choose-label fake-checkbox inside-cloud" for=user_{{$index}}>\n        <figure class="user-avatar">\n          <pv-avatar url="option.avatar" name="option.name"></pv-avatar>\n          <figcaption>{{option.name}}</figcaption>\n        </figure>\n      </label>\n    </form>\n  </li>\n</ul>\n'),$templateCache.put("/scripts/modules/core/directives/select/pvSelect.html",'<menu class="cloud-wrapper" ng-class="{ \'cloud-disabled\': vm.disabled }">\n  <a class="icon-general-chevron {{vm.selectedOption.className + \' \' + linkClass}}"\n     ng-class="{\'active\' : vm.isDropdownOpen}"\n     ng-click="vm.toggleDropdown()"\n     ng-include="\'/scripts/modules/core/directives/select/inputTpl/\' + vm.config.inputTpl">\n  </a>\n\n  <section\n    id="{{vm.config.cloudId}}"\n    ng-if="!vm.config.disabled"\n    class="cloud standard options-cloud"\n    ng-class="{\'visible\' : vm.isDropdownOpen}">\n\n    <span ng-if="vm.config.deselect" class="selection-trigger separator bottom more-spacing">\n      <a href="" ng-click="vm.deselectOption()">{{vm.config.deselectLabel}}</a>\n    </span>\n\n    <pv-search\n      ng-if="vm.config.withSearch"\n      config="vm.config.search"\n      options="vm.options"\n      on-search="vm.onSearch(filteredOptions)"\n      on-reset="vm.onReset()">\n    </pv-search>\n\n    <ul class="scroll-helper options-list">\n      <li\n        ng-repeat="option in vm.filteredOptions track by $index"\n        ng-class="{\'selected\': option === vm.selectedOption}"\n        ng-click="vm.selectOption(option)"\n        ng-include="\'/scripts/modules/core/directives/select/optionTpl/\' + vm.config.optionTpl">\n      </li>\n    </ul>\n    <div class="separator" ng-transclude pv-hide-empty></div>\n  </section>\n</menu>\n'),$templateCache.put("/scripts/modules/core/directives/select/pvSingleSelectList.html",'<pv-search\n  ng-if="vm.config.withSearch"\n  config="vm.config.search"\n  options="vm.options"\n  on-search="vm.onSearch(filteredOptions)"\n  on-reset="vm.onResetSearch()">\n</pv-search>\n\n<ul class="scroll-helper options-list">\n  <li\n    ng-repeat="option in vm.filteredOptions track by $index"\n    ng-class="{\'selected\': option === vm.selectedOption}"\n    ng-click="vm.selectOption(option)"\n    ng-include="\'/scripts/modules/core/directives/select/optionTpl/\' + vm.config.optionTpl">\n  </li>\n</ul>\n'),$templateCache.put("/scripts/modules/core/directives/shortcut/pvShortcut.html",'<small>\n  <span\n    class="custom-color"\n    ng-repeat="key in vm.keys track by $index"\n    ng-class="key.className">\n    {{key.alt}}\n  </span>\n</small>\n'),$templateCache.put("/scripts/modules/core/directives/updateInfo/updateInfo.html",'<section id="modal-box-update-info" class="visible dialogbox-container modal-box-update-info">\n  <a ng-click="closeModal($event)" class="close-modal-button icon-general-close only-icon-font">{{::\'UM_CLOSE_MODAL\'|translate}}</a>\n  <ng-include src="content" class="modal-box-content"></ng-include>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/videoStream/videoStream.html",'<section ng-if="vm.isUsabilityTestingSession" ng-show="vm.isHost" class="streaming-video" id="publisher"></section>\n<section ng-if="vm.isUsabilityTestingSession" ng-show="vm.isHost" class="streaming-video" id="subscribers">\n  <div class="waiting-for-transmission working" ng-if="vm.isMessageVisible">\n    <p>{{vm.message}}</p>\n  </div>\n</section>'),$templateCache.put("/scripts/modules/core/directives/zoom/zoom.view.html",'<ul class="zoom" ng-class="{active: vm.isZoomActive}" ng-click="vm.handleZoomFocus()">\n  <li class="default">\n    <fieldset class="with-unit" data-unit="%">\n      <div class="ds-input ds-input--zoom-control with-icon-on-right ds-icon--size-s ds-input--element-property ds-input--dark-version-available"><input-min-max values="vm.ZOOM_VALUES" min-value="vm.MIN_VALUE" max-value="vm.MAX_VALUE" model="vm.zoom"></input-min-max></div>\n    </fieldset>\n  </li>\n  <li class="zoom-in">\n    <a\n      href="#"\n      class="btn-icon icon-general-plus"\n      ng-mousedown="vm.handleMouseDownZoomIn()"\n      ng-click="vm.handleClick($event)">+</a>\n  </li>\n  <li class="zoom-out">\n    <a\n      href="#"\n      class="btn-icon icon-general-minus"\n      ng-mousedown="vm.handleMouseDownZoomOut()"\n      ng-click="vm.handleClick($event)">-</a>\n  </li>\n</ul>\n'),$templateCache.put("/scripts/modules/core/views/liveShare/configuration.view.html",'<section id="live-share-settings" class="modal-box-content">\n    <article>\n        <h2>Live Presentation</h2>\n        <section class="session-settings standard-list-container options-list">\n            <h3>Session settings</h3>\n            <ul>\n                <li ng-repeat="option in liveShareOptions">\n                    <input id="initial-config-{{$index}}" class="state-helper" ng-model="option.value" type="checkbox" checked>\n                    <label for="initial-config-{{$index}}" class="fake-choose-label fake-checkbox">{{option.name}}</label>\n                </li>\n            </ul>\n        </section>\n        <h3>Link to session</h3>\n        <div ng-class="{\'working\': !inviteUrl}" class="invite-link-container no-button">\n            <input ng-click="onClickLink($event)" type="text" readonly ng-model="inviteUrl">\n        </div>\n        <button ng-click="start()" class="btn-solid blue">Start live session</button>\n    </article>\n    <aside>\n\n    </aside>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/liveShare/finish.view.html",'<section class="live-share-landing full-page-landing visible">\n    <div class="centering-block" ng-switch="type">\n        <h1 class="icon-general-uxpin-logo only-icon-font">UXPin</h1>\n\n        <h2 translate translate-values="{\'projectName\': projectName}">{{message}}</h2>\n        <a ng-href="#" ng-if="backUrl" ng-click="onClickBackToPreview($event)" class="back-to-preview">{{ ::\'LS_BACK_TO_PREVIEW\' | translate }}</a>\n    </div>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/liveShare/initialize.view.html",'<section class="live-share-landing full-page-landing with-input visible">\n  <div class="centering-block">\n    <h1 class="icon-general-uxpin-logo only-icon-font">UXPin</h1>\n    <pv-progress-bar ng-if="!loginUrl" value="loadingProgress"></pv-progress-bar>\n\n    <h2>Loading <strong>{{::projectName}}</strong> {{::sessionTypeName|translate}}.</h2>\n    <form name="setNameForm" ng-if="loginUrl" ng-submit="onFormSubmit(name)">\n      <fieldset>\n        <p>My name is</p>\n        <input required autofocus type="text" ng-model="name" name="name"><em>*</em>\n        <button ng-disabled="setNameForm.$invalid" type="submit" class="btn-solid blue" ng-class="{\'working\': working}">That\'s me</button>\n        <small class="tip">* To join {{::projectName}} live preview session you need to set your name.</small>\n      </fieldset>\n    </form>\n  </div>\n  <section ng-if="loginUrl" class="login-toolbar bottom visible">Are you registered UXPin user? <a href="{{loginUrl}}">Please login</a>.</section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/approvalProcess/accept.view.html",'<section id="approval-process-modal-box" class="modal-box-content">\n  <article>\n    <h2>{{ vm.approvalLabel }} Design</h2>\n    <textarea ng-model="vm.feedback" placeholder="You can add some optional feedback to explain your decision"></textarea>\n    <ul class="btns-group">\n      <li>\n        <a href="" class="gray-style cancel-button action-close" ng-click="vm.closeModal($event)">Cancel</a>\n      </li>\n      <li>\n        <button type="button" class="btn-solid btn-wide blue" ng-click="vm.sendApproval()">{{ vm.approvalLabel }}</button>\n      </li>\n    </ul>\n  </article>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/approvalProcess/approvalProcessControls.view.html",'<ul class="btns-group options-list approval-process-controls" ng-if="vm.approvalData.isActive()">\n  <li class="separator"></li>\n  <li ng-if="vm.approvalData.isPending() || vm.approvalData.isApproved()">\n    <button type="button"\n            class="btn-ghost green with-icon icon-general-ticker"\n            ng-click="vm.approvalButtonClick(true, $event)"\n            ng-class="{disabled: !vm.approvalData.isPending()}">\n      <span>{{vm.approvalData.getApproveLabel()}}</span>\n    </button>\n  </li>\n  <li ng-if="vm.approvalData.isPending() || vm.approvalData.isRejected()">\n    <button type="button"\n            class="btn-ghost red with-icon icon-general-close"\n            ng-click="vm.approvalButtonClick(false, $event)"\n            ng-class="{disabled: !vm.approvalData.isPending()}">\n      <span>{{vm.approvalData.getRejectLabel()}}</span>\n    </button>\n  </li>\n</ul>\n'),$templateCache.put("/scripts/modules/core/views/approvalProcess/review.view.html",'<section id="approval-process-modal-box" class="modal-box-content info updated">\n  <article>\n    <h2>Design updated</h2>\n    <figure>\n      <img width="185" height="149" src="/img/design-updated.svg" alt="Design updated">\n    </figure>\n    <p>\n      Thanks for your previous feedback. The design has been revised. Please review the changes. Once again, you can either approve or reject it.\n    </p>\n    <ul class="btns-group">\n      <li>\n        <button type="button" class="btn-solid btn-wide blue" ng-click="vm.closeModal()">Review changes</button>\n      </li>\n    </ul>\n  </article>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/approvalProcess/welcome.view.html",'<section id="approval-process-modal-box" class="modal-box-content info welcome">\n  <article>\n    <h2>Design approval request</h2>\n    <figure>\n      <img src="/img/review-design.png" srcset="/img/review-design-@2x.png 2x, /img/review-design.png 1x" alt="Design approval request">\n    </figure>\n    <p>\n      Please review the following design. You can either approve it or reject it using the buttons in the top right corner. Youll also be able to leave additional comments afterward.\n    </p>\n    <ul class="btns-group">\n      <li>\n        <button type="button" class="btn-solid btn-wide blue" ng-click="vm.closeModal()">Got it</button>\n      </li>\n    </ul>\n  </article>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/planUpgrade/modal.view.html",'<section id="liveshare-dialogbox" class="visible dialogbox-container with-video modal-box-content">\n    <section class="movie-part">\n        <h2 class="icon-general-uxpin-logo only-icon-font">UXPin</h2>\n\n        <a ng-click="closeMovie($event)" class="close-movie action-close-movie">{{::\'UM_CLOSE_MOVIE\'|translate}}</a>\n\n        <figure class="movie-cover">\n            <img width="394px" height="400px" src="/img/welcome-modal-pic.jpg" alt="">\n        </figure>\n\n        <youtube-video video-id="video.id" player="video.player" class="movie-container"></youtube-video>\n    </section>\n    <section class="content-part">\n        <h2 translate>{{::\'UM_MODAL_HEADER\'|translate}}</h2>\n\n        <p>{{::\'UM_MODAL_TEXT\'|translate}}</p>\n\n        <a ng-click="closeModal($event)" class="close-modal-button icon-general-close only-icon-font close-movie action-close-movie">{{::\'UM_CLOSE_MODAL\'|translate}}</a>\n\n        <a ng-click="playMovie($event)" class="btn-ghost btn-inline icon-general-play with-icon action-close-dialogbox show-me">{{::\'UM_HOW_IT_WORKS\'|translate}}</a>\n\n        <p class="small-tip"><span class="pro-label">{{::\'UM_TEAM\'|translate}}</span> {{::\'UM_TEAM_TEXT\'|translate}}\n          <a ng-click="upgradePlan($event)" href="{{upgradePlanURL}}" class="btn-solid blue upgrade-now">\n            {{::\'UM_UPGRADE_NOW\'|translate}}\n          </a>\n        </p>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/planUpgrade/modalUpgrade.view.html",'<iframe ng-src={{getUpgradeUrl()}} frameBorder="0" />'),$templateCache.put("/scripts/modules/core/views/usabilityTest/introduction.view.html",'<section id="user-testing-wizard" class="modal-box-content wizard subject-welcome" ng-if="!isActiveStep(4)">\n    <article class="wizard-content">\n        <div class="steps">\n            <section class="step" ng-class="{\'active\': isActiveStep(1)}">\n                <h2>Welcome to <strong>{{params.projectName}}</strong> Usability Testing </h2>\n                <section class="agreement" ng-bind-html="params.introduction"></section>\n                <section class="wizard-pagination">\n                    <div class="agreement-checkbox">\n                        <input id="agreement" class="state-helper" type="checkbox" ng-model="params.agreement">\n                        <label for="agreement" class="fake-choose-label fake-checkbox">I grant permission to record this session</label>\n                    </div>\n                    <button ng-disabled="!params.agreement" ng-click="onClickNextStep(2)" class="btn-solid next">Next: <b>Tasks</b></button>\n                </section>\n            </section>\n\n            <section class="step" ng-class="{\'active\': isActiveStep(2)}">\n                <h2>Tasks list</h2>\n\n                <ul class="tasks-list" ng-controller="UsabilityTestTasksController">\n                    <li ng-repeat="task in params.tasks">\n                        <h3><span>Task {{$index + 1}}:</span>{{task.title}}</h3>\n                        <p ng-bind-html="task.content"></p>\n                    </li>\n                </ul>\n\n                <section class="wizard-pagination">\n                    <button ng-disabled="!params.agreement" ng-click="onClickNextStep(3)" class="btn-solid next">Next: <b>Set camera</b></button>\n                </section>\n            </section>\n\n            <section class="step camera-setup" ng-class="{\'active\': isActiveStep(3)}">\n                <h2>Set your face inside camera area</h2>\n                <section class="camera-access-info icon-general-mic-line-on" ng-class="{\'hidden\' : params.answerVideo}">\n                    <p>Google Chrome needs access to your <strong>microphone</strong> and <strong>camera</strong> <br>to record audio or to embed a camera feed.</p>\n                    <p>Please give access to start recording.</p>\n                </section>\n\n                <section class="camera-access-info icon-general-mic-line-on denied hidden" ng-class="{\'hidden\' : !params.blockVideo}">\n                    <p>You rejected giving media access. Recording usability test wouldn\'t be available.</p>\n\n                    <!-- <p><a href="#">Learn</a> how to enable media access.</p> -->\n                </section>\n\n                <capture-video ng-if="isActiveStep(3)" width="750" height="250"></capture-video>\n\n                <section class="wizard-pagination">\n                    Ready? <button ng-disabled="!params.answerVideo" ng-click="onClickStartSession()" class="btn-solid next">Start session!</button>\n                </section>\n            </section>\n        </div>\n    </article>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/usabilityTest/pluginConfirm.view.html",""),$templateCache.put("/scripts/modules/core/views/usabilityTest/screencastifyDownload.view.html",'<section id="user-testing-plugin" class="modal-box-content" ng-if="::vm.isChrome">\n  <article>\n    <h2>Screencastify extension for Chrome</h2>\n\n    <p>\n      If you want to create Usability Testing session, you need to install Chrome extension. <br>Please go to Chrome Web Store to install it.\n    </p>\n\n    <section class="plugin-false" ng-if="!vm.isInstalled">\n      <a ng-href="{{::vm.downloadURL}}"\n         class="btn-solid blue"\n         ng-click="vm.verifyInstallation()"\n         target="_blank">\n        Install extension from Chrome Web Store\n      </a>\n      <a ng-href="{{::vm.helpPageURL}}" target="_blank" class="help">Need help with plugin installation?</a>\n    </section>\n\n    <section class="plugin-true" ng-if="vm.isInstalled">\n      <div class="extension-installed">Extension installed!</div>\n      <button class="btn-solid" ng-click="vm.createUsabilityTest($event)">Create usability test</button>\n    </section>\n  </article>\n</section>\n<section id="user-testing-plugin" class="modal-box-content not-avaible" ng-if="::!vm.isChrome">\n  <article>\n    <h2>You need Chrome!</h2>\n    <p>Currently UXPin Usability Testing Beta is supported only by Google Chrome browser. You can download Google Chrome browser <a href="https://www.google.com/intl/en/chrome/browser/" target="_blank">here</a>, and Usability Testing plugin <a ng-href="{{::vm.downloadURL}}" target="_blank">here</a>.</p>\n    <p>Enjoy your test!</p>\n  </article>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/usabilityTest/videoUpload.view.html",'<section class="live-share-landing full-page-landing visible">\n  <div class="centering-block" ng-switch="vm.uploadState">\n    <h1 class="icon-general-uxpin-logo only-icon-font">UXPin</h1>\n    <h2>You left {{::vm.projectName}} session.</h2>\n\n    <div class="content" ng-switch-when="uploading">\n      <p>The recording is being uploaded to project\'s dashboard. Please don\'t close this tab.</p>\n      <pv-progress-bar value="vm.uploadProgress">{{vm.uploadProgress + \'%\'}}</pv-progress-bar>\n    </div>\n    <div class="content" ng-switch-when="error">\n      <p>The recording is being uploaded to project\'s dashboard. Please don\'t close this tab.</p>\n      <section class="error-message">\n        <p>Sorry, something went wrong</p>\n        <p class="btns">\n          <a class="underline-link blue-link icon-general-revert" ng-click="vm.retry()" type="button">Retry</a>\n          or\n          <a class="underline-link blue-link icon-general-exit" ng-href="{{::vm.downloadURL}}" download="{{::vm.videoName}}">Download</a>\n        </p>\n      </section>\n    </div>\n    <div class="content" ng-switch-when="uploaded">\n      <p>File uploaded successfully. <a ng-href="{{::vm.dashboardURL}}" class="underline-link blue-link">Back to dashboard</a>.</p>\n    </div>\n  </div>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/usabilityTest/wizard.view.html",'<section id="user-testing-wizard" class="modal-box-content wizard">\n    <article ng-if="!isActiveStep(4)">\n        <h2>Create usability test: {{params.projectName}}</h2>\n\n        <ul class="wizard-breadcrumbs">\n            <li ng-repeat="step in getStepsWithBreadcrumbs()" ng-class="{\'active\': isActiveStep($index), \'completed\': $index < params.activeStepIndex}">\n                <span class="step-count">{{$index+1}}</span>\n                <span class="step-label">{{step.label}}</span>\n            </li>\n        </ul>\n\n        <section class="wizard-content" id="wizard-content">\n            <div novalidation class="step step-1" ng-class="{\'active\': isActiveStep(0)}" ng-form="forms.step0">\n                <textarea required ng-model="params.steps[0].introduction"></textarea>\n            </div>\n\n            <section class="step step-2" ng-class="{\'active\': isActiveStep(1)}" ng-form="forms.step1">\n                <ul>\n                    <li class="task-container" ng-repeat="task in getStep(1).tasks" ng-class="{\'visible\': !task.deleting}">\n                        <header class="title">\n                            <label for="task-{{$index}}">Task {{$index + 1}}:</label>\n                            <input required type="text" id="task-{{$index}}" ng-model="task.title">\n                            <a ng-href="#" ng-click="onClickDeleteTask($event, $index)" class="icon-general-trash only-icon-font delete"><span class="tooltip small-style">Delete this task</span></a>\n                        </header>\n                        <textarea required ng-model="task.content"></textarea>\n                    </li>\n                    <li class="task-container visible">\n                        <header class="title">\n                            <label for="new-task-title">Task {{getStep(1).tasks.length + 1}}:</label>\n                            <input required autofocus type="text" id="new-task-title" ng-model="getStep(1).newTask.title" placeholder="Enter task name">\n                            <a ng-if="getStep(1).tasks.length || getStep(1).newTask.title || getStep(1).newTask.content" ng-href="#" ng-click="onClickDeleteTask($event)" class="icon-general-trash only-icon-font delete"><span class="tooltip small-style">Delete this task</span></a>\n                        </header>\n                        <textarea required ng-model="getStep(1).newTask.content" placeholder="Enter task description"></textarea>\n                    </li>\n                </ul>\n            </section>\n\n            <section class="step step-3" ng-class="{\'active\': isActiveStep(2)}" ng-form="forms.step2">\n                <section class="standard-list-container options-list-container">\n                    <ul>\n                        <li ng-repeat="option in getStep(2).options">\n                            <input id="option-{{$index}}" class="state-helper" type="checkbox" ng-model="option.value">\n                            <label for="option-{{$index}}" class="fake-choose-label fake-checkbox">{{option.name}}</label>\n                        </li>\n                        <li >\n                            <input id="breakpoint-enable-option" class="state-helper" type="checkbox" ng-model="getStep(2).breakpoints.enabled">\n                            <label for="breakpoint-enable-option" class="fake-choose-label fake-checkbox">{{getStep(2).breakpoints.name}}</label>\n                        </li>\n                    </ul>\n                    <ul class="breakpoints-list">\n                        <li ng-repeat="breakpoint in getStep(2).breakpoints.list" ng-class="{\'inactive\': !getStep(2).breakpoints.enabled}">\n                            <input id="breakpoint-option-{{$index}}" class="state-helper" ng-disabled="!getStep(2).breakpoints.enabled" type="checkbox" ng-model="breakpoint.value">\n                            <label for="breakpoint-option-{{$index}}" class="fake-choose-label fake-checkbox" ng-bind-html="breakpoint.name"></label>\n                        </li>\n                    </ul>\n                </section>\n            </section>\n\n            <div class="step step-4" ng-class="{\'active\': isActiveStep(3)}" ng-form="forms.step3">\n                <div class="invite-link-container no-button" ng-class="{\'working\': !getStep(3).inviteURL}">\n                    <input type="text" readonly id="invite-link" ng-click="onClickInput($event)" ng-model="getStep(3).inviteURL" class="url-input">\n                    <button ngclipboard data-clipboard-text={{getStep(3).inviteURL}} ngclipboard-success="onCopySuccess()" class="copy-link icon-font-link only-icon-font btn-bordered small-size light-gray-style">{{::\'LS_COPY\' | translate}}</button>\n                    <span class="information" ng-class="{\'visible\': params.isCopied}">{{::\'LS_LINK_HAS_BEEN_COPIED\' | translate}}</span>\n                </div>\n                <label for="invite-link">Invite by sending a link</label>\n            </div>\n        </section>\n\n        <section class="wizard-pagination">\n            <button class="btn-ghost blue prev"\n                    ng-if="params.activeStepIndex > 0"\n                    ng-click="onClickPrevStep()">\n                Back to: {{getStep(\'prev\').label}}\n            </button>\n\n            <button class="btn-solid blue next"\n                    ng-if="params.activeStepIndex < params.steps.length - 1"\n                    ng-disabled="getStepFormObject().$invalid"\n                    ng-click="onClickNextStep()">\n                <strong>Next:</strong> {{getStep(\'next\').label}}\n            </button>\n\n\t\t\t<button class="fake-link icon-general-plus add-task"\n\t\t\t   ng-if="params.activeStepIndex == 1"\n\t\t\t   ng-disabled="getStepFormObject().$invalid"\n\t\t\t   ng-click="onClickAddNewTask(params.steps[1].newTask)">\n                Add another task\n            </button>\n        </section>\n\n    </article>\n\n    <article class="final-step" ng-if="isActiveStep(4)">\n        <h2>Usability testing is ready to be launched!</h2>\n        <button ng-class="{\'waiting\': params.loading}"\n                class="btn-solid big btn-inline"\n                ng-click="onClickSessionStart()">Start session!</button>\n    </article>\n</section>\n'),$templateCache.put("/scripts/modules/documentation/directives/annotationsList/annotationsList.html",'<div class="annotations-list">\n  <div class="annotation"\n       ng-repeat="annotation in vm.data track by $index"\n       ng-attr-id="{{vm.isPinnedToElement(annotation) ? vm.idPrefix + annotation.idElement : \'\'}}"\n       ng-class="{\n          \'active\': vm.isSelected(annotation),\n          \'hovered\': vm.isHovered(annotation),\n          \'no-pin-hover\': vm.hasBlockedHover(annotation),\n          \'pinned\': vm.isPinnedToElement(annotation)\n          }"\n       ng-mouseenter="vm.onMouseEnter($event, annotation)"\n       ng-mouseleave="vm.onMouseLeave($event, annotation)">\n    <span class="annotation-pin pinned"\n          ng-if="vm.isPinnedToElement(annotation)"\n          ng-click="vm.selectAnnotation($event, annotation)">{{annotation.idPin}}</span>\n    <div class="custom-text-field" ng-bind-html="annotation.content | parseUrl"></div>\n  </div>\n</div>\n\n'),$templateCache.put("/scripts/modules/specification/directives/blurData/blurData.html",'<section class="canvas-size data-section">\n  <h3 class="section-title">\n    <span class="ellipsis-helper">Blur</span>\n  </h3>\n  <div class="data">\n    <div class="double-ul-column">\n      <ul class="canvas-data-list">\n        <li>\n          <h5 class="narrow">Radius</h5>\n          <p class="code allow-copying" clipboard-copy data-clipboard-text="{{vm.blur | unit}}">\n            <span class="copy-helper">{{vm.blur | unit}}</span>\n          </p>\n        </li>\n      </ul>\n    </div>\n  </div>\n</section>\n'),$templateCache.put("/scripts/modules/specification/directives/borderData/borderData.html",'<section ng-if="vm.shouldShowBorder || vm.shouldShowBorderRadius && vm.isBorderRadiusSet"\n         class="data-section border-data">\n  <h3 class="section-title">Border &amp; Radius</h3>\n  <div class="data">\n    <div ng-if="vm.shouldShowBorder" class="border-info">\n      <h5 class="light">Border <span>{{::vm.border.borderStyle}}</span></h5>\n      <ul class="visual-info-list weight">\n        <li\n          class="value top code allow-copying"\n          ng-class="{\'default-value\': !vm.border.borderTopWidth || vm.border.borderTopWidth === 0 }"\n          clipboard-copy\n          data-clipboard-text="{{(vm.border.borderTopWidth || 0) | unit}}">\n          <span class="copy-helper">{{::(vm.border.borderTopWidth || 0) | unit}}</span>\n        </li>\n        <li\n          class="value right code allow-copying"\n          ng-class="{\'default-value\': !vm.border.borderRightWidth || vm.border.borderRightWidth === 0 }"\n          clipboard-copy\n          data-clipboard-text="{{(vm.border.borderRightWidth || 0) | unit}}">\n          <span class="copy-helper">{{::(vm.border.borderRightWidth || 0) | unit}}</span>\n        </li>\n        <li\n          class="value bottom code allow-copying"\n          ng-class="{\'default-value\': !vm.border.borderBottomWidth || vm.border.borderBottomWidth === 0 }"\n          clipboard-copy\n          data-clipboard-text="{{(vm.border.borderBottomWidth || 0) | unit}}">\n          <span class="copy-helper">{{::(vm.border.borderBottomWidth || 0) | unit}}</span>\n        </li>\n        <li\n          class="value left code allow-copying"\n          ng-class="{\'default-value\': !vm.border.borderLeftWidth || vm.border.borderLeftWidth === 0 }"\n          clipboard-copy\n          data-clipboard-text="{{(vm.border.borderLeftWidth || 0) | unit}}">\n          <span class="copy-helper">{{::(vm.border.borderLeftWidth || 0) | unit}}</span>\n        </li>\n      </ul>\n    </div>\n\n    <div ng-if="vm.shouldShowBorderRadius" class="border-info">\n      <h5 class="light">Radius</h5>\n      <ul class="visual-info-list radius">\n        <li\n          class="value top-left code allow-copying"\n          ng-class="{\'default-value\': !vm.border.borderTopLeftRadius || vm.border.borderTopLeftRadius === 0 }"\n          clipboard-copy\n          data-clipboard-text="{{(vm.border.borderTopLeftRadius || 0) | unit}}">\n          <span class="copy-helper">{{::(vm.border.borderTopLeftRadius || 0) | unit}}</span>\n        </li>\n        <li\n          class="value top-right code allow-copying"\n          ng-class="{\'default-value\': !vm.border.borderTopRightRadius || vm.border.borderTopRightRadius === 0 }"\n          clipboard-copy\n          data-clipboard-text="{{(vm.border.borderTopRightRadius || 0) | unit}}">\n          <span class="copy-helper">{{::(vm.border.borderTopRightRadius || 0) | unit}}</span>\n        </li>\n        <li\n          class="value bottom-right code allow-copying"\n          ng-class="{\'default-value\': !vm.border.borderBottomRightRadius || vm.border.borderBottomRightRadius === 0 }"\n          clipboard-copy\n          data-clipboard-text="{{(vm.border.borderBottomRightRadius || 0) | unit}}">\n          <span class="copy-helper">{{::(vm.border.borderBottomRightRadius || 0) | unit}}</span>\n        </li>\n        <li\n          class="value bottom-left code allow-copying"\n          ng-class="{\'default-value\': !vm.border.borderBottomLeftRadius || vm.border.borderBottomLeftRadius === 0 }"\n          clipboard-copy\n          data-clipboard-text="{{(vm.border.borderBottomLeftRadius || 0) | unit}}">\n          <span class="copy-helper">{{::(vm.border.borderBottomLeftRadius || 0) | unit}}</span>\n        </li>\n      </ul>\n    </div>\n  </div>\n</section>\n'),$templateCache.put("/scripts/modules/specification/directives/canvasData/canvasData.html",'<section class="canvas-size data-section">\n  <h3 class="section-title">\n    <span class="ellipsis-helper">General</span>\n    <unit-switcher class="unit-select"></unit-switcher>\n  </h3>\n  <div class="data">\n    <div class="double-ul-column">\n      <ul class="canvas-data-list">\n        <li>\n          <h5 class="narrow">Width</h5>\n          <p class="code allow-copying" clipboard-copy data-clipboard-text="{{vm.width | unit}}">\n            <span class="copy-helper">{{vm.width | unit}}</span>\n          </p>\n        </li>\n        <li>\n          <h5 class="narrow">Height</h5>\n          <p class="code allow-copying" clipboard-copy data-clipboard-text="{{vm.height | unit}}">\n            <span class="copy-helper">{{vm.height | unit}}</span>\n          </p>\n        </li>\n      </ul>\n      <ul class="data-position" ng-if="vm.type !== vm.SPEC_OBJECT_TYPES.CANVAS">\n        <li>\n          <h5 class="narrow">X</h5>\n          <p class="code allow-copying" clipboard-copy data-clipboard-text="{{vm.left | unit}}">\n            <span class="copy-helper">{{vm.left | unit}}</span>\n          </p>\n        </li>\n        <li>\n          <h5 class="narrow">Y</h5>\n          <p class="code allow-copying" clipboard-copy data-clipboard-text="{{vm.top | unit}}">\n            <span class="copy-helper">{{vm.top | unit}}</span>\n          </p>\n        </li>\n        <li ng-if="vm.fixed" class="double-size">\n          <h5 class="narrow">Position</h5>\n          <p>Fixed</p>\n        </li>\n      </ul>\n      <ul ng-if="vm.type === vm.SPEC_OBJECT_TYPES.CANVAS">\n        <li>\n          <h5 class="narrow">Canvas</h5>\n          <p title="{{vm.name || vm.getSizeName(vm.width, vm.height)}}">\n            {{vm.name || vm.getSizeName(vm.width, vm.height)}}\n          </p>\n        </li>\n      </ul>\n    </div>\n    <div ng-if="vm.type !== vm.SPEC_OBJECT_TYPES.CANVAS" class="double-ul-column">\n      <ul class="canvas-data-list">\n        <li ng-if="vm.angle !== 0">\n          <h5 class="narrow">Angle</h5>\n          <p class="code angle allow-copying" clipboard-copy data-clipboard-text="{{vm.angle}}deg">\n            <span class="copy-helper">\n              {{vm.angle}}\n              <small class="degree-sign">O</small>\n            </span>\n          </p>\n        </li>\n        <li>\n          <h5 class="narrow">Opacity</h5>\n          <p class="code allow-copying" clipboard-copy data-clipboard-text="{{vm.opacity}}%">\n            <span class="copy-helper">{{vm.opacity}}%</span>\n          </p>\n        </li>\n      </ul>\n    </div>\n  </div>\n</section>\n'),
$templateCache.put("/scripts/modules/specification/directives/colorsList/colorsList.html",'<section class="color-data data-section" ng-if="vm.colors.length || vm.gradients.length">\n  <h3 class="section-title">\n    Colors\n    <cloud trigger-type="hover" offset="vm.offsetColorType" class="outline-info color-type-select">\n      <span data-trigger class="cloud-trigger icon-general-chevron">{{vm.isHexMode() ? \'Hex\' : \'Rgba\'}}</span>\n      <ul data-cloud id="color-type-cloud" class="cloud options-cloud">\n        <li><a ng-click="vm.setMode($event, vm.MODES.HEX)" href="#hex" ng-class="{selected: vm.isHexMode()}">Hex</a></li>\n        <li><a ng-click="vm.setMode($event, vm.MODES.RGBA)" href="#rgba" ng-class="{selected: vm.isRgbaMode()}">Rgba</a></li>\n      </ul>\n    </cloud>\n  </h3>\n\n  <div class="data">\n    <!-- Canvas and group colors -->\n    <ul ng-if="!vm.isElement()" class="colors-list">\n      <li clipboard-copy data-clipboard-text="{{vm.isHexMode() ? color.hex : color.rgba}}" skip-copy-info="true" ng-repeat="color in vm.sortedColors">\n        <figure ng-if="vm.isHexMode()" ng-class="::{\'bright-color\': vm.isBright(color.rgba)}" class="color-preview icon-general-copy" ng-style="::{background: color.rgba}">{{::color.hex}}</figure>\n        <figure ng-if="vm.isRgbaMode()" ng-class="::{\'bright-color\': vm.isBright(color.rgba)}" class="color-preview icon-general-copy" ng-style="::{background: color.rgba}">{{::color.rgba}}</figure>\n        <aside class="details">\n          <h5 ng-if="vm.isHexMode()" class="code">\n            {{::color.hex}}\n            <span class="alpha" ng-if="color.alpha < 1">{{::color.alpha * 100|number:0}}%</span>\n          </h5>\n          <h5 ng-if="vm.isRgbaMode()" class="code">{{::vm.getRgbaValues(color.rgba)}}</h5>\n          <p class="name" title="{{vm.name(color.hex)}}">{{::vm.name(color.hex)}}</p>\n        </aside>\n      </li>\n\n      <li class="color-element gradient" ng-repeat="gradient in vm.gradients">\n        <gradient gradient="gradient" mode="vm.selectedMode" skip-copy-info="true"></gradient>\n      </li>\n\n    </ul>\n\n    <!-- Element colors -->\n    <ul ng-if="vm.isElement()" class="colors-list element">\n      <li class="color-element" ng-repeat="color in vm.elementColors">\n        <div ng-if="color.hex" clipboard-copy success-container-class="color-element" data-clipboard-text="{{vm.getClipboardText(color)}}">\n          <h5 class="color-label light">{{::color.type}}</h5>\n          <figure ng-if="vm.isHexMode()" ng-class="::{\'bright-color\': vm.isBright(color.hex)}" class="color-preview icon-general-copy" ng-style="::{background: color.rgba}">{{::color.hex}}</figure>\n          <figure ng-if="vm.isRgbaMode()" ng-class="::{\'bright-color\': vm.isBright(color.hex)}" class="color-preview icon-general-copy" ng-style="::{background: color.rgba}">{{::color.rgba}}</figure>\n\n          <aside class="details">\n            <h5 ng-if="vm.isHexMode()" class="code">\n              {{::color.hex}}\n              <span class="alpha" ng-if="color.alpha < 1">{{::color.alpha * 100|number:0}}%</span></h5>\n            <h5 ng-if="vm.isRgbaMode()" class="code">{{::vm.getRgbaValues(color.rgba)}}</h5>\n            <p class="name" title="{{vm.name(color.hex)}}">{{::vm.name(color.hex)}}</p>\n          </aside>\n        </div>\n        <div ng-if="color.gradient">\n          <h5 class="color-label light">{{::color.type}}</h5>\n          <gradient gradient="color.gradient" mode="vm.selectedMode"></gradient>\n        </div>\n      </li>\n    </ul>\n\n    <!-- Canvas colors -->\n    <div ng-if="!vm.isElement() && !vm.isGroup()" class="canvas-background">\n      <h5 class="light">Canvas background</h5>\n      <ul class="colors-list">\n        <li ng-if="vm.canvasBg.gradient" class="color-element gradient">\n          <gradient gradient="vm.canvasBg.gradient" mode="vm.selectedMode" skip-copy-info="true"></gradient>\n        </li>\n        <li clipboard-copy data-clipboard-text="{{vm.isHexMode() ? vm.canvasBg.hex : vm.canvasBg.rgba}}" skip-copy-info="true" ng-if="vm.canvasBg.hex">\n          <figure ng-if="vm.isHexMode()" ng-class="{\'bright-color\': vm.isBright(vm.canvasBg.hex)}" class="color-preview icon-general-copy" ng-style="{background: vm.canvasBg.hex}">{{vm.canvasBg.hex}}</figure>\n          <figure ng-if="vm.isRgbaMode()" ng-class="{\'bright-color\': vm.isBright(vm.canvasBg.hex)}" class="color-preview icon-general-copy" ng-style="{background: vm.canvasBg.hex}">{{vm.getRgbaValues(vm.canvasBg.rgba)}}</figure>\n          <aside class="details">\n            <h5 ng-if="vm.isHexMode()" class="code">\n              {{vm.canvasBg.hex}}\n              <span class="alpha" ng-if="color.alpha < 1">{{vm.canvasBg.alpha * 100|number:0}}%</span>\n            </h5>\n            <h5 ng-if="vm.isRgbaMode()" class="code">{{vm.getRgbaValues(vm.canvasBg.rgba)}}</h5>\n            <p class="name" title="{{vm.name(vm.canvasBg.hex)}}">{{vm.name(vm.canvasBg.hex)}}</p>\n          </aside>\n        </li>\n      </ul>\n    </div>\n  </div>\n</section>\n'),$templateCache.put("/scripts/modules/specification/directives/contentData/contentData.html",'<section ng-if="vm.valueTrimmed" class="data-section meta-data">\n  <h3 class="section-title">Content</h3>\n  <span class="copy-link-container">\n    <a href="#copy"\n       class="copy-link underline-link icon-general-copy"\n       success-container-class="data-section"\n       clipboard-copy data-clipboard-text="{{vm.valueTrimmed}}"\n       ng-click="vm.onClick($event)">Copy</a>\n  </span>\n  <textarea class="content-readonly"\n            ng-class="{\'text-list\': vm.isTextList}"\n            ng-model="vm.valueTrimmed"\n            rows="1"\n            auto-height\n            readonly></textarea>\n</section>\n'),$templateCache.put("/scripts/modules/specification/directives/cssCode/cssCode.html",'<section clipboard-copy child-selector=".CodeMirror-line" class="data-section meta-data">\n  <h3 class="section-title">CSS Code</h3>\n  <span class="copy-link-container">\n    <a href="#copy" clipboard-copy data-clipboard-text="{{vm.options.value}}" success-container-class="data-section" class="copy-link underline-link icon-general-copy" ng-click="vm.onClick($event)">Copy</a>\n  </span>\n  <code-editor options="vm.options"></code-editor>\n</section>'),$templateCache.put("/scripts/modules/specification/directives/designSystem/designSystem.html",'<section class="data-section design-system-data">\n  <h3 class="section-title">Design System</h3>\n  <div class="data">\n    <header class="header">\n      <h5 class="sectiion-title">\n        <a ng-if="vm.designSystemURL" href="{{vm.designSystemURL}}" target="_blank">{{vm.documentation.libraryName}}</a>\n        <span ng-if="!vm.designSystemURL" >{{vm.documentation.libraryName}}</span>\n      </h5>\n      <ul class="breadcrumbs-list">\n        <li>UI Pattern</li>\n        <li ng-if="vm.documentation.categoryName.length">{{vm.documentation.categoryName}}</li>\n        <li>{{vm.documentation.itemName}}</li>\n      </ul>\n    </header>\n    <documentation-text content="{{vm.documentation.content}}"></documentation-text>\n  </div>\n</section>\n'),$templateCache.put("/scripts/modules/specification/directives/fontsList/fontsList.html",'<section class="typography-data data-section" ng-hide="!vm.fonts.length">\n  <h3 class="section-title">Typography</h3>\n  <div class="data">\n    <ul ng-if="!vm.isElement()" class="fonts-list">\n      <li ng-repeat="font in vm.sortedFonts">\n        <h5 class="name" ng-style="{\'font-family\': vm.getFontFamily(font, font.variants)}">{{font.fontName}}</h5>\n        <ul class="font-weights-list" >\n          <li ng-repeat="variant in font.variants" ng-style="{\'font-family\': vm.getFontFamily(font, variant.shorthand)}">{{variant.name}}</li>\n        </ul>\n        <ul class="font-sizes-list">\n          <li\n            clipboard-copy\n            data-clipboard-text="{{size}}"\n            ng-repeat="size in font.sizes"\n            class="outline code allow-copying">\n            {{size}}\n          </li>\n        </ul>\n      </li>\n    </ul>\n\n    <ul ng-if="vm.isElement()" class="fonts-list">\n      <li ng-repeat="font in vm.elementFonts">\n        <h5 class="name" ng-style="{\'font-family\': vm.getFontFamily(font, font.variant.shorthand)}">\n          <span class="font-name">{{font.fontName}}</span>\n          <span ng-if="font.fontData.type === vm.FONT_TYPES.TYPEKIT" class="font-type icon-general-typekit only-icon-font" title="Typekit Font">Typekit</span>\n          <span ng-if="font.fontData.type === vm.FONT_TYPES.GOOGLE" class="font-type icon-general-google only-icon-font" title="Google Font">Google</span>\n          <span ng-if="font.fontData.type === vm.FONT_TYPES.CUSTOM" class="font-type icon-general-custom-font only-icon-font" title="Uploaded Font">Uploaded</span>\n        </h5>\n        <p class="weight" ng-style="{\'font-family\': vm.getFontFamily(font, font.variant.shorthand)}">{{font.variant.name | capitalizeFirstLetters}}</p>\n        <div class="double-ul-column typo-data">\n          <ul>\n            <li ng-if="font.fontSize">\n              <h5>Text size</h5>\n              <p\n                class="code allow-copying"\n                clipboard-copy\n                data-clipboard-text="{{font.fontSize | toFloat | unit:true}}">\n                <span class="copy-helper">{{font.fontSize | toFloat | unit:true}}</span>\n              </p>\n            </li>\n            <li ng-if="font.textAlign">\n              <h5>Alignment</h5>\n              <p>{{font.textAlign | capitalizeFirstLetters}}</p>\n            </li>\n            <li ng-if="vm.getTransform(font)" class="text-transform-control">\n              <h5>Transform</h5>\n              <p>{{vm.getTransform(font)}}</p>\n            </li>\n          </ul>\n          <ul>\n            <li ng-if="font.letterSpacing">\n              <h5 title="Spacing between characters">Tracking</h5>\n              <p\n                class="code allow-copying"\n                clipboard-copy\n                data-clipboard-text="{{font.letterSpacing | toFloat}}">\n                <span class="copy-helper">{{font.letterSpacing | toFloat | unit}}</span>\n              </p>\n            </li>\n            <li ng-if="font.lineHeight">\n              <h5 title="Spacing between lines of type">Leading</h5>\n              <p\n                      class="code allow-copying"\n                      clipboard-copy\n                      data-clipboard-text="{{font.lineHeight | toFloat | unit:true}}">\n                <span class="copy-helper">{{font.lineHeight | toFloat | unit:true}}</span>\n              </p>\n            </li>\n          </ul>\n        </div>\n        <div ng-if="vm.areTextStylesSet(font)" class="double-ul-column typo-data">\n          <ul>\n            <li>\n              <h5>Text styles</h5>\n              <ul class="text-styles-list">\n                <li ng-if="vm.isBold(font)">\n                  <figure class="text-style icon-general-style-bold only-icon-font" title="Faux Bold">Bold</figure>\n                </li>\n                <li ng-if="vm.isItalic(font)">\n                  <figure class="text-style icon-general-style-italic only-icon-font" title="Faux Italic">Italic</figure>\n                </li>\n                <li ng-if="vm.hasUnderlineDecoration(font)">\n                  <figure class="text-style icon-general-style-underline only-icon-font" title="Underline">Underline</figure>\n                </li>\n                <li ng-if="vm.hasLineThroughDecoration(font)">\n                  <figure class="text-style icon-general-style-strike only-icon-font" title="Strikethrough">Strikethrough</figure>\n                </li>\n              </ul>\n            </li>\n          </ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n</section>\n'),$templateCache.put("/scripts/modules/specification/directives/gradient/gradient.html",'<div clipboard-copy success-container-class="color-element" skip-copy-info="vm.skipCopyInfo" data-clipboard-text={{vm.gradientCssStyle}} class="gradient-container">\n  <figure class="color-preview icon-general-copy" ng-style="{background: vm.gradientCssStyle}">{{::vm.gradientCssStyle}}</figure>\n  <aside class="details gradient">\n    <cloud trigger-type="hover" defaultPosition="bottom" offset="vm.offsetColorType">\n      <h5 data-trigger class="code icon-general-chevron">Gradient</h5>\n      <div data-cloud class="cloud colors-list options-list" id="gradient-details-cloud">\n        <ul class="gradient-info">\n          <li>\n            <h5>Type: <span>{{::vm.gradientData.type}}</span></h5>\n          </li>\n          <li ng-if="vm.isAngleValid(vm.gradientData.angle)">\n            <h5>Angle: <span>{{::vm.gradientData.angle}}<small class="degree-sign">O</small></span></h5>\n          </li>\n        </ul>\n        <div class="separator"></div>\n        <ul class="colors-list options-list">\n          <li clipboard-copy data-clipboard-text="{{vm.isHexMode() ? color.hex : color.rgba}}" skip-copy-info="true" ng-repeat="color in vm.gradientData.colors">\n            <figure ng-if="vm.isHexMode()" ng-class="::{\'bright-color\': vm.isBright(color.hex)}" class="color-preview icon-general-copy" ng-style="::{background: color.rgba}">{{::color.hex}}</figure>\n            <figure ng-if="vm.isRgbaMode()" ng-class="::{\'bright-color\': vm.isBright(color.hex)}" class="color-preview icon-general-copy" ng-style="::{background: color.rgba}">{{::vm.getRgbaValues(color.rgba)}}</figure>\n            <aside class="details">\n              <h5 ng-if="vm.isHexMode()" class="code">{{::color.hex}} {{::color.alpha * 100 |number:0}}%</h5>\n              <h5 ng-if="vm.isRgbaMode()" class="code">{{::vm.getRgbaValues(color.rgba)}}</h5>\n              <p class="name" title="{{vm.name(color.hex)}}">{{::vm.name(color.hex)}}</p>\n            </aside>\n          </li>\n        </ul>\n      </div>\n    </cloud>\n  </aside>\n</div>\n'),$templateCache.put("/scripts/modules/specification/directives/gridData/gridData.html",'<section class="grid-guides data-section">\n  <h3 class="section-title">Grid</h3>\n  <div class="data">\n    <form class="options">\n      <fieldset>\n        <input ng-model="vm.isGridVisible" ng-change="vm.setGridDisplay(vm.isGridVisible)" id="show-grid" class="state-helper" type="checkbox" ng-checked="vm.isGridVisible" />\n        <label  for="show-grid" class="fake-choose-label fake-checkbox">Show grid</label>\n      </fieldset>\n\n      <fieldset ng-if="vm.areGuidesAvailable()">\n        <input ng-model="vm.areGuidesVisible" ng-change="vm.setGuides(vm.areGuidesVisible)" id="show-guides" class="state-helper" type="checkbox" ng-checked="vm.areGuidesVisible" />\n        <label for="show-guides" class="fake-choose-label fake-checkbox">Show guides</label>\n      </fieldset>\n    </form>\n\n    <div class="double-ul-column grid-data">\n      <ul>\n        <li>\n          <h5>Columns</h5>\n          <p class="code allow-copying" clipboard-copy data-clipboard-text="{{vm.grid.columns}}">\n            <span class="copy-helper">{{vm.grid.columns}}</span>\n          </p>\n        </li>\n        <li>\n          <h5>Column width</h5>\n          <p class="code allow-copying" clipboard-copy data-clipboard-text="{{vm.grid.columnWidth | unit}}">\n            <span class="copy-helper">{{vm.grid.columnWidth | unit}}</span>\n          </p>\n        </li>\n      </ul>\n      <ul>\n        <li>\n          <h5>Gutter</h5>\n          <p class="code allow-copying" clipboard-copy data-clipboard-text="{{vm.grid.gutter | unit}}">\n            <span class="copy-helper">{{vm.grid.gutter | unit}}</span>\n          </p>\n        </li>\n        <li>\n          <h5>Margin</h5>\n          <p class="code allow-copying" clipboard-copy data-clipboard-text="{{vm.grid.margin | unit}}">\n            <span class="copy-helper">{{vm.grid.margin | unit}}</span>\n          </p>\n        </li>\n      </ul>\n    </div>\n  </div>\n</section>\n'),$templateCache.put("/scripts/modules/specification/directives/headerCanvas/headerCanvas.html",'<header class="header-panel">\n  <div class="ellipsis-container">\n    <h2>Summary: <strong title="{{vm.currentPageName}}">{{vm.currentPageName}}</strong></h2>\n  </div>\n</header>'),$templateCache.put("/scripts/modules/specification/directives/headerDesignSystem/headerDesignSystem.html",'<div class="design-system-parent-info notification-overlay">\n  <span>\n    See <a ng-click="vm.selectElement($event, vm.element)">{{ vm.documentation.itemName }}</a> from {{ vm.documentation.libraryName }}\n  </span>\n</div>\n'),$templateCache.put("/scripts/modules/specification/directives/headerElement/headerElement.html",'<header class="header-panel">\n  <div class="ellipsis-container with-icon" ng-if="!vm.hasParent">\n    <h2><strong ng-class="vm.class" title="{{vm.name}}">{{vm.name}}</strong></h2>\n  </div>\n  <div class="ellipsis-container with-icon with-parent" ng-if="vm.hasParent">\n    <figure ng-class="vm.elementParentTypeClass" data-show-node="tooltip">\n      <span class="tooltip">{{vm.elementParentType}}</span>\n    </figure>\n    <h1>\n      <a ng-click="vm.selectElement($event, vm.elementParent)" href="#" class="underline-link">\n        {{vm.elementParent.name}}\n      </a>\n    </h1>\n    <h2 class="icon-general-caret">\n      <strong ng-class="vm.class" title="{{vm.name}}">{{vm.name}}</strong>\n    </h2>\n  </div>\n</header>'),$templateCache.put("/scripts/modules/specification/directives/headerGroup/headerGroup.html",'<header class="header-panel">\n  <div class="ellipsis-container with-icon" ng-if="!vm.hasParent">\n    <figure ng-class="vm.class" data-show-node="tooltip">\n      <span class="tooltip">{{vm.type}}</span>\n    </figure>\n    <h2>\n      <strong title="{{vm.name}}">\n        {{vm.name}}\n      </strong>\n    </h2>\n  </div>\n  <div class="ellipsis-container with-icon with-parent" ng-if="vm.hasParent">\n    <figure ng-class="vm.elementParentTypeClass" data-show-node="tooltip">\n      <span class="tooltip">{{vm.elementParentType}}</span>\n    </figure>\n    <h1>\n      <a ng-click="vm.selectElement($event, vm.elementParent)" href="#" class="underline-link">\n        {{vm.elementParent.name}}\n      </a>\n    </h1>\n    <h2 class="icon-general-caret">\n      <strong ng-class="vm.class" title="{{vm.name}}">{{vm.name}}</strong>\n    </h2>\n  </div>\n  <div ng-if="vm.isMultistate" class="multistate-select">\n    <h5>State</h5>\n    <select\n        id="state-select"\n        name="stateSelect"\n        ng-model="vm.selectedState"\n        ng-options="option.name for option in vm.states track by option.id"\n        ng-change="vm.changeState(vm.selectedState.id)">\n    </select>\n  </div>\n</header>'),$templateCache.put("/scripts/modules/specification/directives/imagesList/assetBackground.html",'<section ng-if="vm.position" class="asset-background">\n  <figure class="position-preview {{vm.positionClass}}">\n    <span class="square-helper"></span>\n  </figure>\n  <article class="details double-ul-column">\n    <ul>\n      <li>\n        <h5>Position</h5>\n        <p>{{vm.position}}</p>\n      </li>\n      <li ng-if="vm.behaviour">\n        <h5>Behaviour</h5>\n        <p>{{vm.behaviour}}</p>\n      </li>\n    </ul>\n  </article>\n</section>'),$templateCache.put("/scripts/modules/specification/directives/imagesList/imageMeta.html",'<p class="meta" ng-if="vm.isLoaded">{{vm.imageMeta.width}}  {{vm.imageMeta.height}}<span ng-if="!vm.withoutSize">, {{vm.imageMeta.size}}</span></p>\n'),$templateCache.put("/scripts/modules/specification/directives/imagesList/imagesList.html",'<section class="data-section asset-data" ng-if="vm.imagesList.length">\n  <h3 class="section-title">Image asset</h3>\n\n  <div ng-repeat="image in vm.imagesList" class="asset">\n    <figure>\n      <img ng-src="{{image.previewImage || image.path}}" />\n    </figure>\n    <section class="details">\n      <article class="image-info">\n        <p class="filename">\n          <span class="ellipsis-helper" title="{{image.file.name}}.{{image.file.extension}}">{{image.file.name}}</span>\n          <span class="extension">.{{image.file.extension}}</span>\n        </p>\n        <image-meta image="image"></image-meta>\n      </article>\n      <aside class="aside-helper">\n        <a ng-href="{{image.path}}" ng-click="vm.download($event, image)" class="underline-link blue-link">Download</a>\n      </aside>\n    </section>\n    <asset-background background="vm.background"></asset-background>\n  </div>\n  <image-downloader\n    image="vm.currentImage"\n  ></image-downloader>\n</section>\n'),$templateCache.put("/scripts/modules/specification/directives/inspector/inspector.html",'<div>\n  <div class="boxes-container"></div>\n  <div class="lines-container"></div>\n</div>\n'),$templateCache.put("/scripts/modules/specification/directives/interactions/interactions.html",'<div>\n  <section ng-if="vm.areInteractionsAvailable" class="data-section meta-data">\n    <h3 class="section-title">Interactions</h3>\n    <ul class="interactions-list">\n      <li class="icon-general-interaction">OnClick show #modal with animation</li>\n      <li class="icon-general-interaction">OnClick set state Button</li>\n    </ul>\n  </section>\n</div>\n'),$templateCache.put("/scripts/modules/specification/directives/metadata/metadata.html",'<div class="content">\n  <section ng-repeat="data in vm.metadata track by $index" class="data-section meta-data">\n    <h3 class="section-title">\n      <span class="ellipsis-helper" title="{{data.name}}">{{data.name}}</span>\n      <div ng-if="data.type === vm.TYPES.CODE && data.codeLang" class="outline-info">\n        <span>{{vm.findCodeOptionLabel(data.codeLang)}}</span>\n      </div>\n    </h3>\n    <p class="meta-text" ng-if="data.type === vm.TYPES.TEXT" ng-bind-html="data.value | linky:\'_blank\'"></p>\n    <p ng-if="data.type === vm.TYPES.LIST">{{vm.getSelectedOption(data.options, data.value)}}</p>\n    <span class="copy-link-container">\n      <a href="#copy" clipboard-copy data-clipboard-text="{{data.type === vm.TYPES.LIST ? vm.getSelectedOption(data.options, data.value) : data.value }}" success-container-class="data-section" class="copy-link underline-link icon-general-copy" ng-click="vm.onClick($event)">Copy</a>\n    </span>\n    <div clipboard-copy child-selector=".CodeMirror-line">\n      <code-editor ng-if="data.type === vm.TYPES.CODE" value="data.value" mode="data.codeLang"></code-editor>\n    </div>\n  </section>\n</div>\n'),$templateCache.put("/scripts/modules/specification/directives/shadowsList/shadowsList.html",'<section class="shadow-data data-section" ng-if="vm.shadows.length">\n  <h3 class="section-title">{{::vm.sectionLabel}}</h3>\n  <div class="data">\n    <ul class="shadows-list">\n      <li ng-repeat="shadow in vm.shadows">\n        <div class="copy-helper" clipboard-copy data-clipboard-text="{{shadow.isHexMode() ? shadow.shadowColor.hex : shadow.shadowColor.rgba}}" skip-copy-info="true">\n          <figure class="color-preview icon-general-copy" ng-style="{\'background-color\': shadow.shadowColor.rgba}">\n            {{shadow.shadowColor.hex}}\n          </figure>\n          <h5 ng-if="vm.colorType === vm.COLOR_TYPES.HEX" class="color-info code">\n              <span class="copy-helper">\n                {{shadow.shadowColor.hex}}\n                {{shadow.shadowColor.alpha * 100| toInt}}%\n              </span>\n          </h5>\n          <h5 ng-if="vm.colorType === vm.COLOR_TYPES.RGBA" class="color-info code">{{vm.getRgbaValues(shadow.shadowColor.rgba)}}</h5>\n        </div>\n\n        <aside class="details">\n          <ul class="properties-list">\n            <li>\n              <h5>X</h5>\n              <p class="code allow-copying" clipboard-copy data-clipboard-text="{{shadow.shadowOffsetX | unit}}">\n                <span class="copy-helper">{{shadow.shadowOffsetX | unit}}</span>\n              </p>\n            </li>\n            <li>\n              <h5>Y</h5>\n              <p class="code allow-copying" clipboard-copy data-clipboard-text="{{shadow.shadowOffsetY | unit}}">\n                <span class="copy-helper">{{shadow.shadowOffsetY | unit}}</span>\n              </p>\n            </li>\n            <li>\n              <h5>Blur</h5>\n              <p class="code allow-copying" clipboard-copy data-clipboard-text="{{shadow.shadowBlur | unit}}">\n                <span class="copy-helper">{{shadow.shadowBlur | unit}}</span>\n              </p>\n            </li>\n          </ul>\n        </aside>\n      </li>\n    </ul>\n  </div>\n</section>\n'),$templateCache.put("/scripts/modules/specification/directives/unitSwitcher/unitSwitcher.html",'<cloud trigger-type="hover" offset="vm.offsetColorType" class="outline-info">\n  <span data-trigger class="cloud-trigger icon-general-chevron">{{vm.activeMode}}</span>\n  <ul data-cloud id="unit-switch-cloud" class="cloud small options-cloud">\n    <li ng-repeat="mode in vm.UNIT_MODES track by $index">\n      <a href="#" ng-click="vm.changeMode($event, mode)" ng-class="{selected: vm.activeMode === mode}">{{mode}}</a>\n    </li>\n  </ul>\n</cloud>\n'),$templateCache.put("/scripts/modules/styleguide/directives/colorsGuideList/colorsGuideList.html",'<section ng-if="vm.colors.length" class="guide-data color-guide-data" id="colors-guide">\n  <h3 class="title">Colors</h3>\n  <ul class="guide-colors-list">\n    <li ng-repeat="color in vm.sortedColors">\n      <figure class="color-preview" ng-style="{background: color.hex, \'box-shadow\': vm.getBoxShadow(color.rgba)}" >{{color.hex}}</figure>\n      <aside class="details">\n        <h5 class="color allow-copying" clipboard-copy data-clipboard-text="{{color.hex}}">\n          <span class="copy-helper">{{color.hex}}</span>\n        </h5>\n        <h5 class="color allow-copying" clipboard-copy data-clipboard-text="{{vm.getRgb(color.hex)}}">\n          <span class="copy-helper">{{vm.getRgbValues(color.rgba)}}</span>\n        </h5>\n        <p class="name" title="{{vm.name(color.hex)}}">{{vm.name(color.hex)}}</p>\n      </aside>\n    </li>\n  </ul>\n</section>'),$templateCache.put("/scripts/modules/styleguide/directives/downloadFont/downloadFont.html",'<div ng-class="{ working: vm.isFontDownloading }" >\n  <a ng-if="!vm.isFontDownloadError && vm.isCustomFont(vm.font.fontData) && !vm.isFontDownloading"\n     href="#download-font"  ng-click="vm.downloadCustomFont($event, vm.font)"\n     class="download-link underline-link icon-general-custom-font">Download font</a>\n  <a ng-if="!vm.isFontDownloadError && vm.isCustomFont(vm.font.fontData) && vm.isFontDownloading"\n     href="#download-font"  ng-click="$event.preventDefault()"\n     class="download-link underline-link icon-general-custom-font">Preparing font...</a>\n  <p ng-if="vm.isFontDownloadError"\n     class="error-info">Something went wrong! <a ng-click="vm.downloadCustomFont($event, vm.font)" href="#">Retry</a>\n  </p>\n  <a ng-if="vm.isGoogleFont(vm.font.fontData)"\n     ng-href="{{vm.getGoogleFontLink(vm.font.fontName)}}"\n     target="_blank"\n     class="download-link underline-link icon-general-google">\n    Get from</a>\n  <a ng-if="vm.isTypekitFont(vm.font.fontData)"\n     ng-href="{{vm.getTypekitFontLink(vm.font.fontName)}}"\n     target="_blank"\n     class="download-link underline-link">\n    Get from Typekit</a>\n</div>\n'),$templateCache.put("/scripts/modules/styleguide/directives/downloadImages/downloadImages.html",'<div class="download-all-container" ng-class="{ working: vm.isImagesDownloading }">\n  <button ng-if="!vm.isImagesDownloadError && !vm.isImagesDownloading" href="#download-images" ng-click="vm.downloadImages($event)" class="ds-btn ds-btn--neutral-style ds-btn--small-size ds-btn--light-weight ds-btn--with-additional-info"><small class="ds-btn__info"><span class="ds-btn__info__ellipsis-helper">{{vm.images.length}}</span></small>Download all</button>\n  <a ng-if="!vm.isImagesDownloadError && vm.isImagesDownloading" href="#download-font" ng-click="$event.preventDefault()" class="download-link underline-link icon-general-custom-font">Preparing images...</a>\n  <p ng-if="vm.isImagesDownloadError" class="error-info">Something went wrong!\n    <a ng-click="vm.downloadImages($event)" href="#">Retry</a>\n  </p>\n</div>\n'),$templateCache.put("/scripts/modules/styleguide/directives/fontsGuideList/fontsGuideList.html",'<section class="guide-data typography-guide-data" id="typography-guide">\n  <h3 class="title">Typography</h3>\n  <ul class="guide-fonts-list">\n    <li ng-repeat="font in vm.sortedFonts track by $index">\n      <section class="font-details font-family">\n        <h5 class="section-label">Family</h5>\n        <h3 class="font-name" ng-style="{\'font-family\': vm.getFontFamily(font, font.variants)}">{{font.fontName}}</h3>\n        <download-font font="font"></download-font>\n      </section>\n\n      <section class="font-details font-styles">\n        <h5 class="section-label">Styles</h5>\n        <ul>\n          <li ng-repeat="variant in font.variants" ng-style="{\'font-family\': vm.getFontFamily(font, variant.shorthand)}">{{variant.name}}</li>\n        </ul>\n      </section>\n\n      <section class="font-details font-preview">\n        <h5 class="section-label">Text preview</h5>\n        <div ng-style="{\'font-family\': vm.getFontFamily(font, font.variants)}">\n          <p>ABCDEFGHIJKLMNOPQRSTUVWXYZ</p>\n          <p>abcdefghijklmnopqrstuvwxyz</p>\n          <p>0123456789 ? ! &amp; @       % * ^ #</p>\n          <p>$    / ( ) [ ] { } . ,</p>\n        </div>\n      </section>\n    </li>\n  </ul>\n</section>\n'),$templateCache.put("/scripts/modules/styleguide/directives/imagesGuideList/imagesGuideList.html",'<section class="guide-data assets-guide-data" id="assets-guide">\n  <h3 class="title">Assets</h3>\n  <download-images\n    images="vm.allImages",\n    project-name="vm.projectName"\n  ></download-images>\n\n  <ul class="assets-list">\n    <li ng-repeat="image in vm.allImages track by $index">\n      <a ng-if="image.type === \'svg\'" ng-href="{{image.path}}" ng-click="vm.setCurrentImage($event, image)" title="Download">\n        <figure class="preview">\n          <img lazy-src="{{image.previewImage}}" />\n        </figure>\n        <footer class="details">\n          <p class="filename">\n            <span class="ellipsis-helper" title="{{image.name}}">{{image.name}}</span>\n            <span class="extension">.svg</span>\n          </p>\n          <image-meta image="image" without-size="{{true}}"></image-meta>\n        </footer>\n      </a>\n      <a ng-if="image.type === \'url\'" ng-href="{{image.path}}" ng-click="vm.setCurrentImage($event, image)" title="Download">\n        <figure class="preview">\n          <img lazy-src="{{image.path}}" />\n        </figure>\n        <footer class="details">\n          <p class="filename">\n            <span class="ellipsis-helper" title="{{image.name}}">{{image.name}}</span>\n            <span class="extension">.{{image.extension}}</span>\n          </p>\n          <image-meta image="image" without-size="{{true}}"></image-meta>\n        </footer>\n      </a>\n    </li>\n  </ul>\n  <image-downloader\n    image="vm.currentImage"\n  ></image-downloader>\n</section>\n'),$templateCache.put("/scripts/modules/styleguide/directives/pageLoader/pageLoader.html","<div></div>\n"),$templateCache.put("/scripts/modules/core/directives/select/inputTpl/pvDefaultInput.html",'<span class="underline-helper">{{vm.selectedOption[vm.config.labelKey]}}</span>\n'),$templateCache.put("/scripts/modules/core/directives/select/inputTpl/pvInputWithLabel.html",'<p ng-switch="!!vm.selectedOption[vm.config.labelKey]">\n  <span class="underline-helper light" ng-switch-when="true">\n    <span class="label">{{vm.config.label}}</span>\n    <span class="ellipsis-helper">{{vm.selectedOption[vm.config.labelKey]}}</span>\n  </span>\n  <span class="underline-helper" ng-switch-when="false">\n    {{vm.config.placeholder}}\n  </span>\n</p>\n\n\n'),
$templateCache.put("/scripts/modules/core/directives/select/optionTpl/pvDefaultOption.html",'<a href="" class="comment-type" ng-class="option.className">\n  {{option[vm.config.labelKey]}}\n</a>\n'),$templateCache.put("/scripts/modules/core/directives/select/optionTpl/pvOptionWithAvatar.html",'<a href="">\n  <figure class="user-avatar">\n    <pv-avatar url="option.avatar" name="option.name"></pv-avatar>\n    <figcaption>{{option[vm.config.labelKey]}}</figcaption>\n  </figure>\n</a>\n'),$templateCache.put("/scripts/modules/core/directives/select/optionTpl/pvOptionWithShortcut.html",'<a class="comment-type" ng-class="option.className">\n  {{option[vm.config.labelKey]}}\n  <pv-shortcut keys="option.shortcut"></pv-shortcut>\n</a>\n'),$templateCache.put("/scripts/modules/core/directives/topBar/filter/filter.html",'<li>\n  <a href="#filters"\n     ng-click="vm.togglePanel($event, vm.PREVIEW_PANELS.FILTERS)"\n     class="comments-filter button-style comment-type"\n     ng-class="[vm.typeClass, vm.assignmentClass, {\'active\': vm.isPanelVisible(vm.PREVIEW_PANELS.FILTERS)}]">\n    <span class="label">View:</span>\n    <span class="underline">{{vm.label}}</span>\n    <figure class="assign-indicator icon-general-user"></figure>\n  </a>\n</li>'),$templateCache.put("/scripts/modules/core/directives/topBar/actions/actions.html",'<cloud default-position="bottomRight"\n       on-open="vm.onCloudOpen"\n       on-close="vm.onCloudClose"\n       auto-close={{true}}\n       offset="vm.offset">\n  <a href="#actions" class="icon-menu with-icon" data-trigger>\n    <span ng-class="{active: vm.isOpen}" class="icon-general-chevron underline">Actions</span>\n  </a>\n\n  <ul data-cloud\n      class="cloud options-cloud with-icons arrow-top header-actions-cloud"\n      ng-class="{\'custom-size\': vm.isOwner() && vm.isWireframe() && !vm.canShowLivePresentation()}">\n    <li ng-if="vm.isOwner() && vm.isWireframe() && vm.hasAccessToEditor()">\n      <a href="{{vm.params.currentDocumentURL}}" class="icon-general-pencil">\n          {{vm.isOriginalProject ? \'Edit prototype\' : \'Edit this iteration\'}}\n      </a>\n    </li>\n    <li ng-if="vm.isOwner() && !vm.isWireframe() && vm.hasAccessToEditor()">\n      <a href="{{vm.params.currentDocumentURL}}" class="icon-general-pencil">Edit document</a>\n    </li>\n    <li>\n      <a href="{{vm.params.dashboardURL}}"  class="icon-general-exit">Go to project</a>\n    </li>\n\n    <li ng-if="vm.isOwner() && vm.isWireframe() && vm.canShowUsabilityTesting()" class="separator">\n      <a href="#usability-testing"\n         ng-click="vm.onClickUsabilityTestSession($event)"\n         class="icon-general-usability-testing">Usability Testing</a>\n    </li>\n    <li ng-if="!vm.hideUsabilityTestingInfo" class="separator">\n      <span class="icon-general-usability-testing disabled">\n        <span>Usability Testing</span>\n        <em class="plan-info" data-show-node="tooltip">\n          <small class="pro-label pro-tooltip">Team</small>\n          <span class="tooltip with-actions pro-tooltip size-220">\n            <small class="pro-label">Team</small>\n            Usability testing is available in Team Plan.\n            <a href="{{vm.params.upgradePlanURL}}"\n               ng-click="vm.upgradePlanTest($event)"\n               class="underline-link blue-link custom-color">Upgrade now!</a>\n          </span>\n        </em>\n      </span>\n    </li>\n    <li ng-if="vm.isOwner() && vm.isWireframe() && vm.canShowLivePresentation()">\n      <a href="#live-presentation"\n         ng-click="vm.onConfigureLiveShareSession($event)"\n         class="icon-general-live-presentation">Start Live Presentation</a>\n    </li>\n    <li ng-if="vm.isOwner() && vm.isWireframe() && !vm.canShowLivePresentation()">\n      <span class="icon-general-live-presentation disabled">\n        <span>Start Live Presentation</span>\n        <em class="plan-info" data-show-node="tooltip">\n          <small class="pro-label pro-tooltip">Team</small>\n          <span class="tooltip with-actions pro-tooltip size-220">\n            <small class="pro-label">Team</small>\n             Live Presentation is available in Team Plan.\n            <a href="#"\n               ng-click="vm.upgradePlanTest($event)"\n               class="underline-link blue-link custom-color">Upgrade now!</a>\n          </span>\n        </em>\n      </span>\n    </li>\n\n    <li class="separator">\n      <a href="{{vm.params.logOutUrl}}" class="icon-general-log-out">Log Out</a>\n    </li>\n  </ul>\n</cloud>\n'),$templateCache.put("/scripts/modules/core/directives/topBar/liveShare/liveShare.html",'<ul class="live-share-menu options-list">\n  <li ng-if="vm.isHostSession || !vm.isUserTestingMode">\n    <ul class="collaborators-list">\n      <li ng-repeat="collaborator in vm.collaborators" data-show-node="tooltip">\n        <figure class="user-avatar" ng-class="{\'muted\' : collaborator.muted}">\n          <img ng-src="{{vm.getCollaboratorAvatar(collaborator)}}"\n               alt="{{collaborator.name}}" />\n          <strong ng-hide="collaborator.customData.avatar"\n                  class="initials">{{collaborator.name | limitTo:1 }}</strong>\n        </figure>\n        <span ng-if="vm.isHostSession && collaborator.type !== \'host\'"\n              ng-click="vm.removeUser(collaborator.id)"\n              class="remove-user">\n          Remove user\n        </span>\n        <figure class="user-color" style="background: {{collaborator.color}};"></figure>\n        <em class="tooltip">{{collaborator.name}}</em>\n      </li>\n    </ul>\n  </li>\n\n  <li ng-if="vm.isHostSession || !vm.isUserTestingMode" class="separator increase-left"></li>\n\n  <li ng-if="!vm.isUserTestingMode && !vm.isHostSession">\n    <a ng-href="#follow-cursor"\n       ng-click="vm.onClickFollowHost($event)"\n       ng-class="{\'active\': vm.host.isFollowed}" style="background-color: {{vm.host.color}};"\n       class="cursor btn-icon icon-general-cursor"\n       data-show-node="tooltip">\n      <span class="tooltip">Follow cursor</span>\n    </a>\n  </li>\n\n  <li ng-if="vm.isHostSession">\n    <cloud on-open="vm.onCloudOpen"\n           on-close="vm.onCloudClose"\n           default-position="bottom"\n           auto-close="{{true}}">\n      <a href="#actions"\n         ng-class="{\'active\': vm.isOpen}"\n         class="btn-icon icon-general-cog"\n         data-show-node="tooltip"\n         data-trigger>\n        <em ng-if="vm.isUserTestingMode" class="tooltip float-right">Usability test settings</em>\n        <em ng-if="!vm.isUserTestingMode" class="tooltip float-right">Live Presentation settings</em>\n      </a>\n\n      <div data-cloud class="cloud big options-cloud session-settings-cloud">\n        <h3>Session settings</h3>\n        <ul class="options-list scroll-ready">\n          <li ng-repeat="option in vm.configuration">\n            <form>\n              <input id="live-share-setting-{{$index}}"\n                     type="checkbox"\n                     class="state-helper"\n                     ng-change="vm.setOption(option)"\n                     ng-model="option.value">\n              <label for="live-share-setting-{{$index}}"\n                     class="fake-choose-label fake-checkbox inside-cloud">{{option.name}}</label>\n            </form>\n          </li>\n        </ul>\n        <form class="separator more-spacing invite-link-container">\n          <h3>Link to session</h3>\n          <input type="text"\n                 class="url-input old-input"\n                 ng-click="vm.inputFocus($event)"\n                 ng-model="vm.inviteURL"\n                 readonly />\n          <button\n              ngclipboard\n              data-clipboard-text={{vm.inviteURL}}\n              ngclipboard-success="vm.onCopySuccess()"\n              class="copy-link icon-general-link only-icon-font btn-bordered small-size">Copy</button>\n          <span class="information"\n                ng-class="{\'visible\': vm.isCopied}">{{::\'LS_LINK_HAS_BEEN_COPIED\' | translate}}</span>\n        </form>\n      </div>\n    </cloud>\n  </li>\n\n  <li ng-if="!vm.isUserTestingMode">\n    <a href="#toggle-mute"\n       class="btn-icon icon-general-mute"\n       ng-class="{\'active\' : vm.muted}"\n       ng-click="vm.toggleMute($event)"\n       data-show-node="tooltip">\n      <em class="tooltip float-right">Toggle mute</em>\n    </a>\n  </li>\n\n  <!--<li ng-if="vm.isHostSession || !vm.isUserTestingMode">-->\n    <!--<a ng-click="onClickFinishSession($event)" class="button-style active">-->\n      <!--End session-->\n    <!--</a>-->\n  <!--</li>-->\n</ul>\n'),$templateCache.put("/scripts/modules/core/directives/updateInfo/modal-content/spec-mode-enterprise.html",'<img src="img/update-info/spec-mode.png" srcset="img/update-info/spec-mode-@2x.png 2x, img/update-info/spec-mode.png 1x" alt="Spec mode" width="400">\n<section class="content">\n  <h1 class="header">Say hello to Spec mode</h1>\n  <ul class="with-ticks">\n    <li>Eliminate time-consuming redlining of your mockups and focus on what matters.</li>\n    <li>Automate your handoff between designer and developer, creating stronger fidelity between design and coded pages.</li>\n    <li>Document each element for easy reuse and bring consistency across all your products and properties.</li>\n  </ul>\n  <button type="button" class="btn btn-solid" ng-click="closeModal($event)">Start using Spec Mode</button>\n</section>'),$templateCache.put("/scripts/modules/core/directives/updateInfo/modal-content/spec-mode.html",'<img src="img/update-info/spec-mode-sketch.jpg" srcset="img/update-info/spec-mode-sketch-@2x.jpg 2x, img/update-info/spec-mode-sketch.jpg 1x" alt="Spec mode" width="470">\n<section class="content">\n  <h1 class="header">Spec Mode</h1>\n  <p class="lead">Where development matches design</p>\n  <p>With Spec Mode and new Sketch Integration, you\'ll:</p>\n  <ul class="with-ticks">\n    <li>Close the gap between design and development, making handoffs a snap.</li>\n    <li>Auto-generate design specs. Add metadata to any element once, keep it forever.</li>\n    <li>Keep your designs sharp when you turn your Sketch files into UXPin prototypes.</li>\n  </ul>\n  <button type="button" class="btn btn-solid" ng-click="closeModal($event)">Try Spec Mode!</button>\n</section>')}]),function(){"use strict";function config($stateProvider){if(ApplicationConfiguration.isDesignSystem){window.ApplicationConfiguration.libraryHash,window.ApplicationConfiguration.idSymbol;$stateProvider.state("designSystem",{abstract:!1,url:"",views:{canvas:{templateUrl:"/scripts/modules/core/views/canvas.view.html",controller:"CanvasController"},topBar:{templateUrl:"/scripts/modules/core/views/topBar.view.html",controller:"TopBarController",controllerAs:"vm"},layers:{templateUrl:"/scripts/modules/core/views/layers.view.html",controller:"LayersController",controllerAs:"vm"},specification:{templateUrl:"/scripts/modules/specification/views/specification.view.html",controller:"SpecificationController",controllerAs:"vm"}},resolve:{isSpecModeEnabled:function($q,Settings){var defer=$q.defer();return Settings.disableSpecification?defer.reject():defer.resolve(),defer.promise}}})}}angular.module("designSystem").config(config),config.$inject=["$stateProvider"]}(),function(){"use strict";function DesignSystemLayout(FeatureToggler,$rootScope,$scope,$window,deviceDetectorHelper,PreviewNavigation,SpecificationService,Engine){var vm=this;vm.isChrome=deviceDetectorHelper.isChrome(),vm.isSafari=deviceDetectorHelper.isSafari(),vm.isFirefox=deviceDetectorHelper.isFirefox(),vm.isSpecModeFeature=SpecificationService.isSpecificationVisible(),vm.PREVIEW_MODES=PreviewNavigation.PREVIEW_MODES,vm.PREVIEW_PANELS=PreviewNavigation.PREVIEW_PANELS,vm.MAIN_PANELS=PreviewNavigation.MAIN_PANELS,vm.isLoading=!0,vm.isModeActive=PreviewNavigation.isModeActive,vm.isPanelVisible=PreviewNavigation.isPanelVisible,vm.isPanelExpanded=PreviewNavigation.isPanelExpanded,vm.leftPanelVisible=!1,$rootScope.$on("$stateChangeError",function(){$window.location="/404"}),$rootScope.$on(PreviewEnums.LOADING,function(e,value){vm.isLoading=value}),$scope.$watch(PreviewNavigation.isLeftPanelVisible,function(value,oldValue){vm.leftPanelVisible=value,value!==oldValue&&Engine.updateCanvasRectangle()})}angular.module("designSystem").controller("DesignSystemLayout",DesignSystemLayout),DesignSystemLayout.$inject=["FeatureToggler","$rootScope","$scope","$window","deviceDetectorHelper","PreviewNavigation","SpecificationService","Engine"]}(),function(){"use strict";function DocumentationController(_,$rootScope,AnalyticsService,Engine,PagesService,PreviewNavigation){function isVisible(){return PreviewNavigation.isModeActive(PreviewNavigation.PREVIEW_MODES.DOCUMENTATION)}function onLoadPage(){vm.documentation=Engine.getDocumentation(),vm.pageId=PagesService.currentPageId,vm.hasPageDocumentation=Engine.isDocumentationAvailable()}function handleModeChanged(e,mode){mode===PreviewNavigation.PREVIEW_MODES.DOCUMENTATION?(AnalyticsService.kissEvent("Preview - Documentation - Mode switched"),onZoomChangeOff=$rootScope.$on(PreviewEnums.ON_ZOOM_CHANGE,_.debounce(onZoomChange,DEBOUNCE_DELAY))):(vm.trackZoomChange=!0,onZoomChangeOff&&onZoomChangeOff())}function onZoomChange(){return vm.trackZoomChange?void AnalyticsService.kissEvent("Preview - Documentation - Zoom used"):void(vm.trackZoomChange=!0)}var onZoomChangeOff,vm=this,DEBOUNCE_DELAY=500;vm.trackZoomChange=!1,vm.isVisible=isVisible,$rootScope.$on(PreviewEnums.ON_PAGE_LOADED,onLoadPage),$rootScope.$on(PreviewEnums.ON_PREVIEW_MODE_CHANGED,handleModeChanged)}angular.module("documentation").controller("DocumentationController",DocumentationController),DocumentationController.$inject=["_","$rootScope","AnalyticsService","Engine","PagesService","PreviewNavigation"]}(),function(){"use strict";function SpecificationController(_,ProjectsService,PagesService,$scope,$rootScope,Engine,Grid,BreakpointsService,SpecificationService,inspectorService,localStorageService,editorSocket,UnitService,ElementService,AnalyticsService,Color,FeatureToggler,DesignSystem,$window){function getPageName(id){if(PagesService.pagesMap[id])return PagesService.pagesMap[id].name}function getAllElementsDocumantation(){var projectHash=ProjectsService.currentProjectHash;DesignSystem.fetchDesignSystems(projectHash).then(function(data){documentation=data||{}})}function onResetSelection(){selectedElement=null,Engine.deselectAllElements(),setCurrentObjectType(ElementEnums.TYPE.CANVAS)}function onPageLoad(){isSpecMode()&&initalizeSpecMode()}function initalizeSpecMode(){initPage(),currentPage||(currentPage=Engine.getPage(),currentPage.on($window.uxpinEngine.Events.ELEMENT_PICKED,onPick),offOnPick=$rootScope.$on(PreviewEnums.LAYER_SELECTED,function(event,data){onPick({element:data},event.name)}),currentPage.on($window.uxpinEngine.Events.ELEMENT_HOVERED,onHover),offOnHover=$rootScope.$on(PreviewEnums.LAYER_HOVERED,function(event,data){onHover({element:data},event.name)}))}function onPageChange(e,id){vm.currentPageName=getPageName(id)}function onModeChange(isSpecMode){isSpecMode&&initalizeSpecMode(),currentPage&&(isSpecMode&&cache.canvas?(AnalyticsService.kissEvent("Spec - Mode entered"),inspectorService.setSource({isCanvasBoundingRect:!0,x:0,y:0,width:cache.canvas.canvasViewWidth,height:cache.canvas.canvasViewHeight}),_.isUndefined(documentation)&&!ApplicationConfiguration.isDesignSystem&&getAllElementsDocumantation()):isSpecMode||(inspectorService.setSource(null),inspectorService.setTarget(null),setCurrentObjectType(ElementEnums.TYPE.CANVAS)))}function updateCssCode(){selectedElement&&getCache(selectedElement)&&(vm.cssCode=SpecificationService.getCssCode(getCache(selectedElement),Color.getSelectedColorType()))}function initPage(){cache={},selectedElement=null,setCurrentObjectType(ElementEnums.TYPE.CANVAS),inspectorService.setTarget(null)}function isSpecMode(){return Engine.isSpecMode()}function setData(element){switch(element||(vm.activeElementDSInfo=null),element&&!_.isEmpty(documentation)&&setElementDSInfo(element),vm.currentObjectType){case ElementEnums.TYPE.CANVAS:setCanvasData();break;case ElementEnums.TYPE.ELEMENT:setElementData(element),AnalyticsService.kissEvent("Spec - Element inspected");break;case ElementEnums.TYPE.GROUP:setGroupData(element),AnalyticsService.kissEvent("Spec - Element inspected"),element.isMultistate()&&setMultistateData(element),element.isComponent()&&!_.isEmpty(documentation)&&setElementDocumentationData(element)}selectedElement=element}function onPick(element,type){element&&element.element?setCurrentObjectType(SpecificationService.getObjectType(element.element),element.element):setCurrentObjectType(ElementEnums.TYPE.CANVAS),type!==PreviewEnums.LAYER_SELECTED&&$scope.$apply()}function setCurrentObjectType(objectType,element){vm.currentObjectType=objectType,setData(element)}function getSymbolsAncestor(element){for(var parent=element.parent,symbols=[];parent;)parent.isComponent()&&symbols.push(parent),parent=parent.parent;return symbols}function setCache(element,value){var symbols=getSymbolsAncestor(element);symbols.length?cache[MD5(element.id+_.map(symbols,"id").join(""))]=value:cache[element.id]=value}function getCache(element){var symbols=getSymbolsAncestor(element);return symbols.length?cache[MD5(element.id+_.map(symbols,"id").join(""))]:cache[element.id]}function onHover(element,type){if(lastElement!==element.element){var eventSource=type!==PreviewEnums.LAYER_HOVERED?inspectorService.EVENT_SOURCES.MOUSE:inspectorService.EVENT_SOURCES.LAYERS;element&&element.element?inspectorService.setTarget(element.element,eventSource):cache.canvas?inspectorService.setTarget({isCanvasBoundingRect:!0,x:0,y:0,width:cache.canvas.canvasViewWidth,height:cache.canvas.canvasViewHeight},eventSource):inspectorService.setTarget(null,eventSource),lastElement=element.element,type!==PreviewEnums.LAYER_HOVERED&&$scope.$apply()}}function changeTab(tab){tab!==vm.activeTab&&AnalyticsService.kissEvent("Spec - Tab switched",{"Spec - Tab switched":vm.activeTab}),vm.activeTab=tab,setTab(tab)}function setTab(tab){localStorageService.set(SPEC_TAB_KEY,tab)}function getTab(){var tab,storage=localStorageService.get(SPEC_TAB_KEY);return!storage||storage===vm.SPEC_TABS.METADATA&&!vm.metadata.length||storage===vm.SPEC_TABS.INTERACTIONS&&!vm.interactions.length?(tab=vm.DEFAULT_TAB,setTab(tab)):tab=storage,tab}function checkTabsContent(specProperties){if(vm.activeTab===vm.SPEC_TABS.METADATA&&_.isEmpty(specProperties.metadata)||vm.activeTab===vm.SPEC_TABS.INTERACTIONS&&_.isEmpty(specProperties.interactions))return changeTab(vm.DEFAULT_TAB)}function changeState(stateId){selectedElement.showState(stateId),$window.requestAnimationFrame(function(){$rootScope.$emit(PreviewEnums.SPEC_MODE_REFRESH_ELEMENT_SELECTION),setGeneralProperties(selectedElement),$scope.$apply()})}function setGeneralProperties(properties){vm.width=properties.width,vm.height=properties.height,vm.left=properties.x,vm.top=properties.y,vm.opacity=properties.opacity}function setCanvasData(){var specProperties,lastUpdatedDate=SpecificationService.getLastUpdateDate();updateGridData(),specProperties=cache.canvas||Engine.getCanvasSpecProperties(),vm.sketchArtboard=specProperties.sketchArtboard,vm.sketchArtboard&&vm.sketchArtboard.width&&vm.sketchArtboard.height&&(specProperties.canvasViewWidth=vm.sketchArtboard.width,specProperties.canvasViewHeight=vm.sketchArtboard.height),cache.canvas=specProperties,vm.width=specProperties.canvasViewWidth,vm.height=specProperties.canvasViewHeight,vm.isLoaded=!0,vm.grid={columnWidth:specProperties.gridColumnWidth,columns:specProperties.gridColumns,gutter:specProperties.gridGutter,margin:specProperties.gridMargin},vm.name="",vm.colors=_.values(specProperties.colors),vm.fonts=_.values(specProperties.fonts),vm.gradients=specProperties.gradients,vm.canvasBg=SpecificationService.getCanvasBg(specProperties),vm.cssCode="",vm.images=SpecificationService.getCanvasImages(specProperties),vm.border={},vm.lastUpdatedDate=lastUpdatedDate?lastUpdatedDate.fromNow:"",vm.lastUpdatedDateTitle=lastUpdatedDate?lastUpdatedDate.full:"",vm.metadata=specProperties.metadata,vm.textContentTrimmed="",vm.shadows=[],vm.innerShadows=[],vm.additionalStyles={},vm.background={position:specProperties.backgroundPosition,repeat:specProperties.backgroundRepeat,size:specProperties.backgroundSize},isSpecMode()&&inspectorService.setSource({isCanvasBoundingRect:!0,x:0,y:0,width:specProperties.canvasViewWidth,height:specProperties.canvasViewHeight}),checkTabsContent(specProperties)}function setGroupData(element){var specProperties=getCache(element)||element.getSpecProperties();setGeneralProperties(specProperties),setParentProperty(element),vm.colors=_.values(specProperties.colors),vm.fonts=_.values(specProperties.fonts),vm.gradients=specProperties.gradients,vm.name=specProperties.name,vm.blur=specProperties.blur,vm.type=element.type,vm.typeClass=ElementService.getElementTypeClass(element),vm.fixed=specProperties.fixed,vm.cssCode="",vm.border={},vm.angle=Math.round(specProperties.angle),vm.metadata=specProperties.metadata,vm.textContentTrimmed="",vm.shadows=SpecificationService.getElementShadows(specProperties),vm.innerShadows=SpecificationService.getElementInnerShadows(specProperties),vm.isMultistate=!1,inspectorService.setSource(element),setCache(element,specProperties),checkTabsContent(specProperties)}function setElementDocumentationData(element){if(!element.hasMaster)return void(vm.activeElementDocumentation=null);var idMaster=element.getComponentMasterId();vm.activeElementDocumentation=documentation[idMaster]||null}function setElementDSInfo(element){for(var component=element.componentInstance;component&&!documentation[component.getComponentMasterId()];)component=component.componentInstance;if(!component)return void(vm.activeElementDSInfo=null);var idMaster=component.getComponentMasterId();vm.activeElementDSInfo={element:component,documentation:documentation[idMaster]}}function setMultistateData(element){vm.isMultistate=!0,vm.states=element.states,vm.selectedState={id:element.activeState.id,name:element.activeState.name}}function setElementData(element){var specProperties=getCache(element)||element.getSpecProperties();setGeneralProperties(specProperties),setParentProperty(element),vm.colors=SpecificationService.getElementColors(specProperties),vm.fonts=specProperties.fonts.fontsList,vm.name=specProperties.name,vm.blur=specProperties.blur,vm.typeClass=ElementService.getElementTypeClass(element),vm.fixed=specProperties.fixed,vm.cssCode=SpecificationService.getCssCode(specProperties),vm.images=SpecificationService.getElementImages(specProperties,element),vm.border=SpecificationService.getBorderData(specProperties),vm.gradients=[],vm.angle=Math.round(specProperties.angle),vm.metadata=specProperties.metadata,vm.textContentTrimmed=ElementService.getTextContentTrimmed(specProperties,element),vm.shadows=SpecificationService.getElementShadows(specProperties),vm.innerShadows=SpecificationService.getElementInnerShadows(specProperties),vm.shouldShowBorder=ElementService.hasElementBorderProperty(element),vm.shouldShowBorderRadius=ElementService.hasElementBorderRadiusProperty(element),vm.isBorderRadiusSet=ElementService.isElementBorderRadiusSet(specProperties),vm.isTextList=ElementService.isTextList(element),vm.background={position:specProperties.backgroundPosition,repeat:specProperties.backgroundRepeat,size:specProperties.backgroundSize},inspectorService.setSource(element),setCache(element,specProperties),checkTabsContent(specProperties)}function setParentProperty(element){vm.elementParent=element.parent,vm.elementParentType=element.parent.type,vm.elementParentTypeClass=ElementService.getElementTypeClass(vm.elementParent),vm.hasParent=ElementService.hasElementParent(element)}function updateGridData(){if(ProjectsService.currentProjectSettings&&ProjectsService.currentProjectSettings.grid){var canvasDomElement=Engine.getPage().canvas.view.domElement,gridData=Grid.mapSettingsForEngine(Grid.mapSavedSettings(ProjectsService.currentProjectSettings.grid),PagesService.currentBreakpointId);gridData.gridDisplay=Engine.isGridVisible(),Engine.getPage().updateGrid(gridData),Engine.getPage().canvas.gridColumnWidth<0&&(gridData.gridColumns=Math.floor(canvasDomElement.offsetWidth/(gridData.gridColumnWidth+gridData.gridGutter)),Engine.getPage().updateGrid(gridData))}}var lastElement,currentPage,selectedElement,documentation,vm=this,SPEC_TAB_KEY="activeSpecTab",cache={},currentPageId=PagesService.currentPageId;vm.SPEC_OBJECT_TYPES=ElementEnums.TYPE,vm.isLoaded=!1,vm.grid={},vm.width=null,vm.height=null,vm.blur=null,vm.colors=[],vm.fonts=[],vm.gradients=[],vm.metadata=[],vm.interactions=[],vm.states=[],vm.background={},vm.selectedState=null,vm.isMultistate=!1,vm.currentObjectType=ElementEnums.TYPE.CANVAS,vm.SPEC_TABS=specModeEnums.SPEC_TABS,vm.DEFAULT_TAB=vm.SPEC_TABS.PROPERTIES,vm.activeTab=getTab(),vm.currentPageName=getPageName(currentPageId)||DesignSystem.getSymbolContent().name,vm.isSpecModeStyleguideFeature=FeatureToggler.specModeStyleguide,vm.activeElementDocumentation=null,vm.activeElementDSInfo=null,vm.selectElement=function(event,element){event.preventDefault(),setCurrentObjectType(SpecificationService.getObjectType(element),element),Engine.selectElement(element)},vm.isActiveObject=function(type){return vm.currentObjectType===type},vm.changeTab=changeTab,vm.changeState=changeState;var offOnPick,offOnHover;editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_SAVED,initPage);var offResetSelection=$rootScope.$on(PreviewEnums.SPEC_MODE_RESET_ELEMENT_SELECTION,onResetSelection),offPageLoad=$rootScope.$on(PreviewEnums.ON_PAGE_LOADED,onPageLoad),offPageChange=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,onPageChange);$scope.$watch(UnitService.loadMode,updateCssCode),$scope.$watch(Color.getSelectedColorType,updateCssCode),$scope.$watch(isSpecMode,onModeChange),$scope.$on("$destroy",function(){offResetSelection(),offPageLoad(),offPageChange(),offOnPick&&offOnPick(),offOnHover&&offOnHover()})}angular.module("specification").controller("SpecificationController",SpecificationController),SpecificationController.$inject=["_","ProjectsService","PagesService","$scope","$rootScope","Engine","Grid","BreakpointsService","SpecificationService","inspectorService","localStorageService","editorSocket","UnitService","ElementService","AnalyticsService","Color","FeatureToggler","DesignSystem","$window"]}(),function(global){"use strict";var specModeEnums=function(){return{SPEC_TABS:{PROPERTIES:"properties",METADATA:"metadata",INTERACTIONS:"interactions"}}}();global.specModeEnums=specModeEnums}(window),function(){"use strict";function CssService(_,tinycolor,UnitService,Color){function cleanString(text){return(text||"").trim().replace("\n","").replace(/[\u200B-\u200D\uFEFF]/g,"")}function setOpacity(specProperties){return addStyle.call(cssCode,"opacity",specProperties.opacity/100,CSS_INITIALS_VALUES.opacity)}function transformColor(color){return Color.getColorsSet(color)[colorType]}function setBoxShadow(specProperties){var boxShadowsString=_.compact([buildShadowString(specProperties.shadows,"boxShadow"),buildShadowString(specProperties.innerShadows,"boxShadow",!0)]).join(", ");if(!_.isEmpty(boxShadowsString))return addStyle.call(cssCode,"boxShadow",boxShadowsString,CSS_INITIALS_VALUES.boxShadow)}function buildShadowString(shadows,shadowProperty,isInset){var filteredShadows=_.filter(shadows,function(shadow){return shadow.shadowType===shadowProperty&&shadow.shadowEnabled});if(!_.isEmpty(filteredShadows))return _.compact(_.map(filteredShadows,function(shadow){var shadowString=addUnit(shadow.shadowOffsetX)+" "+addUnit(shadow.shadowOffsetY)+" "+addUnit(shadow.shadowBlur)+" "+shadow.shadowColor;return"filter"===shadowProperty?"drop-shadow("+shadowString+")":isInset?"inset "+shadowString:shadowString})).join("filter"===shadowProperty?" ":", ")}function setTextShadow(specProperties){var textShadowsString=buildShadowString(specProperties.shadows,"textShadow");if(!_.isEmpty(textShadowsString))return addStyle.call(cssCode,"textShadow",textShadowsString,CSS_INITIALS_VALUES.boxShadow)}function buildBlurString(value){return value?"blur("+addUnit(value)+")":""}function setFilter(specProperties){var dropShadowsString=buildShadowString(specProperties.shadows,"filter"),blurString=buildBlurString(specProperties.blur),filter=[dropShadowsString,blurString].join(" ").trim();return addStyle.call(cssCode,"filter",filter,CSS_INITIALS_VALUES.boxShadow)}function setTransform(specProperties){return specProperties.angle?addStyle.call(cssCode,"transform","rotate("+_.round(specProperties.angle)+"deg)"):addStyle.call(cssCode,"transform",specProperties.transform)}function setAdditionalStyles(specProperties){var hasAdditionalStyles=_.values(specProperties.additionalStyles).filter(function(style){return style}).length;specProperties&&!_.isEmpty(specProperties.additionalStyles)&&hasAdditionalStyles&&(addComment.call(cssCode,additionalStylesLabel),_.forEach(specProperties.additionalStyles,function(value,property){addStyle.call(cssCode,_.kebabCase(property),value)}))}function setFonts(specProperties){var uniqueFonts=_.uniqWith(specProperties.fonts.fontsList,function(a,b){return a=_.omit(a,["textContent"]),b=_.omit(b,["textContent"]),_.isEqual(a,b)});_.forEach(uniqueFonts,function(font){uniqueFonts.length>1&&addComment.call(cssCode,_.truncate(cleanString(font.textContent),{length:20})),addStyle.call(cssCode,"fontFamily",font.fontName,[]),parseInt(font.fontSize,10)&&addStyle.call(cssCode,"fontSize",UnitService.convertPx(parseInt(font.fontSize,10)),[]),addStyle.call(cssCode,"color",transformColor(font.color),[]),addStyle.call(cssCode,"fontWeight",font.fontWeight,CSS_INITIALS_VALUES.fontWeight),addStyle.call(cssCode,"fontStyle",font.fontStyle,CSS_INITIALS_VALUES.fontStyle),addStyle.call(cssCode,"textDecoration",font.textDecoration,CSS_INITIALS_VALUES.textDecoration),parseInt(font.lineHeight,10)&&addStyle.call(cssCode,"lineHeight",UnitService.convertPx(parseInt(font.lineHeight,10)),CSS_INITIALS_VALUES.fontWeight),parseInt(font.letterSpacing,10)&&addStyle.call(cssCode,"letterSpacing",UnitService.convertPx(parseInt(font.letterSpacing,10)),CSS_INITIALS_VALUES.letterSpacing),font.textTransform&&"none"!==font.textTransform&&addStyle.call(cssCode,"textTransform",font.textTransform,[]),font.fontVariant&&"normal"!==font.fontVariant&&addStyle.call(cssCode,"fontVariant",font.fontVariant,[]),addStyle.call(cssCode,"textAlign",font.textAlign,CSS_INITIALS_VALUES.textAlign)})}function setBackgroundImage(specProperties){var gradientData;isGradient(specProperties.backgroundImage)?(gradientData=extractGradientData(specProperties.backgroundImage),addStyle.call(cssCode,"backgroundImage",getGradientCssStyle(colorType,gradientData))):specProperties.backgroundImage&&addStyle.call(cssCode,"backgroundImage",specProperties.backgroundImage.split("/").pop())}function setBackgroundPosition(specProperties){specProperties.backgroundImage&&addStyle.call(cssCode,"backgroundPosition",specProperties.backgroundPosition,CSS_INITIALS_VALUES.backgroundPosition)}function setColor(propertyName,initialValues,specProperties){specProperties[propertyName]&&addStyle.call(cssCode,propertyName,specProperties[propertyName][colorType],initialValues)}function setProperty(propertyName,initialValues,isNumber,specProperties){addStyle.call(cssCode,propertyName,specProperties[propertyName],initialValues,isNumber)}function getBorderWidths(specProperties){return _.map(_.values(_.pick(specProperties,["borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopWidth"])),function(value){return parseInt(value,10)||0})}function getBorderRadiuses(specProperties){return _.map(_.values(_.pick(specProperties,["borderTopLeftRadius","borderBottomLeftRadius","borderTopRightRadius","borderBottomRightRadius"])),function(value){return parseInt(value,10)||0})}function hasBorder(specProperties){var bordersWidths=getBorderWidths(specProperties);return bordersWidths.some(function(border){
return border>0})}function hasBorderRadius(specProperties){var bordersRadiuses=getBorderRadiuses(specProperties);return bordersRadiuses.some(function(border){return border>0})}function setBorderRadius(specProperties){var borderRadiuses=getBorderRadiuses(specProperties),isBorderRadiusEqual=function(border){return border===borderRadiuses[0]};if(hasBorderRadius(specProperties)){if(borderRadiuses.every(isBorderRadiusEqual))return addStyle.call(cssCode,"border-radius",borderRadiuses[0],[],!0);addStyle.call(cssCode,"border-top-left-radius",borderRadiuses[0],[],!0),addStyle.call(cssCode,"border-bottom-left-radius",borderRadiuses[1],[],!0),addStyle.call(cssCode,"border-top-right-radius",borderRadiuses[2],[],!0),addStyle.call(cssCode,"border-bottom-right-radius",borderRadiuses[3],[],!0)}}function setBorder(specProperties){var borders=getBorderWidths(specProperties),borderColor=specProperties.borderColor?specProperties.borderColor[colorType]:"transparent",isBorderEqual=function(value){return borders[0]===value};if(hasBorder(specProperties)){if(_.every(borders,isBorderEqual))return void addStyle.call(cssCode,"border",addUnit(borders[0])+" "+specProperties.borderStyle+" "+borderColor);addStyle.call(cssCode,"border-top-width",borders[0],[],!0),addStyle.call(cssCode,"border-bottom-width",borders[1],[],!0),addStyle.call(cssCode,"border-left-width",borders[2],[],!0),addStyle.call(cssCode,"border-right-width",borders[3],[],!0),addStyle.call(cssCode,"border-style",specProperties.borderStyle),addStyle.call(cssCode,"border-color",borderColor)}}function setPadding(specProperties){var paddings={left:parseInt(specProperties.paddingLeft,10),right:parseInt(specProperties.paddingRight,10),top:parseInt(specProperties.paddingTop,10),bottom:parseInt(specProperties.paddingBottom,10)},isFalsy=function(value){return!value},isPaddingEqual=function(value){return paddings.left===value};if(!_.every(paddings,isFalsy))return _.every(paddings,isPaddingEqual)?void addStyle.call(cssCode,"padding",paddings.left,[],!0):_.isEqual(paddings.left,paddings.right)&&!_.isEqual(paddings.top,paddings.bottom)?void addStyle.call(cssCode,"padding",[addUnit(paddings.top),addUnit(paddings.right),addUnit(paddings.bottom)].join(" ")):_.isEqual(paddings.left,paddings.right)&&_.isEqual(paddings.top,paddings.bottom)?void addStyle.call(cssCode,"padding",[addUnit(paddings.top),addUnit(paddings.right)].join(" ")):void addStyle.call(cssCode,"padding",[addUnit(paddings.top),addUnit(paddings.right),addUnit(paddings.bottom),addUnit(paddings.left)].join(" "))}function setPositionFixed(specProperties){specProperties.fixed&&(addStyle.call(cssCode,"position","fixed"),addStyle.call(cssCode,"left",parseInt(specProperties.x,10),[],!0),addStyle.call(cssCode,"top",parseInt(specProperties.y,10),[],!0))}function toDash(str){return str.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function addUnit(value,isFont){return UnitService.convertPx(value,isFont)}function addStyle(propertyName,propertyValue,initialValues,isNumber){initialValues=initialValues||[],propertyValue&&initialValues.indexOf(propertyValue)===-1&&(isNumber&&(propertyValue=addUnit(parseInt(propertyValue,10))),this.push(toDash(propertyName)+": "+propertyValue+";"))}function addComment(string){this.push("/* "+string+" */")}function isGradient(value){return/^linear-gradient/.test(value)||/^radial-gradient/.test(value)}function getColorsSets(colors){return colors.map(function(rgb){var tmpColor=tinycolor(rgb);return{rgba:tmpColor.toRgbString(),hex:tmpColor.toHexString(),alpha:tmpColor.getAlpha()}})}function fixColorStops(colorStops){var fixedColorStops=_.clone(colorStops);return fixedColorStops.length>=2&&(fixedColorStops[fixedColorStops.length-1]="100%"),fixedColorStops}function getGradientCssStyle(mode,gradientData){var cssStyle,colorValue,colorsStr=gradientData.colors.map(function(color,id){return colorValue=color.alpha<1?color.rgba:color.hex,colorValue+" "+gradientData.colorsStops[id]}).join(", ");return cssStyle=gradientData.type===GRADIENT_TYPES.RADIAL?"radial-gradient("+gradientData.shape+", "+colorsStr+" )":"linear-gradient("+gradientData.angle+"deg, "+colorsStr+" )"}function createGradientObject(type,gradientData){var shape,angle,rgbs,hexs,colorsStops,colors;return rgbs=gradientData.match(/rgba?\([^)]+\)/g)||[],hexs=gradientData.match(/#([0-9A-F]*)/g)||[],colors=getColorsSets(rgbs.concat(hexs)),colorsStops=fixColorStops(gradientData.match(/[0-9]+%/g)||[]),type===GRADIENT_TYPES.RADIAL?shape=gradientData.split(",")[0]||"":angle=gradientData.match(/(.*)deg/)?gradientData.match(/(.*)deg/)[1]:0,{angle:parseFloat(angle)?180-parseFloat(angle):parseFloat(angle),colors:colors,type:type,colorsStops:colorsStops,shape:shape}}function extractGradientData(gradient){var data=[],type="";return/^linear-gradient/.test(gradient)&&(data=gradient.match(/^linear-gradient\((.*)\)/),type=GRADIENT_TYPES.LINEAR),/^radial-gradient/.test(gradient)&&(data=gradient.match(/^radial-gradient\((.*)\)/),type=GRADIENT_TYPES.RADIAL),data[1]?createGradientObject(type,data[1]):null}function getCssCodeFromSpecProperties(specProperties,selectedColorType){var cssPropertiesSettersFns=[setPositionFixed,setProperty.bind(this,"width",CSS_INITIALS_VALUES.width,!0),setProperty.bind(this,"height",CSS_INITIALS_VALUES.height,!0),setOpacity,setPadding,setBorder,setBorderRadius,setColor.bind(this,"fill",[]),setColor.bind(this,"backgroundColor",CSS_INITIALS_VALUES.backgroundColor),setBackgroundImage,setBackgroundPosition,setProperty.bind(this,"backgroundRepeat",CSS_INITIALS_VALUES.backgroundRepeat,!1),setProperty.bind(this,"backgroundSize",CSS_INITIALS_VALUES.backgroundSize,!1),setFonts,setBoxShadow,setTextShadow,setFilter,setTransform,setAdditionalStyles];return colorType=selectedColorType||Color.COLOR_TYPES.HEX,cssCode=[],_.forEach(cssPropertiesSettersFns,function(property){_.isFunction(property)&&property(specProperties)}),cssCode.join("\n")}var colorType,CSS_INITIALS_VALUES={width:["auto"],height:["auto"],backgroundColor:["transparent"],backgroundPosition:["0% 0%"],backgroundSize:["auto"],backgroundRepeat:["repeat"],textAlign:["start","left"],letterSpacing:["normal"],lineHeight:["normal"],fontWeight:["normal",400],fontStyle:["normal"],textDecoration:["none"],dropShadow:["none"],textShadow:["none"],opacity:[1]},GRADIENT_TYPES={LINEAR:"Linear",RADIAL:"Radial"},cssCode=[],additionalStylesLabel="Custom CSS";return{extractGradientData:extractGradientData,getGradientCssStyle:getGradientCssStyle,getCssCodeFromSpecProperties:getCssCodeFromSpecProperties,hasBorder:hasBorder,hasBorderRadius:hasBorderRadius,isGradient:isGradient}}angular.module("specification").factory("CssService",CssService),CssService.$inject=["_","tinycolor","UnitService","Color"]}(),function(){"use strict";function DateService(_,moment){function getDate(date){var lastestDate=_.isArray(date)?Math.max.apply(Math,date):date;if(lastestDate&&0!==lastestDate)return lastestDate=moment(1e3*lastestDate),{fromNow:lastestDate.fromNow(),full:lastestDate.format(DATE_TITLE_FORMAT)}}var DATE_TITLE_FORMAT="D MMMM YYYY [at] h:mm:ss a";return{getDate:getDate}}angular.module("specification").factory("DateService",DateService),DateService.$inject=["_","moment"]}(),function(){"use strict";function ElementService(_,CssService,FileService,SvgService,ElementClassService,Color){function getUniqueFontColors(fontsColors){return _.uniq(_.compact(fontsColors),function(color){return color.hex+color.alpha})||[]}function getBackgroundColor(specProperties){var backgroundColor;return!_.isEmpty(specProperties.backgroundColor)&&parseFloat(specProperties.backgroundColor.alpha)?(backgroundColor=specProperties.backgroundColor,backgroundColor.type=COLOR_TYPES.FILL):_.isEmpty(specProperties.fill)?specProperties.gradient&&(backgroundColor={type:COLOR_TYPES.FILL,gradient:specProperties.gradient},backgroundColor.type=COLOR_TYPES.FILL):_.isArray(specProperties.fill)?backgroundColor=specProperties.fill.map(function(color){return _.extend({},color,{type:COLOR_TYPES.FILL})}):(backgroundColor=specProperties.fill,backgroundColor.type=COLOR_TYPES.FILL),backgroundColor}function getActiveBackgroundColor(specProperties){var activeBackgroundColor;return!_.isEmpty(specProperties.activeBackgroundColor)&&parseFloat(specProperties.activeBackgroundColor.alpha)&&(activeBackgroundColor=specProperties.activeBackgroundColor,activeBackgroundColor.type=COLOR_TYPES.FILL),activeBackgroundColor}function getBorderColor(specProperties){var borderColor;return CssService.hasBorder(specProperties)&&specProperties.borderColor&&(borderColor=specProperties.borderColor,borderColor.type=COLOR_TYPES.BORDER),borderColor}function getCellsBackgroundColors(specProperties){var cellsBackgroundColors=[];return specProperties.cellsBackgroundColors&&(cellsBackgroundColors=specProperties.cellsBackgroundColors.map(function(color){return color.type=COLOR_TYPES.FILL,color})),cellsBackgroundColors}function getCellsBorderColors(specProperties){var cellsBorderColors=[];return specProperties.cellsBorderColors&&(cellsBorderColors=specProperties.cellsBorderColors.map(function(color){return color.type=COLOR_TYPES.BORDER,color})),cellsBorderColors}function getStrokeColor(specProperties){return _.isArray(specProperties.strokeColor)?specProperties.strokeColor.map(function(color){return color.type=COLOR_TYPES.STROKE,color}):null}function getElementColors(specProperties){var colors=[],backgroundColor=getBackgroundColor(specProperties),activeBackgroundColor=getActiveBackgroundColor(specProperties),borderColor=getBorderColor(specProperties),cellsBackgroundColors=getCellsBackgroundColors(specProperties),cellsBorderColors=getCellsBorderColors(specProperties),fontColors=getUniqueFontColors(specProperties.fontsColors),strokeColor=getStrokeColor(specProperties);return colors=_.compact(colors.concat(fontColors.map(function(color){return color.type=COLOR_TYPES.COLOR,color}),backgroundColor,activeBackgroundColor,borderColor,cellsBackgroundColors,cellsBorderColors,strokeColor))}function getElementShadows(specProperties){return parseShadows(specProperties.shadows)}function getElementInnerShadows(specProperties){return parseShadows(specProperties.innerShadows)}function parseShadows(shadows){return _.map(_.filter(shadows,function(shadow){return shadow.shadowEnabled}),function(shadow){return _.assign({},shadow,{shadowColor:Color.getColorsSet(shadow.shadowColor)})})}function getElementImages(specProperties,engineElement){var svg,images=[];return engineElement.view.domElement.tagName.toLowerCase()===IMAGE_TYPES.SVG&&(svg=SvgService.getSvgImage(engineElement),images.push({path:svg.image,file:{name:engineElement.name,extension:IMAGE_TYPES.SVG},width:engineElement.width,height:engineElement.height,size:svg.size,rawSource:svg.rawSource,previewImage:svg.previewImage,type:IMAGE_TYPES.SVG})),specProperties.src&&images.push({path:specProperties.src,file:FileService.getFilename(specProperties.src),type:IMAGE_TYPES.URL}),specProperties.backgroundImage&&!CssService.isGradient(specProperties.backgroundImage)&&images.push({path:specProperties.backgroundImage,file:FileService.getFilename(specProperties.backgroundImage),type:IMAGE_TYPES.URL}),_.compact(images)}function getBorderData(specProperties){return _.mapValues(_.pick(specProperties,["borderStyle","borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"]),function(value){var number=parseInt(value);return number||value})}function getTextContentTrimmed(specProperties,element){var textContentTrimmed,textContent=specProperties.textContent;if(!_.isEmpty(textContent)){if(isTextList(element)){var trimmedWithClosingTag;return trimmedWithClosingTag=element.inputValue.replace(/<(?!\/li\s*?)[^>]+>/g,""),textContentTrimmed=trimmedWithClosingTag.replace(/\<\/li\>/g,"\r\n").trim()}textContentTrimmed=textContent.trim().replace(/\u200B/g,"")}return textContentTrimmed}function getElementTypeClass(element){return ElementClassService.getListItemClassByType(element.type)}function hasElementOneOfProperties(element,properties){for(var property,i=0;i<properties.length;i++)if(property=properties[i],property in element)return!0;return!1}function hasElementBorderProperty(element){return hasElementOneOfProperties(element,["borderTopWidth","borderBottomWidth","borderLeftWidth","borderRightWidth"])}function hasElementBorderRadiusProperty(element){return hasElementOneOfProperties(element,["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"])}function hasElementParent(element){var parentType=element.parent.type.toLowerCase();return!_.isEmpty(parentType)&&parentType!==ElementEnums.TYPE.CANVAS}function isElementBorderRadiusSet(specProperties){return CssService.hasBorderRadius(specProperties)}function isGroup(element){var objectType=ElementEnums.TYPE;return element&&element.type&&[objectType.GROUP,objectType.MULTISTATE,objectType.COMPONENT].indexOf(element.type.toLowerCase())!==-1}function isHotspot(element){var objectType=ElementEnums.TYPE;return element&&element.type&&[objectType.HOTSPOT].indexOf(element.type.toLowerCase())!==-1}function isTag(element){var objectType=ElementEnums.TYPE;return element&&element.type&&[objectType.TAG].indexOf(element.type.toLowerCase())!==-1}function isTextList(element){var value=element.inputValue;return element.type.toLowerCase()===ELEMENT_TYPE.TEXT_ELEMENT&&(value.indexOf("<ul><li>")>-1||value.indexOf("<ol><li>")>-1)}function getGroupAncestor(element){for(var ancestor=element.parent;ancestor&&!isGroup(ancestor);)ancestor=ancestor.parent;return ancestor}function getAncestors(element){for(var ancestors=[];element.parent;)ancestors.push(element.parent),element=element.parent;return ancestors}function canBeFixed(element){var ancestors=getAncestors(element);return!_.some(ancestors,function(ancestor){return ancestor.isClip||ancestor.isMultistate()})}function isAncestorFixed(el){for(var currentElement=el.parent;currentElement&&"Canvas"!==currentElement.type;){if(currentElement.fixed)return!0;currentElement=currentElement.parent}return!1}var ELEMENT_TYPE=ElementEnums.TYPE,COLOR_TYPES={FILL:"Fill",BORDER:"Border",COLOR:"Text",STROKE:"Stroke"},IMAGE_TYPES={SVG:"svg",URL:"url"};return{getElementColors:getElementColors,getElementShadows:getElementShadows,getElementInnerShadows:getElementInnerShadows,getElementImages:getElementImages,getBorderData:getBorderData,getTextContentTrimmed:getTextContentTrimmed,getElementTypeClass:getElementTypeClass,hasElementBorderProperty:hasElementBorderProperty,hasElementBorderRadiusProperty:hasElementBorderRadiusProperty,hasElementParent:hasElementParent,isElementBorderRadiusSet:isElementBorderRadiusSet,isGroup:isGroup,isHotspot:isHotspot,isTag:isTag,isTextList:isTextList,getGroupAncestor:getGroupAncestor,getAncestors:getAncestors,canBeFixed:canBeFixed,isAncestorFixed:isAncestorFixed}}angular.module("specification").factory("ElementService",ElementService),ElementService.$inject=["_","CssService","FileService","SvgService","ElementClassService","Color"]}(),angular.module("specification").factory("inspectorService",["_","$rootScope","Engine",function(_,$rootScope,Engine){"use strict";function Point(x,y,type){this.x=x,this.y=y,this.type=type}function updateScale(){scale=Engine.getScale()}function getElementCenterPoints(el){return{centerTopPoint:new Point(el.x+el.width/2,el.y,POINT_TYPES.TOP),centerBottomPoint:new Point(el.x+el.width/2,el.y+el.height,POINT_TYPES.BOTTOM),centerLeftPoint:new Point(el.x,el.y+el.height/2,POINT_TYPES.LEFT),centerRightPoint:new Point(el.x+el.width,el.y+el.height/2,POINT_TYPES.RIGHT)}}function isHorizontalHelperNeeded(x,target){return x<target.x||x>target.x+target.width}function isVerticalHelperNeeded(y,target){return y<target.y||y>target.y+target.height}function getVerticalHelper(point,left,target,source){var helper=null;return isVerticalHelperNeeded(point.y,target)&&(helper=point.y<target.y?getTopVerticalHelperData(left,source,target):getBottomVerticalHelperData(left,source,target)),helper}function getHorizontalHelper(point,top,source,target){var helper=null;return isHorizontalHelperNeeded(point.x,target)&&(helper=point.x<target.x?getLeftHorizontalHelperData(top,source,target):getRightHorizontalHelperData(top,source,target)),helper}function getLeftHorizontalHelperData(top,source,target){return{type:LINE_TYPES.HORIZONTAL,size:target.x-source.x+"px",left:source.x+"px",top:(target.y===top?top:top-LINE_WIDTH)+"px"}}function getRightHorizontalHelperData(top,source,target){return{type:LINE_TYPES.HORIZONTAL,size:source.x+source.width-(target.x+target.width)+"px",left:target.x+target.width+"px",top:(target.y===top?top:top-LINE_WIDTH)+"px"}}function getTopVerticalHelperData(left,source,target){return{size:target.y-source.y+"px",left:(target.x===left?left:left-LINE_WIDTH)+"px",top:source.y+"px",type:LINE_TYPES.VERTICAL}}function getBottomVerticalHelperData(left,source,target){return{type:LINE_TYPES.VERTICAL,size:source.y+source.height-(target.y+target.height)+"px",top:target.y+target.height+"px",left:(target.x===left?left:left-LINE_WIDTH)+"px"}}function getLinesDataForTopSide(point,targetData,source,target){var top,helper=null;return point.y-targetData.centerBottomPoint.y>=0?top=targetData.centerBottomPoint.y:point.y-targetData.centerTopPoint.y>=0&&(top=targetData.centerTopPoint.y),_.isNumber(top)?(helper=getHorizontalHelper(point,top,source,target),{size:_.round(point.y-top)+"px",left:point.x+"px",top:top+"px",helper:helper,type:LINE_TYPES.VERTICAL,pointType:point.type}):null}function getLinesDataForBottomSide(point,targetData,source,target){var top,helper=null;return targetData.centerTopPoint.y-point.y>=0?top=targetData.centerTopPoint.y:targetData.centerBottomPoint.y-point.y>=0&&(top=targetData.centerBottomPoint.y),_.isNumber(top)?(helper=getHorizontalHelper(point,top,source,target),{size:_.round(top-point.y)+"px",left:point.x+"px",top:point.y+"px",helper:helper,type:LINE_TYPES.VERTICAL,pointType:point.type}):null}function getLinesDataForLeftSide(point,targetData,source,target){var helper=null,left=null;return point.x-targetData.centerRightPoint.x>=0?left=targetData.centerRightPoint.x:point.x-targetData.centerLeftPoint.x>=0&&(left=targetData.centerLeftPoint.x),_.isNumber(left)?(helper=getVerticalHelper(point,left,target,source),{size:_.round(point.x-left)+"px",left:left+"px",top:point.y+"px",helper:helper,type:LINE_TYPES.HORIZONTAL,pointType:point.type}):null}function getLinesDataForRightSide(point,targetData,source,target){var helper=null,left=null;return targetData.centerLeftPoint.x-point.x>=0?left=targetData.centerLeftPoint.x:targetData.centerRightPoint.x-point.x>=0&&(left=targetData.centerRightPoint.x),_.isNumber(left)?(helper=getVerticalHelper(point,left,target,source),{size:_.round(left-point.x)+"px",left:point.x+"px",top:point.y+"px",helper:helper,type:LINE_TYPES.HORIZONTAL,pointType:point.type}):null}function isChild(parent,child){return parent.x<=child.x&&parent.y<=child.y&&parent.x+parent.width>=child.x+child.width&&parent.y+parent.height>=child.y+child.height}function getTargetBoundingRect(shift){return target?target.isCanvasBoundingRect?{x:Math.round(target.x+(shift&&shift.x?shift.x:0))*scale,y:Math.round(target.y+(shift&&shift.y?shift.y:0))*scale,width:target.width*scale,height:target.height*scale,isCanvasBoundingRect:target.isCanvasBoundingRect}:getElementBoundingRect(target,shift):null}function getElementBoundingRect(element,shift){if(!element)return null;var box=element.getBoundingBox(!0);return{x:Math.round(box.left+(shift&&shift.x?shift.x:0))*scale,y:Math.round(box.top+(shift&&shift.y?shift.y:0))*scale,width:(box.right-box.left)*scale,height:(box.bottom-box.top)*scale}}function getSourceBoundingRect(shift){return source?source.isCanvasBoundingRect?{x:Math.round(source.x+(shift&&shift.x?shift.x:0))*scale,y:Math.round(source.y+(shift&&shift.y?shift.y:0))*scale,width:source.width*scale,height:source.height*scale,isCanvasBoundingRect:source.isCanvasBoundingRect}:getElementBoundingRect(source,shift):null}var source,target,POINT_TYPES={LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},LINE_TYPES={HORIZONTAL:"horizontal",VERTICAL:"vertical"},LINE_WIDTH=1,scale=Engine.getScale();return $rootScope.$on(PreviewEnums.ON_ZOOM_CHANGE,updateScale),{POINT_TYPES:POINT_TYPES,LINE_TYPES:LINE_TYPES,EVENT_SOURCES:{MOUSE:"mouse",LAYERS:"layers"},setTarget:function(newTarget,eventSource){target=newTarget,$rootScope.$emit(PreviewEnums.INSPECTOR_TARGET_CHANGED,eventSource||this.EVENT_SOURCES.MOUSE)},setSource:function(newSource){source=newSource,$rootScope.$emit(PreviewEnums.INSPECTOR_SOURCE_CHANGED)},getTarget:function(){return target},getSource:function(){return source},getSourceBoundingRect:getSourceBoundingRect,getTargetBoundingRect:getTargetBoundingRect,getElementBoundingRect:getElementBoundingRect,getLineAndHelpersData:function(sourceShift,targetShift){if(source&&target){var sourceBoundingRect=getSourceBoundingRect(sourceShift),targetBoundingRect=getTargetBoundingRect(targetShift);isChild(sourceBoundingRect,targetBoundingRect)&&(targetBoundingRect=[sourceBoundingRect,sourceBoundingRect=targetBoundingRect][0]);var sourceData=getElementCenterPoints(sourceBoundingRect),targetData=getElementCenterPoints(targetBoundingRect);return _.compact(_.map(sourceData,function(point){switch(point.type){case POINT_TYPES.TOP:return getLinesDataForTopSide(point,targetData,sourceBoundingRect,targetBoundingRect);case POINT_TYPES.BOTTOM:return getLinesDataForBottomSide(point,targetData,sourceBoundingRect,targetBoundingRect);case POINT_TYPES.LEFT:return getLinesDataForLeftSide(point,targetData,sourceBoundingRect,targetBoundingRect);case POINT_TYPES.RIGHT:return getLinesDataForRightSide(point,targetData,sourceBoundingRect,targetBoundingRect)}}))}}}}]),function(){"use strict";function SpecificationService(_,moment,FileService,CssService,ElementService,DateService,UsersService,FeatureToggler){function isSpecificationVisible(){return FeatureToggler.specModeStyleguide&&("W"===ApplicationConfiguration.project.type||ApplicationConfiguration.isDesignSystem)}function getObjectType(object){return _.isFunction(object.isCanvas)&&object.isCanvas()?ElementEnums.TYPE.CANVAS:_.isFunction(object.isGroup)&&object.isGroup()||_.isFunction(object.isComponent)&&object.isComponent()?ElementEnums.TYPE.GROUP:ElementEnums.TYPE.ELEMENT}function getCanvasBg(specProperties){var bg;return CssService.isGradient(specProperties.backgroundImage)?bg={gradient:specProperties.backgroundImage}:specProperties.backgroundColor&&(bg=specProperties.backgroundColor),bg}function getCanvasImages(specProperties){var images=[];return specProperties.backgroundImage&&!CssService.isGradient(specProperties.backgroundImage)&&images.push({path:specProperties.backgroundImage,file:FileService.getFilename(specProperties.backgroundImage),type:"url"}),_.compact(images)}function getCssCode(specProperties,colorType){return CssService.getCssCodeFromSpecProperties(specProperties,colorType)}function getElementImages(specProperties,engineElement){return ElementService.getElementImages(specProperties,engineElement)}function getElementColors(specProperties){return ElementService.getElementColors(specProperties)}function getElementShadows(specProperties){return ElementService.getElementShadows(specProperties)}function getElementInnerShadows(specProperties){return ElementService.getElementInnerShadows(specProperties)}function getBorderData(specProperties){return ElementService.getBorderData(specProperties)}function setLastUpdateDate(date){lastUpdate=DateService.getDate(date)}function getLastUpdateDate(){return lastUpdate}var lastUpdate;return{getElementColors:getElementColors,getElementShadows:getElementShadows,getElementInnerShadows:getElementInnerShadows,getObjectType:getObjectType,getCssCode:getCssCode,getElementImages:getElementImages,getCanvasImages:getCanvasImages,getBorderData:getBorderData,getCanvasBg:getCanvasBg,setLastUpdateDate:setLastUpdateDate,getLastUpdateDate:getLastUpdateDate,isSpecificationVisible:isSpecificationVisible}}angular.module("specification").factory("SpecificationService",SpecificationService),SpecificationService.$inject=["_","moment","FileService","CssService","ElementService","DateService","UsersService","FeatureToggler"]}(),function(){"use strict";function SvgService(_,$document){function getSvgData(engineElement,previewMode){var source,svg=angular.element(engineElement.view.domElement.cloneNode(!0)),serializer=new XMLSerializer;svg.attr("version",1.1).attr("preserveAspectRatio","xMidYMid meet").attr("xmlns","http://www.w3.org/2000/svg").css({transform:null,opacity:null,filter:"none",webkitFilter:"none"});var viewBox=svg.attr("viewBox"),hasMask=!_.isEmpty(svg.find("mask"));if(viewBox&&parseInt(engineElement.strokeWidth,10)&&!hasMask){var viewBoxData=viewBox.split(" ").map(function(value){return parseFloat(value)});$document[0].body.appendChild(svg[0]);var screenCTM=svg[0].getScreenCTM();$document[0].body.removeChild(svg[0]);var offset=engineElement.strokeWidth/2/screenCTM.a,width=Math.ceil(viewBoxData[2]+2*offset),height=Math.ceil(viewBoxData[3]+2*offset);svg.attr("viewBox",[viewBoxData[0]-offset,viewBoxData[1]-offset,width,height].join(" "))}return previewMode&&(viewBox||svg.attr("viewBox","0 0 "+engineElement.width+" "+engineElement.height),svg.attr("preserveAspectRatio","xMidYMid slice"),svg.css({width:PREVIEW_IMAGE_SIZE.WIDTH+"px",height:PREVIEW_IMAGE_SIZE.HEIGHT+"px"})),source=serializer.serializeToString(svg[0]),source='<?xml version="1.0" standalone="no"?>\r\n'+source,{image:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(source),rawSource:source,size:source.length}}function getSvgImage(engineElement){var svgData=getSvgData(engineElement);return{previewImage:getSvgData(engineElement,!0).image,image:svgData.image,rawSource:svgData.rawSource,size:svgData.size}}var PREVIEW_IMAGE_SIZE={WIDTH:70,HEIGHT:70};return{getSvgImage:getSvgImage}}angular.module("specification").factory("SvgService",SvgService),SvgService.$inject=["_","$document"]}(),function(){"use strict";function UnitService(localStorageService,UnitConversionService){function changeMode(mode){activeMode=mode,saveMode(mode)}function getActiveMode(){return activeMode}function saveMode(mode){return localStorageService.set(UNIT_MODE_KEY,mode)}function loadMode(){return localStorageService.get(UNIT_MODE_KEY)}function initActiveModeMap(){var map={};return map[UNIT_MODES.PIXELS]=convertToPx,map[UNIT_MODES.POINTS]=convertToPt,map[UNIT_MODES.RETINA_X2]=convertToRetina(RETINA_SCALE_FACTOR.X2),map[UNIT_MODES.RETINA_X3]=convertToRetina(RETINA_SCALE_FACTOR.X3),map[UNIT_MODES.LDPI]=convertToAndroid(DENSITY_TYPES.LDPI.VALUE),map[UNIT_MODES.MDPI]=convertToAndroid(DENSITY_TYPES.MDPI.VALUE),map[UNIT_MODES.HDPI]=convertToAndroid(DENSITY_TYPES.HDPI.VALUE),map[UNIT_MODES.XHDPI]=convertToAndroid(DENSITY_TYPES.XHDPI.VALUE),map[UNIT_MODES.XXHDPI]=convertToAndroid(DENSITY_TYPES.XXHDPI.VALUE),map[UNIT_MODES.XXXHDPI]=convertToAndroid(DENSITY_TYPES.XXXHDPI.VALUE),map}function convertPx(value,isFont){if(ACTIVE_MODE_MAP.hasOwnProperty(activeMode))return ACTIVE_MODE_MAP[activeMode](value,isFont)}function convertToPx(value){return Math.round(value)+UNIT.PX}function convertToPt(value){return Math.round(value)+UNIT.PT}function convertToRetina(scale){return function(value){var convertedValue=roundValue(UnitConversionService.retinaScaleUp(value,scale),TO_FIXED_DIGIT);return convertedValue=removeZeros(convertedValue),convertedValue+=UNIT.PT}}function convertToAndroid(baseDpi){return function(value,isFont){var unit=isFont?UNIT.SP:UNIT.DP,convertedValue=roundValue(UnitConversionService.dpToPx(value,baseDpi),TO_FIXED_DIGIT);return convertedValue=removeZeros(convertedValue),convertedValue+=unit}}function removeZeros(value){var value=value.replace(/(\.[0-9]*?)0+$/,"$1");return value=value.replace(/\.$/,"")}function roundValue(value,digits){return value.toFixed(digits)}var UNIT_MODES={PIXELS:"Pixels",POINTS:"Points",RETINA_X2:"Retina @2x",RETINA_X3:"Retina @3x",LDPI:"LDPI @0.75x",MDPI:"MDPI @1x",HDPI:"HDPI @1.5x",XHDPI:"XHDPI @2x",XXHDPI:"XXHDPI @3x",XXXHDPI:"XXXHDPI @4x"},RETINA_SCALE_FACTOR={X2:2,X3:3},UNIT_MODE_KEY="activeUnitMode",TO_FIXED_DIGIT=2,UNIT=UnitConversionService.UNIT,DENSITY_TYPES=UnitConversionService.DENSITY_TYPES,ACTIVE_MODE_MAP=initActiveModeMap(),activeMode=loadMode()||UNIT_MODES.PIXELS;return{UNIT_MODES:UNIT_MODES,changeMode:changeMode,loadMode:loadMode,convertPx:convertPx,saveMode:saveMode,getActiveMode:getActiveMode}}angular.module("specification").factory("UnitService",UnitService),UnitService.$inject=["localStorageService","UnitConversionService"]}(),function(){"use strict";function UnitConversionService(){function pxToPt(px){return px*FACTOR.PX_PT}function ptToPx(pt){return pt*FACTOR.PT_PX}function pxToDp(px,dpi){return px/(dpi/STANDARD_DPI)}function dpToPx(dp,dpi){return dp*(dpi/STANDARD_DPI)}function retinaScaleDown(value,scale){return value/scale}function retinaScaleUp(value,scale){return value*scale}var DENSITY_TYPES={LDPI:{VALUE:120,FACTOR:.75},MDPI:{VALUE:160,FACTOR:1},HDPI:{VALUE:240,FACTOR:1.5},XHDPI:{VALUE:320,FACTOR:2},XXHDPI:{VALUE:480,FACTOR:3},XXXHDPI:{VALUE:640,FACTOR:4}},FACTOR={PX_PT:.75,PT_PX:1.333333,PX_SP:1.5},UNIT={PX:"px",PT:"pt",DP:"dp",SP:"sp"},STANDARD_DPI=DENSITY_TYPES.MDPI.VALUE;return{DENSITY_TYPES:DENSITY_TYPES,UNIT:UNIT,pxToPt:pxToPt,ptToPx:ptToPx,pxToDp:pxToDp,dpToPx:dpToPx,retinaScaleDown:retinaScaleDown,retinaScaleUp:retinaScaleUp}}angular.module("specification").factory("UnitConversionService",UnitConversionService)}(),function(){"use strict";function config($stateProvider){ApplicationConfiguration.isStyleguide&&$stateProvider.state("styleguide",{abstract:!1,url:"/{section}",params:{section:{value:"",squash:!0}},views:{"":{templateUrl:"/scripts/modules/styleguide/views/styleguide.view.html",controller:"StyleguideController",controllerAs:"vm"}},resolve:{pages:function(PagesService){return PagesService.getPages()},isStyleGuideEnabled:function($q,FeatureToggler){var d=$q.defer();return FeatureToggler.specModeStyleguide?d.resolve(!0):d.reject(null),d.promise}}})}angular.module("styleguide").config(config),config.$inject=["$stateProvider"]}(),function(){"use strict";function StyleguideController(_,ProjectsService,PagesService,$rootScope,$stateParams,DateService,UXPinService){function isProjectEmpty(){return[vm.colors,vm.images,vm.svgs,vm.fonts].every(function(assetsArray){return!assetsArray.length})}var vm=this;vm.pagesIds=PagesService.getVisiblePagesIds(),vm.currentProjectName=ProjectsService.currentProjectName,vm.lastUpdatedDate="",vm.lastUpdatedDateTitle="",vm.isLoaded=!1,vm.images=[],vm.svgs=vm.images,vm.fonts=vm.images,vm.colors=vm.images,vm.isProjectEmpty=isProjectEmpty,vm.initialSection=$stateParams.section,vm.currentProjectHash=ProjectsService.currentProjectHash,vm.homepageURL=UXPinService.getHomepageURL(),$rootScope.$on(PreviewEnums.ON_STYLEGUIDE_DATA_LOAD_STARTED,function(){vm.isLoaded=!1}),$rootScope.$on(PreviewEnums.ON_STYLEGUIDE_DATA_LOAD_FINISHED,function(event,styleGuideData){vm.colors=styleGuideData.colors,vm.images=styleGuideData.images,vm.svgs=styleGuideData.svgs,vm.fonts=_.values(styleGuideData.fonts),vm.isLoaded=!0,vm.setLastUpdateDate(styleGuideData.lastUpdates)}),vm.setLastUpdateDate=function(dateList){var date=DateService.getDate(dateList);date&&(vm.lastUpdatedDate=date.fromNow,vm.lastUpdatedDateTitle=date.full)}}angular.module("styleguide").controller("StyleguideController",StyleguideController),StyleguideController.$inject=["_","ProjectsService","PagesService","$rootScope","$stateParams","DateService","UXPinService"]}(),function(){"use strict";function StyleguideLayout(FeatureToggler,$rootScope,$window,AnalyticsService,deviceDetectorHelper){var vm=this;vm.isStyleguideFeature=FeatureToggler.specModeStyleguide,vm.isLoading=!0,vm.isChrome=deviceDetectorHelper.isChrome(),vm.isSafari=deviceDetectorHelper.isSafari(),vm.isFirefox=deviceDetectorHelper.isFirefox(),AnalyticsService.kissEvent("Spec - Style Guide entered"),$rootScope.$on("$stateChangeError",function(event){
$window.location="/404"}),$rootScope.$on(PreviewEnums.ON_STYLEGUIDE_DATA_LOAD_FINISHED,function(){vm.isLoading=!1})}angular.module("styleguide").controller("StyleguideLayout",StyleguideLayout),StyleguideLayout.$inject=["FeatureToggler","$rootScope","$window","AnalyticsService","deviceDetectorHelper"]}(),function(){"use strict";function imageLazyLoading(_){return{restrict:"A",scope:{},link:imageLazyLoadingLink.bind(this,_)}}function imageLazyLoadingLink(_,scope,element,attrs){function loadImagesCollection(){angular.forEach(imagesCollection,function(image,id){isLoading[id]||isLoaded[id]||!isImageInViewport(image)||loadImage(id,image.getAttribute("lazy-src"),image)})}function getParent(image){for(var parent=image.parent();!_.isEmpty(parent);){if(parent[0]&&parent[0].tagName&&parent[0].tagName.toLowerCase()===attrs.imageLazyLoadingParentTagName)return parent;parent=parent.parent()}return parent}function loadImage(id,src,image){var img=new Image,parent=getParent(angular.element(image));isLoading[id]=!0,parent.addClass(LOADING_CLASS),img.onload=img.onerror=function(){isLoaded[id]=!0,isLoading[id]=!1,image.setAttribute("src",src),parent.removeClass(LOADING_CLASS)},img.src=src}function isImageInViewport(image){var rect=image.getBoundingClientRect(),containerRect=element[0].getBoundingClientRect();return rect.top>=containerRect.top&&rect.left>=containerRect.left&&rect.bottom<=containerRect.bottom&&rect.right<=containerRect.right}var imagesCollection=[],isLoaded={},isLoading={},isListenerAdded=!1,WAIT_TIME=200,LOADING_CLASS="loading";scope.$watchCollection(function(){return element[0].querySelectorAll("img[lazy-src]")},function(images){imagesCollection=images,isLoaded={},isLoading={},loadImagesCollection(),isListenerAdded||(element.on("scroll",onScroll),isListenerAdded=!0)});var onScroll=_.throttle(function(){return Object.keys(isLoaded).length===imagesCollection.length?(element.off("scroll",onScroll),void(isListenerAdded=!1)):void loadImagesCollection()},WAIT_TIME)}angular.module("specification").directive("imageLazyLoading",imageLazyLoading),imageLazyLoading.$inject=["_"]}(),function(){"use strict";function navBar($timeout,$state,$rootScope){return{restrict:"A",scope:!1,link:function(scope,element,attrs){function scrollToInitialSection(){var scrollContainer;attrs.duScrollContainer&&attrs.initialSection&&(scrollContainer=angular.element(document.getElementById(attrs.duScrollContainer)),scrollContainer.scrollTo(angular.element(document.getElementById(attrs.initialSection))))}var removeDuScrollSpyEvent;$timeout(function(){scrollToInitialSection()}),removeDuScrollSpyEvent=$rootScope.$on("duScrollspy:becameActive",function($event,$element,$target){var hash=$element.prop("hash").replace("#","");$state.params.section!==hash&&$state.go("styleguide",{section:hash},{notify:!1})}),scope.$on("$destroy",function(){removeDuScrollSpyEvent()})}}}angular.module("styleguide").directive("navBar",navBar),navBar.$inject=["$timeout","$state","$rootScope"]}(),function(){"use strict";function BackgroundService(){function getBehaviourMap(){var map={};return map[BACKGROUND.SIZE.COVER]="Fit to fill",map[BACKGROUND.REPEAT.REPEAT]="Repeat on axis X, Y",map[BACKGROUND.REPEAT.REPEAT_X]="Repeat on axis X",map[BACKGROUND.REPEAT.REPEAT_Y]="Repeat on axis Y",map}function getPositionClass(posX,posY){return posX===BACKGROUND.POSITION.CENTER?posY:posY===BACKGROUND.POSITION.CENTER?posX:posY+"-"+posX}function getBehaviour(repeat,size){var key=size!==BACKGROUND.SIZE.AUTO?size:repeat;return BEHAVIOUR[key]||""}var BACKGROUND={POSITION:{TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left",CENTER:"center"},SIZE:{AUTO:"auto",COVER:"cover"},REPEAT:{NO_REPEAT:"no-repeat",REPEAT_X:"repeat-x",REPEAT_Y:"repeat-y",REPEAT:"repeat"}},BEHAVIOUR=getBehaviourMap();return{getPositionClass:getPositionClass,getBehaviour:getBehaviour}}angular.module("styleguide").factory("BackgroundService",BackgroundService)}(),function(){"use strict";function commentsAssigneeFilters(){return{restrict:"E",replace:!0,scope:{},templateUrl:"/scripts/modules/comments/directives/commentsAssigneeFilters/commentsAssigneeFilters.html",controller:commentsAssigneeFiltersCtrl,controllerAs:"vm"}}function commentsAssigneeFiltersCtrl(_,CommentsFilterSettings,AssignHelper,$scope,UsersService){function activate(){vm.options=(AssignHelper.getOptions()||[]).filter(function(option){return option.id_user!==parseInt(UsersService.me.id_user)}),vm.selectedOptions=CommentsFilterSettings.getAssignmentFilter(),_.isArray(vm.selectedOptions)&&(vm.selectedUsers=vm.selectedOptions.filter(function(option){return!_.isNull(option)&&option!==vm.me})),$scope.$watch(function(){return!!CommentsFilterSettings.getTypeFilters().length},function(value){vm.isDisabled=!value})}function getUsersIds(){return _.map(vm.options,function(option){return option.id_user})}function resetAssignmentFilter(){vm.selectedOptions=CommentsFilterSettings.DISABLED,CommentsFilterSettings.disableAssignmentFilter()}function isSelected(value){return _.isArray(vm.selectedOptions)?vm.selectedOptions.indexOf(parseInt(value))!==-1:vm.selectedOptions===value}function isUserSelected(){return vm.selectedUsers.length}function isAllUsersSelected(){return vm.selectedUsers.length===getUsersIds().length}function getLabelName(){return isUserSelected()?1===vm.selectedUsers.length?(_.first(vm.options.filter(function(user){return user.id_user===vm.selectedUsers[0]}))||{}).name:vm.selectedUsers.length+" users":"None"}function onUserSelect(value,toggleAll){return value&&_.isArray(value)&&(isAllUsersSelected()||isUserSelected()&&toggleAll?vm.selectedUsers=[]:vm.selectedUsers=value),vm.selectedOptions=vm.selectedUsers.concat(vm.selectedOptions&&(vm.selectedOptions.indexOf(vm.me)!==-1?vm.me:[])),vm.selectedOptions.length?void CommentsFilterSettings.setAssignmentFilter(vm.selectedOptions):void resetAssignmentFilter()}function onSelect(value){return null===value?(vm.selectedOptions=null!==vm.selectedOptions?value:CommentsFilterSettings.DISABLED,vm.selectedUsers=[],void CommentsFilterSettings.setAssignmentFilter(vm.selectedOptions)):value===CommentsFilterSettings.DISABLED?(vm.selectedOptions=value,vm.selectedUsers=[],void CommentsFilterSettings.setAssignmentFilter(vm.selectedOptions)):(_.isArray(vm.selectedOptions)?isSelected(value)?vm.selectedOptions=vm.selectedOptions.filter(function(option){return option!==parseInt(value)}):vm.selectedOptions.push(parseInt(value)):(vm.selectedOptions=[],vm.selectedOptions.push(parseInt(value))),vm.selectedOptions.length?void CommentsFilterSettings.setAssignmentFilter(vm.selectedOptions):void resetAssignmentFilter())}function onCloudOpen(){vm.isOpen=!0}function onCloudClose(){vm.isOpen=!1}var vm=this;vm.options=[],vm.selectedOptions=[],vm.selectedUsers=[],vm.isDisabled=!1,vm.me=parseInt(UsersService.me.id_user),vm.getUsersIds=getUsersIds,vm.onSelect=onSelect,vm.isSelected=isSelected,vm.onUserSelect=onUserSelect,vm.isUserSelected=isUserSelected,vm.isAllUsersSelected=isAllUsersSelected,vm.getLabelName=getLabelName,vm.onCloudOpen=onCloudOpen,vm.onCloudClose=onCloudClose,vm.cloudOffset={bottom:{x:-40,y:7}},activate()}angular.module("comments").directive("commentsAssigneeFilters",commentsAssigneeFilters),commentsAssigneeFiltersCtrl.$inject=["_","CommentsFilterSettings","AssignHelper","$scope","UsersService"]}(),function(){"use strict";function CommentsListApi(){function create(id,api){if(listApi[id])throw new Error("Api for commentsList id:"+id+" already created.");listApi[id]=api}function remove(id){listApi[id]&&delete listApi[id]}function scrollTo(id,commentId){listApi[id]&&listApi[id].scrollTo(commentId)}function reloadList(id){listApi[id]&&listApi[id].reloadList()}var listApi={};return{create:create,remove:remove,scrollTo:scrollTo,reloadList:reloadList}}angular.module("comments").factory("CommentsListApi",CommentsListApi)}(),function(){"use strict";function pvCommentsList(){function compile(element){element.addClass("scrolled-container")}return{restrict:"E",scope:{listId:"@",minItemHeight:"@",comments:"=",scrollTo:"="},templateUrl:"/scripts/modules/comments/directives/commentsList/pvCommentsList.html",compile:compile,controller:pvCommentsListCtrl,controllerAs:"vm",bindToController:!0}}function pvCommentsListCtrl(_,$scope,CommentsListApi){function activate(){vm.listId&&CommentsListApi.create(vm.listId,{scrollTo:scrollTo,reloadList:reloadList}),$scope.$watchCollection("vm.comments",function(){visibleScrollHeight&&(vm.visibleItems=vm.comments.slice(0,endIndex+1))}),$scope.$on("$destroy",onDestroy)}function onHeightKnown(height){visibleScrollHeight=height,minEndIndex=Math.ceil(visibleScrollHeight/vm.minItemHeight)-1,endIndex=minEndIndex,_.isEmpty(vm.comments)||(vm.visibleItems=vm.comments.slice(0,endIndex+1))}function onDestroy(){vm.listId&&CommentsListApi.remove(vm.listId)}function unloadRecords(scrollTop){var length=vm.visibleItems.length,newEndIndex=Math.ceil((visibleScrollHeight+scrollTop)/vm.minItemHeight)-1;newEndIndex<endIndex&&(vm.visibleItems.splice(newEndIndex,length+1),endIndex=newEndIndex)}function loadMoreRecords(){var length=vm.visibleItems.length,newItems=vm.comments.slice(length,length+CHUNK_SIZE);newItems.length&&(vm.visibleItems.push.apply(vm.visibleItems,newItems),endIndex+=CHUNK_SIZE)}function scrollTo(id){var commentIndex=getCommentIndex(id);commentIndex>-1&&(changeEndIndex(commentIndex),vm.scrollTarget="group-"+id+"-panel")}function reloadList(){visibleScrollHeight&&(vm.visibleItems=vm.comments.slice(0,minEndIndex+1),endIndex=minEndIndex)}function changeEndIndex(index){var newEndIndex=minEndIndex>index?minEndIndex:index;vm.visibleItems=vm.comments.slice(0,newEndIndex+1),endIndex=newEndIndex}function getCommentIndex(id){return _.findIndex(vm.comments,function(item){return item._id==id})}var visibleScrollHeight,minEndIndex,endIndex,CHUNK_SIZE=2,vm=this;vm.visibleItems=[],vm.scrollTarget=null,vm.onHeightKnown=onHeightKnown,vm.loadMoreRecords=loadMoreRecords,vm.unloadRecords=unloadRecords,activate()}angular.module("comments").directive("pvCommentsList",pvCommentsList),pvCommentsListCtrl.$inject=["_","$scope","CommentsListApi"]}(),function(){"use strict";function commentsOtherFilters(){return{restrict:"E",replace:!0,scope:{},templateUrl:"/scripts/modules/comments/directives/commentsOtherFilters/commentsOtherFilters.html",controller:commentsTypeFilterCtrl,controllerAs:"vm"}}function commentsTypeFilterCtrl(Settings,CommentsFilterSettings,hotkeys){function addShortcuts(){hotkeys.add({combo:"shift+alt+h",description:"Toggle comments visibility",callback:function(){togglePinsVisibility()}})}function togglePinsVisibility(){CommentsFilterSettings.setPinsVisibility(!CommentsFilterSettings.getPinsVisibility())}function toggleResolvedCommentsVisibility(){Settings.setShowResolvedComments(!Settings.showResolvedComments)}var vm=this;vm.togglePinsVisibility=togglePinsVisibility,vm.toggleResolvedCommentsVisibility=toggleResolvedCommentsVisibility,vm.arePinsVisible=CommentsFilterSettings.getPinsVisibility,vm.areResolvedCommentsVisible=function(){return Settings.showResolvedComments},addShortcuts()}angular.module("comments").directive("commentsOtherFilters",commentsOtherFilters),commentsTypeFilterCtrl.$inject=["Settings","CommentsFilterSettings","hotkeys"]}(),function(){"use strict";function pvCommentsSearch(){return{restrict:"E",scope:{searchFor:"=",onSearch:"&"},templateUrl:"/scripts/modules/comments/directives/commentsSearch/pvCommentsSearch.html",controller:pvCommentsSearchCtrl,controllerAs:"vm",bindToController:!0}}function pvCommentsSearchCtrl(_,$scope){function activate(){$scope.$watch("vm.searchFor",function(newValue,oldValue){newValue!==oldValue&&vm.onSearch({$searchText:vm.searchFor})})}function handleFocus(){vm.focused=!0}function handleKeyDown(event){event.stopPropagation(),event.keyCode===KEY_CODES.ESC&&escapeSearch()}function resetSearch(){vm.focused=!1,vm.searchFor=""}function escapeSearch(){_.isEmpty(vm.searchFor)?vm.focused=!1:vm.searchFor=""}var KEY_CODES=keysEnums.KEY_CODES,vm=this;vm.focused=!1,vm.handleFocus=handleFocus,vm.handleKeyDown=handleKeyDown,vm.resetSearch=resetSearch,activate()}angular.module("comments").directive("pvCommentsSearch",pvCommentsSearch),pvCommentsSearchCtrl.$inject=["_","$scope"]}(),function(){"use strict";function CommentsTreeApi(){function create(id,api){if(treeApi[id])throw new Error("Api for commentsTree id:"+id+" already created.");treeApi[id]=api}function remove(id){treeApi[id]&&delete treeApi[id]}function isPageHidden(id,pageId){if(treeApi[id])return treeApi[id].isPageHidden(pageId)}function togglePage(id,pageId){treeApi[id]&&treeApi[id].togglePage(pageId)}function scrollTo(id,commentId){treeApi[id]&&treeApi[id].scrollTo(commentId)}var treeApi={};return{create:create,remove:remove,isPageHidden:isPageHidden,togglePage:togglePage,scrollTo:scrollTo}}angular.module("comments").factory("CommentsTreeApi",CommentsTreeApi)}(),function(){"use strict";function pvCommentsTree(){function compile(element){element.addClass("scrolled-container")}return{restrict:"E",scope:{treeId:"@",minItemHeight:"@",tree:"=",showBreakpoints:"="},templateUrl:"/scripts/modules/comments/directives/commentsTree/pvCommentsTree.html",compile:compile,controller:pvCommentsTreeCtrl,controllerAs:"vm",bindToController:!0}}function pvCommentsTreeCtrl(_,$scope,CommentsTreeApi){function activate(){vm.treeId&&CommentsTreeApi.create(vm.treeId,{isPageHidden:isPageHidden,togglePage:togglePage,scrollTo:scrollTo}),$scope.$watchCollection("vm.tree",function(){visibleScrollHeight&&reloadTree()}),$scope.$on("$destroy",onDestroy)}function onDestroy(){vm.treeId&&CommentsTreeApi.remove(vm.treeId)}function onHeightKnown(height){visibleScrollHeight=height,minNumberOfItems=Math.ceil(visibleScrollHeight/vm.minItemHeight),reloadTree()}function isPageHidden(id){return!!vm.hiddenPages[id]}function togglePage(id){vm.hiddenPages[id]?delete vm.hiddenPages[id]:vm.hiddenPages[id]=!0,reloadTree()}function loadMoreRecords(count){var newItems,page,visiblePage,pagesLength,pageIndex,breakpoint,visibleBreakpoint,breakpointsLength,breakpointIndex,breakpointStartIndex,comments,commentsLength,visibleComments,visibleCommentsLength,commentsStartIndex,itemsToLoad=count||CHUNK_SIZE;for(pagesLength=vm.tree.length,pageIndex=endIndex.pageIndex;pageIndex<pagesLength&&itemsToLoad>0;pageIndex++){for(page=vm.tree[pageIndex],visiblePage=vm.visibleTree[pageIndex],breakpointStartIndex=visiblePage?endIndex.breakpointIndex:0,visiblePage||(visiblePage={id:page.id,name:page.name,breakpoints:[]}),breakpointsLength=page.breakpoints.length,breakpointIndex=breakpointStartIndex;breakpointIndex<breakpointsLength&&itemsToLoad>0;breakpointIndex++)breakpoint=page.breakpoints[breakpointIndex],visibleBreakpoint=visiblePage.breakpoints[breakpointIndex],commentsStartIndex=visibleBreakpoint?endIndex.commentIndex+1:0,visibleBreakpoint||(visibleBreakpoint={id:breakpoint.id,name:breakpoint.name,comments:[]}),comments=breakpoint.comments,commentsLength=breakpoint.comments.length,visibleComments=visibleBreakpoint.comments,visibleCommentsLength=visibleBreakpoint.comments.length,commentsLength>visibleCommentsLength&&(newItems=comments.slice(commentsStartIndex,commentsStartIndex+itemsToLoad),visibleComments.push.apply(visibleComments,newItems),itemsToLoad-=newItems.length,numberOfItems+=newItems.length,endIndex.commentIndex=visibleComments.length-1,endIndex.breakpointIndex=breakpointIndex,!visiblePage.breakpoints[breakpointIndex]&&visibleComments.length&&visiblePage.breakpoints.push(visibleBreakpoint));!vm.visibleTree[pageIndex]&&visiblePage.breakpoints.length&&vm.visibleTree.push(visiblePage),endIndex.pageIndex=pageIndex}}function unloadRecords(scrollTop){var pageIndex,visiblePage,breakpointIndex,visibleBreakpoint,visibleComments,visibleCommentsLength,newNumberOfItems=Math.ceil((visibleScrollHeight+scrollTop)/vm.minItemHeight),itemsToUnload=numberOfItems-newNumberOfItems;if(itemsToUnload>0){for(pageIndex=endIndex.pageIndex;pageIndex>-1&&itemsToUnload>0;pageIndex--){for(visiblePage=vm.visibleTree[pageIndex],breakpointIndex=endIndex.breakpointIndex;breakpointIndex>-1&&itemsToUnload>0;breakpointIndex--)visibleBreakpoint=visiblePage.breakpoints[breakpointIndex],visibleComments=visibleBreakpoint.comments,visibleCommentsLength=visibleComments.length,itemsToUnload<visibleCommentsLength?(visibleComments.splice(visibleCommentsLength-itemsToUnload,visibleCommentsLength+1),endIndex.commentIndex=visibleComments.length-1,itemsToUnload=0):(visiblePage.breakpoints.pop(),itemsToUnload-=visibleCommentsLength);_.isEmpty(visiblePage.breakpoints)&&(vm.visibleTree.pop(),endIndex.pageIndex=pageIndex-1,visiblePage=vm.visibleTree[endIndex.pageIndex]),endIndex.breakpointIndex=visiblePage.breakpoints.length-1,endIndex.commentIndex=visiblePage.breakpoints[endIndex.breakpointIndex].comments.length-1}numberOfItems=newNumberOfItems}}function scrollTo(id){var commentIndex=getCommentIndex(id);commentIndex>-1&&(changeEndIndex(commentIndex),vm.scrollTarget="group-"+id+"-panel")}function changeEndIndex(index){var count=index+1;count<numberOfItems&&reloadTree(count<minNumberOfItems?minNumberOfItems:count),loadMoreRecords(count-numberOfItems)}function getCommentIndex(id){var index,count=0;return _.each(vm.tree,function(page){if(_.each(page.breakpoints,function(breakpoint){return index=_.findIndex(breakpoint.comments,function(comment){return comment._id==id}),index!==-1?(count+=index+1,!1):void(count+=breakpoint.comments.length)}),index>-1)return!1}),count-1}function reloadTree(count){var visiblePage,visibleBreakpoint,itemsToLoad=count||numberOfItems||minNumberOfItems,tree=[];numberOfItems=0,_.each(vm.tree,function(page,pageIndex){if(visiblePage={id:page.id,name:page.name,breakpoints:[]},vm.hiddenPages[page.id]||_.each(page.breakpoints,function(breakpoint,breakpointIndex){if(visibleBreakpoint={id:breakpoint.id,name:breakpoint.name,comments:[]},visibleBreakpoint.comments=breakpoint.comments.slice(0,itemsToLoad),itemsToLoad-=visibleBreakpoint.comments.length,numberOfItems+=visibleBreakpoint.comments.length,visibleBreakpoint.comments.length&&visiblePage.breakpoints.push(visibleBreakpoint),!itemsToLoad)return endIndex.breakpointIndex=breakpointIndex,endIndex.commentIndex=visibleBreakpoint.comments.length-1,!1}),(visiblePage.breakpoints.length||vm.hiddenPages[page.id])&&tree.push(visiblePage),!itemsToLoad)return endIndex.pageIndex=pageIndex,!1}),vm.visibleTree=tree}var visibleScrollHeight,minNumberOfItems,numberOfItems,CHUNK_SIZE=2,vm=this,endIndex={pageIndex:0,breakpointIndex:0,commentIndex:0};vm.visibleTree=[],vm.hiddenPages={},vm.scrollTarget=null,vm.onHeightKnown=onHeightKnown,vm.loadMoreRecords=loadMoreRecords,vm.unloadRecords=unloadRecords,vm.togglePage=togglePage,activate()}angular.module("comments").directive("pvCommentsTree",pvCommentsTree),pvCommentsTreeCtrl.$inject=["_","$scope","CommentsTreeApi"]}(),function(){"use strict";function commentsTypeFilters(){return{restrict:"E",replace:!0,scope:{},templateUrl:"/scripts/modules/comments/directives/commentsTypeFilters/commentsTypeFilters.html",controller:commentsTypeFiltersCtrl,controllerAs:"vm"}}function commentsTypeFiltersCtrl(CommentsSettings,CommentsFilterSettings,hotkeys){function activate(){vm.commentTypesActive=CommentsSettings.commentTypesActive(),vm.filterOptions=CommentsFilterSettings.getTypeFilterOptions(),vm.selectedFilters=CommentsFilterSettings.getTypeFilters(),addShortcuts()}function isSelected(option){return vm.selectedFilters.indexOf(option.value)!==-1}function addShortcuts(){_.each(vm.filterOptions,function(option){hotkeys.add({combo:option.shortcut.join("+"),description:option.value,callback:function(){changeActiveFilter(option.value)}})})}function handleFilterChange(){CommentsFilterSettings.setTypeFilters(vm.selectedFilters)}function changeActiveFilter(value){vm.selectedFilters.indexOf(value)!==-1?vm.selectedFilters=vm.selectedFilters.filter(function(filter){return filter!==value}):vm.selectedFilters.push(value),handleFilterChange(vm.selectedFilters)}var vm=this;vm.filterOptions=[],vm.selectedFilters=null,vm.commentTypesActive=!1,vm.disabled=!1,vm.assignmentOptions=[],vm.selectedAssignmentOption={},vm.changeActiveFilter=changeActiveFilter,vm.isSelected=isSelected,activate()}angular.module("comments").directive("commentsTypeFilters",commentsTypeFilters),commentsTypeFiltersCtrl.$inject=["CommentsSettings","CommentsFilterSettings","hotkeys"]}(),function(){"use strict";function PreviewCommentCanvasCtrl($rootScope,$scope,$controller,PreviewNavigation){if($controller("PreviewCommentAbstractCtrl",{$scope:$scope}),$scope.type="canvas",$scope.onResolved=function(value){value&&$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null)},$scope.isNew()){$scope.$on("$destroy",function(){onAddingComment()});var onAddingComment=$rootScope.$on(PreviewEnums.ADDING_COMMENT,function(e,value){$scope.focusMe(value,100)})}}angular.module("comments").controller("PreviewCommentCanvasCtrl",PreviewCommentCanvasCtrl),PreviewCommentCanvasCtrl.$inject=["$rootScope","$scope","$controller","PreviewNavigation"]}(),function(){"use strict";function previewCommentCanvas(){return{restrict:"E",replace:!0,scope:{groupId:"=",comment:"=",commentType:"=",notifications:"=",parentId:"@",reply:"@",replyForm:"@",x:"@",y:"@"},controller:"PreviewCommentCanvasCtrl",templateUrl:"/scripts/modules/comments/directives/preview-comment/pvComment.html"}}angular.module("comments").directive("previewCommentCanvas",previewCommentCanvas)}(),function(){"use strict";function PreviewCommentPanelCtrl($rootScope,$scope,$controller,CommentsService){if($controller("PreviewCommentAbstractCtrl",{$scope:$scope}),$scope.type="panel",$scope.searchFor=CommentsService.searchFor,$scope.onResolved=function(value){},!$scope.isNew()){$scope.$on("$destroy",function(){onSearchComments()});var onSearchComments=$rootScope.$on("searchComments",function(e){$scope.searchFor=CommentsService.searchFor})}}angular.module("comments").controller("PreviewCommentPanelCtrl",PreviewCommentPanelCtrl),PreviewCommentPanelCtrl.$inject=["$rootScope","$scope","$controller","CommentsService"]}(),function(){"use strict";function previewCommentPanel(){return{restrict:"E",replace:!0,scope:{groupId:"=",comment:"=",commentType:"=",notifications:"=",parentId:"@",reply:"@",replyForm:"@",x:"@",y:"@"},controller:"PreviewCommentPanelCtrl",templateUrl:"/scripts/modules/comments/directives/preview-comment/pvComment.html"}}angular.module("comments").directive("previewCommentPanel",previewCommentPanel)}(),function(){"use strict";function PreviewCommentAbstractCtrl($rootScope,$scope,$state,$timeout,$filter,ProjectsService,PagesService,DocumentsService,CommentsService,CommentsSettings,UsersService,NotifyHelper,CommentsHelper,AssignHelper,CommentsState,$translate,ApprovalsService,PreviewNavigation){function activate(){switch($scope.commentMode=getInitialCommentMode(),$scope.state=CommentsState,$scope.parentId&&($scope.parentComment=CommentsService.commentsMap[$scope.parentId]),$scope.commentMode){case COMMENT_MODE.NEW:activateNewMode();break;case COMMENT_MODE.PREVIEW:activatePreviewMode()}}function getLoveIconTitle(){return isLoved()?dontLoveItTitle:loveItTitle}function activateNewMode(){$scope.isAssignmentActive=AssignHelper.isAssignmentActive(),$scope.avatarUrl=UsersService.me.avatar,$scope.userName=UsersService.me.name,$scope.inputPlaceholder=getInputPlaceholder(),$scope.newCommentClick=newCommentClick,$scope.onAssignOpen=onAssignOpen,$scope.isAssignmentActive&&($scope.assign.options=AssignHelper.getOptions(),$scope.assign.selected=getAssignedUserId()),$scope.isNew()&&($scope.isGroupSelected()||!$scope.parentId)&&PreviewNavigation.isPanelVisible(PreviewNavigation.PREVIEW_PANELS.COMMENTS)&&focusMe(!0,300),addNewModeEvents()}function activatePreviewMode(){$scope.avatarUrl=$scope.comment.user.avatar,$scope.userName=$scope.comment.user.name,$scope.commentCreatedAt=moment($scope.comment.created_at).fromNow(),$scope.canEdit=CommentsService.canEdit($scope.comment),$scope.canEditContent=CommentsService.canEditContent($scope.comment),$scope.isGroupSelected()&&$scope.focusMe(!0),addPreviewModeEvents(),CommentsService.getComment($scope.comment._id).then(function(comment){$scope.update(comment)})}function addNewModeEvents(){var onSetAnonymousName=$rootScope.$on(PreviewEnums.SET_ANONYMOUS_NAME,function(event,name){name&&$scope.focusMe(!0,1)}),onCommentAssignedUserUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_ASSIGNED_USER_UPDATE,function(event,commentId,assignedUserId){$scope.parentId===commentId&&($scope.assign.selected=assignedUserId)});$scope.$on("$destroy",function(){onSetAnonymousName(),onCommentAssignedUserUpdate()})}function addPreviewModeEvents(){var onReplyingComment=$rootScope.$on(PreviewEnums.REPLYING_COMMENT,function(e,id,type,isReplying){$scope.comment._id!==id&&$scope.comment._parent_comment!==id||$scope.type!==type||($scope.isReplying=isReplying)}),onCommentContentUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_CONTENT_UPDATE,function(e,id,content){$scope.comment._id===id&&($scope.comment.comment=content,update($scope.comment))});$scope.$on("$destroy",function(){$scope.commentMode===COMMENT_MODE.EDIT&&exitEditMode(),onReplyingComment(),onCommentContentUpdate()})}function getInitialCommentMode(){return $scope.isNew()?COMMENT_MODE.NEW:COMMENT_MODE.PREVIEW}function getAssignedUserId(){return $scope.parentComment?$scope.parentComment.assignedUserId:null}function getInputPlaceholder(){return $scope.replyForm?INPUT_PLACEHOLDERS.REPLY:INPUT_PLACEHOLDERS.FIRST}function isCanvas(){return"canvas"===$scope.type}function isNew(){return void 0===$scope.comment}function isAnonymousWithName(){return UsersService.isAnonymous()&&UsersService.isAnonymousNameSet()}function isPreviewMode(){return $scope.commentMode===COMMENT_MODE.PREVIEW}function isEditMode(){return $scope.commentMode===COMMENT_MODE.EDIT}function isFormHidden(){return $scope.state.groupInEditModeId===$scope.groupId}function isEditDisabled(){return null!==$scope.state.groupInEditModeId}function isLoved(){return!$scope.isNew()&&CommentsService.isLoved($scope.comment)}function isGroupSelected(){return $scope.state.selectedGroupId===$scope.groupId}function focusMe(value,delay){value&&($scope.isError=!1),delay>0?$timeout(function(){$scope.form.focused=value},delay):$scope.form.focused=value}function loveMe(event){event.stopPropagation(),CommentsService.updateComment($scope.comment._id,{is_loved:!$scope.isLoved()})}function replyMe(event){event.stopPropagation();var id=$scope.comment._parent_comment||$scope.comment._id;$rootScope.$emit(PreviewEnums.REPLYING_COMMENT,id,$scope.type,!$scope.isReplying)}function resolveMe(value){CommentsService.updateCommentResolve($scope.parentComment._id,value)}function editMe(event){event.stopPropagation(),isEditDisabled()||($scope.commentMode=COMMENT_MODE.EDIT,$scope.state.groupInEditModeId=$scope.groupId,$scope.form.text=$scope.comment.comment,focusMe(!0))}function cancelEdit(event){event.stopPropagation(),exitEditMode()}function exitEditMode(){$scope.commentMode=COMMENT_MODE.PREVIEW,$scope.state.groupInEditModeId=null,$scope.resetFormData()}function deleteMe(event){event&&event.stopPropagation(),CommentsService.canEdit($scope.comment)&&CommentsService.deleteComment($scope.comment._id)}function submitMe(event){event.stopPropagation(),$scope.working||(isNew()?addNewComment():updateCommentContent())}function addNewComment(){if(validate()){$rootScope.$emit(PreviewEnums.SUBMIT_COMMENT),UsersService.isAnonymous()||CommentsSettings.setLastUsedCommentType($scope.commentType);var mentions=getMentionsEmails();$scope.working=!0,CommentsService.addComment(getCommentProperties()).then(function(comment){$scope.resetFormData(),$scope.parentId&&!_.isEmpty(mentions)&&emitNotificationsUpdate(),comment._parent_comment||(NotifyHelper.rememberSelection($scope.notifications),$rootScope.$emit(PreviewEnums.SELECT_COMMENT,comment._id,"canvas"))}).finally(function(){$scope.working=!1})}}function updateCommentContent(){if(validate()){$rootScope.$emit(PreviewEnums.SUBMIT_COMMENT);var mentions=getMentionsEmails();$scope.working=!0,CommentsService.updateCommentContent($scope.comment._id,$scope.form.text,mentions).then(function(){_.isEmpty(mentions)||emitNotificationsUpdate(),exitEditMode()}).finally(function(){$scope.working=!1})}}function getMentionsEmails(){return _.map($scope.form.mentions,function(mention){return mention.email})}function emitNotificationsUpdate(){var commentId=$scope.parentId||$scope.comment._parent_comment||$scope.comment._id;$rootScope.$emit(PreviewEnums.ON_NOTIFICATIONS_UPDATE,commentId)}function update(comment){var text;text=CommentsHelper.encodeMentions(comment.comment),text=$filter("linky")(text,"_blank"),text=CommentsHelper.decodeMentions(text),text=$filter("simpleMarkdown")(text),$scope.previewText=text}function resetFormData(){$scope.form.text="",$scope.form.mentions=[]}function getGroupLength(){return CommentsService.commentsTree[$scope.comment._id].length}function newCommentClick(event){event.stopPropagation()}function onAssignOpen(){$timeout(function(){$rootScope.$emit(PreviewEnums.ON_ASSIGNMENT_LIST_OPEN,$scope.assign.config.cloudId,$scope.type)})}function onChangeAssignedUser(){$scope.parentId&&CommentsService.updateAssignedUser($scope.parentId,$scope.assign.selected)}function onTextareaKeyDown(event){event.which===KEY_CODES.ESC&&$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null),event.stopPropagation(),event.which===KEY_CODES.ENTER&&onTextareaEnter(event)}function onTextareaEnter(event){hasSpecialKey(event)||(event.preventDefault(),submitMe(event)),hasAltCtrlOrMetaKey(event)&&event.preventDefault()}function hasSpecialKey(event){return event.shiftKey||event.altKey||event.metaKey||event.ctrlKey}function hasAltCtrlOrMetaKey(event){return event.altKey||event.metaKey||event.ctrlKey}function onTextareaMouseDown(event){event.stopPropagation(),$scope.isError=!1}function getCommentProperties(){var properties={project_hash:ProjectsService.currentProjectHash,comment:$scope.form.text,position:{x:$scope.x,y:$scope.y},type:$scope.commentType,collaborators_all:UsersService.collaboratorEmails.length,notify:NotifyHelper.formatNotify($scope.notifications,getMentionsEmails())};return $scope.isAssignmentActive&&!$scope.parentId&&(properties.assignedUserId=parseInt($scope.assign.selected,10)),ProjectsService.isDocument()?$scope.parentId?(properties.id_document=CommentsService.commentsMap[$scope.parentId].id_document,properties._parent_comment=$scope.parentId):properties.id_document=DocumentsService.currentDocumentId:$scope.parentId?(properties.id_page=CommentsService.commentsMap[$scope.parentId].id_page,properties._parent_comment=$scope.parentId):properties.id_page=PagesService.currentPageId,UsersService.isAnonymous()&&(properties.user={name:UsersService.me.name}),ApprovalsService.getIsActive()&&(properties.type=commentTypes.TEAM,properties.user={is_stakeholder:!0,name:UsersService.me.name,id:ApplicationConfiguration.stakeholder.id}),properties}function validate(){return $scope.isError=!$scope.form.text,!$scope.isError}var INPUT_PLACEHOLDERS={FIRST:"Whats your comment?",REPLY:"Whats your response?"},COMMENT_MODE={NEW:"new",PREVIEW:"preview",EDIT:"edit"},KEY_CODES=keysEnums.KEY_CODES,commentTypes=CommentsSettings.commentTypes;$scope.id="comment-"+MD5((new Date).getTime()),$scope.commentMode=null,$scope.state={},$scope.working=!1,$scope.isReplying=!1,$scope.isError=!1,$scope.inputPlaceholder="",$scope.isAssignmentActive=!1,$scope.isAnonymous=UsersService.isAnonymous(),$scope.isAnonymousWithName=isAnonymousWithName,$scope.avatarUrl=null,$scope.avatarInitials=null,$scope.notificationPanel=!1,$scope.textElements={},$scope.parentComment=null,$scope.previewText="",$scope.form={text:"",mentions:[],focused:!1},$scope.assign={options:[],selected:null,onChange:onChangeAssignedUser,config:{cloudId:"assignment-cloud-"+$scope.id,label:"Assigned:",labelKey:"name",valueKey:"id_user",placeholder:"Assign to someone",inputTpl:"pvInputWithLabel.html",optionTpl:"pvOptionWithAvatar.html",deselect:!0,deselectLabel:"Unassign",withSearch:!0,
search:{label:"Search for the user...",placeholder:"Type to search...",searchKey:"name"}}},$scope.isCanvas=isCanvas,$scope.isNew=isNew,$scope.isEditMode=isEditMode,$scope.isEditDisabled=isEditDisabled,$scope.isPreviewMode=isPreviewMode,$scope.isLoved=isLoved,$scope.getLoveIconTitle=getLoveIconTitle,$scope.isFormHidden=isFormHidden,$scope.isGroupSelected=isGroupSelected,$scope.focusMe=focusMe,$scope.loveMe=loveMe,$scope.replyMe=replyMe,$scope.resolveMe=resolveMe,$scope.editMe=editMe,$scope.cancelEdit=cancelEdit,$scope.deleteMe=deleteMe,$scope.submitMe=submitMe,$scope.update=update,$scope.resetFormData=resetFormData,$scope.getGroupLength=getGroupLength,$scope.onTextareaMouseDown=onTextareaMouseDown,$scope.onTextareaKeyDown=onTextareaKeyDown,activate();var loveItTitle=$translate.instant("LOVE_IT"),dontLoveItTitle=$translate.instant("DONT_LOVE_IT")}angular.module("comments").controller("PreviewCommentAbstractCtrl",PreviewCommentAbstractCtrl),PreviewCommentAbstractCtrl.$inject=["$rootScope","$scope","$state","$timeout","$filter","ProjectsService","PagesService","DocumentsService","CommentsService","CommentsSettings","UsersService","NotifyHelper","CommentsHelper","AssignHelper","CommentsState","$translate","ApprovalsService","PreviewNavigation"]}(),function(){"use strict";function previewCommentAnonymous(){return{restrict:"E",scope:{},controller:previewCommentAnonymousCtrl,controllerAs:"vm",templateUrl:"/scripts/modules/comments/directives/preview-comment-anonymous/preview-comment-anonymous.directive.html"}}function previewCommentAnonymousCtrl($rootScope,$scope){function getReferer(){return ApplicationConfiguration.loginPageURL+"/?cb="+encodeURIComponent(window.location.href)}var vm=this;vm.referer=getReferer()}angular.module("comments").directive("previewCommentAnonymous",previewCommentAnonymous),previewCommentAnonymousCtrl.$inject=["$rootScope","$scope"]}(),function(){"use strict";function PreviewCommentContainerCtrl(_,$rootScope,$scope,$timeout,CommentsService,CommentsSettings,UsersService,NotificationsService,NotifyHelper,PreviewNavigation){function activate(){commentTypes=CommentsSettings.commentTypes,$scope.groupId=getGroupId(),$scope.initialCommentType=getInitialCommentType(),$scope.commentTypesActive=CommentsSettings.commentTypesActive(),$scope.selected=!isNew()&&CommentsService.selectedCommentId===$scope.comment._id,$scope.commentType.options=CommentsSettings.getCommentTypeOptions(),$scope.commentType.selected=isNew()?$scope.initialCommentType:$scope.comment.type,$scope.children=getCommentChildren(),updateNotify(),$scope.selected&&updateNotifications(),isNew()||(updateClasses(),addOldCommentModeEvents(),isPanel()&&($scope.toggle=toggle,addPanelModeEvents()))}function getGroupId(){var id=$scope.comment?$scope.comment._id:"new-comment";return"canvas-"+id}function getInitialCommentType(){return $scope.comment?$scope.comment.type?$scope.comment.type:commentTypes.PUBLIC:CommentsSettings.commentTypesActive()?CommentsSettings.getLastUsedCommentType()||commentTypes.TEAM:commentTypes.PUBLIC}function updateCommentChildren(){$scope.children=getCommentChildren()}function getCommentChildren(){if(!$scope.comment)return[];var childrenIds=CommentsService.commentsTree[$scope.comment._id];return _.map(childrenIds,function(childId){return CommentsService.commentsMap[childId]})}function isNew(){return void 0===$scope.comment}function isPanel(){return"panel"===$scope.type}function isCanvas(){return"canvas"===$scope.type}function isOpen(){return $scope.selected}function isAnonymousWithoutName(){return UsersService.isAnonymous()&&!UsersService.isAnonymousNameSet()}function handleCommentTypeChange(){CommentsSettings.setLastUsedCommentType($scope.commentType.selected),$scope.isNew()?$rootScope.$emit(PreviewEnums.ON_COMMENT_TYPE_UPDATE,null,$scope.commentType.selected):CommentsService.updateCommentType($scope.comment._id,$scope.commentType.selected)}function toggle(){var selectedComment=$scope.selected?null:$scope.comment._id;$rootScope.$emit(PreviewEnums.SELECT_COMMENT,selectedComment,$scope.type)}function hide(){$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null)}function addOldCommentModeEvents(){var onReplyingComment=$rootScope.$on(PreviewEnums.REPLYING_COMMENT,function(event,id,type,isReplying){$scope.comment._id===id&&type===$scope.type&&($scope.selected=isReplying,updateClasses())}),onAddComment=$rootScope.$on(PreviewEnums.ADD_COMMENT,function(event,id,parentId){$scope.comment._id===parentId&&(updateClasses(),updateCommentChildren())}),onDeleteComment=$rootScope.$on(PreviewEnums.DELETE_COMMENT,function(event,id){isChildren(id)&&updateCommentChildren()}),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(event,id){PreviewNavigation.isPanelVisible(PreviewNavigation.PREVIEW_PANELS.COMMENTS)&&($scope.selected&&$scope.comment._id!==id&&($scope.selected=!1,updateClasses()),$scope.selected||$scope.comment._id!==id||($scope.selected=!0,updateClasses()))}),onChangeNotifications=$rootScope.$on(PreviewEnums.ON_CHANGE_NOTIFICATIONS,function(event,commentId){(isPanel()||isCommentIdMatch(commentId))&&updateNotify()}),onNotificationsUpdate=$rootScope.$on(PreviewEnums.ON_NOTIFICATIONS_UPDATE,function(event,commentId){isCommentIdMatch(commentId)&&updateNotifications()}),onCommentTypeUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,updateCommentType);$scope.$on("$destroy",function(){onSelectComment(),onAddComment(),onDeleteComment(),onReplyingComment(),onCommentTypeUpdate(),onChangeNotifications(),onNotificationsUpdate(),onNotifyClose()})}function addPanelModeEvents(){var onDeleteComment=$rootScope.$on(PreviewEnums.DELETE_COMMENT,function(event,id){isChildren(id)&&updateCommentChildren()}),onKeyDown=$rootScope.$on("keyDown",function(event,keyEvent){if($scope.selected&&keyEvent.which===BACKSPACE){if($scope.comment.user.id!==UsersService.me.id_user)return;$rootScope.$emit(PreviewEnums.DELETE_COMMENT,$scope.comment._id,!0)}}),onResolveComment=$rootScope.$on(PreviewEnums.RESOLVE_COMMENT,function(event,id,value){$scope.comment._id===id&&handleResolveComment(value)}),onCommentTypeUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,updateCommentType);$scope.$on("$destroy",function(){onResolveComment(),onDeleteComment(),onKeyDown(),onCommentTypeUpdate()})}function isChildren(id){return!!_.find($scope.children,function(child){return child._id===id})}function isCommentIdMatch(id){return!_.isEmpty($scope.comment)&&$scope.comment._id===id}function updateCommentType(event,id,type){$scope.comment._id===id&&($scope.commentType.selected=type)}function updateClasses(){$scope.isNew()||(setClass("selected",$scope.selected),setClass("resolved",$scope.comment.resolved.is),setClass("active",$scope.comment.resolved.is&&$scope.justResolved),setClass("archived",$scope.comment.resolved.is&&!$scope.justResolved),setClass("delete",$scope.deleted),setClass("hide",$scope.deleted))}function setClass(className,value){var index=$scope.classes.indexOf(className);value&&index===-1?$scope.classes.push(className):value||index===-1||$scope.classes.splice(index,1)}function handleResolveComment(value){value?($scope.justResolved=!0,updateClasses(),$timeout(function(){$scope.justResolved=!1,updateClasses()},PreviewEnums.SHOW_RESOLVED_TIMEOUT)):updateClasses()}function onNotifyOpen(){CommentsService.selectedCommentShowNotificationPanel=!0}function onNotifyClose(){CommentsService.selectedCommentShowNotificationPanel=!1,_.isEmpty($scope.comment)||saveNotificationsChanges()}function saveNotificationsChanges(){var addedEmails=_.difference($scope.notify.selected,$scope.notify.initialSelected),removedEmails=_.difference($scope.notify.initialSelected,$scope.notify.selected);_.isEmpty(addedEmails)||(NotificationsService.addToNotifications($scope.comment._id,addedEmails),NotifyHelper.rememberSelection($scope.notify.selected)),_.isEmpty(removedEmails)||(NotificationsService.removeFromNotification($scope.comment._id,removedEmails),NotifyHelper.rememberSelection($scope.notify.selected))}function updateNotifications(){NotificationsService.getNotifications().then(updateNotify)}function updateNotify(){var commentId=_.isEmpty($scope.comment)?null:$scope.comment._id;$scope.notify.people=NotifyHelper.getPeople(),$scope.notify.initialSelected=NotifyHelper.getSelectedEmails(commentId),$scope.notify.selected=_.clone($scope.notify.initialSelected)}var commentTypes,BACKSPACE=8;$scope.selected=!1,$scope.justResolved=!1,$scope.deleted=!1,$scope.classes=[],$scope.children=[],$scope.commentTypesActive=!1,$scope.commentType={options:[],selected:null},$scope.notify={people:[],initialSelected:[],selected:[]},$scope.isNew=isNew,$scope.isPanel=isPanel,$scope.isCanvas=isCanvas,$scope.isOpen=isOpen,$scope.isAnonymous=UsersService.isAnonymous(),$scope.isAnonymousWithoutName=isAnonymousWithoutName,$scope.hide=hide,$scope.toggle=_.noop,$scope.handleCommentTypeChange=handleCommentTypeChange,$scope.onNotifyOpen=onNotifyOpen,$scope.onNotifyClose=onNotifyClose,activate(),$scope.$watch("comment",activate)}angular.module("comments").controller("PreviewCommentContainerCtrl",PreviewCommentContainerCtrl),PreviewCommentContainerCtrl.$inject=["_","$rootScope","$scope","$timeout","CommentsService","CommentsSettings","UsersService","NotificationsService","NotifyHelper","PreviewNavigation"]}(),function(){"use strict";function previewCommentContainer($rootScope,$document,DOMService){function hasPageScrollbar(page){return("scroll"===page.style.overflow||"scroll"===page.style.overflowX||"scroll"===page.style.overflowY)&&(page.clientHeight<page.scrollHeight||page.clientWidth<page.scrollWidth)}function getPageInfo(page){return{hasScrollbar:hasPageScrollbar(page),rect:page.getBoundingClientRect()}}function isPointInsideRect(point,rect){return point.x>=rect.left&&point.x<=rect.right&&point.y>=rect.top&&point.y<=rect.bottom}var scrollX=0,scrollY=0;return{restrict:"E",replace:!0,scope:{comment:"=",type:"@",x:"=",y:"="},controller:"PreviewCommentContainerCtrl",templateUrl:"/scripts/modules/comments/directives/preview-comment-container/preview-comment-container.directive.html",link:function(scope,element,attributes){function reposition(){var x=scope.x,y=scope.y,commentWidth=elementWidth+PreviewEnums.COMMENT_FORM_DELTA_X-PreviewEnums.PIN_RADIUS,containerDimensions=DOMService.getContainerDimensions(),halfConteinerWidth=Math.round(containerDimensions.width/2),pageMargin=Math.round(halfConteinerWidth-pageInfo.rect.width/2),isRightNew=pageMargin+x-scrollX+PreviewEnums.PIN_RADIUS<halfConteinerWidth;isRightNew=pageMargin>=commentWidth?!isRightNew:isRightNew,isRight!==isRightNew&&(isRight=isRightNew,isRight?element.removeClass("left"):element.addClass("left"));var left=isRight?x-scrollX+PreviewEnums.COMMENT_FORM_DELTA_X:x-scrollX-commentWidth+PreviewEnums.PIN_RADIUS;element.css({left:left+"px",top:y+PreviewEnums.COMMENT_FORM_DELTA_Y+PreviewEnums.PIN_RADIUS-scrollY+"px",display:isVisible()?"block":"none"})}function isVisible(){return!dragging}function pointerEvents(value){value?element.removeClass("no-pointer-events"):element.addClass("no-pointer-events")}var pageInfo,overflowedPage,isRight=!0,dragging=!1,elementWidth=element[0].offsetWidth;element[0].offsetHeight;if("canvas"===attributes.type){var onDraggingComment=$rootScope.$on(PreviewEnums.DRAGGING_COMMENT,function(e,value){dragging=value,reposition()});if(overflowedPage=$document[0].querySelector("[overflowed-page]")){scrollX=overflowedPage.scrollLeft,scrollY=overflowedPage.scrollTop;var onPageScroll=$rootScope.$on(PreviewEnums.ON_PAGE_SCROLL,function(e,x,y){scrollX===x&&scrollY===y?pointerEvents(!0):(scrollX=x,scrollY=y,onScrollEnd(),reposition())});scope.$on("$destroy",function(){onPageScroll(),onDraggingComment()});var onScrollEnd=_.debounce(pointerEvents.bind(this,!0),100);element.on("wheel",function(e){pageInfo||(pageInfo=getPageInfo(overflowedPage)),pageInfo.hasScrollbar&&isPointInsideRect({x:e.clientX,y:e.clientY},pageInfo.rect)&&pointerEvents(!1)}),pageInfo=getPageInfo(overflowedPage)}else scope.$on("$destroy",function(){onDraggingComment()}),pageInfo=getPageInfo($document[0].querySelector(".canvas-content"));scope.$watch("x",reposition),scope.$watch("y",reposition),reposition()}}}}angular.module("comments").directive("previewCommentContainer",["$rootScope","$document","DOMService",previewCommentContainer])}(),function(){"use strict";function PreviewCommentGroupCtrl($rootScope,$scope,CommentsService,UsersService){function activate(){$scope.searchFor=CommentsService.searchFor,$scope.filteredChildren=getFilteredChildren(),$scope.isNew()||addListeners()}function addListeners(){var onCommentChildrenChange=$scope.$watch("commentChildren",function(newChildren,oldChildren){!$scope.toggler.isVisible&&newChildren.length>oldChildren.length&&($scope.toggler.isOpen=!0),updateChildren()}),onSearchComments=$rootScope.$on("searchComments",function(){$scope.searchFor=CommentsService.searchFor,updateChildren()});$scope.$on("$destroy",function(){onCommentChildrenChange(),onSearchComments()})}function isNew(){return void 0===$scope.comment}function isGroup(){return $scope.comment&&CommentsService.isGroup($scope.comment._id)}function isPanel(){return"panel"===$scope.type}function isCanvas(){return"canvas"===$scope.type}function isAnonymousWithoutName(){return UsersService.isAnonymous()&&!UsersService.isAnonymousNameSet()}function hasSearchFor(text){return""===$scope.searchFor||text.toLocaleLowerCase().indexOf($scope.searchFor)!==-1}function getCheckboxId(){return $scope.comment._id+"-"+$scope.type}function onTogglerClick(event){event.stopPropagation(),$scope.toggler.isOpen=!$scope.toggler.isOpen,$scope.childrenToDisplay=getChildrenToDisplay()}function updateChildren(){$scope.filteredChildren=getFilteredChildren(),$scope.toggler.isVisible=$scope.filteredChildren.length>MAX_CHILDREN,$scope.toggler.commentsCount=$scope.toggler.isVisible?$scope.filteredChildren.length-1:0,$scope.childrenToDisplay=getChildrenToDisplay()}function commentCountInfo(){return"Show "+$scope.toggler.commentsCount+" more"}function getFilteredChildren(){return $scope.searchFor?_.filter($scope.commentChildren,function(child){return hasSearchFor(child.comment)}):$scope.commentChildren}function getChildrenToDisplay(){if(!$scope.toggler.isVisible||$scope.toggler.isOpen)return $scope.filteredChildren;var comments=[];return comments.push(_.last($scope.filteredChildren)),comments}var MAX_CHILDREN=3;$scope.childrenToDisplay=[],$scope.filteredChildren=[],$scope.searchFor="",$scope.toggler={isVisible:!1,isOpen:!1,commentsCount:0},$scope.isNew=isNew,$scope.isGroup=isGroup,$scope.isPanel=isPanel,$scope.isCanvas=isCanvas,$scope.isAnonymous=UsersService.isAnonymous(),$scope.isAnonymousWithoutName=isAnonymousWithoutName,$scope.hasSearchFor=hasSearchFor,$scope.getCheckboxId=getCheckboxId,$scope.onTogglerClick=onTogglerClick,$scope.commentCountInfo=commentCountInfo,activate()}angular.module("comments").controller("PreviewCommentGroupCtrl",PreviewCommentGroupCtrl),PreviewCommentGroupCtrl.$inject=["$rootScope","$scope","CommentsService","UsersService"]}(),function(){"use strict";function previewCommentGroup(){return{restrict:"E",replace:!0,scope:{groupId:"=",comment:"=",commentType:"=",commentChildren:"=",notifications:"=",reply:"=",type:"@",x:"@",y:"@"},controller:"PreviewCommentGroupCtrl",templateUrl:"/scripts/modules/comments/directives/preview-comment-group/preview-comment-group.directive.html"}}angular.module("comments").directive("previewCommentGroup",previewCommentGroup)}(),function(){"use strict";function anonymousName(){return{restrict:"E",scope:{x:"@",y:"@"},controller:anonymousNameCtrl,controllerAs:"vm",templateUrl:"/scripts/modules/core/directives/anonymousName/anonymousName.directive.html"}}function anonymousNameCtrl($rootScope,$scope,UsersService){function isAnonymousNameSet(){return UsersService.isAnonymousNameSet()}function getAnonymousName(){return vm.isAnonymousNameSet?UsersService.getAnonymousName():""}function isValid(name){return name&&name.match(/\w+/)}function changeName(event){event.preventDefault(),vm.displayForm=!0}function onChange(){var name=vm.anonymousName;isValid(name)&&(vm.showError=!1)}function onKeyDown(event){var keyCode=event.keyCode;event.stopPropagation(),keyCode===KEY_CODES.ENTER&&(event.preventDefault(),setName()),keyCode===KEY_CODES.ESC&&vm.isAnonymousNameSet&&(event.preventDefault(),vm.displayForm=!1,vm.anonymousName=getAnonymousName())}function setName(){var name=vm.anonymousName;isValid(name)?($rootScope.$emit(PreviewEnums.SET_ANONYMOUS_NAME,name.trim()),vm.displayForm=!vm.isAnonymousNameSet):vm.showError=!0}var vm=this,KEY_CODES=keysEnums.KEY_CODES;vm.showError=!1,vm.isAnonymousNameSet=isAnonymousNameSet(),vm.displayForm=!vm.isAnonymousNameSet,vm.displayBtn=!vm.isAnonymousNameSet,vm.anonymousName=getAnonymousName(),vm.changeName=changeName,vm.setName=setName,vm.onChange=onChange,vm.onKeyDown=onKeyDown;var onSubmitComment=$rootScope.$on(PreviewEnums.SUBMIT_COMMENT,setName);$scope.$on("$destroy",function(){onSubmitComment()})}angular.module("core").directive("anonymousName",anonymousName),anonymousNameCtrl.$inject=["$rootScope","$scope","UsersService"]}(),angular.module("core").controller("AppViewPromoController",["$rootScope","$scope","localStorageService","deviceDetectorHelper",function($rootScope,$scope,localStorageService,deviceDetectorHelper){"use strict";$scope.isAndroid="Android"===deviceDetectorHelper.getOS().name,localStorageService.set(PreviewEnums.APP_VIEW_PROMO_VIEWED,1),$scope.close=function(){$rootScope.$emit(PreviewEnums.ON_APP_VIEW_PROMO_CLOSE)}}]),angular.module("core").directive("appViewPromo",[function(){"use strict";return{restrict:"E",replace:!0,scope:!0,controller:"AppViewPromoController",templateUrl:"/scripts/modules/core/directives/appViewPromo/appViewPromo.directive.html"}}]),function(){"use strict";function pvAvatar(){return{restrict:"E",scope:{url:"=",name:"=",avatarClass:"@"},templateUrl:"/scripts/modules/core/directives/avatar/pvAvatar.html",controller:pvAvatarCtrl,controllerAs:"vm"}}function pvAvatarCtrl($scope){function activate(){$scope.$watch("url",function(newUrl){vm.url=newUrl}),$scope.$watch("name",function(newName){vm.initials=newName?getInitals(newName):""})}function getInitals(name){var nameParts=name.split(" ");return(nameParts[0][0]+(nameParts.length>1?nameParts[1][0]:"")).toUpperCase()}function getUserAvatar(){return vm.url?vm.url:"/img/transparent.png"}var vm=this;vm.url="",vm.initials="",vm.getUserAvatar=getUserAvatar,activate()}angular.module("core").directive("pvAvatar",pvAvatar),pvAvatarCtrl.$inject=["$scope"]}(),function(){"use strict";function pvBreakpoints(){return{restrict:"E",scope:{breakpoints:"="},templateUrl:"/scripts/modules/core/directives/breakpoints/pvBreakpoints.html",controller:pvBreakpointsCtrl,controllerAs:"vm"}}function pvBreakpointsCtrl(_,$scope,PagesService,LiveShareService,UsabilityTestService,Settings){function onResponsive(){Settings.setResponsive(vm.isResponsive)}function activate(){$scope.$watch("breakpoints",function(newBreakpoints){vm.breakpoints=newBreakpoints,vm.areBreakpointsVisible=vm.breakpoints&&vm.breakpoints.length>1,vm.isUTSession&&lockBreakpoints()}),ApplicationConfiguration.isDesignSystem||(LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,onLiveSessionStart),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,onLiveSessionFinish),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,onTesterJoined),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,onUTSessionStart),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,onUTSessionFinish))}function getActiveBreakPoint(){return _.first(vm.breakpoints.filter(function(breakpoint){return isActive(breakpoint.id)}))}function isActive(id){return id===PagesService.currentBreakpointId}function onClick(id){PagesService.changePageBreakpoint(id)}function onLiveSessionStart(){vm.isLiveSession=!0,vm.isResponsive&&setResponsive(!1)}function onLiveSessionFinish(){vm.isLiveSession=!1}function onUTSessionStart(){vm.isUTSession=!0,vm.isResponsive&&setResponsive(!1),UsabilityTestService.isHostSession()&&lockBreakpoints()}function onUTSessionFinish(){vm.isUTSession=!1,vm.breakpoints=vm.allBreakpoints,vm.areBreakpointsVisible=vm.breakpoints.length>1}function onTesterJoined(){UsabilityTestService.isHostSession()||lockBreakpoints()}function onCloudOpen(){vm.isOpen=!0}function onCloudClose(){vm.isOpen=!1}function setResponsive(value){vm.isResponsive=value,Settings.setResponsive(value)}function lockBreakpoints(){var availableBreakpoints=UsabilityTestService.getTestData().project.available_breakpoints;vm.allBreakpoints=_.clone(vm.breakpoints),vm.breakpoints=vm.breakpoints.filter(function(breakpoint){return!!_.find(availableBreakpoints,function(availableBreakPoint){return availableBreakPoint.id===breakpoint.id})}),vm.areBreakpointsVisible=vm.breakpoints.length>1}var vm=this;vm.breakpoints=[],vm.areBreakpointsVisible=!1,vm.isUTSession=!1,vm.isLiveSession=!1,vm.isOpen=!1,vm.isResponsive=Settings.isResponsive,vm.isActive=isActive,vm.onClick=onClick,vm.onCloudOpen=onCloudOpen,vm.onCloudClose=onCloudClose,vm.onResponsive=onResponsive,vm.getActiveBreakPoint=getActiveBreakPoint,activate()}angular.module("core").directive("pvBreakpoints",pvBreakpoints),pvBreakpointsCtrl.$inject=["_","$scope","PagesService","LiveShareService","UsabilityTestService","Settings"]}(),function(){"use strict";function CloudComponent(_,scope,trigger,cloud,options){this._=_,this.scope=scope,this.trigger=trigger,this.cloud=cloud,this.options=options,this.isOpen=!1,this.CLASSES={VISIBLE:"visible"},this.onScroll=this.onScroll.bind(this),this.onResize=this.onResize.bind(this),this.onKeydown=this.onKeydown.bind(this),this.onTriggerClick=this.onTriggerClick.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onCloudClick=this.onCloudClick.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this),this.handleDocumentMouseDown=this.handleDocumentMouseDown.bind(this)}function cloud(_){return{restrict:"E",scope:{onOpen:"=",onClose:"=",availablePositions:"=",offset:"=",defaultPosition:"@",triggerType:"@",autoClose:"@",autoFit:"@",focusFirstInput:"@",focusInput:"@",closingDelay:"@"},templateUrl:"/scripts/modules/core/directives/cloud/cloud.html",transclude:!0,link:function(scope,element){var trigger=element[0].querySelector("[data-trigger]"),cloud=element[0].querySelector("[data-cloud]"),scopeOptions=function(){var options={};return _.forEach(defaultOptions,function(option,key){"offset"===key&&scope[key]?options[key]=_.extend({},defaultOptions[key],scope[key]):scope[key]&&(options[key]=scope[key])}),options}(),options=_.extend({},defaultOptions,scopeOptions);if(!trigger)throw Error("Trigger is not defined");if(!cloud)throw Error("Cloud is not defined");var cloudComponent=new CloudComponent(_,scope,trigger,cloud,options);cloudComponent.init(),element.on("$destroy",function(){cloudComponent.removeCloudFromDOM(),cloudComponent.removeGlobalEventListeners()})}}}angular.module("core").directive("cloud",cloud);var MAX_ZINDEX=2147483647,OPENING_DELAY=50,cloudPositions={TOP:"top",TOP_LEFT:"topLeft",TOP_RIGHT:"topRight",BOTTOM:"bottom",BOTTOM_LEFT:"bottomLeft",BOTTOM_RIGHT:"bottomRight",LEFT_BOTTOM:"leftBottom",LEFT_TOP:"leftTop",RIGHT_TOP:"rightTop",RIGHT_BOTTOM:"rightBottom"},triggerTypes={CLICK:"click",HOVER:"hover"},keyCodes={ESC:27},defaultOptions={availablePositions:[cloudPositions.BOTTOM,cloudPositions.BOTTOM_LEFT,cloudPositions.BOTTOM_RIGHT,cloudPositions.TOP,cloudPositions.TOP_LEFT,cloudPositions.TOP_RIGHT,cloudPositions.RIGHT_BOTTOM,cloudPositions.RIGHT_TOP,cloudPositions.LEFT_BOTTOM,cloudPositions.LEFT_TOP],offset:{top:{x:0,y:-5},topLeft:{x:0,y:-5},topRight:{x:0,y:-5},bottom:{x:0,y:5},bottomLeft:{x:0,y:5},bottomRight:{x:0,y:5},leftTop:{x:-5,y:0},leftBottom:{x:-5,y:0},rightTop:{x:5,y:0},rightBottom:{x:5,y:0}},defaultPosition:cloudPositions.BOTTOM,triggerType:triggerTypes.CLICK,autoClose:!1,autoFit:!1,focusFirstInput:!1,focusInput:null,closingDelay:300,onOpen:function(){},onClose:function(){}};CloudComponent.prototype.init=function(){this.trigger.addEventListener("click",this.onTriggerClick),this.trigger.addEventListener("mouseenter",this.onMouseEnter),this.trigger.addEventListener("mouseleave",this.onMouseLeave),this.cloud.addEventListener("click",this.onCloudClick),this.cloud.addEventListener("mouseenter",this.onMouseEnter),this.cloud.addEventListener("mouseleave",this.onMouseLeave),this.removeCloudFromDOM()},CloudComponent.prototype.addCloudClasses=function(classNames){!this._.isArray(classNames)||this._.isArray(classNames)&&!classNames.length||this.cloud.classList.add.apply(this.cloud.classList,classNames)},CloudComponent.prototype.removeCloudClasses=function(classNames){!this._.isArray(classNames)||this._.isArray(classNames)&&!classNames.length||this.cloud.classList.remove.apply(this.cloud.classList,classNames)},CloudComponent.prototype.setCloudStyle=function(styles){if(styles){var cssText="";this._.forEach(styles,function(style,key){style&&(cssText+=key+":"+style+";")}),this.cloud.style.cssText=cssText}},CloudComponent.prototype.appendCloudToBody=function(){document.body.appendChild(this.cloud)},CloudComponent.prototype.removeCloudFromDOM=function(){this.cloud&&this.cloud.parentNode&&this.cloud.parentNode.removeChild(this.cloud)},CloudComponent.prototype.getScrollX=function(){return window.scrollX||window.pageXOffset},CloudComponent.prototype.getScrollY=function(){return window.scrollY||window.pageYOffset},CloudComponent.prototype.setBoundingRects=function(){this.triggerBoundingRect=this.trigger.getBoundingClientRect(),this.cloudBoundingRect=this.cloud.getBoundingClientRect()},CloudComponent.prototype.setCloudClassNamesByPosition=function(position){switch(position){case cloudPositions.BOTTOM:this.classNames=["arrow-top"];break;case cloudPositions.BOTTOM_LEFT:this.classNames=["arrow-top-right"];break;case cloudPositions.BOTTOM_RIGHT:this.classNames=["arrow-top-left"];break;case cloudPositions.TOP:this.classNames=["arrow-bottom"];break;case cloudPositions.TOP_LEFT:this.classNames=["arrow-bottom-right"];break;case cloudPositions.TOP_RIGHT:this.classNames=["arrow-bottom-left"];break;case cloudPositions.LEFT_TOP:this.classNames=["arrow-right-bottom"];break;case cloudPositions.LEFT_BOTTOM:this.classNames=["arrow-right-top"];break;case cloudPositions.RIGHT_TOP:this.classNames=["arrow-left-bottom"];break;case cloudPositions.RIGHT_BOTTOM:this.classNames=["arrow-left-top"]}},CloudComponent.prototype.getOffsetFromOptions=function(position){return this.options.offset&&this.options.offset[position]?this.options.offset[position]:{x:0,y:0}},CloudComponent.prototype.setRightTopPosition=function(){var offsetX=this.getOffsetFromOptions(cloudPositions.RIGHT_TOP).x,offsetY=this.getOffsetFromOptions(cloudPositions.RIGHT_TOP).y;this.position={name:cloudPositions.RIGHT_TOP,x:this.getScrollX()+this.triggerBoundingRect.right+offsetX,y:this.getScrollY()+this.triggerBoundingRect.bottom-this.cloudBoundingRect.height+offsetY}},CloudComponent.prototype.setRightBottomPosition=function(){var offsetX=this.getOffsetFromOptions(cloudPositions.RIGHT_BOTTOM).x,offsetY=this.getOffsetFromOptions(cloudPositions.RIGHT_BOTTOM).y;this.position={name:cloudPositions.RIGHT_BOTTOM,x:this.getScrollX()+this.triggerBoundingRect.right+offsetX,y:this.getScrollY()+this.triggerBoundingRect.top+offsetY}},CloudComponent.prototype.setLeftTopPosition=function(){var offsetX=this.getOffsetFromOptions(cloudPositions.LEFT_TOP).x,offsetY=this.getOffsetFromOptions(cloudPositions.LEFT_TOP).y;this.position={name:cloudPositions.LEFT_TOP,x:this.getScrollX()+this.triggerBoundingRect.left-this.cloudBoundingRect.width+offsetX,y:this.getScrollY()+this.triggerBoundingRect.bottom-this.cloudBoundingRect.height+offsetY}},CloudComponent.prototype.setLeftBottomPosition=function(){var offsetX=this.getOffsetFromOptions(cloudPositions.LEFT_BOTTOM).x,offsetY=this.getOffsetFromOptions(cloudPositions.LEFT_BOTTOM).y;this.position={name:cloudPositions.LEFT_BOTTOM,x:this.getScrollX()+this.triggerBoundingRect.left-this.cloudBoundingRect.width+offsetX,y:this.getScrollY()+this.triggerBoundingRect.top+offsetY}},CloudComponent.prototype.setTopPosition=function(){var offsetX=this.getOffsetFromOptions(cloudPositions.TOP).x,offsetY=this.getOffsetFromOptions(cloudPositions.TOP).y,height=this._.min([this.cloudMaxHeight,this.cloudBoundingRect.height]);this.position={name:cloudPositions.TOP,x:this.getScrollX()+this.triggerBoundingRect.left+this.triggerBoundingRect.width/2-this.cloudBoundingRect.width/2+offsetX,y:this.getScrollY()+this.triggerBoundingRect.top-height+offsetY}},CloudComponent.prototype.setTopLeftPosition=function(){var offsetX=this.getOffsetFromOptions(cloudPositions.TOP_LEFT).x,offsetY=this.getOffsetFromOptions(cloudPositions.TOP_LEFT).y,height=this._.min([this.cloudMaxHeight,this.cloudBoundingRect.height]);this.position={name:cloudPositions.TOP_LEFT,x:this.getScrollX()+this.triggerBoundingRect.right-this.cloudBoundingRect.width+offsetX,y:this.getScrollY()+this.triggerBoundingRect.top-height+offsetY}},CloudComponent.prototype.setTopRightPosition=function(){var offsetX=this.getOffsetFromOptions(cloudPositions.TOP_RIGHT).x,offsetY=this.getOffsetFromOptions(cloudPositions.TOP_RIGHT).y,height=this._.min([this.cloudMaxHeight,this.cloudBoundingRect.height]);this.position={name:cloudPositions.TOP_RIGHT,x:this.getScrollX()+this.triggerBoundingRect.left+offsetX,y:this.getScrollY()+this.triggerBoundingRect.top-height+offsetY}},CloudComponent.prototype.setBottomPosition=function(){var offsetX=this.getOffsetFromOptions(cloudPositions.BOTTOM).x,offsetY=this.getOffsetFromOptions(cloudPositions.BOTTOM).y;this.position={name:cloudPositions.BOTTOM,x:this.getScrollX()+this.triggerBoundingRect.left+this.triggerBoundingRect.width/2-this.cloudBoundingRect.width/2+offsetX,y:this.getScrollY()+this.triggerBoundingRect.bottom+offsetY}},CloudComponent.prototype.setBottomLeftPosition=function(){var offsetX=this.getOffsetFromOptions(cloudPositions.BOTTOM_LEFT).x,offsetY=this.getOffsetFromOptions(cloudPositions.BOTTOM_LEFT).y;this.position={name:cloudPositions.BOTTOM_LEFT,x:this.getScrollX()+this.triggerBoundingRect.right-this.cloudBoundingRect.width+offsetX,y:this.getScrollY()+this.triggerBoundingRect.bottom+offsetY}},CloudComponent.prototype.setBottomRightPosition=function(){var offsetX=this.getOffsetFromOptions(cloudPositions.BOTTOM_RIGHT).x,offsetY=this.getOffsetFromOptions(cloudPositions.BOTTOM_RIGHT).y;this.position={name:cloudPositions.BOTTOM_RIGHT,x:this.getScrollX()+this.triggerBoundingRect.left+offsetX,y:this.getScrollY()+this.triggerBoundingRect.bottom+offsetY}},CloudComponent.prototype.getDefaultPosition=function(){return this.options.defaultPosition||cloudPositions.BOTTOM},CloudComponent.prototype.setProperPosition=function(){var defaultPosition=this.getDefaultPosition();if(this.doesCloudFitInWindow(defaultPosition))return!0;for(var positions=this.options.availablePositions.filter(function(position){return position!==defaultPosition}),i=0;i<positions.length;i++)if(this.doesCloudFitInWindow(positions[i]))return!0;this.setSelectedPosition(defaultPosition)},CloudComponent.prototype.setSelectedPosition=function(position){switch(position=position||cloudPositions.BOTTOM){case cloudPositions.BOTTOM:this.setBottomPosition();break;case cloudPositions.BOTTOM_LEFT:this.setBottomLeftPosition();break;case cloudPositions.BOTTOM_RIGHT:this.setBottomRightPosition();break;case cloudPositions.TOP:this.setTopPosition();break;case cloudPositions.TOP_LEFT:this.setTopLeftPosition();break;case cloudPositions.TOP_RIGHT:this.setTopRightPosition();break;case cloudPositions.LEFT_TOP:this.setLeftTopPosition();break;case cloudPositions.LEFT_BOTTOM:this.setLeftBottomPosition();break;case cloudPositions.RIGHT_TOP:this.setRightTopPosition();break;case cloudPositions.RIGHT_BOTTOM:this.setRightBottomPosition()}},CloudComponent.prototype.doesCloudFitInWindow=function(position){
position=position||cloudPositions.BOTTOM,this.setBoundingRects();var windowWidth=window.innerWidth,windowHeight=window.innerHeight;return this.setSelectedPosition(position),this.position.y>=0&&this.position.y+this.cloudBoundingRect.height<=windowHeight&&this.position.x>0&&this.position.x+this.cloudBoundingRect.width<=windowWidth},CloudComponent.prototype.isElementInViewport=function(el,container){var rect=el.getBoundingClientRect(),containerRect=this._.isFunction(container.getBoundingClientRect)?container.getBoundingClientRect():{top:0,left:0,bottom:window.innerHeight,right:window.innerWidth};return rect.top>=containerRect.top&&rect.left>=containerRect.left&&rect.bottom<=containerRect.bottom&&rect.right<=containerRect.right},CloudComponent.prototype.onScroll=function(e){e.target.contains(this.trigger)&&this.isOpen&&(this.isElementInViewport(this.trigger,e.target)?this.refreshCloudPosition():this.closeCloud())},CloudComponent.prototype.onResize=function(){this.isOpen&&this.refreshCloudPosition()},CloudComponent.prototype.onKeydown=function(e){var keyCode=e.keyCode;keyCode===keyCodes.ESC&&this.closeCloud()},CloudComponent.prototype.addGlobalEventListeners=function(){this.getTriggerType()===triggerTypes.CLICK&&(document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("click",this.handleDocumentClick)),window.addEventListener("scroll",this.onScroll,!0),window.addEventListener("resize",this.onResize,!0),window.addEventListener("keydown",this.onKeydown,!0)},CloudComponent.prototype.removeGlobalEventListeners=function(){this.getTriggerType()===triggerTypes.CLICK&&(document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("click",this.handleDocumentClick)),window.removeEventListener("scroll",this.onScroll,!0),window.removeEventListener("resize",this.onResize,!0),window.removeEventListener("keydown",this.onKeydown,!0)},CloudComponent.prototype.adjustCloudMaxHeightAndPosition=function(){var heightToBottom,heightToTop,selectedPosition,MARGIN=20,defaultPosition=this.getDefaultPosition();if(this.setBoundingRects(),heightToBottom=window.innerHeight-this.triggerBoundingRect.bottom-MARGIN,heightToTop=this.triggerBoundingRect.top-MARGIN,heightToBottom>=heightToTop)if(heightToTop>this.cloud.offsetHeight)selectedPosition=defaultPosition,this.cloudMaxHeight=heightToTop;else switch(this.cloudMaxHeight=heightToBottom,defaultPosition){case cloudPositions.TOP:selectedPosition=cloudPositions.BOTTOM;break;case cloudPositions.TOP_LEFT:selectedPosition=cloudPositions.BOTTOM_LEFT;break;case cloudPositions.TOP_RIGHT:selectedPosition=cloudPositions.BOTTOM_RIGHT;break;default:selectedPosition=defaultPosition}else if(heightToBottom>this.cloud.offsetHeight)selectedPosition=defaultPosition,this.cloudMaxHeight=heightToBottom;else switch(this.cloudMaxHeight=heightToTop,defaultPosition){case cloudPositions.BOTTOM:selectedPosition=cloudPositions.TOP;break;case cloudPositions.BOTTOM_LEFT:selectedPosition=cloudPositions.TOP_LEFT;break;case cloudPositions.BOTTOM_RIGHT:selectedPosition=cloudPositions.TOP_RIGHT;break;default:selectedPosition=defaultPosition}this.setSelectedPosition(selectedPosition),this.removeCloudClasses(this.classNames),this.setCloudClassNamesByPosition(this.position.name)},CloudComponent.prototype.openCloud=function(){return!this.isOpen&&(this.isOpen=!0,void this.onCloudOpen())},CloudComponent.prototype.getTriggerType=function(){return this.options.triggerType||triggerTypes.CLICK},CloudComponent.prototype.focusFirstInput=function(){setTimeout(function(){var input=this.cloud.querySelector("input[type=text]");input&&this._.isFunction(input.focus)&&input.focus()}.bind(this))},CloudComponent.prototype.focusInput=function(){setTimeout(function(){var input=this.cloud.querySelector(this.options.focusInput);input&&this._.isFunction(input.focus)&&input.focus()}.bind(this))},CloudComponent.prototype.onCloudOpen=function(){this.appendCloudToBody(),setTimeout(function(){this.setCloudStyle({visibility:"hidden",display:"block"}),setTimeout(function(){this.setCloudPositionStyle(),this.options.focusFirstInput?this.focusFirstInput():this.options.focusInput&&this.focusInput(),this.addGlobalEventListeners()}.bind(this))}.bind(this)),this._.isFunction(this.options.onOpen)&&this.options.onOpen(this.trigger,this.cloud)},CloudComponent.prototype.closeCloud=function(){return!!this.isOpen&&(this.removeCloudFromDOM(),this.isOpen=!1,void this.onCloudClose())},CloudComponent.prototype.onCloudClose=function(){this.removeGlobalEventListeners(),this.removeCloudClasses([this.CLASSES.VISIBLE]),this._.isFunction(this.options.onClose)&&this.options.onClose(this.trigger,this.cloud)},CloudComponent.prototype.setCloudPositionStyle=function(){this.options.autoFit?this.adjustCloudMaxHeightAndPosition():(this.setBoundingRects(),this.setProperPosition(),this.removeCloudClasses(this.classNames),this.setCloudClassNamesByPosition(this.position.name)),this.setCloudStyle({"z-index":MAX_ZINDEX,transform:"inherit",left:this.position.x+"px","max-height":this.cloudMaxHeight?this.cloudMaxHeight+"px":null,top:this.position.y+"px"}),this.addCloudClasses(this.classNames.concat(this.CLASSES.VISIBLE))},CloudComponent.prototype.refreshCloudPosition=function(){this.setCloudPositionStyle()},CloudComponent.prototype.getCloudElement=function(){return this.cloud},CloudComponent.prototype.toggleCloud=function(){this.isOpen?this.closeCloud():this.openCloud()},CloudComponent.prototype.handleDocumentClick=function(e){this.preventClick||!this.options.autoClose&&this.cloud.contains(e.target)||this.options.autoClose&&this.cloud.contains(e.target)&&"A"!==e.target.tagName||this.closeCloud()},CloudComponent.prototype.handleDocumentMouseDown=function(e){if(this.preventClick=!1,!this.options.autoClose&&this.cloud.contains(e.target)||this.options.autoClose&&this.cloud.contains(e.target)&&"A"!==e.target.tagName)return void(this.preventClick=!0)},CloudComponent.prototype.onCloudClick=function(e){this.getTriggerType()===triggerTypes.HOVER&&this.options.autoClose&&this.closeCloud()},CloudComponent.prototype.onTriggerClick=function(e){return e.preventDefault(),this.getTriggerType()!==triggerTypes.CLICK?(this.options.autoClose&&"A"===e.target.tagName&&this.closeCloud(),!1):void this.toggleCloud()},CloudComponent.prototype.onMouseEnter=function(e){return e.preventDefault(),this.getTriggerType()===triggerTypes.HOVER&&(clearTimeout(this.closingCloudTimeout),this.isMouseLeaving=!1,void(this.openingCloudTimeout=setTimeout(function(){this.openCloud()}.bind(this),OPENING_DELAY)))},CloudComponent.prototype.onMouseLeave=function(e){return e.preventDefault(),this.getTriggerType()===triggerTypes.HOVER&&!this.isMouseLeaving&&(clearTimeout(this.openingCloudTimeout),this.closingCloudTimeout=setTimeout(function(){this.isMouseLeaving=!1,this.closeCloud()}.bind(this),this.options.closingDelay),void(this.isMouseLeaving=!0))},cloud.$inject=["_"]}(),function(){"use strict";function codeEditor(_,CodeMirror){return{restrict:"E",replace:!0,scope:{options:"=",value:"=",mode:"="},templateUrl:"/scripts/modules/core/directives/codeEditor/codeMirror.html",link:function(scope,element){function removeSingleNumbers(){codeMirror.doc.size>1?(codeMirror.setOption("lineNumbers",!0),codeMirror.setOption("gutters",[])):(codeMirror.setOption("lineNumbers",!1),codeMirror.setOption("gutters",["fake-gutter"]))}var defaultOptions={mode:"sass",lineNumbers:!0,lineWrapping:!0,readOnly:!0,value:"",theme:"uxpin-readonly",viewportMargin:100},codeMirror=CodeMirror.fromTextArea(element[0],_.extend({},defaultOptions,scope.options));scope.$watch(function(){return scope.options?scope.options.value:""},function(val){codeMirror.setValue(val||"")}),scope.$watch(function(){return scope.value},function(val){val&&codeMirror.setValue(val||"")}),scope.$watch(function(){return scope.mode},function(val){val&&codeMirror.setOption("mode",val)}),scope.$watch(function(){removeSingleNumbers()})}}}angular.module("core").directive("codeEditor",codeEditor),codeEditor.$inject=["_","CodeMirror"]}(),function(){"use strict";function pvEmailsParser(ValidationHelper){function link(scope,el,attrs,ngModelCtrl){function parser(value){var items=value.split(attrs.pvEmailsParser),emails=[];return _.each(items,function(item){var trimmedItem=item.trim();ValidationHelper.isEmail(trimmedItem)&&emails.push(trimmedItem)}),emails}function formatter(value){var emails=[];return _.isArray(value)?(_.each(value,function(item){var trimmedItem=item.trim();ValidationHelper.isEmail(trimmedItem)&&emails.push(trimmedItem)}),emails.join(",")):""}ngModelCtrl.$parsers.push(parser),ngModelCtrl.$formatters.push(formatter)}return{restrict:"A",require:"ngModel",link:link}}angular.module("core").directive("pvEmailsParser",pvEmailsParser),pvEmailsParser.$inject=["ValidationHelper"]}(),function(){"use strict";function pvEnter(){function link(scope,el,attrs){var ENTER_KEY_CODE=13;el.on("keydown keypress",function(event){event.which===ENTER_KEY_CODE&&(event.preventDefault(),scope.$apply(function(){scope.$eval(attrs.pvEnter)}))})}return{restrict:"A",link:link}}angular.module("core").directive("pvEnter",pvEnter)}(),function(){"use strict";function pvFocusMe($parse,$timeout){function link(scope,el,attrs){var model=$parse(attrs.pvFocusMe);scope.$watch(model,function(value){value&&$timeout(function(){el[0].focus()},0)}),el.on("blur",function(){scope.$apply(function(){model.assign(scope,!1)})})}return{restrict:"A",link:link}}angular.module("core").directive("pvFocusMe",pvFocusMe),pvFocusMe.$inject=["$parse","$timeout"]}(),function(){"use strict";function pvToggler(){function link(scope,el,attrs,controllers){function activate(){ngModelCtrl.$render=renderer,ngModelCtrl.$formatters.push(formatter),ngModelCtrl.$parsers.push(parser),el.on("click",handleClick)}function renderer(){var viewValue=ngModelCtrl.$viewValue;label.text(viewValue)}function formatter(value){return value?attrs.trueLabel:attrs.falseLabel}function parser(newValue){return newValue===attrs.trueLabel}function handleClick(event){event.preventDefault(),event.stopPropagation(),scope.$apply(function(){toggleViewValue()})}function toggleViewValue(){var newViewValue=ngModelCtrl.$viewValue===attrs.trueLabel?attrs.falseLabel:attrs.trueLabel;updateViewValue(newViewValue)}function updateViewValue(value){ngModelCtrl.$setViewValue(value),label.text(value)}var ngModelCtrl=controllers[0],label=el.find("a");activate()}return{restrict:"E",require:["ngModel","?ngChange"],scope:{title:"@",trueLabel:"@",falseLabel:"@"},link:link,templateUrl:"/scripts/modules/core/directives/controls/pvToggler.html"}}angular.module("core").directive("pvToggler",pvToggler)}(),function(){"use strict";function imageDownloader($timeout){return{restrict:"E",scope:{image:"="},templateUrl:"/scripts/modules/core/directives/imageDownloader/imageDownloader.html",link:function(scope,element){var form=element.find("form");scope.$watchCollection(function(){return scope.image},function(value){value&&(scope.name=value.name,scope.type=value.type,scope.content=value.content,$timeout(function(){form[0].submit()}))})}}}angular.module("core").directive("imageDownloader",imageDownloader),imageDownloader.$inject=["$timeout"]}(),function(){"use strict";function inputMinMax(){return{restrict:"E",replace:!0,scope:{model:"=?",values:"=?",onFocus:"=?",onBlur:"=?",disabled:"=?",minValue:"=?",maxValue:"=?",incrementValue:"@?",shiftIncrementValue:"@?"},templateUrl:"/scripts/modules/core/directives/input/inputMinMax.view.html",controller:inputMinMaxCtrl,controllerAs:"vm",bindToController:!0}}function inputMinMaxCtrl(_,$scope,$element){function handleFocus(event){event.target.select(),storeValue(),_.isFunction(vm.onFocus)&&vm.onFocus(event),isFocused=!0}function handleBlur(event){(!parseInt(vm.model)||parseInt(vm.model)<vm.minValue)&&(vm.model=vm.minValue),parseInt(vm.model)>vm.maxValue&&(vm.model=vm.maxValue),_.isFunction(vm.onBlur)&&vm.onBlur(event),isFocused=!1}function handleKeyDown(event){var charCode=event.keyCode,charStr=String.fromCharCode(charCode),availableKeys=_.values(KEYS_CODES);return vm.disabled||!/\d/.test(charStr)&&availableKeys.indexOf(event.keyCode)===-1?void event.preventDefault():(handleChangeValueKeyAction(event),void handleFinishKeyAction(event))}function handleChangeValueKeyAction(event){if(!([KEYS_CODES.ARROW_UP,KEYS_CODES.ARROW_DOWN].indexOf(event.keyCode)<0)){var direction=event.keyCode===KEYS_CODES.ARROW_UP?1:-1,oldValue=vm.model||0;hasStrictValues()?vm.model=getNewValue(vm.values,oldValue,direction):vm.model=oldValue+direction*(event.shiftKey?vm.shiftIncrementValue:vm.incrementValue),event.preventDefault()}}function hasStrictValues(){return!!vm.values.length}function getNewValue(values,value,direction){return direction>0?getNextValue(values,value):getPrevValue(values,value)}function getNextValue(values,value){for(var i=0;i<values.length;i++)if(value<values[i])return values[i];return values[values.length-1]}function getPrevValue(values,value){for(var i=values.length-1;i>0;i--)if(value>values[i])return values[i];return values[0]}function storeValue(){storedValue=vm.model}function restoreValue(){storedValue!==vm.model&&(vm.model=storedValue)}function handleFinishKeyAction(event){switch(event.keyCode){case KEYS_CODES.ENTER:handleBlur();break;case KEYS_CODES.ESCAPE:cancel()}}function cancel(){restoreValue(),handleBlur()}var vm=this,isFocused=!1,storedValue=null,KEYS_CODES={ARROW_LEFT:37,ARROW_RIGHT:39,ARROW_UP:38,ARROW_DOWN:40,ENTER:13,ESCAPE:27,BACKSPACE:8};vm.incrementValue=vm.incrementValue||1,vm.shiftIncrementValue=vm.shiftIncrementValue||10,vm.handleFocus=handleFocus,vm.handleBlur=handleBlur,vm.handleKeyDown=handleKeyDown}angular.module("core").directive("inputMinMax",inputMinMax),inputMinMaxCtrl.$inject=["_","$scope","$element"]}(),function(){"use strict";function layersList(){return{restrict:"E",replace:!0,scope:{collection:"<",nodeMap:"<"},templateUrl:"/scripts/modules/core/directives/layers/layersList.view.html",controller:layersListCtrl,controllerAs:"vm",bindToController:!0}}function layersListCtrl($scope,Engine,$rootScope,ElementClassService){function toggleExpandStatus(e,id){e.stopPropagation(),vm.expandStatus[id]=!vm.expandStatus[id]}function onMouseEnter(e,node){e.stopPropagation(),vm.hoveredElement!==node.id&&($rootScope.$emit(PreviewEnums.LAYER_HOVERED,node.raw),vm.hoveredElement=node.id)}function onMouseLeave(e){e.stopPropagation(),null!==vm.hoveredElement&&($rootScope.$emit(PreviewEnums.LAYER_HOVERED,null),vm.hoveredElement=null)}function onChangePage(){vm.selectedElement=null,vm.hiddenElement=[],vm.hoveredElement=null}function select(e,node){e.stopPropagation(),vm.selectedElement===node.id?(Engine.deselectAllElements(null),$rootScope.$emit(PreviewEnums.LAYER_SELECTED,null),vm.selectedElement=null):(Engine.selectElement(node.raw),vm.selectedElement=node.id,$rootScope.$emit(PreviewEnums.LAYER_SELECTED,node.raw))}function isSelected(id){return id===vm.selectedElement}function toggleVisibility(e,node){e.preventDefault(),e.stopPropagation(),isHidden(node.id)?(node.raw.stateIa="visible",vm.hiddenElement.splice(vm.hiddenElement.indexOf(node.id),1)):(node.raw.stateIa="hidden",vm.hiddenElement.push(node.id))}function isHidden(id){return vm.hiddenElement.indexOf(id)>-1}function onPageLoad(){currentPage||(currentPage=Engine.getPage(),currentPage.on(window.uxpinEngine.Events.ELEMENT_PICKED,onPick),currentPage.on(window.uxpinEngine.Events.ELEMENT_HOVERED,onHover))}function onPick(data){data&&data.element?vm.selectedElement=data.element.id:vm.selectedElement=null}function onHover(data){data&&data.element?vm.hoveredElement=data.element.id:vm.hoveredElement=null}var currentPage,vm=this,onPageLoadOff=$rootScope.$on(PreviewEnums.ON_PAGE_LOADED,onPageLoad),onChangePageOff=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,onChangePage);vm.selectedElement=null,vm.hiddenElement=[],vm.hoveredElement=null,vm.onMouseEnter=onMouseEnter,vm.onMouseLeave=onMouseLeave,vm.select=select,vm.isSelected=isSelected,vm.toggleVisibility=toggleVisibility,vm.isHidden=isHidden,vm.toggleExpandStatus=toggleExpandStatus,vm.getListItemClassByType=ElementClassService.getListItemClassByType,vm.expandStatus={},$scope.$on("$destroy",function(){onPageLoadOff(),onChangePageOff()})}angular.module("core").directive("layersList",layersList),layersListCtrl.$inject=["$scope","Engine","$rootScope","ElementClassService"]}(),angular.module("core").controller("MediaAccessTipController",["$rootScope","$scope",function($rootScope,$scope){"use strict";$scope.isTipVisible=!1,$scope.isDenied=!1;var showTip=function(){$scope.isTipVisible=!0},hideTip=function(){$scope.isTipVisible=!1},isTipOpen=function(){return $scope.isTipVisible};$scope.onClickClose=function(){hideTip()};var onMediaAccess=$rootScope.$on(PreviewEnums.MEDIA_ACCESS,function(e,value){switch(value){case PreviewEnums.MEDIA_ACCESS_TYPE.REQUEST:showTip();break;case PreviewEnums.MEDIA_ACCESS_TYPE.ALLOWED:case PreviewEnums.MEDIA_ACCESS_TYPE.HIDE:hideTip();break;case PreviewEnums.MEDIA_ACCESS_TYPE.DENIED:$scope.isDenied=!0,isTipOpen()||showTip()}});$scope.$on("$destroy",function(){onMediaAccess()})}]),angular.module("core").directive("mediaAccessTip",[function(){"use strict";return{restrict:"E",replace:!0,scope:!0,controller:"MediaAccessTipController",templateUrl:"/scripts/modules/core/directives/mediaAccessTip/mediaAccessTip.directive.html"}}]),function(){"use strict";function pvCollaboratorMention(UsersService){function link(scope,el,attrs,pvMentionCtrl){function label(option){return"@"+option.name}function highlight(option){return'<span class="mention">'+label(option)+"</span>"}function encode(option){return"["+option.name+"](mailto:"+option.email+")"}function decode(value){var splited=value.split("](");return{name:splited[0].replace("[",""),email:splited[1].replace(/(\)|mailto:)/gi,"")}}function filter(match,options){var lowerCaseMatch=match[1].toLowerCase();return _.filter(options,function(option){return _.includes(option.name.toLowerCase(),lowerCaseMatch)})}function onMentionsUpdate(mentions){scope.mentions=mentions}pvMentionCtrl.optionsCache=_.toArray(UsersService.collaboratorsMap),pvMentionCtrl.label=label,pvMentionCtrl.highlight=highlight,pvMentionCtrl.filter=filter,pvMentionCtrl.encode=encode,pvMentionCtrl.decode=decode,scope.mentions&&(pvMentionCtrl.onMentionsUpdate=onMentionsUpdate)}return{restrict:"A",require:"pvMention",scope:{mentions:"=?"},link:link}}angular.module("core").directive("pvCollaboratorMention",pvCollaboratorMention),pvCollaboratorMention.$inject=["UsersService"]}(),function(){"use strict";function pvMention(){function compile(el,attrs){var fakeTextarea='<div class="mention-area"></div>';return el.after(fakeTextarea),link}function link(scope,el,attrs,controllers){var ngModelCtrl=controllers[0],pvMentionCtrl=controllers[1];pvMentionCtrl.init(ngModelCtrl)}return{restrict:"A",require:["ngModel","pvMention"],compile:compile,link:link,controller:pvMentionCtrl,controllerAs:"$pvMention"}}function pvMentionCtrl($scope,$element,$attrs,$document,pvMentionsUtils,EscapeHtmlService){function init(model){ngModel=model,ngModel.$render=render,ngModel.$parsers.push(parser),ngModel.$formatters.push(formatter),$attrs.ngTrim="false",addListeners()}function addListeners(){$element.on("keyup input change",_.throttle(handleInputChange,250,{trailing:!1})),$element.on("focus",handleFocus),$element.on("scroll",updateScrollPosition),$scope.$on("$destroy",function(){removeSearchListeners()})}function addSearchListeners(){$document[0].addEventListener("keydown",handleKeyDown,!0)}function removeSearchListeners(){$document[0].removeEventListener("keydown",handleKeyDown,!0)}function label(option){return""}function highlight(option){return""}function encode(option){return""}function decode(text){return{}}function filter(match,options){return[]}function onMentionsUpdate(mentions){}function labelRegExp(option){return new RegExp("\\B"+vm.label(option)+"\\b","gi")}function encodeRegExp(option){var escapedEncode=vm.encode(option).replace(/[|\\{}()[\]^$+*?.]/g,"\\$&");return new RegExp(escapedEncode,"gi")}function caret(){return'<span class="'+CARET_CLASS+'"></span>'}function render(){var viewValue=ngModel.$viewValue||"";renderRealTextarea(viewValue),renderFakeTextarea(viewValue)}function parser(value){var mention,mentionsLength=vm.mentions.length;updateScrollPosition(),updateMentions(getParserMentions(value)),renderFakeTextarea(value);for(var i=0;i<mentionsLength;i++)mention=vm.mentions[i],value=value.replace(vm.labelRegExp(mention),vm.encode(mention));return value.trim()}function formatter(value){var mention,mentionsLength=vm.mentions.length;updateMentions(getFormatterMentions(value)),value=value.toString()||"";for(var i=0;i<mentionsLength;i++)mention=vm.mentions[i],value=value.replace(vm.encodeRegExp(mention),vm.label(mention));return value}function getParserMentions(value){for(var labelRegExp,optionsCache=vm.optionsCache,optionsCacheLength=optionsCache.length,mentions=[],i=0;i<optionsCacheLength;i++){var mention=optionsCache[i];labelRegExp=vm.labelRegExp(mention),labelRegExp.test(value)&&mentions.push(mention)}return mentions}function getFormatterMentions(value){for(var mention,mentions=_.uniq(value.match(DECODE_PATTERN)),mentionsLength=mentions.length,decodedMentions=[],i=0;i<mentionsLength;i++)mention=vm.decode(mention),decodedMentions.push(vm.decode(mention));return decodedMentions}function handleInputChange(){var element=$element[0],selectionStart=element.selectionStart;if(selectionStart===element.selectionEnd){var text=element.value,match=PATTERN.exec(text.substr(0,selectionStart));if(!oldInputChangeMatch&&!match)return void(oldInputChangeMatch=match);oldInputChangeMatch=match,$scope.$apply(function(){match?(updateMenuPosition(),vm.search(match)):vm.cancel()})}}function handleKeyDown(event){if(vm.searching)switch(event.keyCode){case KEY_CODES.ENTER:enter(event);break;case KEY_CODES.ARROW_UP:arrowUp(event);break;case KEY_CODES.ARROW_DOWN:arrowDown(event)}}function handleFocus(){$document.on("mouseup",handleMouseUp)}function handleMouseUp(event){event.target!==$element[0]&&($document.off("mouseup",handleMouseUp),vm.searching&&$scope.$evalAsync(function(){cancel()}))}function updateScrollPosition(){fakeTextarea.scrollTop=$element[0].scrollTop}function search(match){vm.searching=match,vm.options=vm.filter(match,vm.optionsCache),vm.searching?addSearchListeners():removeSearchListeners(),vm.activeOption||(vm.activeOption=_.take(vm.options))}function select(option){addMention(option),ngModel.$setViewValue(replace(option)),ngModel.$render(),$element[0].focus(),vm.cancel()}function enter(event){event.stopPropagation(),event.preventDefault(),vm.activeOption&&vm.select(vm.activeOption)}function arrowUp(event){event.preventDefault();var index=vm.options.indexOf(vm.activeOption);vm.activeOption=index>0?vm.options[index-1]:vm.options[vm.options.length-1]}function arrowDown(event){event.preventDefault();var index=vm.options.indexOf(vm.activeOption);vm.activeOption=index<vm.options.length-1?vm.options[index+1]:vm.options[0]}function cancel(){vm.searching=!1,vm.activeOption=null,removeSearchListeners()}function replace(option){var search=vm.searching,text=ngModel.$viewValue;return text.substr(0,search.index+search[0].indexOf("@"))+vm.label(option)+" "+text.substr(search.index+search[0].length)}function addMention(mention){vm.mentions.push(mention),vm.onMentionsUpdate(vm.mentions)}function updateMentions(mentions){vm.mentions=mentions,vm.onMentionsUpdate(vm.mentions)}function renderRealTextarea(value){$element[0].value=value}function renderFakeTextarea(text){text=EscapeHtmlService.escape(text);var mention,caretMatch=getCaretMatch(text),mentionsLength=vm.mentions.length;caretMatch&&(text=withCaret(caretMatch,text)),text=text.toString()||"";for(var i=0;i<mentionsLength;i++)mention=vm.mentions[i],text=text.replace(vm.labelRegExp(mention),vm.highlight(mention));fakeTextarea.innerHTML=text+"<br />"}function getCaretMatch(text){return PATTERN.exec(text.substr(0,$element[0].selectionStart))}function withCaret(match,text){return text.substr(0,match.index+match[0].length)+caret()+text.substr(match.index+match[0].length)}function updateMenuPosition(){vm.menuPosition=getCaretPosition()}function getCaretPosition(){var caret=fakeTextarea.querySelector("."+CARET_CLASS);return{top:pvMentionsUtils.toPixels(caret.offsetTop-$element[0].scrollTop+MARGIN),left:pvMentionsUtils.toPixels(caret.offsetLeft+Math.round(caret.offsetWidth/2))}}var ngModel,PATTERN=/(?:\s+|^)@((\w|@|\.)+(?: \w+)?)$/,DECODE_PATTERN=/\[(.*?)\]\(mailto:(.*?)\)/gi,CARET_CLASS="caret",MARGIN=20,KEY_CODES=keysEnums.KEY_CODES,vm=this;vm.optionsCache=[],vm.options=[],vm.mentions=[],vm.activeOption=null,vm.searching=!1,vm.menuPosition=null,vm.init=init,vm.label=label,vm.labelRegExp=labelRegExp,vm.encodeRegExp=encodeRegExp,vm.highlight=highlight,vm.filter=filter,vm.select=select,vm.encode=encode,vm.decode=decode,vm.search=search,vm.cancel=cancel,vm.onMentionsUpdate=onMentionsUpdate;var $fakeTextarea=$element.next(),fakeTextarea=$fakeTextarea[0],oldInputChangeMatch=null}angular.module("core").directive("pvMention",pvMention),pvMentionCtrl.$inject=["$scope","$element","$attrs","$document","pvMentionsUtils","EscapeHtmlService"]}();!function(){"use strict";function pvMentionsUtils(){function toPixels(value){return value+"px"}return{toPixels:toPixels}}angular.module("core").factory("pvMentionsUtils",pvMentionsUtils)}();!function(){"use strict";function pvNotify($document){function link(scope,el,attrs,controllers){function activate(){ngModelCtrl&&(ngModelCtrl.$render=renderer),scope.$on("$destroy",onDestroy)}function renderer(){vm.selected=ngModelCtrl.$viewValue||[],vm.updateFilters()}function toggle(){return vm.isOpen?void closeDropdown():void openDropdown()}function openDropdown(){vm.isOpen||(vm.isOpen=!0,bindEvents(),_.isFunction(scope.onOpen)&&scope.onOpen())}function closeDropdown(){vm.isOpen&&(vm.isOpen=!1,unbindEvents(),_.isFunction(scope.onClose)&&scope.onClose())}function bindEvents(){$document[0].addEventListener("click",onClick,!0),$document.on("keydown",onKeyDown)}function unbindEvents(){$document[0].removeEventListener("click",onClick,!0),$document.off("keydown",onKeyDown)}function selectProjectMembers(){vm.selected=vm.getProjectMembersEmails(),vm.selectFilter("projectMembers"),ngModelCtrl.$setViewValue(vm.selected)}function selectAll(){vm.selected=vm.getAllEmails(),vm.selectFilter("all"),ngModelCtrl.$setViewValue(vm.selected)}function selectNone(){vm.selected=[],vm.selectFilter("none"),ngModelCtrl.$setViewValue(vm.selected)}function onClick(event){el[0].contains(event.target)||scope.$apply(function(){closeDropdown()})}function onKeyDown(event){event.which===KEY_CODES.ESC&&scope.$apply(function(){closeDropdown()})}function onTextareaEnter(){vm.customEmails&&(addPeople(vm.getCustomPeople()),addSelectedEmails(vm.customEmails),vm.customEmails=[],vm.scrollToBottom=!0)}function onDestroy(){unbindEvents()}function addPeople(people){scope.people=vm.people.concat(people)}function addSelectedEmails(emails){vm.selected=_.uniq(vm.selected.concat(emails)),ngModelCtrl.$setViewValue(vm.selected)}var KEY_CODES=keysEnums.KEY_CODES,vm=scope.vm,ngModelCtrl=controllers[0];vm.selected=[],vm.isOpen=!1,vm.toggle=toggle,vm.closeDropdown=closeDropdown,vm.selectProjectMembers=selectProjectMembers,vm.selectAll=selectAll,vm.selectNone=selectNone,vm.onTextareaEnter=onTextareaEnter,activate()}return{restrict:"E",require:["?ngModel","?ngChange"],scope:{people:"=",onOpen:"&?",onClose:"&?"},templateUrl:"/scripts/modules/core/directives/notify/pvNotify.html",link:link,controller:pvNotifyCtrl,controllerAs:"vm"}}function pvNotifyCtrl($scope){function activate(){$scope.$watch("people",function(newPeople){vm.people=newPeople,vm.projectMembersEmails=getProjectMembersEmails(),vm.updateFilters()})}function isEmailOnList(email){return!!_.find(vm.people,function(person){return person.email===email})}function isAllSelected(){return _.every([vm.people.length>0,vm.people.length===vm.selected.length,vm.people.length!==vm.projectMembersEmails.length])}function isProjectMembersSelected(){var diff=_.difference(vm.projectMembersEmails,vm.selected);return _.every([_.isEmpty(diff),vm.projectMembersEmails.length===vm.selected.length])}function isNoneSelected(){return _.isEmpty(vm.selected)}function getAllEmails(){return _.map(vm.people,function(person){return person.email})}function getProjectMembersEmails(){var emails=[];return _.each(vm.people,function(person){person.isOwner&&emails.push(person.email)}),emails}function getNewPerson(email){return{name:email,email:email,id:MD5(email)}}function getCustomPeople(){var customPeople=[];return _.each(_.uniq(vm.customEmails),function(email){isEmailOnList(email)||customPeople.push(getNewPerson(email))}),customPeople}function selectFilter(name){deselectFilters(),vm.filters[name]=!0}function deselectFilters(){_.each(vm.filters,function(value,key){vm.filters[key]=!1})}function updateFilters(){vm.filters.all=isAllSelected(),vm.filters.projectMembers=isProjectMembersSelected(),vm.filters.none=isNoneSelected()}var vm=this;vm.people=[],vm.projectMembersEmails=[],vm.customEmails=[],vm.scrollToBottom=!1,vm.filters={projectMembers:!1,all:!1,none:!1},vm.isEmailOnList=isEmailOnList,vm.isAllSelected=isAllSelected,vm.isProjectMembersSelected=isProjectMembersSelected,vm.isNoneSelected=isNoneSelected,vm.selectFilter=selectFilter,vm.deselectFilters=deselectFilters,vm.getAllEmails=getAllEmails,vm.getProjectMembersEmails=getProjectMembersEmails,vm.getNewPerson=getNewPerson,vm.getCustomPeople=getCustomPeople,vm.updateFilters=updateFilters,activate()}angular.module("core").directive("pvNotify",pvNotify),pvNotify.$inject=["$document"],pvNotifyCtrl.$inject=["$scope"]}(),function(){"use strict";function PreviewPinCtrl($rootScope,$scope,$document,$timeout,CommentsService,CommentsSettings,UsersService,PagesService,DocumentsService,ProjectsService,CommentsState,ApprovalsService){function activate(){commentTypes=CommentsSettings.commentTypes,$scope.selected=$scope.selectedDelayed=$scope.comment&&CommentsService.selectedCommentId===$scope.comment._id}function isOpen(){return $scope.selected}function isNew(){return angular.isUndefined($scope.comment)}function isTeam(){return!!ApprovalsService.getIsActive()||($scope.isNew()?$scope.commentType?$scope.commentType===commentTypes.TEAM:CommentsSettings.getLastUsedCommentType()?CommentsSettings.getLastUsedCommentType()===commentTypes.TEAM:CommentsSettings.commentTypesActive():$scope.comment.type===commentTypes.TEAM)}function isAnonymousMode(){return UsersService.isAnonymous()}function open(){$scope.selected=!0,$scope.applyVisibility()}function toggle(){$scope.isNew()||$scope.isDragging||($scope.selected=!$scope.selected,$scope.applyVisibility())}function hide(){if($scope.selected)return $scope.selected=!1,$scope.applyVisibility(),!0}function initDrag(){maxWidth=getContentWidth()-PreviewEnums.PIN_RADIUS,maxHeight=getContentHeight()-PreviewEnums.PIN_RADIUS,$scope.isDragging=!0,updateClasses(),$document.on("mouseup",onMouseUp),$rootScope.$emit(PreviewEnums.DRAGGING_COMMENT,!0)}function startDrag(event){CommentsService.canEdit($scope.comment)&&($scope.dragClickPos={x:event.pageX,y:event.pageY},$scope.dragStartPos={x:$scope.comment.position.x,y:$scope.comment.position.y},$scope.dragClickPos&&$scope.dragStartPos&&$document.on("mousemove",onMouseMove))}function endDrag(){$document.unbind("mousemove",onMouseMove)}function onDblclick(event){event.preventDefault()}function onMouseMove(event){var x=$scope.dragStartPos.x+event.pageX-$scope.dragClickPos.x,y=$scope.dragStartPos.y+event.pageY-$scope.dragClickPos.y;$scope.isDragging||initDrag(),x<-PreviewEnums.PIN_RADIUS&&(x=-PreviewEnums.PIN_RADIUS),y<-PreviewEnums.PIN_RADIUS&&(y=-PreviewEnums.PIN_RADIUS),x>maxWidth&&(x=maxWidth),y>maxHeight&&(y=maxHeight),$scope.$apply(function(){$scope.comment.position.x=x,$scope.comment.position.y=y})}function onMouseUp(){$scope.dragClickPos=null,$document.unbind("mousemove",onMouseMove),$document.unbind("mouseup",onMouseUp),
$timeout(function(){$scope.isDragging=!1,updateClasses()},0),computePosition(),CommentsService.updateComment($scope.comment._id,{position:$scope.comment.position}).then(function(){$scope.dragStartPos=null},function(){$scope.comment.position.x=$scope.dragStartPos.x,$scope.comment.position.y=$scope.dragStartPos.y,$scope.dragStartPos=null}),$rootScope.$emit(PreviewEnums.DRAGGING_COMMENT,!1)}function getCommentPointStyle(){return{left:$scope.x+"px",top:$scope.y+"px"}}function getContentId(){return ProjectsService.isDocument()?DocumentsService.currentDocumentId:PagesService.currentPageId}function getPageCanvasBundingRect(){if(!pageCanvasBoundingRect){var pageCanvas=$document[0].querySelector(".ng-canvas");pageCanvas&&(pageCanvasBoundingRect=pageCanvas.getBoundingClientRect())}return pageCanvasBoundingRect}function getContentWidth(){if(ProjectsService.isDocument())return parseInt(DocumentsService.currentDocumentProperties.size.width);var rect=getPageCanvasBundingRect(),contentWidth=PagesService.getContentWidth(),pageWidth=rect?Math.round(rect.width):0;return Math.max(contentWidth,pageWidth)}function getContentHeight(){if(ProjectsService.isDocument())return parseInt(DocumentsService.currentDocumentProperties.size.height);var rect=getPageCanvasBundingRect(),pageHeight=rect?Math.round(rect.height):0;return Math.max(PagesService.currentPageProperties.size.height,pageHeight)}function applyVisibility(){updateClasses(),setSelectedDelayed($scope.selected),$rootScope.$emit(PreviewEnums.SELECT_COMMENT,$scope.selected?$scope.comment._id:null,"canvas")}function setSelectedDelayed(value){$timeout(function(){$scope.selectedDelayed=value,updateClasses()},0)}function updateIndex(){$scope.index=CommentsService.getIndex(getContentId(),$scope.comment._id)}function computePosition(){$scope.selected&&$timeout(function(){updateClasses()},0)}function updateClasses(){setClass("selected",$scope.selectedDelayed),setClass("adding-comment",$scope.isNew()),setClass("resolved",!$scope.isNew()&&$scope.comment.resolved.is),setClass("dragging",$scope.isDragging),setClass("hide",$scope.deleting),setClass("comment-team",$scope.isTeam()),setClass("comment-public",!$scope.isTeam())}function setClass(className,value){var index=$scope.classes.indexOf(className);value&&index===-1?$scope.classes.push(className):value||index===-1||$scope.classes.splice(index,1)}var maxWidth=0,maxHeight=0,commentTypes=[];$scope.selected=!1,$scope.isDragging=!1,$scope.commentType=null,$scope.dragStartPos=null,$scope.dragClickPos=null,$scope.isTop=!0,$scope.isLeft=!0,$scope.deleting=!1,$scope.classes=[],$scope.toggle=toggle,$scope.hide=hide,$scope.open=open,$scope.isOpen=isOpen,$scope.applyVisibility=applyVisibility,$scope.startDrag=startDrag,$scope.endDrag=endDrag,$scope.getCommentPointStyle=getCommentPointStyle,$scope.isNew=isNew,$scope.isTeam=isTeam,$scope.onDblclick=onDblclick,$scope.isAnonymousMode=isAnonymousMode,activate();var pageCanvasBoundingRect;if($scope.isNew()){$scope.selected=!1;var onAddingComment=$rootScope.$on(PreviewEnums.ADDING_COMMENT,function(event,value){$scope.selected=value,updateClasses(),setSelectedDelayed($scope.selected),value&&(computePosition(),$scope.index=CommentsService.getIndex(getContentId()))}),onNewCommentTypeUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,function(event,id,type){$scope.commentType=type,updateClasses()});$scope.$on("$destroy",function(){onAddingComment(),onNewCommentTypeUpdate()})}else{var onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(event,id){$scope.selected&&$scope.comment._id!==id&&($scope.selected=!1,setSelectedDelayed($scope.selected)),$scope.selected||$scope.comment._id!==id||($scope.selected=!0,setSelectedDelayed($scope.selected))}),onSelected=$scope.$watch("selected",function(newValue,oldValue){!oldValue&&newValue&&computePosition()}),onDeletingComment=$rootScope.$on(PreviewEnums.DELETING_COMMENT,function(event,id,value){$scope.comment._id===id&&($scope.selected=$scope.selectedDelayed=!1,$scope.deleting=value,updateClasses())}),onResolveComment=$rootScope.$on(PreviewEnums.RESOLVE_COMMENT,function(event,id){$scope.comment._id===id&&updateClasses()}),onCommentTypeUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,function(event,id){$scope.comment._id===id&&updateClasses()}),onDeleteComment=$rootScope.$on(PreviewEnums.DELETE_COMMENT,updateIndex),onSortComments=$rootScope.$on(PreviewEnums.SORT_COMMENTS,updateIndex);$scope.$on("$destroy",function(){onSelectComment(),onSelected(),onDeletingComment(),onResolveComment(),onCommentTypeUpdate(),onDeleteComment(),onSortComments()}),updateIndex(),computePosition(),updateClasses()}}angular.module("core").controller("PreviewPinCtrl",PreviewPinCtrl),PreviewPinCtrl.$inject=["$rootScope","$scope","$document","$timeout","CommentsService","CommentsSettings","UsersService","PagesService","DocumentsService","ProjectsService","CommentsState","ApprovalsService"]}(),function(){"use strict";function previewPin(){function link(scope,element,attrs){function toggleElement(){var parent=element[0].parentNode;if(parent)return parent.querySelector(".comments-group")}scope.toggleElement=toggleElement}return{restrict:"E",replace:!0,scope:{comment:"=",x:"@",y:"@"},controller:"PreviewPinCtrl",templateUrl:"/scripts/modules/core/directives/preview-pin/preview-pin.directive.html",link:link}}angular.module("core").directive("previewPin",previewPin)}(),function(){"use strict";function pvProgressBar(){return{restrict:"E",scope:{value:"="},templateUrl:"/scripts/modules/core/directives/progressBar/pvProgressBar.html",transclude:!0}}angular.module("core").directive("pvProgressBar",pvProgressBar)}(),function(){"use strict";function ScreencastifyRecorderApi(){function create(id,api){if(recorderApi[id])throw new Error("Api for recorder id:"+id+" already created.");recorderApi[id]=api}function remove(id){recorderApi[id]&&delete recorderApi[id]}function startRecording(id){recorderApi[id]&&recorderApi[id].startRecording()}function stopRecording(id){recorderApi[id]&&recorderApi[id].stopRecording()}var recorderApi={};return{create:create,remove:remove,startRecording:startRecording,stopRecording:stopRecording}}angular.module("core").factory("ScreencastifyRecorderApi",ScreencastifyRecorderApi)}(),function(){"use strict";function pvScreencastifyRecorder(){return{restrict:"E",scope:{id:"@",onStartRecording:"&",onStopRecording:"&",onVideoReady:"&"},templateUrl:"/scripts/modules/core/directives/screencastify/pvScreencastifyRecorder.html",controller:pvScreencastifyRecorderCtrl,controllerAs:"vm",bindToController:!0}}function pvScreencastifyRecorderCtrl(_,$scope,ScreencastifyService,ScreencastifyRecorderApi){function activate(){ScreencastifyService.onSharedFiles=onSharedFiles,vm.recorder=new ScreencastifyService.Recorder,vm.recorder.onStateChanged=onStateChange,vm.recorder.onTimeChanged=onTimeChanged,vm.id&&ScreencastifyRecorderApi.create(vm.id,{startRecording:startRecording,stopRecording:stopRecording}),$scope.$on("$destroy",onDestroy)}function startRecording(){var config={recordConfig:{captureSource:"screen",audio:{mic:!0,system:!1}},shareUrl:location.href};ScreencastifyService.isAppConnected().then(function(isConnected){isConnected?vm.recorder.start(config).then(function(){$scope.$apply(function(){vm.isRecording=!0,_.isFunction(vm.onStartRecording)&&vm.onStartRecording()})}):ScreencastifyService.connectApp()})}function stopRecording(){vm.recorder.stop().then(function(){$scope.$apply(function(){vm.isRecording=!1,_.isFunction(vm.onStopRecording)&&vm.onStopRecording()})})}function onStateChange(state){state===RECORDER_STATES.INACTIVE&&$scope.$apply(function(){vm.isRecording=!1,_.isFunction(vm.onStopRecording)&&vm.onStopRecording()})}function onTimeChanged(time){$scope.$apply(function(){vm.duration=time})}function onSharedFiles(fileIds){return ScreencastifyService.getFile(fileIds[0]).then(function(videoData){_.isFunction(vm.onVideoReady)&&vm.onVideoReady({$videoData:videoData})}),!0}function onDestroy(){vm.recorder.state!==RECORDER_STATES.INACTIVE&&stopRecording(),vm.id&&ScreencastifyRecorderApi.remove(vm.id)}var RECORDER_STATES={INACTIVE:"inactive"},vm=this;vm.recorder=null,vm.isRecording=!1,vm.duration=0,vm.startRecording=startRecording,vm.stopRecording=stopRecording,activate()}angular.module("core").directive("pvScreencastifyRecorder",pvScreencastifyRecorder),pvScreencastifyRecorderCtrl.$inject=["_","$scope","ScreencastifyService","ScreencastifyRecorderApi"]}(),function(){"use strict";function pvWhenHeightKnown(_,$$rAF,$parse,$window){function link(scope,element,attrs){function update(){scope.$apply(function(){whenHeightKnownHandler(scope,{$height:element[0].clientHeight})})}var RESIZE_DEBOUNCE=50,whenHeightKnownHandler=$parse(attrs.pvWhenHeightKnown),debouncedUpdate=_.debounce(update,RESIZE_DEBOUNCE);$$rAF(function(){var windowEl=angular.element($window);update(),windowEl.bind("resize",debouncedUpdate),scope.$on("$destroy",function(){windowEl.unbind("resize",debouncedUpdate)})})}return{restrict:"A",link:link}}angular.module("core").directive("pvWhenHeightKnown",pvWhenHeightKnown),pvWhenHeightKnown.$inject=["_","$$rAF","$parse","$window"]}(),function(){"use strict";function pvWhenScrollEnds(){function link(scope,element,attrs){function handleScroll(){latestKnownScrollTop=element[0].scrollTop,requestTick()}function requestTick(){ticking||requestAnimationFrame(update),ticking=!0}function update(){var hiddenContentHeight=element[0].scrollHeight-element[0].clientHeight;hiddenContentHeight-latestKnownScrollTop<=THRESHOLD&&scope.$apply(attrs.pvWhenScrollEnds),ticking=!1}var THRESHOLD=100,latestKnownScrollTop=0,ticking=!1;element.on("scroll wheel touchmove touchend",handleScroll)}return{restrict:"A",link:link}}angular.module("core").directive("pvWhenScrollEnds",pvWhenScrollEnds)}(),function(){"use strict";function pvWhenScrollTop($parse){function link(scope,element,attrs){function handleScroll(){latestKnownScrollTop=element[0].scrollTop,requestTick()}function requestTick(){ticking||requestAnimationFrame(update),ticking=!0}function update(){var hiddenContentHeight=element[0].scrollHeight-element[0].clientHeight;prevScrollTop>latestKnownScrollTop&&hiddenContentHeight-latestKnownScrollTop>THRESHOLD&&scope.$apply(function(){whenScrollTopHandler(scope,{$scrollTop:latestKnownScrollTop})}),prevScrollTop=latestKnownScrollTop,ticking=!1}var THRESHOLD=100,whenScrollTopHandler=$parse(attrs.pvWhenScrollTop),prevScrollTop=0,latestKnownScrollTop=0,ticking=!1;element.on("scroll wheel touchmove touchend",handleScroll)}return{restrict:"A",link:link}}angular.module("core").directive("pvWhenScrollTop",pvWhenScrollTop),pvWhenScrollTop.$inject=["$parse"]}(),function(){"use strict";function pvSearch(){return{restrict:"E",scope:{options:"=",config:"=",onSearch:"&?",onReset:"&?"},templateUrl:"/scripts/modules/core/directives/search/pvSearch.html",controller:pvSearchCtrl,controllerAs:"vm",replace:!0}}function pvSearchCtrl($scope){function activate(){$scope.$watch("options",function(newOptions){vm.options=newOptions,vm.searchValue&&search()}),$scope.$watch("config",function(newConfig){vm.config=_.defaults(newConfig||{},DEFAULT_CONFIG),vm.searchValue&&search()})}function search(){vm.filteredOptions=vm.searchValue?filterOptions(vm.searchValue):vm.options,_.isFunction($scope.onSearch)&&$scope.onSearch({filteredOptions:vm.filteredOptions})}function filterOptions(value){return _.filter(vm.options,function(option){return option[vm.config.searchKey].toLowerCase().indexOf(value.trim().toLowerCase())>-1})}function resetSearch(){_.isEmpty(vm.searchValue)||(vm.searchValue="",vm.filteredOptions=[],_.isFunction($scope.onReset)&&$scope.onReset())}var DEFAULT_CONFIG={label:"",placeholder:"",searchKey:"text"},vm=this;vm.options=[],vm.filteredOptions=[],vm.searchValue="",vm.search=search,vm.filterOptions=filterOptions,vm.resetSearch=resetSearch,activate()}angular.module("core").directive("pvSearch",pvSearch),pvSearchCtrl.$inject=["$scope"]}(),function(){"use strict";function pvCloud($parse,$document){function link(scope,el,attrs){function activate(){attrs.pvCloudOpen&&initModel(),triggerEl.addEventListener("click",toggle),scope.$on("$destroy",function(){closeCloud()})}function initModel(){model=$parse(attrs.pvCloudOpen),scope.$watch(model,function(value){value?openCloud():closeCloud()})}function applyModelValue(value){model(scope)!==value&&scope.$apply(function(){model.assign(scope,value)})}function addDocumentEventListeners(){$document[0].addEventListener("click",onClick,!0),$document[0].addEventListener("keydown",onKeyDown,!0)}function removeDocumentEventListeners(){$document[0].removeEventListener("click",onClick,!0),$document[0].removeEventListener("keydown",onKeyDown,!0)}function isCloudVisible(){return cloudEl.classList.contains(VISIBLE_CLASS)}function toggle(){isCloudVisible()?closeCloud():openCloud()}function openCloud(){_.isEmpty(model)||applyModelValue(!0),cloudEl.classList.add(VISIBLE_CLASS),addDocumentEventListeners()}function closeCloud(){_.isEmpty(model)||applyModelValue(!1),cloudEl.classList.remove(VISIBLE_CLASS),removeDocumentEventListeners()}function onClick(event){el[0].contains(event.target)||closeCloud()}function onKeyDown(event){event.keyCode===KEY_CODES.ESC&&(event.stopPropagation(),closeCloud())}var model,KEY_CODES=keysEnums.KEY_CODES,triggerEl=el[0].querySelector("[pv-cloud-trigger]"),cloudEl=el[0].querySelector("[pv-cloud-element]");activate()}var VISIBLE_CLASS="visible";return{restrict:"A",link:link}}angular.module("core").directive("pvCloud",pvCloud),pvCloud.$inject=["$parse","$document"]}(),function(){"use strict";function pvMultiSelectList(){function link(scope,el,attrs,controllers){function activate(){ngModelCtrl&&(ngModelCtrl.$render=renderer)}function renderer(){vm.selected=ngModelCtrl.$viewValue||[],vm.updateSelection()}function select(option){if(option.checked)vm.selected.push(scope.key?option[scope.key]:option.email);else{var index=vm.selected.indexOf(scope.key?option[scope.key]:option.email);vm.selected.splice(index,1)}ngModelCtrl&&ngModelCtrl.$setViewValue(_.clone(vm.selected))}var vm=scope.vm,ngModelCtrl=controllers[0];vm.selected=[],vm.select=select,activate()}return{restrict:"E",require:["?ngModel","?ngChange"],scope:{options:"=",scrollToBottom:"=?",key:"@?"},templateUrl:"/scripts/modules/core/directives/select/pvMultiSelectList.html",link:link,controller:pvMultiSelectListCtrl,controllerAs:"vm",transclude:!0}}function pvMultiSelectListCtrl($scope){function activate(){$scope.$watch("options",function(newOptions){vm.options=newOptions,vm.filteredOptions=filterOptions(vm.searchValue),updateSelection()})}function search(){vm.filteredOptions=vm.searchValue?filterOptions(vm.searchValue):vm.options}function resetSearch(){vm.searchValue="",vm.filteredOptions=vm.options}function filterOptions(value){return _.filter(vm.options,function(option){return option.name.toLowerCase().indexOf(value.trim().toLowerCase())>-1})}function updateSelection(){_.each(vm.options,function(option){option.checked=vm.selected.indexOf($scope.key?option[$scope.key]:option.email)>-1})}var vm=this;vm.options=[],vm.filteredOptions=[],vm.searchValue="",vm.search=search,vm.resetSearch=resetSearch,vm.updateSelection=updateSelection,activate()}angular.module("core").directive("pvMultiSelectList",pvMultiSelectList),pvMultiSelectListCtrl.$inject=["$scope"]}(),function(){"use strict";function pvSelect($document){function link(scope,el,attrs,controllers){function activate(){ngModelCtrl&&(ngModelCtrl.$render=renderer,ngModelCtrl.$formatters.push(formatter),ngModelCtrl.$parsers.push(parser),scope.$watch("vm.selectedOption",updateViewValue)),scope.$on("$destroy",handleDestroy)}function renderer(){vm.selectedOption=ngModelCtrl.$viewValue}function formatter(value){if(value)return _.find(scope.options,function(option){return option[vm.config.valueKey]===value})||{}}function parser(newValue){return _.isEmpty(newValue)?null:newValue[vm.config.valueKey]}function updateViewValue(newOption,oldOption){newOption!==oldOption&&ngModelCtrl.$setViewValue(newOption)}function toggleDropdown(){return vm.isDropdownOpen?void closeDropdown():void openDropdown()}function openDropdown(){vm.config.disabled||vm.isDropdownOpen||(vm.isDropdownOpen=!0,bindDropdownEvents(),_.isFunction(scope.onOpen)&&scope.onOpen())}function closeDropdown(){vm.isDropdownOpen&&(vm.isDropdownOpen=!1,unbindDropdownEvents(),_.isFunction(scope.onClose)&&scope.onClose())}function handleDestroy(){unbindDropdownEvents()}function bindDropdownEvents(){$document[0].addEventListener("click",handleClick,!0),$document[0].addEventListener("keydown",handleKeydown,!0)}function unbindDropdownEvents(){$document[0].removeEventListener("click",handleClick,!0),$document[0].removeEventListener("keydown",handleKeydown,!0)}function handleClick(event){el[0].contains(event.target)||scope.$apply(function(){closeDropdown()})}function handleKeydown(event){var keyCode=event.keyCode;keyCode!==KEY_CODES.ENTER&&keyCode!==KEY_CODES.ESC||(event.stopPropagation(),scope.$apply(function(){closeDropdown()}))}var KEY_CODES=keysEnums.KEY_CODES,vm=scope.vm,ngModelCtrl=controllers[0];vm.selectedOption={},vm.isDropdownOpen=!1,vm.toggleDropdown=toggleDropdown,vm.openDropdown=openDropdown,vm.closeDropdown=closeDropdown,activate()}return{restrict:"E",require:["?ngModel","?ngChange"],scope:{options:"=",config:"=",linkClass:"@",onOpen:"&?",onClose:"&?"},templateUrl:"/scripts/modules/core/directives/select/pvSelect.html",link:link,controller:pvSelectCtrl,controllerAs:"vm",transclude:!0}}function pvSelectCtrl($scope){function activate(){vm.config=_.defaults($scope.config||{},DEFAULT_CONFIG),$scope.$watch("options",function(newOptions){vm.options=newOptions,vm.filteredOptions=newOptions})}function isSelectedOption(option){return vm.selectedOption===option}function onSearch(filteredOptions){vm.filteredOptions=filteredOptions}function onReset(){vm.filteredOptions=vm.options}function selectOption(option){isSelectedOption(option)||(vm.selectedOption=option,vm.config.closeOnSelect&&vm.closeDropdown())}function deselectOption(){vm.config.deselect&&(vm.selectedOption={})}var DEFAULT_CONFIG={valueKey:"value",labelKey:"text",placeholder:"",inputTpl:"pvDefaultInput.html",optionTpl:"pvDefaultOption.html",deselect:!1,deselectLabel:"",closeOnSelect:!0,withSearch:!1,search:{label:"",placeholder:"",searchKey:"text"}},vm=this;vm.options=[],vm.filteredOptions=[],vm.config={},vm.searchConfig={},vm.selectOption=selectOption,vm.deselectOption=deselectOption,vm.onSearch=onSearch,vm.onReset=onReset,activate()}angular.module("core").directive("pvSelect",pvSelect),pvSelect.$inject=["$document"],pvSelectCtrl.$inject=["$scope"]}(),function(){"use strict";function pvSingleSelectList(){function link(scope,el,attrs,controllers){function activate(){ngModelCtrl&&(ngModelCtrl.$render=renderer,ngModelCtrl.$formatters.push(formatter),ngModelCtrl.$parsers.push(parser))}function renderer(){vm.selectedOption=ngModelCtrl.$viewValue}function formatter(value){if(value)return _.find(scope.options,function(option){return formatOption(option)===value})||{}}function parser(newValue){return _.isEmpty(newValue)?null:formatOption(newValue)}function formatOption(value){return vm.config.valueKey?value[vm.config.valueKey]:value}function selectOption(option){isSelectedOption(option)||(vm.selectedOption=option,ngModelCtrl.$setViewValue(option))}function isSelectedOption(option){return vm.selectedOption===option}var vm=scope.vm,ngModelCtrl=controllers[0];vm.selectOption=selectOption,activate()}return{restrict:"E",require:["?ngModel","?ngChange"],scope:{options:"=",config:"="},templateUrl:"/scripts/modules/core/directives/select/pvSingleSelectList.html",link:link,controller:pvSingleSelectListCtrl,controllerAs:"vm"}}function pvSingleSelectListCtrl($scope){function activate(){vm.config=_.defaults($scope.config||{},DEFAULT_CONFIG),$scope.$watch("options",function(newOptions){vm.options=newOptions,vm.filteredOptions=newOptions})}function onSearch(filteredOptions){vm.filteredOptions=filteredOptions}function onResetSearch(){vm.filteredOptions=vm.options}var DEFAULT_CONFIG={valueKey:"",labelKey:"text",optionTpl:"pvDefaultOption.html",withSearch:!1,search:{label:"",placeholder:"",searchKey:"text"}},vm=this;vm.options=[],vm.filteredOptions=[],vm.selectedOption={},vm.config={},vm.onSearch=onSearch,vm.onResetSearch=onResetSearch,activate()}angular.module("core").directive("pvSingleSelectList",pvSingleSelectList),pvSingleSelectListCtrl.$inject=["$scope"]}(),function(){"use strict";function pvShortcut(){return{restrict:"E",scope:{keys:"="},templateUrl:"/scripts/modules/core/directives/shortcut/pvShortcut.html",controller:pvShortcutCtrl,controllerAs:"vm"}}function pvShortcutCtrl($scope){function activate(){$scope.$watch("keys",function(newValue){vm.keys=_.map(newValue,function(value){return formatKey(value)})})}function formatKey(value){var lowerCaseValue=value.toLowerCase();return"undefined"==typeof ICON_KEYS[lowerCaseValue]?{alt:value}:_.extend({className:"only-icon-font icon-font-"+ICON_KEYS[lowerCaseValue].icon},ICON_KEYS[lowerCaseValue])}var ICON_KEYS={cmd:{icon:"cmd-key",alt:"cmd"},shift:{icon:"shift-key",alt:"shift"}},vm=this;vm.keys=[],activate()}angular.module("core").directive("pvShortcut",pvShortcut),pvShortcutCtrl.$inject=["$scope"]}(),function(){"use strict";function updateInfo(){return{restrict:"E",scope:{modalName:"@"},controller:updateInfoCtrl,controllerAs:"vm",replace:!0}}function updateInfoCtrl($scope,$modal,localStorageService){var vm=this;vm.ls=localStorageService,vm.modalName=$scope.modalName,vm.lsKey=PreviewEnums.UPDATE_INFO.LS.SEEN+"_"+vm.modalName,vm.planUniqueName=ApplicationConfiguration.userData.plan_unique_name,vm.isTrial=ApplicationConfiguration.userData.is_trial,vm.isLoggedIn=!ApplicationConfiguration.userData.is_anonymous,shouldShowModal(vm)&&($modal.open({templateUrl:"/scripts/modules/core/directives/updateInfo/updateInfo.html",controller:modalCtrl,scope:$scope}),localStorageService.set(vm.lsKey,!0))}function modalCtrl($scope,$modalInstance){var templateFile=UpdateInfoModals[$scope.$parent.modalName].content;$scope.content=PreviewEnums.UPDATE_INFO.MODAL_CONTENT_DIR+"/"+templateFile,$scope.closeModal=function($event){$modalInstance.close()}}function shouldShowModal(vm){return!modalSeen(vm)&&validLoggedIn(vm)&&validPlan(vm)&&validType(vm)&&validDate(vm)}function validLoggedIn(vm){var loggedInValid=UpdateInfoModals[vm.modalName].loggedInOnly&&vm.isLoggedIn||!UpdateInfoModals[vm.modalName].loggedInOnly,loginNotRequiredValid=!UpdateInfoModals[vm.modalName].loggedInOnly&&"all"!==UpdateInfoModals[vm.modalName].plan&&"all"!==UpdateInfoModals[vm.modalName].type;return loggedInValid||loginNotRequiredValid}function modalSeen(vm){return vm.ls.get(vm.lsKey)||!1}function validDate(vm){var start=new Date(UpdateInfoModals[vm.modalName].start).getTime(),end=new Date(UpdateInfoModals[vm.modalName].end).getTime(),now=Date.now();return start<now&&now<end}function validType(vm){var validTrial=vm.isTrial&&["all","trial"].indexOf(UpdateInfoModals[vm.modalName].type)>-1,validOther=!vm.isTrial&&["all","other"].indexOf(UpdateInfoModals[vm.modalName].type)>-1;return validTrial||validOther}function validPlan(vm){var enterprise=isEnterprise(vm),validEnterprise=enterprise&&["all","enterprise"].indexOf(UpdateInfoModals[vm.modalName].plan)>-1,validOther=!enterprise&&["all","other"].indexOf(UpdateInfoModals[vm.modalName].plan)>-1;return validEnterprise||validOther}function isEnterprise(vm){return vm.planUniqueName.toLowerCase().indexOf("enterprise")>-1}angular.module("core").directive("updateInfo",updateInfo),updateInfoCtrl.$inject=["$scope","$modal","localStorageService"],modalCtrl.$inject=["$scope","$modalInstance"]}(),function(){"use strict";function videoStream(){return{restrict:"E",scope:{isUsabilityTestingSession:"=",isHost:"="},controller:videoStreamCtrl,controllerAs:"vm",bindToController:!0,templateUrl:"/scripts/modules/core/directives/videoStream/videoStream.html"}}function videoStreamCtrl($rootScope,$scope,UsabilityTestService){var vm=this;vm.isMessageVisible=!0,vm.message="Waiting for participant",UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){$scope.$apply(function(){vm.isMessageVisible=!0,vm.message="Waiting for participant"})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,function(){$scope.$apply(function(){vm.isMessageVisible=!0,vm.message="Waiting for participant to allow Camera access"})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.VIDEO_PARTICIPANT_JOINED,function(){$scope.$apply(function(){vm.isMessageVisible=!1,vm.message=""})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.VIDEO_PARTICIPANT_LEFT,function(){$scope.$apply(function(){vm.isMessageVisible=!0,vm.message="Waiting for participant"})})}angular.module("core").directive("videoStream",videoStream),videoStreamCtrl.$inject=["$rootScope","$scope","UsabilityTestService"]}(),function(){"use strict";function zoom(){return{restrict:"E",replace:!0,scope:{},templateUrl:"/scripts/modules/core/directives/zoom/zoom.view.html",controller:zoomCtrl,controllerAs:"vm",bindToController:!0}}function zoomCtrl(_,$scope,$rootScope,$timeout,$interval,Engine,PreviewNavigation,ProjectsService){function getNextValue(values,value){for(var i=0;i<values.length;i++)if(value<values[i])return values[i];return values[values.length-1]}function getPrevValue(values,value){for(var i=values.length-1;i>0;i--)if(value>values[i])return values[i];return values[0]}function setZoom(){var scale=vm.zoom/100;Engine.setScale(scale),$rootScope.$emit(PreviewEnums.ON_ZOOM_CHANGE)}function updateValue(value){_.isEqual(value,vm.zoom)||(vm.zoom=Math.min(Math.max(value,_.min(ZOOM_VALUES)),_.max(ZOOM_VALUES)))}function handleZoomFocus(){vm.isZoomActive||(setIsActive(!0),document.body.addEventListener("mousedown",handleZoomDefocus))}function handleZoomDefocus(event){event&&document.querySelector(".zoom").contains(event.target)||(setIsActive(!1),document.body.removeEventListener("mousedown",handleZoomDefocus))}function setIsActive(value){vm.isZoomActive=value}function zoomReset(){updateValue(ZOOM_DEFAULT_VALUE)}function zoomIn(params){updateValue(params?vm.zoom+params.delta:getNextValue(ZOOM_VALUES,vm.zoom))}function zoomOut(params){updateValue(params?vm.zoom+params.delta:getPrevValue(ZOOM_VALUES,vm.zoom))}function handleMouseDownZoomIn(){zoomIn()}function handleMouseDownZoomOut(){zoomOut()}function handleClick(event){event.preventDefault()}function shouldZoomWork(){return PreviewNavigation.isModeActive(PREVIEW_MODES.SIMULATE)||PreviewNavigation.isModeActive(PREVIEW_MODES.SPEC)||PreviewNavigation.isModeActive(PREVIEW_MODES.DOCUMENTATION)&&!ProjectsService.isDocument()}function handleModeChange(event,mode){mode&&mode===PreviewNavigation.PREVIEW_MODES.COMMENT&&vm.zoom!==ZOOM_DEFAULT_VALUE&&(zoomReset(),setZoom())}var removeZoomInListener,removeZoomOutListener,removeZoomResetListener,removeModeChangeEventListener,vm=this,ZOOM_DEFAULT_VALUE=100,ZOOM_VALUES=[10,25,50,75,100,200,300,400,500,1e3],MIN_VALUE=10,MAX_VALUE=1e3,PREVIEW_MODES=PreviewNavigation.PREVIEW_MODES;vm.isZoomActive=!1,vm.zoom=ZOOM_DEFAULT_VALUE,vm.ZOOM_VALUES=ZOOM_VALUES,vm.MIN_VALUE=MIN_VALUE,vm.MAX_VALUE=MAX_VALUE,vm.handleClick=handleClick,vm.handleMouseDownZoomIn=handleMouseDownZoomIn,vm.handleMouseDownZoomOut=handleMouseDownZoomOut,vm.handleZoomFocus=handleZoomFocus,vm.handleZoomDefocus=handleZoomDefocus,vm.setZoom=setZoom,removeZoomInListener=$rootScope.$on(PreviewEnums.ON_ZOOM_IN,function(e,params){shouldZoomWork()&&$timeout(function(){zoomIn(params)},0)}),removeZoomOutListener=$rootScope.$on(PreviewEnums.ON_ZOOM_OUT,function(e,params){shouldZoomWork()&&$timeout(function(){zoomOut(params)},0)}),removeZoomResetListener=$rootScope.$on(PreviewEnums.ON_ZOOM_RESET,function(){shouldZoomWork()&&$timeout(function(){zoomReset()},0)}),removeModeChangeEventListener=$rootScope.$on(PreviewEnums.ON_PREVIEW_MODE_CHANGED,handleModeChange),$scope.$on("$destroy",function(){removeZoomInListener(),removeZoomOutListener(),removeZoomResetListener(),removeModeChangeEventListener()}),$scope.$watch("vm.zoom",function(value){var value=value?parseInt(value):0;!value||MIN_VALUE>value||MAX_VALUE<value||(vm.zoom=value,setZoom())})}angular.module("core").directive("zoom",zoom),zoomCtrl.$inject=["_","$scope","$rootScope","$timeout","$interval","Engine","PreviewNavigation","ProjectsService"]}(),function(){"use strict";function AbstractPageAnimation(Engine,_,$q,PagesService){function Animation(container,duration,delay,easing){this.container=container,this.duration=duration||800,this.delay=delay||0,this.easing=easing||"ease-out",this.nextPage=angular.element(this.container[0].querySelector(".ng-canvas")),this.currentPage=this.nextPage.clone(),this.currentPage.removeClass("ng-canvas").addClass("ng-canvas-old"),this.currentPage.css({transformOrigin:"0 0 0",webkitTransformOrigin:"0 0 0"}),this.initialTransform=this.currentPage.css("transform")||"",this.currentPageFixedPositionNodes=this.currentPage[0].querySelectorAll(".fixed-position"),this.fixedElementData=null}return Animation.prototype.is=function(type){return this.type===type},Animation.prototype.getCurrentPageWidth=function(shouldBeNegative){var width=PagesService.currentPageProperties.size.width;return shouldBeNegative?-width:width},Animation.prototype.getCurrentPageHeight=function(shouldBeNegative){var height=PagesService.currentPageProperties.size.height;return shouldBeNegative?-height:height},Animation.prototype.handleFixedElements=function(nodes){for(var savedData=[],i=0;i<nodes.length;i++){var node=angular.element(nodes[i]);savedData.push({node:node,left:node.css("left"),top:node.css("top")}),node.css({position:"absolute !important",left:"",top:""})}return savedData},Animation.prototype.isZoom=function(){return 1!==this.getZoomValue()},Animation.prototype.canDoAnimation=function(){return!0},Animation.prototype.getZoomValue=function(){var match=this.initialTransform.match(/scale\((.*)\)/);return match&&match[1]?parseFloat(match[1].split(",")):1},Animation.prototype.onAnimationInit=function(){Engine.setInteractionsEnabled(!1),this.handleFixedElements(this.currentPageFixedPositionNodes)},Animation.prototype.prepareNextPage=function(){if(this.nextPageFixedPositionNodes=this.nextPage[0].querySelectorAll(".fixed-position"),this.fixedElementData=this.handleFixedElements(this.nextPageFixedPositionNodes),this.nextPageImages=this.nextPage[0].querySelectorAll("img"),this.nextPageImages.length)return $q.all(_.map(this.nextPageImages,function(nextPageImage){var image=new Image,deferred=$q.defer();return image.onload=deferred.resolve,image.onerror=deferred.resolve,image.src=nextPageImage.src,deferred.promise}));var defer=$q.defer();return defer.resolve(),defer.promise},Animation.prototype.onAnimationEnd=function(){if(Engine.setInteractionsEnabled(!0),Engine.triggerWindowLoad(),this.fixedElementData)for(var i=0;i<this.fixedElementData.length;i++){var elementData=this.fixedElementData[i];elementData.node.css({position:"",left:elementData.left,right:elementData.right})}},Animation}angular.module("core").factory("AbstractPageAnimation",AbstractPageAnimation),AbstractPageAnimation.$inject=["Engine","_","$q","PagesService"]}(),function(){"use strict";function FadeAnimation(AbstractPageAnimation){function Animation(container,duration,delay,easing){AbstractPageAnimation.apply(this,arguments)}return Animation.prototype=Object.create(AbstractPageAnimation.prototype),Animation.prototype.constructor=Animation,Animation.prototype.prepareAnimationContainer=function(){return this.currentPage.css({opacity:"1"}),this.nextPage.css({opacity:"0"}),this.container.prepend(this.currentPage),this.nextPage},Animation.prototype.onAnimationInit=function(){AbstractPageAnimation.prototype.onAnimationInit.call(this);var fadeInKeyFrames={from:{opacity:"0"},to:{opacity:"1"}},fadeOutKeyFrames={from:{opacity:"1"},to:{opacity:"0"}};return{fadeInKeyFrames:fadeInKeyFrames,fadeOutKeyFrames:fadeOutKeyFrames
}},Animation.prototype.startAnimation=function(animationNames){this.nextPage.css({animation:animationNames.fadeInKeyFrames+" "+this.duration+"ms "+this.easing}),this.currentPage.css({animation:animationNames.fadeOutKeyFrames+" "+this.duration+"ms "+this.easing})},Animation.prototype.onAnimationEnd=function(){AbstractPageAnimation.prototype.onAnimationEnd.call(this),this.currentPage.remove(),this.nextPage.css({animation:"",opacity:""})},Animation}angular.module("core").factory("FadeAnimation",FadeAnimation),FadeAnimation.$inject=["AbstractPageAnimation"]}(),function(){"use strict";function FlipXAnimation(AbstractPageAnimation){function Animation(container,duration,delay,easing,type){AbstractPageAnimation.apply(this,arguments),this.type=type||"right",this.angle="right"===type?"180deg":"-180deg"}return Animation.prototype=Object.create(AbstractPageAnimation.prototype),Animation.prototype.constructor=Animation,Animation.prototype.canDoAnimation=function(){return!this.isZoom()},Animation.prototype.prepareAnimationContainer=function(){var width=this.getCurrentPageWidth(),height=this.getCurrentPageHeight();return this.currentPage.css({transformOrigin:"50% 50%",transform:"rotateY(0deg)",backfaceVisibility:"hidden",webkitBackfaceVisibility:"hidden",width:width+"px",height:height+"px"}),this.nextPage.css({transformOrigin:"50% 50%",transform:"rotateY("+this.angle+")",backfaceVisibility:"hidden",webkitBackfaceVisibility:"hidden",width:width+"px",height:height+"px"}),this.animationContainer=angular.element("<div>").css({position:"absolute",width:width+"px",height:height+"px",perspective:"1000px",overflow:"visible"}),this.flipContainer=angular.element("<div>").append(this.currentPage).append(this.nextPage).css({position:"absolute",transform:"rotateY(0deg)",transformStyle:"preserve-3d"}),this.animationContainer.append(this.flipContainer),this.container.append(this.animationContainer),this.flipContainer},Animation.prototype.onAnimationInit=function(){AbstractPageAnimation.prototype.onAnimationInit.call(this);var flipKeyFrames={from:{transform:"rotateY(0deg)"},to:{transform:"rotateY("+this.angle+")"}};return{flipKeyFrames:flipKeyFrames}},Animation.prototype.startAnimation=function(animationNames){this.nextPageInitialSize={width:this.nextPage.css("width"),height:this.nextPage.css("height")},this.flipContainer.css({animation:animationNames.flipKeyFrames+" "+this.duration+"ms "+this.easing})},Animation.prototype.onAnimationEnd=function(){AbstractPageAnimation.prototype.onAnimationEnd.call(this),this.container.prepend(this.nextPage),this.animationContainer.remove(),this.nextPage.css({width:this.nextPageInitialSize.width,height:this.nextPageInitialSize.height,animation:"",transform:this.initialTransform,left:"",transformOrigin:"",backfaceVisibility:"",webkitBackfaceVisibility:""})},Animation}angular.module("core").factory("FlipXAnimation",FlipXAnimation),FlipXAnimation.$inject=["AbstractPageAnimation"]}(),function(){"use strict";function FlowAnimation(AbstractPageAnimation){function Animation(container,duration,delay,easing,type){AbstractPageAnimation.apply(this,arguments),this.type=type||"right"}return Animation.prototype=Object.create(AbstractPageAnimation.prototype),Animation.prototype.constructor=Animation,Animation.prototype.canDoAnimation=function(){return!this.isZoom()},Animation.prototype.prepareAnimationContainer=function(){var width=this.getCurrentPageWidth();return this.currentPage.css({transform:this.initialTransform||"scale(1)",transformOrigin:"50% 50%"}),this.nextPage.css({left:("right"===this.type?-width:width)+"px",transformOrigin:"50% 50%"}),this.flowContainer=angular.element("<div>"),this.flowContainer.append(this.currentPage),this.flowContainer.append(this.nextPage),this.flowContainer.css({width:2*width+"px",position:"absolute",transform:this.initialTransform+" translateX(0)"}),this.container.append(this.flowContainer),this.flowContainer},Animation.prototype.onAnimationInit=function(){AbstractPageAnimation.prototype.onAnimationInit.call(this);var width=this.getCurrentPageWidth(),flowScaleKeyFrames={0:{transform:"scale(1)"},25:{transform:"scale(0.71)"},75:{transform:"scale(0.71)"},100:{transform:"scale(1)"}},flowMoveKeyFrames={0:{transform:"translateX(0)"},25:{transform:"translateX(0)"},75:{transform:"translateX("+("right"===this.type?width:-width)+"px)"},100:{transform:"translateX("+("right"===this.type?width:-width)+"px)"}};return{flowScale:flowScaleKeyFrames,flowMove:flowMoveKeyFrames}},Animation.prototype.startAnimation=function(animationNames){this.flowContainer.css({animation:animationNames.flowMove+" "+this.duration+"ms "+this.easing}),this.currentPage.css({animation:animationNames.flowScale+" "+this.duration+"ms "+this.easing}),this.nextPage.css({animation:animationNames.flowScale+" "+this.duration+"ms "+this.easing})},Animation.prototype.onAnimationEnd=function(){AbstractPageAnimation.prototype.onAnimationEnd.call(this),this.container.prepend(this.nextPage),this.flowContainer.remove(),this.nextPage.css({animation:"",transform:this.initialTransform,left:"",transformOrigin:""})},Animation}angular.module("core").factory("FlowAnimation",FlowAnimation),FlowAnimation.$inject=["AbstractPageAnimation"]}(),function(){"use strict";function PushXAnimation(AbstractPageAnimation){function Animation(container,duration,delay,easing,type){AbstractPageAnimation.apply(this,arguments),this.type=type||"right"}return Animation.prototype=Object.create(AbstractPageAnimation.prototype),Animation.prototype.constructor=Animation,Animation.prototype.prepareAnimationContainer=function(){return this.nextPage.css({transform:this.initialTransform+" translateX("+this.getCurrentPageWidth(this.is("right"))+"px)"}),this.container.prepend(this.currentPage),this.currentPage},Animation.prototype.onAnimationInit=function(){AbstractPageAnimation.prototype.onAnimationInit.call(this);var pushXCurrentPageKeyFrames={from:{transform:this.initialTransform+" translateX(0)"},to:{transform:this.initialTransform+" translateX("+this.getCurrentPageWidth(this.is("left"))+"px)"}},pushXNextPageKeyFrames={from:{transform:this.initialTransform+" translateX("+this.getCurrentPageWidth(this.is("right"))+"px)"},to:{transform:this.initialTransform+" translateX(0)"}};return{pushXCurrentPageKeyFrames:pushXCurrentPageKeyFrames,pushXNextPageKeyFrames:pushXNextPageKeyFrames}},Animation.prototype.startAnimation=function(animationNames){this.currentPage.css({animation:animationNames.pushXCurrentPageKeyFrames+" "+this.duration+"ms "+this.easing}),this.nextPage.css({animation:animationNames.pushXNextPageKeyFrames+" "+this.duration+"ms "+this.easing})},Animation.prototype.onAnimationEnd=function(){AbstractPageAnimation.prototype.onAnimationEnd.call(this),this.currentPage.remove(),this.nextPage.css({animation:"",transform:this.initialTransform})},Animation}angular.module("core").factory("PushXAnimation",PushXAnimation),PushXAnimation.$inject=["AbstractPageAnimation"]}(),function(){"use strict";function PushYAnimation(AbstractPageAnimation){function Animation(container,duration,delay,easing,type){AbstractPageAnimation.apply(this,arguments),this.type=type||"up"}return Animation.prototype=Object.create(AbstractPageAnimation.prototype),Animation.prototype.constructor=Animation,Animation.prototype.prepareAnimationContainer=function(){return this.nextPage.css({transform:this.initialTransform+" translateY("+this.getCurrentPageHeight("down"===this.type)+"px)"}),this.currentPage.css({transform:this.initialTransform+" translateY(0)"}),this.container.prepend(this.currentPage),this.currentPage},Animation.prototype.onAnimationInit=function(){AbstractPageAnimation.prototype.onAnimationInit.call(this);var pushXCurrentPageKeyFrames={from:{transform:this.initialTransform+" translateY(0)"},to:{transform:this.initialTransform+" translateY("+this.getCurrentPageHeight("up"===this.type)+"px)"}},pushXNextPageKeyFrames={from:{transform:this.initialTransform+" translateY("+this.getCurrentPageHeight("down"===this.type)+"px)"},to:{transform:this.initialTransform+" translateY(0)"}};return{pushXCurrentPageKeyFrames:pushXCurrentPageKeyFrames,pushXNextPageKeyFrames:pushXNextPageKeyFrames}},Animation.prototype.startAnimation=function(animationNames){this.currentPage.css({animation:animationNames.pushXCurrentPageKeyFrames+" "+this.duration+"ms "+this.easing}),this.nextPage.css({animation:animationNames.pushXNextPageKeyFrames+" "+this.duration+"ms "+this.easing})},Animation.prototype.onAnimationEnd=function(){AbstractPageAnimation.prototype.onAnimationEnd.call(this),this.currentPage.remove(),this.nextPage.css({animation:"",transform:this.initialTransform})},Animation}angular.module("core").factory("PushYAnimation",PushYAnimation),PushYAnimation.$inject=["AbstractPageAnimation"]}(),function(){"use strict";function SlideNFadeAnimation(AbstractPageAnimation){function Animation(container,duration,delay,easing,type){AbstractPageAnimation.apply(this,arguments),this.type=type||"right"}return Animation.prototype=Object.create(AbstractPageAnimation.prototype),Animation.prototype.constructor=Animation,Animation.prototype.prepareAnimationContainer=function(){return this.currentPage.css({opacity:"1",transform:this.initialTransform+" translateX(0)"}),this.container.append(this.currentPage),this.currentPage},Animation.prototype.onAnimationInit=function(){var width=this.getCurrentPageWidth();AbstractPageAnimation.prototype.onAnimationInit.call(this);var keyframes={from:{opacity:"1",transform:this.initialTransform+" translateX(0)"},to:{opacity:"0",transform:this.initialTransform+" translateX("+("right"===this.type?width:-width)+"px)"}};return{keyframes:keyframes}},Animation.prototype.startAnimation=function(animationNames){this.currentPage.css({animation:animationNames.keyframes+" "+this.duration+"ms "+this.easing})},Animation.prototype.onAnimationEnd=function(){AbstractPageAnimation.prototype.onAnimationEnd.call(this),this.currentPage.remove()},Animation}angular.module("core").factory("SlideNFadeAnimation",SlideNFadeAnimation),SlideNFadeAnimation.$inject=["AbstractPageAnimation"]}(),function(){"use strict";function SlideXAnimation(AbstractPageAnimation){function Animation(container,duration,delay,easing,type){AbstractPageAnimation.apply(this,arguments),this.type=type||"right"}return Animation.prototype=Object.create(AbstractPageAnimation.prototype),Animation.prototype.constructor=Animation,Animation.prototype.prepareAnimationContainer=function(){return this.nextPage.css({transform:this.initialTransform+" translateX("+this.getCurrentPageWidth(this.is("right"))+"px)"}),this.container.prepend(this.currentPage),this.nextPage},Animation.prototype.onAnimationInit=function(){AbstractPageAnimation.prototype.onAnimationInit.call(this);var slideXNextPageKeyFrames={from:{transform:this.initialTransform+" translateX("+this.getCurrentPageWidth(this.is("right"))+"px)"},to:{transform:this.initialTransform+" translateX(0)"}},slideXCurrentPageKeyFrames={from:{transform:this.initialTransform+" translateX(0)"},to:{transform:this.initialTransform+" translateX("+(this.is("right")?"10%":"-10%")+")"}};return{slideXNextPageKeyFrames:slideXNextPageKeyFrames,slideXCurrentPageKeyFrames:slideXCurrentPageKeyFrames}},Animation.prototype.startAnimation=function(animationNames){this.nextPage.css({animation:animationNames.slideXNextPageKeyFrames+" "+this.duration+"ms "+this.easing}),this.currentPage.css({animation:animationNames.slideXCurrentPageKeyFrames+" "+this.duration+"ms "+this.easing})},Animation.prototype.onAnimationEnd=function(){AbstractPageAnimation.prototype.onAnimationEnd.call(this),this.currentPage.remove(),this.nextPage.css({animation:"",transform:this.initialTransform})},Animation}angular.module("core").factory("SlideXAnimation",SlideXAnimation),SlideXAnimation.$inject=["AbstractPageAnimation"]}(),function(){"use strict";function SlideYAnimation(AbstractPageAnimation){function Animation(container,duration,delay,easing,type){AbstractPageAnimation.apply(this,arguments),this.type=type||"up"}return Animation.prototype=Object.create(AbstractPageAnimation.prototype),Animation.prototype.constructor=Animation,Animation.prototype.prepareAnimationContainer=function(){return"up"===this.type?(this.nextPage.css({transform:this.initialTransform+" translateY("+this.getCurrentPageHeight()+"px)"}),this.container.prepend(this.currentPage),this.nextPage):(this.currentPage.css({transform:this.initialTransform+" translateY(0)"}),this.container.append(this.currentPage),this.currentPage)},Animation.prototype.onAnimationInit=function(){AbstractPageAnimation.prototype.onAnimationInit.call(this);var slideYKeyFrames;return slideYKeyFrames="up"===this.type?{from:{transform:this.initialTransform+" translateY("+this.getCurrentPageHeight()+"px)"},to:{transform:this.initialTransform+" translateY(0)"}}:{from:{transform:this.initialTransform+" translateY(0)"},to:{transform:this.initialTransform+" translateY("+this.getCurrentPageHeight()+"px)"}},{slideYKeyFrames:slideYKeyFrames}},Animation.prototype.startAnimation=function(animationNames){"up"===this.type?this.nextPage.css({animation:animationNames.slideYKeyFrames+" "+this.duration+"ms "+this.easing}):this.currentPage.css({animation:animationNames.slideYKeyFrames+" "+this.duration+"ms "+this.easing})},Animation.prototype.onAnimationEnd=function(){AbstractPageAnimation.prototype.onAnimationEnd.call(this),this.currentPage.remove(),this.nextPage.css({animation:"",transform:this.initialTransform})},Animation}angular.module("core").factory("SlideYAnimation",SlideYAnimation),SlideYAnimation.$inject=["AbstractPageAnimation"]}(),function(){"use strict";function annotationsList(){return{restrict:"E",scope:{data:"="},templateUrl:"/scripts/modules/documentation/directives/annotationsList/annotationsList.html",controller:annotationsListCtrl,controllerAs:"vm",bindToController:!0}}function annotationsListCtrl($rootScope,$scope,$element,$window,$timeout,Engine,AnalyticsService){function activate(){page=Engine.getPage(),onChangePageOff=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,onChangePage),page.on($window.uxpinEngine.Events.ANNOTATION_ELEMENT_HIGHLIGHTED,delayedOnHover),page.on($window.uxpinEngine.Events.ANNOTATION_ELEMENT_SELECTED,onSelect),$scope.$on("$destroy",onDestroy)}function onDestroy(){onChangePageOff(),page.off($window.uxpinEngine.Events.ANNOTATION_ELEMENT_HIGHLIGHTED,delayedOnHover),page.off($window.uxpinEngine.Events.ANNOTATION_ELEMENT_SELECTED,onSelect)}function delayedOnHover(data){$timeout(function(){onHover(data)},TIMEOUT_DELAY)}function blockHover(annotation){isSelected(annotation)?vm.blockedHover=annotation.idElement:vm.blockedHover=null}function hasBlockedHover(annotation){return annotation.idElement===vm.blockedHover}function isPinnedToElement(annotation){return annotation.idElement}function isSelected(annotation){return annotation.idElement===vm.selectedAnnotation}function isHovered(annotation){return annotation.idElement===vm.hoveredElement}function onChangePage(){vm.blockedHover=null,vm.hoveredElement=null,vm.selectedAnnotation=null,vm.selectedPreviously=null}function onMouseEnter(event,annotation){event.stopPropagation(),isPinnedToElement(annotation)&&(blockHover(annotation),Engine.setAnnotationHighlight(annotation.idElement,!hasBlockedHover(annotation)))}function onMouseLeave(event,annotation){event.stopPropagation(),isPinnedToElement(annotation)&&Engine.setAnnotationHighlight(annotation.idElement,!1)}function onHover(data){data&&data.id?vm.hoveredElement=data.id:vm.hoveredElement=null}function isElementVisible(el,offsetTop,scrollCanvas){var elRect=el.getBoundingClientRect(),shouldScrollY=elRect.top>=offsetTop&&elRect.bottom<=window.innerHeight;if(scrollCanvas){var canvasRect=document.getElementById("canvas-wrapper").getBoundingClientRect(),shouldScrollX=elRect.left>=canvasRect.left&&elRect.right<=canvasRect.width;return shouldScrollY&&shouldScrollX}return shouldScrollY}function onSelect(data){if(data&&data.id){var id=data.id,el=$element[0].querySelector("#"+PIN_ID_PREFIX+id);vm.selectedAnnotation=id,AnalyticsService.kissEvent("Preview - Documentation - Element with documentation selected"),scrollToElement(el,ANNOTATION_OFFSET_TOP,!1)}else vm.selectedAnnotation=null}function scrollToElement(el,offsetTop,scrollCanvas){if(el&&!isElementVisible(el,offsetTop,scrollCanvas)){if(!scrollCanvas)return el.scrollIntoView();var elRect=el.getBoundingClientRect(),canvas=document.getElementById("canvas-wrapper"),canvasRect=canvas.getBoundingClientRect(),ngCanvasRect=canvas.querySelector(".ng-canvas").getBoundingClientRect(),elPositionY=elRect.top+elRect.height/2,elPositionX=elRect.left+elRect.width/2,top=elPositionY-ngCanvasRect.top-canvasRect.height/2,left=elPositionX-ngCanvasRect.left-canvasRect.width/2;canvas.scrollTop=top,canvas.scrollLeft=left}}function selectAnnotation(event,annotation){event.preventDefault();var id=annotation.idElement;if(vm.selectedPreviously!==id&&Engine.setAnnotationSelection(vm.selectedPreviously,!1),isSelected(annotation))Engine.setAnnotationSelection(id,!1),vm.selectedAnnotation=null;else{var el=document.querySelector(".ng-canvas [data-id='"+id+"']");scrollToElement(el,CANVAS_OFFSET_TOP,!0),Engine.setAnnotationSelection(vm.selectedAnnotation,!1),Engine.setAnnotationSelection(id,!0),vm.selectedAnnotation=id,vm.selectedPreviously=id,AnalyticsService.kissEvent("Preview - Documentation - Documentation selected")}}var page,onChangePageOff,vm=this,TIMEOUT_DELAY=10,ANNOTATION_OFFSET_TOP=34,CANVAS_OFFSET_TOP=42,PIN_ID_PREFIX="doc-";vm.idPrefix=PIN_ID_PREFIX,vm.blockedHover=null,vm.hoveredElement=null,vm.selectedAnnotation=null,vm.selectedPreviously=null,vm.hasBlockedHover=hasBlockedHover,vm.isPinnedToElement=isPinnedToElement,vm.isSelected=isSelected,vm.isHovered=isHovered,vm.onMouseEnter=onMouseEnter,vm.onMouseLeave=onMouseLeave,vm.selectAnnotation=selectAnnotation,activate()}angular.module("documentation").directive("annotationsList",annotationsList),annotationsListCtrl.$inject=["$rootScope","$scope","$element","$window","$timeout","Engine","AnalyticsService"]}(),function(){"use strict";function blurData(){return{restrict:"E",scope:{blur:"="},templateUrl:"/scripts/modules/specification/directives/blurData/blurData.html",controller:blurDataCtrl,controllerAs:"vm",bindToController:!0}}function blurDataCtrl(){}angular.module("specification").directive("blurData",blurData),blurDataCtrl.$inject=[]}(),function(){"use strict";function borderData(){return{restrict:"E",scope:{border:"=",shouldShowBorder:"=",shouldShowBorderRadius:"=",isBorderRadiusSet:"="},templateUrl:"/scripts/modules/specification/directives/borderData/borderData.html",controller:borderDataCtrl,controllerAs:"vm",bindToController:!0}}function borderDataCtrl(_,$scope){}angular.module("specification").directive("borderData",borderData),borderDataCtrl.$inject=["_","$scope"]}(),function(){"use strict";function canvasData(){return{restrict:"E",scope:{width:"=",height:"=",left:"=",top:"=",name:"=",fixed:"=",type:"=",angle:"=",opacity:"="},templateUrl:"/scripts/modules/specification/directives/canvasData/canvasData.html",controller:canvasDataCtrl,controllerAs:"vm",bindToController:!0}}function canvasDataCtrl(_,BreakpointsService,SpecificationService){var vm=this;vm.SPEC_OBJECT_TYPES=ElementEnums.TYPE,vm.getSizeName=function(width,height){var data=_.find(BreakpointsService.breakpointsMap,function(breakpoint){return breakpoint.width===width&&breakpoint.height===height});return data?data.name:"Custom"}}angular.module("specification").directive("canvasData",canvasData),canvasDataCtrl.$inject=["_","BreakpointsService","SpecificationService"]}(),function(){"use strict";function colorsList(){return{restrict:"E",scope:{colors:"=",gradients:"=",canvasBg:"=",backgroundColor:"=?",readabilityLevel:"=?",type:"="},templateUrl:"/scripts/modules/specification/directives/colorsList/colorsList.html",controller:colorsListCtrl,controllerAs:"vm",bindToController:!0}}function colorsListCtrl(_,$scope,tinycolor,ntc,Color,SpecificationService,AnalyticsService){function activate(){$scope.$watch("vm.colors",function(colors){if(_.isArray(colors))return vm.isElement()?void(vm.elementColors=_.uniqWith(colors,function(a,b){return a.hex===b.hex&&a.alpha===b.alpha&&a.type===b.type})):void(vm.sortedColors=_.clone(colors).sort(function(a,b){return tinycolor(b.hex).getBrightness()-tinycolor(a.hex).getBrightness()}))})}var vm=this;vm.MODES=Color.COLOR_TYPES,vm.TYPES=ElementEnums.TYPE,vm.offsetColorType={bottom:{x:0,y:10}},vm.name=Color.name,vm.selectedMode=Color.getSelectedColorType(),vm.isRgbaMode=function(){return vm.selectedMode===vm.MODES.RGBA},vm.isHexMode=function(){return vm.selectedMode===vm.MODES.HEX},vm.setMode=function(event,mode){event.preventDefault(),mode!==vm.selectedMode&&AnalyticsService.kissEvent("Spec - Color format",{"Spec - Color format":vm.selectedMode}),vm.selectedMode=mode,Color.setSelectedColorType(mode)},vm.isReadable=Color.isReadable,vm.isBright=Color.isBright,vm.isElement=function(){return vm.type===vm.TYPES.ELEMENT},vm.isGroup=function(){return vm.type===vm.TYPES.GROUP},vm.getRgbaValues=function(color){return Color.getRgbaValues(color).join(", ")},vm.getClipboardText=function(color){return color.gradient?color.gradient:vm.isHexMode()?color.hex:color.rgba},activate()}angular.module("specification").directive("colorsList",colorsList),colorsListCtrl.$inject=["_","$scope","tinycolor","ntc","Color","SpecificationService","AnalyticsService"]}(),function(){"use strict";function contentData(){return{restrict:"E",scope:{valueTrimmed:"=",isTextList:"="},templateUrl:"/scripts/modules/specification/directives/contentData/contentData.html",controller:contentDataCtrl,controllerAs:"vm",bindToController:!0}}function contentDataCtrl($scope){var vm=this;vm.onClick=function(e){e.preventDefault()}}angular.module("specification").directive("contentData",contentData),contentDataCtrl.$inject=["$scope"]}(),function(){"use strict";function cssCode(){return{restrict:"E",scope:{value:"="},templateUrl:"/scripts/modules/specification/directives/cssCode/cssCode.html",controller:cssCodeCtrl,controllerAs:"vm",bindToController:!0}}function cssCodeCtrl($scope){var vm=this;vm.options={value:vm.value},vm.onClick=function(e){e.preventDefault()},$scope.$watch("vm.value",function(value){vm.options={value:value}})}angular.module("specification").directive("cssCode",cssCode),cssCodeCtrl.$inject=["$scope"]}(),function(){"use strict";function designSystem(){return{restrict:"E",scope:{documentation:"="},templateUrl:"/scripts/modules/specification/directives/designSystem/designSystem.html",controller:designSystemCtrl,controllerAs:"vm",bindToController:!0}}function designSystemCtrl($scope,UXPinService){var vm=this;$scope.$watch("vm.documentation",function(documentation){vm.documentation=documentation,vm.designSystemURL=vm.documentation.hasLibraryDesignSystem?UXPinService.getDesignSystemURL(vm.documentation.libraryHash):null})}angular.module("specification").directive("designSystem",designSystem),designSystemCtrl.$inject=["$scope","UXPinService"]}(),function(){"use strict";function documentationText(){return{restrict:"E",scope:{content:"@"},link:function(scope,el,attrs){attrs.$observe("content",function(newValue){var content,TextEditorComponent=uxpinSharedComponents.React.createFactory(uxpinSharedComponents.RichTextEditor);try{content=angular.fromJson(newValue)}catch(e){content=newValue}uxpinSharedComponents.ReactDOM.unmountComponentAtNode(el[0]),uxpinSharedComponents.ReactDOM.render(TextEditorComponent({value:content,readOnly:!0}),el[0])})}}}angular.module("specification").directive("documentationText",documentationText)}(),function(){"use strict";function fontsList(){return{restrict:"E",scope:{fonts:"=",type:"="},templateUrl:"/scripts/modules/specification/directives/fontsList/fontsList.html",controller:fontsListCtrl,controllerAs:"vm",bindToController:!0}}function fontsListCtrl(_,$scope,Font,UnitService){function activate(){$scope.$watch("vm.fonts",manageFonts),$scope.$watch(UnitService.loadMode,function(){return manageFonts(vm.fonts)})}function mapVariant(variantsMap,variant){return{name:Font.getVariantName(variant,variantsMap?variantsMap[variant]:null),shorthand:variant}}function mapFontSize(size){return vm.unit(parseFloat(size),!0)}function manageFonts(fonts){if(_.isArray(fonts)){var fontsArray=[];if(vm.isElement())return void(vm.elementFonts=_.uniqWith(fonts.map(function(font){return _.extend({},font,{variant:{name:Font.getVariantName(font.fontData.fvd,font.fontData.displayVariant),shorthand:font.fontData.fvd},letterSpacing:"normal"===font.letterSpacing?0:font.letterSpacing,textAlign:"start"===font.textAlign?"left":font.textAlign})}),function(a,b){return a=_.omit(a,["color","textContent"]),b=_.omit(b,["color","textContent"]),_.isEqual(a,b)}));_.forEach(fonts,function(font){fontsArray.push({fontFamily:font.fontFamily,fontData:font.fontData,fontName:font.fontName.replace(/['"]+/g,""),sizes:font.sizes.map(mapFontSize).sort(Font.getCompareFontSizeFn()),variants:font.variants.map(mapVariant.bind(null,font.displayVariants)).sort(Font.getCompareVariantsFn())})}),vm.getFontFamily=Font.getFontFamily,vm.sortedFonts=_.sortBy(fontsArray,"fontName")}}var vm=this;vm.unit=UnitService.convertPx,vm.TYPES={ELEMENT:"element"},vm.isElement=function(){return vm.type===vm.TYPES.ELEMENT},vm.isBold=Font.isBold,vm.isItalic=Font.isItalic,vm.hasUnderlineDecoration=Font.hasUnderlineDecoration,vm.hasLineThroughDecoration=Font.hasLineThroughDecoration,vm.getTransform=Font.getTransform,vm.FONT_TYPES=Font.FONT_TYPES,vm.areTextStylesSet=function(font){return vm.hasUnderlineDecoration(font)||vm.hasLineThroughDecoration(font)||vm.isItalic(font)||vm.isBold(font)},activate()}angular.module("specification").directive("fontsList",fontsList),fontsListCtrl.$inject=["_","$scope","Font","UnitService"]}(),function(){"use strict";function gradient(){return{restrict:"E",scope:{gradient:"=",mode:"=",skipCopyInfo:"=?"},templateUrl:"/scripts/modules/specification/directives/gradient/gradient.html",controller:gradientCtrl,controllerAs:"vm",bindToController:!0}}function gradientCtrl(_,$scope,Color,tinycolor,CssService){var vm=this;vm.MODES=Color.COLOR_TYPES,vm.isCopiedInfoVisible=[!1,0],vm.isRgbaMode=function(){return vm.mode===vm.MODES.RGBA},vm.isHexMode=function(){return vm.mode===vm.MODES.HEX},vm.name=Color.name,vm.getRgbaValues=function(color){return Color.getRgbaValues(color).join(",")},vm.isBright=Color.isBright,vm.extractGradientData=function(gradient){return CssService.extractGradientData(gradient)},vm.isAngleValid=function(angle){var number=parseInt(angle);return!_.isNaN(number)&&_.isNumber(number)},$scope.$watch("vm.mode",function(mode){vm.gradientData&&(vm.gradientCssStyle=CssService.getGradientCssStyle(mode,vm.gradientData))}),$scope.$watch("vm.gradient",function(gradient){gradient&&(vm.gradientData=vm.extractGradientData(gradient),vm.gradientCssStyle=CssService.getGradientCssStyle(vm.mode,vm.gradientData))})}angular.module("specification").directive("gradient",gradient),gradientCtrl.$inject=["_","$scope","Color","tinycolor","CssService"]}(),function(){"use strict";function gridData(){return{restrict:"E",scope:{grid:"="},templateUrl:"/scripts/modules/specification/directives/gridData/gridData.html",controller:gridDataCtrl,controllerAs:"vm",bindToController:!0}}function gridDataCtrl(_,$rootScope,Engine,ProjectsService,$state,AnalyticsService){function areGuidesAvailable(){return!_.isEmpty(ProjectsService.currentProjectSettings)&&ProjectsService.currentProjectSettings.guides&&ProjectsService.currentProjectSettings.guides[$state.params.pageId]}function setGuides(areGuidesVisible){areGuidesAvailable()&&(areGuidesVisible?Engine.setGuides(ProjectsService.currentProjectSettings.guides[$state.params.pageId]):Engine.resetGuides())}function setGridDisplay(isGridVisible){AnalyticsService.kissEvent("Spec - Show grid",{"Spec - Show grid":isGridVisible}),Engine.setGridDisplay(isGridVisible)}var vm=this;vm.areGuidesVisible=Engine.areGuidesVisible(),vm.isGridVisible=Engine.isGridVisible(),vm.setGridDisplay=setGridDisplay,vm.setGuides=setGuides,vm.areGuidesAvailable=areGuidesAvailable}angular.module("specification").directive("gridData",gridData),gridDataCtrl.$inject=["_","$rootScope","Engine","ProjectsService","$state","AnalyticsService"]}(),function(){"use strict";function headerCanvas(){return{restrict:"E",scope:{currentPageName:"=",lastUpdatedDate:"=",lastUpdatedDateTitle:"="},templateUrl:"/scripts/modules/specification/directives/headerCanvas/headerCanvas.html",controller:headerCanvasCtrl,controllerAs:"vm",bindToController:!0}}function headerCanvasCtrl(){}angular.module("specification").directive("headerCanvas",headerCanvas)}(),function(){"use strict";function headerDesignSystem(){return{restrict:"E",scope:{element:"=",documentation:"=",selectElement:"="},templateUrl:"/scripts/modules/specification/directives/headerDesignSystem/headerDesignSystem.html",controller:headerDesignSystemCtrl,controllerAs:"vm",bindToController:!0}}function headerDesignSystemCtrl(){}angular.module("specification").directive("headerDesignSystem",headerDesignSystem)}(),function(){"use strict";function headerElement(){return{restrict:"E",scope:{name:"=",class:"=",hasParent:"=",elementParent:"=",elementParentType:"=",elementParentTypeClass:"=",selectElement:"="},templateUrl:"/scripts/modules/specification/directives/headerElement/headerElement.html",controller:headerElementCtrl,controllerAs:"vm",bindToController:!0}}function headerElementCtrl(){}angular.module("specification").directive("headerElement",headerElement)}(),function(){"use strict";function headerGroup(){return{restrict:"E",scope:{name:"=",type:"=",class:"=",hasParent:"=",elementParent:"=",elementParentType:"=",elementParentTypeClass:"=",selectElement:"=",isMultistate:"=",selectedState:"=",changeState:"=",states:"="},templateUrl:"/scripts/modules/specification/directives/headerGroup/headerGroup.html",controller:headerGroupCtrl,controllerAs:"vm",bindToController:!0}}function headerGroupCtrl(){}angular.module("specification").directive("headerGroup",headerGroup)}(),function(){"use strict";function assetBackground(){return{restrict:"E",scope:{background:"="},templateUrl:"/scripts/modules/specification/directives/imagesList/assetBackground.html",controller:assetBackgroundCtrl,controllerAs:"vm",bindToController:!0}}function assetBackgroundCtrl(_,$scope,BackgroundService){function parseBackground(background){if(!_.isEmpty(background)&&!_.isEmpty(background.position)){var positionXY=background.position.split(" "),repeat=background.repeat,size=background.size,posX=positionXY[0],posY=positionXY[1];vm.position=_.isEqual(posX,posY)?posX:_.reverse(positionXY).join(" "),vm.positionClass=BackgroundService.getPositionClass(posX,posY),vm.behaviour=BackgroundService.getBehaviour(repeat,size)}}var vm=this;vm.position,vm.positionClass,vm.behaviour,$scope.$watch("vm.background",function(background){parseBackground(background)})}angular.module("specification").directive("assetBackground",assetBackground),assetBackgroundCtrl.$inject=["_","$scope","BackgroundService"]}(),function(){"use strict";function imageMeta(){return{restrict:"E",scope:{image:"=",withoutSize:"@?"},templateUrl:"/scripts/modules/specification/directives/imagesList/imageMeta.html",controller:imageMetaCtrl,controllerAs:"vm",bindToController:!0}}function imageMetaCtrl(_,$scope,$q,ImageService){function setMetadata(size,width,height){vm.isLoaded=!0,vm.imageMeta={size:Math.ceil(size/1024)+"kB",width:Math.round(width)+"px",height:Math.round(height)+"px"}}var vm=this,promises=[];vm.imageMeta={},vm.isLoaded=!1,"url"===vm.image.type?(promises.push(ImageService.getImageDimensions(vm.image.path)),vm.withoutSize||promises.push(ImageService.getImageSize(vm.image.path)),$q.all(promises).then(function(data){setMetadata(data[1]||0,data[0].width,data[0].height)})):"svg"===vm.image.type&&setMetadata(vm.image.size,vm.image.width,vm.image.height)}angular.module("specification").directive("imageMeta",imageMeta),imageMetaCtrl.$inject=["_","$scope","$q","ImageService"];
}(),function(){"use strict";function imagesList(){return{restrict:"E",scope:{images:"=",background:"="},templateUrl:"/scripts/modules/specification/directives/imagesList/imagesList.html",controller:imagesListCtrl,controllerAs:"vm",bindToController:!0}}function imagesListCtrl(_,$scope,AnalyticsService){function isForbidden(image){return forbiddenImages.some(function(forbiddenImage){return image.path.indexOf(forbiddenImage)!==-1})}var vm=this,forbiddenImages=["/p/imagepixel.png","/p/elements/video/"];vm.currentImage=null,vm.download=function(event,image){event.preventDefault(),vm.currentImage={timestamp:Date.now(),type:image.type,name:image.file.name+"."+image.file.extension,content:"svg"===image.type?image.rawSource:image.path},AnalyticsService.kissEvent("Spec - Download asset",{"Spec - Download asset":image.file.extensions})},$scope.$watch("vm.images",function(images){vm.imagesList=_.compact(_.map(images,function(image){if(!isForbidden(image))return image}))}),$scope.$watch("vm.background",function(background){vm.background=background})}angular.module("specification").directive("imagesList",imagesList),imagesListCtrl.$inject=["_","$scope","AnalyticsService"]}(),function(){"use strict";function inspector(inspectorService,_,$timeout,$rootScope,Engine,UnitService,ElementService){return{restrict:"E",scope:{},templateUrl:"/scripts/modules/specification/directives/inspector/inspector.html",link:function(scope,element){inspectorLink(scope,element,inspectorService,_,$timeout,$rootScope,Engine,UnitService,ElementService)}}}function inspectorLink(scope,element,inspectorService,_,$timeout,$rootScope,Engine,UnitService,ElementService){function init(){canvasWrapper=document.getElementById("canvas-wrapper"),canvasWrapper&&(angular.element(canvasWrapper).off("click",resetElementSelection),angular.element(canvasWrapper).on("click",resetElementSelection),canvasContainer=canvasWrapper.querySelector(".ng-canvas-container"),canvasContainerWidth=canvasContainer.getBoundingClientRect().width)}function resetElementSelection(e){Engine.isSpecMode()&&"canvas-wrapper"===e.target.id&&$rootScope.$emit(PreviewEnums.SPEC_MODE_RESET_ELEMENT_SELECTION)}function onScroll(e){var source;if(Engine.isSpecMode()&&canvasWrapper.contains(e.target)){if(source=inspectorService.getSource(),(!source||source&&!source.fixed)&&!canvasWrapper.contains(e.target))return;inspectorService.setSource(null),inspectorService.setTarget(null),scope.$apply(),$timeout.cancel(scrollTimeout),scrollTimeout=$timeout(function(){inspectorService.setSource(currentSource),inspectorService.setTarget(currentTarget)},100)}}function createLineElement(){var div=angular.element("<div></div>");return div}function createHelperLine(type,size,left,top){if(!parseInt(size))return null;var line=createLineElement();return line.addClass("distance-line-helper"),line.addClass(type),line.css({left:left,top:top}),type===inspectorService.LINE_TYPES.HORIZONTAL?line.css({width:size,height:"1px"})[0].outerHTML:line.css({height:size,width:"1px"})[0].outerHTML}function createDistanceLine(type,size,left,top,isSwitched){if(!parseInt(size))return null;var minCanvasOffset=30,line=createLineElement();return line.addClass("distance-line"),line.addClass(type),line.append('<span class="value code">'+UnitService.convertPx(parseInt(size)/scale)+"</span>"),line.css({left:left,top:top}),isSwitched&&line.addClass("switch-value"),parseInt(size)<15&&line.addClass("small-value-offset"),type===inspectorService.LINE_TYPES.HORIZONTAL?(decorateHorizontalLine(line,size,left,top,minCanvasOffset),line.css({width:size,height:"1px"})[0].outerHTML):(decorateVerticalLine(line,size,left,top,minCanvasOffset),line.css({height:size,width:"1px"})[0].outerHTML)}function decorateVerticalLine(line,size,left,top,minCanvasOffset){var switchLabelOffset=60;parseInt(size)<minCanvasOffset&&0===parseInt(top)?line.addClass("pull-down"):parseInt(size)<minCanvasOffset&&parseInt(top)>0&&line.addClass("pull-up"),canvasContainerWidth-parseInt(left)<switchLabelOffset&&line.addClass("pull-left")}function decorateHorizontalLine(line,size,left,top,minCanvasOffset){parseInt(size)<minCanvasOffset&&0===parseInt(left)?line.addClass("pull-right"):parseInt(size)<minCanvasOffset&&parseInt(left)>minCanvasOffset&&line.addClass("pull-left"),parseInt(top)<minCanvasOffset&&line.addClass("pull-down")}function clearLines(){linesContainer.html("")}function findPoint(point,line){return line.pointType===point}function shouldSwitchLines(data){var MIN_VERTICAL_LINE_SIZE=40,MIN_HORIZONTAL_LINE_SIZE=50,switched={},bottom=_.find(data,findPoint.bind(this,inspectorService.POINT_TYPES.BOTTOM)),top=_.find(data,findPoint.bind(this,inspectorService.POINT_TYPES.TOP)),left=_.find(data,findPoint.bind(this,inspectorService.POINT_TYPES.LEFT)),right=_.find(data,findPoint.bind(this,inspectorService.POINT_TYPES.RIGHT));return bottom&&parseInt(bottom.size)<MIN_VERTICAL_LINE_SIZE&&right&&parseInt(right.size)<MIN_HORIZONTAL_LINE_SIZE&&(switched[bottom.pointType]=!0),bottom&&left&&!switched[bottom.pointType]&&parseInt(bottom.size)<MIN_VERTICAL_LINE_SIZE&&parseInt(left.size)<MIN_HORIZONTAL_LINE_SIZE&&(switched[left.pointType]=!0),bottom&&right&&switched[bottom.pointType]&&parseInt(bottom.size)<MIN_VERTICAL_LINE_SIZE&&parseInt(right.size)<MIN_HORIZONTAL_LINE_SIZE&&(switched[right.pointType]=!0),right&&top&&!switched[right.pointType]&&parseInt(top.size)<MIN_VERTICAL_LINE_SIZE&&parseInt(right.size)<MIN_HORIZONTAL_LINE_SIZE&&(switched[top.pointType]=!0),switched}function drawLines(data){clearLines();var lines=[],switchedLines=shouldSwitchLines(data);_.forEach(data,function(line){lines.push(createDistanceLine(line.type,line.size,line.left,line.top,switchedLines[line.pointType])),line.helper&&lines.push(createHelperLine(line.helper.type,line.helper.size,line.helper.left,line.helper.top))}),linesContainer.html(_.compact(lines).join(""))}function drawBox(boundingRect,className){if(boundingRect.isCanvasBoundingRect)return null;var box=angular.element("<div></div>");return box.addClass(className),box.css({width:boundingRect.width+"px",height:boundingRect.height+"px",left:boundingRect.x+"px",top:boundingRect.y+"px"}),box}function getShiftData(el){var shiftData={};if(el)return el.fixed&&ElementService.canBeFixed(el)||ElementService.isAncestorFixed(el)?shiftData=getCanvasWrapperScrollPosition():el&&el.isCanvasBoundingRect||(shiftData=getScrollPosition(el.view.domElement)),shiftData}function getCanvasWrapperScrollPosition(){return canvasWrapper?{x:canvasWrapper.scrollLeft,y:canvasWrapper.scrollTop}:null}function mergeScrollPosition(oldScrollPosition,newScrollPosition){return _.mergeWith(oldScrollPosition,newScrollPosition,function(a,b){if(_.isNumber(a)&&_.isNumber(b))return a+b})}function getScrollPosition(el){var scrollPosition={x:0,y:0};return el&&el.parentNode?(scrollPosition=mergeScrollPosition(scrollPosition,{x:-el.parentNode.scrollLeft,y:-el.parentNode.scrollTop}),el.parentNode!==canvasContainer?mergeScrollPosition(scrollPosition,getScrollPosition(el.parentNode)):scrollPosition):scrollPosition}function getSourceBoundingRect(){var source=inspectorService.getSource();return inspectorService.getSourceBoundingRect(getShiftData(source))}function onSourceBoundingRectChange(){var boundingRect=getSourceBoundingRect();clearLines(),drawSelectedBox(boundingRect)}function drawHoveredBox(boundingRect,eventSource){var group,opacityClass="",layerHoveredClass="";hoveredBox&&hoveredBox.remove(),hoveredBoxAncestor&&(hoveredBoxAncestor.remove(),highlightedHoverdGroup=null),boundingRect&&(currentTarget=inspectorService.getTarget(),group=ElementService.getGroupAncestor(currentTarget),group&&highlightedSelectedGroup!==group?(drawAncesorHoveredBox(inspectorService.getElementBoundingRect(group,getShiftData(group))),highlightedHoverdGroup=group):ElementService.isGroup(currentTarget)&&(opacityClass="semi-transparent"),eventSource===inspectorService.EVENT_SOURCES.LAYERS&&(layerHoveredClass="layer-hovered"),hoveredBox=drawBox(boundingRect,"element-outline hovered "+opacityClass+" "+layerHoveredClass),boxesContainer.append(hoveredBox))}function drawAncesorHoveredBox(boundingRect){hoveredBoxAncestor=drawBox(boundingRect,"element-outline semi-transparent"),boxesContainer.append(hoveredBoxAncestor)}function drawAncestorSelectedBox(boundingRect){selectedBoxAncestor=drawBox(boundingRect,"element-outline semi-transparent"),boxesContainer.append(selectedBoxAncestor)}function drawSelectedBox(boundingRect){var group;selectedBox&&selectedBox.remove(),selectedBoxAncestor&&(selectedBoxAncestor.remove(),highlightedSelectedGroup=null),boundingRect&&(currentSource=inspectorService.getSource(),group=ElementService.getGroupAncestor(currentSource),group&&(drawAncestorSelectedBox(inspectorService.getElementBoundingRect(group,getShiftData(group))),highlightedSelectedGroup=group,highlightedHoverdGroup===highlightedSelectedGroup&&hoveredBoxAncestor&&(hoveredBoxAncestor.remove(),highlightedHoverdGroup=null)),selectedBox=drawBox(boundingRect,"element-outline selected"),boxesContainer.append(selectedBox))}function getTargetBoundingRect(){var target=inspectorService.getTarget();return inspectorService.getTargetBoundingRect(getShiftData(target))}function refreshSelection(){var target=inspectorService.getTarget(),source=inspectorService.getSource(),data=inspectorService.getLineAndHelpersData(getShiftData(source),getShiftData(target));scale=Engine.getScale(),data?(drawLines(data),drawSelectedBox(getSourceBoundingRect()),drawHoveredBox(getTargetBoundingRect())):clearLines()}function onTargetBoundingRectChange(event,eventSource){var boundingRect=getTargetBoundingRect(),target=inspectorService.getTarget(),source=inspectorService.getSource(),data=inspectorService.getLineAndHelpersData(getShiftData(source),getShiftData(target));data?drawLines(data):clearLines(),drawHoveredBox(boundingRect,eventSource)}var currentSource,currentTarget,hoveredBox,hoveredBoxAncestor,selectedBoxAncestor,selectedBox,highlightedSelectedGroup,highlightedHoverdGroup,scrollTimeout,canvasWrapper,canvasContainer,canvasContainerWidth,removeRefreshEventListener,removeZoomChangeEventListener,removePageLoadEventListener,removeSourceChangedEventListener,removeTargetChangedEventListener,linesContainer=angular.element(element[0].querySelector(".lines-container")),boxesContainer=angular.element(element[0].querySelector(".boxes-container")),scale=Engine.getScale();window.addEventListener("scroll",onScroll,!0),removeRefreshEventListener=$rootScope.$on(PreviewEnums.SPEC_MODE_REFRESH_ELEMENT_SELECTION,refreshSelection),removeZoomChangeEventListener=$rootScope.$on(PreviewEnums.ON_ZOOM_CHANGE,refreshSelection),removeSourceChangedEventListener=$rootScope.$on(PreviewEnums.INSPECTOR_SOURCE_CHANGED,onSourceBoundingRectChange),removeTargetChangedEventListener=$rootScope.$on(PreviewEnums.INSPECTOR_TARGET_CHANGED,onTargetBoundingRectChange),scope.$watch(UnitService.loadMode,refreshSelection),init(),removePageLoadEventListener=$rootScope.$on(PreviewEnums.ON_PAGE_LOADED,init),element.on("$destroy",function(){window.removeEventListener(onScroll),angular.element(canvasWrapper).off("click",resetElementSelection),removePageLoadEventListener(),removeRefreshEventListener(),removeZoomChangeEventListener(),removeTargetChangedEventListener(),removeSourceChangedEventListener()})}angular.module("specification").directive("inspector",inspector),inspector.$inject=["inspectorService","_","$timeout","$rootScope","Engine","UnitService","ElementService"]}(),function(){"use strict";function interactions(){return{restrict:"E",scope:{interactions:"="},templateUrl:"/scripts/modules/specification/directives/interactions/interactions.html",controller:interactionsCtrl,controllerAs:"vm",bindToController:!0}}function interactionsCtrl(){var vm=this;vm.areInteractionsAvailable=!1}angular.module("specification").directive("interactions",interactions)}(),function(){"use strict";function metadata(){return{restrict:"E",scope:{metadata:"="},templateUrl:"/scripts/modules/specification/directives/metadata/metadata.html",controller:metadataCtrl,controllerAs:"vm",bindToController:!0}}function metadataCtrl(_,CODE_EDITOR){var TYPES={LIST:"list",CODE:"code",TEXT:"text"},vm=this;vm.TYPES=TYPES,vm.findCodeOptionLabel=function(codeLang){var match=_.find(CODE_EDITOR.MODES_OPTIONS,function(option){return codeLang===option.value});return match?match.text:codeLang},vm.getSelectedOption=function(options,value){if(!_.isEmpty(options)){var selectedOption=_.find(options,function(option){return option.value===value})||options[0];return selectedOption.text}},vm.onClick=function(e){e.preventDefault()}}angular.module("specification").directive("metadata",metadata),metadataCtrl.$inject=["_","CODE_EDITOR"]}(),function(){"use strict";function shadowsList(){return{restrict:"E",scope:{shadows:"=",sectionLabel:"@"},templateUrl:"/scripts/modules/specification/directives/shadowsList/shadowsList.html",controller:shadowsListCtrl,controllerAs:"vm",bindToController:!0}}function shadowsListCtrl($scope,Color){var vm=this;vm.COLOR_TYPES=Color.COLOR_TYPES,vm.getRgbaValues=function(color){return Color.getRgbaValues(color).join(", ")},$scope.$watch(Color.getSelectedColorType,function(colorType){vm.colorType=colorType})}angular.module("specification").directive("shadowsList",shadowsList),shadowsListCtrl.$inject=["$scope","Color"]}(),function(){"use strict";function unitSwitcher(){return{restrict:"E",scope:{unitSwitcher:"="},templateUrl:"/scripts/modules/specification/directives/unitSwitcher/unitSwitcher.html",controller:unitSwitcherCtrl,controllerAs:"vm",bindToController:!0}}function unitSwitcherCtrl(UnitService){var vm=this;vm.offsetColorType={bottom:{x:0,y:10}},vm.UNIT_MODES=UnitService.UNIT_MODES,vm.activeMode=UnitService.getActiveMode(),vm.changeMode=function(e,mode){e.preventDefault(),UnitService.changeMode(mode),vm.activeMode=mode}}angular.module("specification").directive("unitSwitcher",unitSwitcher),unitSwitcherCtrl.$inject=["UnitService"]}(),function(){"use strict";function colorsGuideList(){return{restrict:"E",scope:{colors:"="},templateUrl:"/scripts/modules/styleguide/directives/colorsGuideList/colorsGuideList.html",controller:colorsGuideListCtrl,controllerAs:"vm",bindToController:!0}}function colorsGuideListCtrl(_,$scope,tinycolor,Color){function activate(){$scope.$watch("vm.colors",function(colors){_.isArray(colors)&&(vm.sortedColors=_.clone(colors).sort(function(a,b){return tinycolor(b.hex).getBrightness()-tinycolor(a.hex).getBrightness()}))})}function getBoxShadow(color){var shadowMono=tinycolor("black").setAlpha(.1),shadowColor=tinycolor(color).setAlpha(.3),shadow=Color.isWhite(color)?shadowMono:shadowColor;return"0 10px 30px "+shadow.toRgbString()}function getRgbValues(color){var rgba=Color.getRgbaValues(color),rgb=_.dropRight(rgba);return rgb.join(", ")}function getRgb(color){return tinycolor(color).toRgbString()}var vm=this;vm.sortedColors=[],vm.name=Color.name,vm.getBoxShadow=getBoxShadow,vm.getRgbValues=getRgbValues,vm.getRgb=getRgb,activate()}angular.module("styleguide").directive("colorsGuideList",colorsGuideList),colorsGuideListCtrl.$inject=["_","$scope","tinycolor","Color"]}(),function(){"use strict";function downloadFont(){return{restrict:"E",scope:{font:"="},templateUrl:"/scripts/modules/styleguide/directives/downloadFont/downloadFont.html",controller:downloadFontCtrl,controllerAs:"vm",bindToController:!0}}function downloadFontCtrl(Font,$window){function downloadCustomFont($event,font){$event.preventDefault(),vm.isFontDownloadError=!1,vm.isFontDownloading=!0,Font.downloadCustomFont(font.fontName,_.map(font.variants,"shorthand")).then(function(data){data&&!data.isDownloading&&data.url&&($window.location.href=data.url,vm.isFontDownloading=!1)}).catch(function(){vm.isFontDownloadError=!0,vm.isFontDownloading=!1})}var vm=this;vm.isFontDownloadError=!1,vm.isFontDownloading=!1,vm.isGoogleFont=Font.isGoogleFont,vm.isCustomFont=Font.isCustomFont,vm.isTypekitFont=Font.isTypekitFont,vm.getGoogleFontLink=Font.getGoogleFontLink,vm.getTypekitFontLink=Font.getTypekitFontLink,vm.downloadCustomFont=downloadCustomFont}angular.module("styleguide").directive("downloadFont",downloadFont),downloadFontCtrl.$inject=["Font","$window"]}(),function(){"use strict";function downloadImages(){return{restrict:"E",scope:{images:"=",projectName:"="},templateUrl:"/scripts/modules/styleguide/directives/downloadImages/downloadImages.html",controller:downloadImagesCtrl,controllerAs:"vm",bindToController:!0}}function downloadImagesCtrl(_,ImageService,$window,AnalyticsService){function downloadImages($event){$event.preventDefault(),vm.isImagesDownloadError=!1,vm.isImagesDownloading=!0;var images=vm.images.map(function(image){return{type:image.type,name:image.name+"."+("svg"===image.type?image.type:image.extension),content:"svg"===image.type?image.rawSource:image.path}});ImageService.downloadImages(vm.projectName,images).then(function(data){data&&!data.isDownloading&&data.url&&(AnalyticsService.kissEvent("Spec - Download all assets"),$window.location.href=data.url,vm.isImagesDownloading=!1)}).catch(function(){vm.isImagesDownloadError=!0,vm.isImagesDownloading=!1})}var vm=this;vm.isImagesDownloadError=!1,vm.isImagesDownloading=!1,vm.downloadImages=downloadImages}angular.module("styleguide").directive("downloadImages",downloadImages),downloadImagesCtrl.$inject=["_","ImageService","$window","AnalyticsService"]}(),function(){"use strict";function fontsGuideList(){return{restrict:"E",scope:{fonts:"="},templateUrl:"/scripts/modules/styleguide/directives/fontsGuideList/fontsGuideList.html",controller:fontsGuideListCtrl,controllerAs:"vm",bindToController:!0}}function fontsGuideListCtrl($scope,Font){function mapVariant(variantsMap,variant){return{name:Font.getVariantName(variant,variantsMap?variantsMap[variant]:null),shorthand:variant}}function updateFontsList(fonts){if(_.isArray(fonts)){var fontsArray=[];_.forEach(fonts,function(font){fontsArray.push({fontFamily:font.fontFamily,fontData:font.fontData,fontName:font.fontName.replace(/['"]+/g,""),variants:font.variants.map(mapVariant.bind(null,font.displayVariants)).sort(Font.getCompareVariantsFn())})}),vm.sortedFonts=_.sortBy(fontsArray,"fontName")}}var vm=this;vm.getFontFamily=Font.getFontFamily,vm.sortedFonts=[],$scope.$watch(function(){return vm.fonts},updateFontsList)}angular.module("styleguide").directive("fontsGuideList",fontsGuideList),fontsGuideListCtrl.$inject=["$scope","Font"]}(),function(){"use strict";function imagesGuideList(){return{restrict:"E",scope:{images:"=",svgs:"=",projectName:"="},templateUrl:"/scripts/modules/styleguide/directives/imagesGuideList/imagesGuideList.html",controller:imagesGuideListCtrl,controllerAs:"vm",bindToController:!0}}function imagesGuideListCtrl($scope,_,SvgService,FileService){function manageImages(data){var uniqueSvgs=_.uniqWith(data.svgs,compareSvgs)||[],uniqueImages=_.uniq(data.images)||[],mappedImages=_.map(uniqueImages,transformImage)||[],filteredImages=_.filter(mappedImages,removeEmptyName)||[];nameCounter={},vm.allImages=_.sortBy(_.concat(_.map(uniqueSvgs,transformSvg),filteredImages),sortByName)}function sortByName(image){return image.name.toLowerCase()}function removeEmptyName(image){return!!image.name}function transformImage(image){return _.extend({},FileService.getFilename(image),{type:"url",path:image})}function transformSvg(svg){var svgData=SvgService.getSvgImage(svg);return _.isUndefined(nameCounter[svg.name])?nameCounter[svg.name]=0:svg.name+="-"+ ++nameCounter[svg.name],{previewImage:svgData.previewImage,path:svgData.image,rawSource:svgData.rawSource,type:"svg",name:svg.name,width:svg.width,height:svg.height}}function compareSvgs(prev,next){var prevSvg=angular.element("<svg>").html(prev.view.domElement.innerHTML).find("path"),nextSvg=angular.element("<svg>").html(next.view.domElement.innerHTML).find("path");if(prevSvg[0]&&nextSvg[0])return prevSvg[0].outerHTML===nextSvg[0].outerHTML;var colorsMatch=!0;return prev.color&&next.color&&(colorsMatch=prev.color.toLowerCase()===next.color.toLowerCase()),prev.view.domElement.innerHTML===next.view.domElement.innerHTML&&colorsMatch}var vm=this,nameCounter={};vm.currentImage=null,vm.setCurrentImage=function(event,image){event.preventDefault(),vm.currentImage={timestamp:Date.now(),type:image.type,name:image.name+"."+("svg"===image.type?image.type:image.extension),content:"svg"===image.type?image.rawSource:image.path}},$scope.$watchCollection(function(){return{svgs:vm.svgs,images:vm.images}},manageImages)}angular.module("styleguide").directive("imagesGuideList",imagesGuideList),imagesGuideListCtrl.$inject=["$scope","_","SvgService","FileService"]}(),function(){"use strict";function pageLoader(PagesService,Engine,_,$rootScope){return{restrict:"E",scope:{pagesIds:"="},templateUrl:"/scripts/modules/styleguide/directives/pageLoader/pageLoader.html",link:function(scope,element){this.PagesService=PagesService,this.Engine=Engine,this._=_,this.$rootScope=$rootScope,pageLoaderLink.apply(this,arguments)}}}function pageLoaderLink(scope,element){function removeParams(image){return image.split("?")[0]}var specProperties,lastUpdates,loadPagesData=function(pagesData){var i=0;specProperties=[],lastUpdates=[],loadPageData(pagesData,i)},loadPageData=function(pagesData,i){this.Engine.loadPageInContainer(element[0],pagesData[i]).then(onLoad.bind(this,pagesData,i))}.bind(this),onPagesIdsChange=function(pagesIds){pagesIds&&pagesIds.length&&(this.$rootScope.$emit(PreviewEnums.ON_STYLEGUIDE_DATA_LOAD_STARTED),this.PagesService.getAllPagesData(pagesIds).then(loadPagesData))}.bind(this),onLoad=function(pagesData,i,canvas){lastUpdates.push(pagesData[i].last_update),specProperties.push(canvas.getSpecProperties()),i++,i<pagesData.length?loadPageData(pagesData,i):(this.$rootScope.$emit(PreviewEnums.ON_STYLEGUIDE_DATA_LOAD_FINISHED,_.extend({},getStyleGuideData(specProperties),{lastUpdates:lastUpdates})),element.empty())},getStyleGuideData=function(specProperties){return specProperties.reduce(function(prevValue,currentValue){var data={};return data.colors=mergeColors(prevValue,currentValue),data.images=mergeImages(prevValue,currentValue),data.svgs=mergeSvgs(prevValue,currentValue),data.fonts=mergeFonts(prevValue,currentValue),data}.bind(this),{})}.bind(this),mergeColors=function(prevValue,currentValue){return this._.uniqBy(this._.compact(this._.concat(prevValue.colors,currentValue.colors,prevValue.backgroundColor)),function(color){return color.hex})}.bind(this),mergeImages=function(prevValue,currentValue){var prevImages=this._.map(prevValue.images,removeParams),currentImages=this._.map(currentValue.images,removeParams);return this._.uniqWith(this._.compact(this._.concat(prevImages,currentImages)),function(prev,next){return prev===next})}.bind(this),mergeSvgs=function(prevValue,currentValue){return this._.compact(this._.concat(prevValue.svgs,currentValue.svgs))}.bind(this),mergeFonts=function(prevValue,currentValue){return this._.merge({},prevValue.fonts,currentValue.fonts,function(a,b){if(this._.isArray(a))return this._.union(a.concat(b))}.bind(this))}.bind(this);element.css("display","none"),scope.$watchCollection(function(){return scope.pagesIds},onPagesIdsChange)}angular.module("styleguide").directive("pageLoader",pageLoader),pageLoader.$inject=["PagesService","Engine","_","$rootScope"]}(),function(){"use strict";function actions(){return{restrict:"E",scope:{},templateUrl:"/scripts/modules/core/directives/topBar/actions/actions.html",controller:ActionsCtrl,controllerAs:"vm",bindToController:!0}}function ActionsCtrl(_,$scope,$state,$modal,UsersService,ProjectsService,ExportService,UXPinService,PreviewNavigation){function onCloudOpen(){vm.isOpen=!0}function onCloudClose(){vm.isOpen=!1}function onClickUsabilityTestSession(event){event.preventDefault(),$state.go("home.page.usability-test",{step:1})}function onConfigureLiveShareSession($event){PreviewNavigation.setActiveMode(PreviewNavigation.PREVIEW_MODES.SIMULATE),$event.preventDefault(),$modal.open({templateUrl:"/scripts/modules/core/views/liveShare/configuration.view.html",controller:"LiveShareConfigurationController"})}var vm=this;vm.hideUsabilityTestingInfo=!0,vm.onClickUsabilityTestSession=onClickUsabilityTestSession,vm.onConfigureLiveShareSession=onConfigureLiveShareSession,vm.isOpen=!1,vm.onCloudOpen=onCloudOpen,vm.hasAccessToEditor=UsersService.hasAccessToEditor,vm.onCloudClose=onCloudClose,vm.isOriginalProject=ProjectsService.isOriginalProject(),vm.params={isDocument:ProjectsService.isDocument(),isUXTestDocument:ProjectsService.isUXTestDocument(),isOwner:UsersService.me.is_owner,features:ExportService.isExport()?{}:ProjectsService.currentProjectFeatures,logOutUrl:UXPinService.getLogOutURL(),upgradePlanURL:ApplicationConfiguration.upgradePlanURL},UsersService.me.is_owner?(vm.params.currentDocumentURL=UXPinService.getCurrentDocumentURL(),vm.params.dashboardURL=UXPinService.getCurrentCollectionURL()):(vm.params.currentDocumentURL=null,vm.params.dashboardURL=UXPinService.getDashboardURL()),vm.offset={bottomRight:{x:0,y:10}},vm.upgradePlanTest=function(event){event.preventDefault(),$modal.open({templateUrl:"/scripts/modules/core/views/planUpgrade/modalUpgrade.view.html",controller:"PlanUpgradeController",windowClass:"iframe-modal-box upgrade-plan-modal-box"})},vm.upgradePlan=function(event){event.preventDefault(),$modal.open({templateUrl:"/scripts/modules/core/views/planUpgrade/modal.view.html",controller:"PlanUpgradeController"})},vm.isOwner=function(){return vm.params.isOwner},vm.isWireframe=function(){return!vm.params.isDocument},vm.canShowUsabilityTesting=function(){return vm.params.features.user_testing},vm.canShowLivePresentation=function(){return vm.params.features.live_share}}angular.module("core").directive("actions",actions),ActionsCtrl.$inject=["_","$scope","$state","$modal","UsersService","ProjectsService","ExportService","UXPinService","PreviewNavigation"]}(),function(){"use strict";function filter(){return{restrict:"E",scope:{togglePanel:"=",isPanelVisible:"="},templateUrl:"/scripts/modules/core/directives/topBar/filter/filter.html",controller:filterCtrl,controllerAs:"vm",bindToController:!0}}function filterCtrl(_,$rootScope,PreviewNavigation,CommentsFilterSettings,COMMENTS_FILTER,UsersService){function setClassNames(){var typeFilters=CommentsFilterSettings.getTypeFilters(),typeClassArray=(CommentsFilterSettings.getAssignmentFilter(),[]);vm.label=LABEL.NONE,vm.assignmentClass="",vm.typeClass="";for(var i=0;i<typeFilters.length;i++)switch(typeFilters[i]){case COMMENTS_FILTER.TYPE_VALUES.PUBLIC_COMMENTS:typeClassArray.push(CLASS_NAMES.PUBLIC);break;case COMMENTS_FILTER.TYPE_VALUES.TEAM_COMMENTS:typeClassArray.push(CLASS_NAMES.TEAM)}typeClassArray.length===_.size(COMMENTS_FILTER.TYPE_VALUES)?(vm.label=LABEL.ALL,vm.isAnonymous||(vm.typeClass=CLASS_NAMES.ALL)):typeClassArray.length&&(vm.label=LABEL.FILTERED,vm.typeClass=typeClassArray.join(" ")),CommentsFilterSettings.isAssignmentFilterDisabled()||(vm.assignmentClass=CLASS_NAMES.ASSIGN)}var vm=this;vm.isAnonymous=UsersService.isAnonymous();var CLASS_NAMES={PUBLIC:"comment-public",TEAM:"comment-team",ALL:"comment-all",ASSIGN:"with-assign"},LABEL={FILTERED:"Filtered",ALL:"All",NONE:"None"};vm.PREVIEW_PANELS=PreviewNavigation.PREVIEW_PANELS,$rootScope.$on(PreviewEnums.ON_COMMENTS_FILTER_CHANGE,setClassNames),setClassNames()}angular.module("core").directive("filter",filter),filterCtrl.$inject=["_","$rootScope","PreviewNavigation","CommentsFilterSettings","COMMENTS_FILTER","UsersService"]}(),function(){"use strict";function liveShare(){return{restrict:"E",scope:{isHostSession:"=",isLiveShareSession:"=",isUserTestingSession:"="},templateUrl:"/scripts/modules/core/directives/topBar/liveShare/liveShare.html",controller:liveShareCtrl,controllerAs:"vm",bindToController:!0}}function liveShareCtrl(_,$scope,$rootScope,$state,$timeout,LiveSessionInstanceService){function updateCollaboratorsList(inScope){inScope?vm.collaborators=LiveSessionInstance.getCollaboratorsData():$scope.$apply(function(){vm.collaborators=LiveSessionInstance.getCollaboratorsData()})}function onCloudOpen(){vm.isOpen=!0}function onCloudClose(){vm.isOpen=!1}function shouldUploadVideo(){return vm.isHostSession&&vm.isUserTestingMode&&LiveSessionInstance.hasVideoData()}var vm=this,LiveSessionInstance=LiveSessionInstanceService.get();vm.isHostSession=LiveSessionInstance.isHostSession(),vm.settingsPanelVisibilityModel=!1,vm.muted=!1,vm.inviteURL=LiveSessionInstance.getInviteURL(),vm.collaborators=LiveSessionInstance.getCollaboratorsData(),vm.isUserTestingMode=LiveSessionInstance.getType()===LiveShare.enums.SESSION_TYPES.TESTING,vm.host=null,vm.onCloudOpen=onCloudOpen,vm.onCloudClose=onCloudClose,vm.toggleMute=function(event){event.preventDefault(),vm.muted=LiveSessionInstance.muted=!LiveSessionInstance.muted,LiveSessionInstance.mute(vm.muted),updateCollaboratorsList(!0)},vm.removeUser=function(userID){LiveSessionInstance.removeCollaborator(userID)},vm.getCollaboratorAvatar=function(collaborator){return collaborator.customData.avatar?collaborator.customData.avatar:"/img/transparent.png"},LiveSessionInstance.getConfigurationOptions().then(function(options){vm.configuration=options}),vm.setOption=function(option){LiveSessionInstance.setOption(option.param,option.value)},vm.inputFocus=function(event){event.target.select()},vm.onCopySuccess=function(){var HIDE_COPY_MESSAGE_AFTER=1e3;vm.isCopied=!0,$timeout(function(){vm.isCopied=!1},HIDE_COPY_MESSAGE_AFTER)},vm.isHostSession||(vm.host=LiveSessionInstance.getHostData(),LiveSessionInstance.registerObserverCallback("followCursorOff",function(){$scope.$apply(function(){vm.host=LiveSessionInstance.getHostData()})})),vm.onClickFollowHost=function(event){event.preventDefault(),vm.host.isFollowed=!0,LiveSessionInstance.followCursor(vm.host.id)},LiveSessionInstance.registerObserverCallback("mute",updateCollaboratorsList.bind(this,!1)),LiveSessionInstance.registerObserverCallback("collaboratorJoin",updateCollaboratorsList.bind(this,!1)),LiveSessionInstance.registerObserverCallback("collaboratorLeft",updateCollaboratorsList.bind(this,!1)),LiveSessionInstance.registerObserverCallback("finish",function(data){var stateName=shouldUploadVideo()?"home.page.usability-test-video-upload":"home.page.live-share-finish";vm.collaborators=[],$state.go(stateName,data),$rootScope.$emit(PreviewEnums.MEDIA_ACCESS,PreviewEnums.MEDIA_ACCESS_TYPE.HIDE)})}angular.module("core").directive("liveShare",liveShare),liveShareCtrl.$inject=["_","$scope","$rootScope","$state","$timeout","LiveSessionInstanceService"]}(),angular.module("core").directive("zenMode",["$rootScope","appStateManager",function($rootScope,appStateManager){"use strict";return{restrict:"A",link:function(scope,elem,attrs){function toggleZenMode(e){e.preventDefault();var isFullScreen=isZenMode();isFullScreen?document.body.classList.remove(ZEN_MODE_CLASS):document.body.classList.add(ZEN_MODE_CLASS),appStateManager.saveState({isZenMode:!isFullScreen}),$rootScope.$emit(PreviewEnums.ON_CHANGE_ZEN_MODE,!isFullScreen)}var ZEN_MODE_CLASS="zen-mode",isZenMode=function(){return document.body.classList.contains(ZEN_MODE_CLASS)},state=appStateManager.getCurrentState();state.isZenMode&&document.body.classList.add(ZEN_MODE_CLASS),elem.on("click",toggleZenMode)}}}]);
//# sourceMappingURL=maps/app.js.map
